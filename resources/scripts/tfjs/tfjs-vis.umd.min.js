/*! For license information please see tfjs-vis.umd.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tfvis=e():t.tfvis=e()}(self,(function(){return(()=>{var t={9305:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9674),i=n(6113);class o extends r.Component{componentDidMount(){const{name:t,tab:e}=this.props;this.props.registerSurface(t,e,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:e,styles:n}=this.props,a=Object.assign({},o.defaultStyles,n),{width:s,height:u}=a;let{maxHeight:l,maxWidth:c}=a;l=u===o.defaultStyles.height?l:u,c=s===o.defaultStyles.width?c:s;const f=i.css({display:e?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:u,width:s,maxHeight:l,maxWidth:c,overflow:"auto"}),h=i.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),d=i.css({boxSizing:"border-box"});return r.h("div",{className:`${f} tf-surface`,ref:t=>this.container=t,"data-visible":e},r.h("div",{className:`${h} tf-label`,ref:t=>this.label=t},t),r.h("div",{className:`${d} tf-draw-area`,ref:t=>this.drawArea=t}))}}o.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"},e.SurfaceComponent=o},7651:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9674),i=n(6113);class o extends r.Component{render(){const{tabNames:t,activeTab:e,handleClick:n}=this.props,o=t.length>0?t.map((t=>r.h(a,{key:t,id:t,handleClick:n,isActive:t===e},t))):null,s=i.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return r.h("div",{className:`${s} visor-tabs`},o)}}e.Tabs=o;class a extends r.Component{render(){const{children:t,isActive:e,handleClick:n,id:o}=this.props,a=i.css({borderBottomColor:e?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return r.h("a",{className:`${a} tf-tab`,"data-isactive":e,onClick:()=>n(o)},t)}}},619:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(9674),i=n(6113),o=n(9305),a=n(7651);class s extends r.Component{static render(t,e,n){return r.render(r.h(s,Object.assign({},n)),t,e)}constructor(t){super(t),this.surfaces=new Map;const e=null==t.startOpen||t.startOpen;this.state={isOpen:e,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,e){const n=this.surfaceId(t,e);let r;if(!this.surfaces.has(n))throw Error(`Surface not found with id: ${n}`);return r=this.surfaces.get(n),{container:r.container,label:r.label,drawArea:r.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,e){return t+e}setTabs(t){const e=t.map((t=>t.tab)),n=this.state.tabs;let r;for(const t of e)n.has(t)||(n.add(t),r=t);null!=r&&this.setState({tabs:n,activeTab:r})}getTabs(){return this.state.tabs}registerSurface(t,e,n){const r=this.surfaceId(t,e);this.surfaces.set(r,n)}keyHandler(t){192===t.keyCode&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:e,activeTab:n}=this.state,{surfaceList:s}=this.props,l=Array.from(this.getTabs().values()),c=e?"90vw":"550px",f=i.css({width:c,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),h=i.css({right:"0"}),d=i.css({right:`calc(-${c} - 10px)`}),p=t?h:d,g=i.css({});return r.h("div",{className:`${f} ${p} visor`,"data-isopen":t,"data-isfullscreen":e},r.h(u,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:e}),r.h(a.Tabs,{tabNames:l,activeTab:n,handleClick:this.setActiveTab.bind(this)}),r.h("div",{className:`${g} visor-surfaces`},s.map((t=>r.h(o.SurfaceComponent,{key:t.name+t.tab,name:t.name,tab:t.tab,styles:t.styles,registerSurface:this.registerSurface.bind(this),visible:n===t.tab})))))}}function u(t){const{isFullScreen:e,fullScreenHandler:n,closeHandler:o}=t,a=i.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=i.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),u=i.css({marginLeft:"auto"});return r.h("div",{className:`${a} visor-controls`},r.h("button",{className:`${s}`,onClick:n},e?"Minimize":"Maximize"),r.h("button",{className:`${s} ${u}`,onClick:o},"Hide"))}e.VisorComponent=s},5590:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(8903),n(7998);const r=n(9240),i=n(5005),o=n(928),a=n(2007),s=n(7275),u=n(6200),l=n(8296),c=n(345),f=n(1753),h=n(7194),d=n(2194),p=n(3209),g=n(14);e.version_vis=g.version;const m={barchart:r.barchart,table:l.table,histogram:a.histogram,linechart:s.linechart,scatterplot:u.scatterplot,confusionMatrix:i.confusionMatrix,heatmap:o.heatmap};e.render=m;const y={accuracy:p.accuracy,perClassAccuracy:p.perClassAccuracy,confusionMatrix:p.confusionMatrix};e.metrics=y;const v={history:c.history,fitCallbacks:c.fitCallbacks,perClassAccuracy:h.perClassAccuracy,valuesDistribution:d.valuesDistribution,layer:f.layer,modelSummary:f.modelSummary};e.show=v;var b=n(1811);e.visor=b.visor,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(985))},9240:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(4624)),a=n(9117),s=n(1295);e.barchart=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=s.getDrawArea(t),i=e,c=Object.assign({},u,n);if(l.has(r)){const t=l.get(r);if(s.shallowEquals(c,t.lastOptions)){yield s.nextFrame();const e=t.view,n=e.changeset().remove((()=>!0)).insert(i);return void(yield e.change("values",n).runAsync())}}const{xLabel:f,yLabel:h,xType:d,yType:p}=c;let g=null;null!=f&&(g={title:f});let m,y=null;null!=h&&(y={title:h}),m=null!=c.color?Array.isArray(c.color)?{field:"index",type:"nominal",scale:{range:c.color}}:{value:c.color}:{value:"#4C78A0"};const v={width:c.width||a.getDefaultWidth(r),height:c.height||a.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:c.fontSize,titleFontSize:c.fontSize},text:{fontSize:c.fontSize},legend:{labelFontSize:c.fontSize,titleFontSize:c.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:d,axis:g},y:{field:"value",type:p,axis:y},color:m}};yield s.nextFrame();const b=yield o.default(r,v,{actions:!1,mode:"vega-lite",defaultStyle:!1});l.set(r,{view:b.view,lastOptions:c})}))};const u={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},l=new Map},5005:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(4624)),a=n(9117),s=n(1295);e.confusionMatrix=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=Object.assign({},u,n),i=s.getDrawArea(t),l=[],c=e.values,f=e.tickLabels||[],h=0===f.length;let d=!0;for(let t=0;t<c.length;t++){const e=h?`Class ${t}`:f[t];h&&f.push(e);for(let n=0;n<c[t].length;n++){const i=h?`Class ${n}`:f[n],o=c[t][n];t!==n||r.shadeDiagonal?(l.push({label:e,prediction:i,count:o,scaleCount:o}),0!==o&&(d=!1)):l.push({label:e,prediction:i,count:o,noFill:!0})}}if(!r.shadeDiagonal&&d)for(const t of l)!0===t.noFill&&(t.noFill=!1,t.scaleCount=t.count);const p={width:r.width||a.getDefaultWidth(i),height:r.height||a.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:l},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:f}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:f}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};!1===r.shadeDiagonal&&p.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&p.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const g="string"==typeof r.colorMap?{scheme:r.colorMap}:r.colorMap;p.layer[0].encoding.color.scale.range=g,yield o.default(i,p,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))};const u={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]}},928:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(n(8903)),s=o(n(4624)),u=n(9117),l=n(5807),c=n(1295);function f(t,e,n){const r=t instanceof a.Tensor?t.shape:[t.length,t[0].length];0===n?l.assert(r[0]===e.length,`Length of xTickLabels (${e.length}) must match number of rows (${r[0]})`):1===n&&l.assert(r[1]===e.length,`Length of yTickLabels (${e.length}) must match number of columns (${r[1]})`)}e.heatmap=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const i=Object.assign({},h,n),o=c.getDrawArea(t);let d=e.values;i.rowMajor&&(d=yield function(t){return r(this,void 0,void 0,(function*(){let e,n;t instanceof a.Tensor?(e=t.shape,n=t.transpose()):(e=[t.length,t[0].length],n=a.tidy((()=>a.tensor2d(t).transpose()))),l.assert(2===n.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return l.assert(e[0]===i[1]&&e[1]===i[0],`Unexpected transposed shape. Original ${e} : Transposed ${i}`),r}))}(e.values));const{xTickLabels:p,yTickLabels:g}=e;null!=p&&f(d,p,0),null!=g&&f(d,g,1);const m=[];if(d instanceof a.Tensor){l.assert(2===d.rank,"Input to renderHeatmap must be a 2d array or Tensor2d");const t=yield d.data(),[e,n]=d.shape;for(let r=0;r<e;r++){const e=p?`${p[r]}@tfidx@${r}`:r;for(let i=0;i<n;i++){const o=g?`${g[i]}@tfidx@${i}`:i,a=t[r*n+i];m.push({x:e,y:o,value:a})}}}else{const t=d;for(let e=0;e<t.length;e++){const n=p?`${p[e]}@tfidx@${e}`:e;for(let r=0;r<t[e].length;r++){const i=g?`${g[r]}@tfidx@${r}`:r,o=t[e][r];m.push({x:n,y:i,value:o})}}}const y={actions:!1,mode:"vega-lite",defaultStyle:!1},v={width:i.width||u.getDefaultWidth(o),height:i.height||u.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:m},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:i.xType,title:i.xLabel,sort:!1},y:{field:"y",type:i.yType,title:i.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},b=new RegExp("@tfidx@\\d+$");let x;switch(p&&(v.encoding.x.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),g&&(v.encoding.y.axis={labelExpr:"replace(datum.value, regexp(/@tfidx@\\d+$/), '')"}),(p||g)&&(y.tooltip={sanitize:t=>String(t).replace(b,"")}),i.colorMap){case"blues":x=["#f7fbff","#4292c6"];break;case"greyscale":x=["#000000","#ffffff"];break;case"viridis":default:x="viridis"}if("viridis"!==x&&(v.encoding.fill.scale={range:x}),i.domain){const t=v.encoding.fill;null!=t.scale?t.scale=Object.assign({},t.scale,{domain:i.domain}):t.scale={domain:i.domain}}yield s.default(o,v,y)}))};const h={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1}},2007:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(6722),a=i(n(4624)),s=n(9117),u=n(3209),l=n(8296),c={maxBins:12,fontSize:11};e.histogram=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=function(t){if(null==t.length)throw new Error("input data must be an array");if(0===t.length)return[];if("object"==typeof t[0]){if(null==t[0].value)throw new Error("input data must have a value field");return t}{const e=Array(t.length);for(let n=0;n<t.length;n++)e[n]={value:t[n]};return e}}(e),i=Object.assign({},c,n),f=s.subSurface(t,"histogram");if(!1!==n.stats){const e=s.subSurface(t,"stats",{prepend:!0});let a;a=n.stats?n.stats:u.arrayStats(r.map((t=>t.value))),function(t,e,n){const r=o.format(",.4~f"),i=o.format(".4~p"),a=[],s=[];if(null!=t.numVals&&(a.push("Num Vals"),s.push(r(t.numVals))),null!=t.min&&(a.push("Min"),s.push(r(t.min))),null!=t.max&&(a.push("Max"),s.push(r(t.max))),null!=t.numZeros){a.push("# Zeros");let e="";t.numVals&&(e=t.numZeros>0?`(${i(t.numZeros/t.numVals)})`:""),s.push(`${r(t.numZeros)} ${e}`)}if(null!=t.numNans){a.push("# NaNs");let e="";t.numVals&&(e=t.numNans>0?`(${i(t.numNans/t.numVals)})`:""),s.push(`${r(t.numNans)} ${e}`)}if(null!=t.numInfs){a.push("# Infinity");let e="";t.numVals&&(e=t.numInfs>0?`(${i(t.numInfs/t.numVals)})`:""),s.push(`${r(t.numInfs)} ${e}`)}l.table(e,{headers:a,values:[s]},n)}(a,e,{fontSize:i.fontSize})}if(0===r.length)return;const h=[];for(let t=0;t<r.length;t++){const e=r[t].value;null!=e&&isFinite(e)&&h.push(r[t])}const d={width:i.width||s.getDefaultWidth(f),height:i.height||s.getDefaultHeight(f),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:h},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return a.default(f,d,{actions:!1,mode:"vega-lite",defaultStyle:!1})}))}},7275:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(4624)),a=n(9117),s=n(5807),u=n(1295);e.linechart=function(t,e,n={}){return r(this,void 0,void 0,(function*(){const r=Array.isArray(e.values[0])?e.values:[e.values],i=r[0].length,c=e.series?e.series:r.map(((t,e)=>`Series ${e+1}`));s.assert(c.length===r.length,"Must have an equal number of series labels as there are data series"),null!=n.seriesColors&&s.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const f=[];for(let t=0;t<i;t++){const e={x:t};c.forEach(((n,i)=>{const o=r[i][t].y;e[n]=o,e[`${n}-name`]=n})),f.push(e)}const h=Object.assign({},l,n),d={x:{field:"x",type:h.xType,title:h.xLabel},tooltip:[{field:"x",type:"quantitative"},...c.map((t=>({field:t,type:"quantitative"})))]},p=c.map((t=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:t,type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:`${t}-name`,type:"nominal",legend:{values:c,title:null},scale:{range:h.seriesColors}}}}))),g=u.getDrawArea(t),m={width:h.width||a.getDefaultWidth(g),height:h.height||a.getDefaultHeight(g),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:f},encoding:d,layer:[...p,{mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}}]};return yield o.default(g,m,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},1295:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(985),o=n(1811);e.getDrawArea=function(t){if(t instanceof HTMLElement)return t;if(i.isSurface(t))return t.drawArea;if(i.isSurfaceInfo(t))return o.visor().surface({name:t.name,tab:t.tab,styles:t.styles}).drawArea;throw new Error("Not a drawable")},e.shallowEquals=function(t,e){const n=Object.getOwnPropertyNames(t),r=Object.getOwnPropertyNames(e);if(n.length!==r.length)return!1;for(let r=0;r<n.length;r++){const i=n[r];if(t[i]!==e[i])return!1}return!0},e.nextFrame=function(){return r(this,void 0,void 0,(function*(){yield new Promise((t=>requestAnimationFrame(t)))}))}},6200:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(4624)),a=n(9117),s=n(5807),u=n(1295);e.scatterplot=function(t,e,n={}){return r(this,void 0,void 0,(function*(){let r=e.values;const i=null==e.series?[]:e.series;r=Array.isArray(r[0])?r:[r];const c=[];r.forEach(((t,e)=>{const n=null!=i[e]?i[e]:`Series ${e+1}`,r=t.map((t=>Object.assign({},t,{series:n})));c.push(...r)})),null!=n.seriesColors&&s.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const f=u.getDrawArea(t),h=Object.assign({},l,n),d={width:h.width||a.getDefaultWidth(f),height:h.height||a.getDefaultHeight(f),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:h.fontSize,titleFontSize:h.fontSize},text:{fontSize:h.fontSize},legend:{labelFontSize:h.fontSize,titleFontSize:h.fontSize}},data:{values:c},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:h.xType,title:h.xLabel,scale:h.zoomToFit?{zero:!1}:null!=h.xAxisDomain?{domain:h.xAxisDomain}:void 0},y:{field:"y",type:h.yType,title:h.yLabel,scale:h.zoomToFit?{zero:!1}:null!=h.yAxisDomain?{domain:h.yAxisDomain}:void 0},color:{field:"series",type:"nominal",scale:{range:h.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield o.default(f,d,{actions:!1,mode:"vega-lite",defaultStyle:!1}),Promise.resolve()}))};const l={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11}},8296:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(6722),i=n(4677),o=n(6113),a=n(1295);e.table=function(t,e,n={}){if(e&&null==e.headers)throw new Error('Data to render must have a "headers" property');if(e&&null==e.values)throw new Error('Data to render must have a "values" property');const u=a.getDrawArea(t),l=Object.assign({},s,n);let c=i.select(u).select("table.tf-table");const f=o.css({fontSize:l.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(0===c.size()&&(c=i.select(u).append("table"),c.attr("class",` ${f} tf-table`),c.append("thead").append("tr"),c.append("tbody")),1!==c.size())throw new Error("Error inserting table");const h=o.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),d=c.select("thead").select("tr").selectAll("th").data(e.headers),p=d.enter().append("th").attr("class",`${h}`);d.merge(p).html((t=>t)),d.exit().remove();const g=r.format(",.4~f"),m=c.select("tbody").selectAll("tr").data(e.values),y=m.enter().append("tr"),v=o.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),b=m.merge(y).selectAll("td").data((t=>t)),x=b.enter().append("td").attr("class",`${v}`);b.merge(x).html((t=>"number"==typeof t?g(t):t)),b.exit().remove(),m.exit().remove()};const s={fontSize:14}},345:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(7275),o=n(1295),a=n(9117);function s(t,e,n,s={}){return r(this,void 0,void 0,(function*(){const r=o.getDrawArea(t),c={};for(const t of n)if(/val_/.test(t)){const r=t.replace("val_","");u(c,r);const i=l(e,t,n.indexOf(t));c[r].series.push(t),c[r].values.push(i)}else{const r=l(e,t,n.indexOf(t));u(c,t),c[t].series.push(t),c[t].values.push(r)}const f=Object.keys(c),h=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},s),d=[];for(const t of f){const e=a.subSurface(r,t),n=c[t].series,o=c[t].values;n.every((t=>Boolean(t.match("acc"))))&&(h.zoomToFitAccuracy?h.zoomToFit=!0:(h.yAxisDomain=[0,1],delete h.zoomToFit));const s=i.linechart(e,{values:o,series:n},h);d.push(s)}yield Promise.all(d)}))}function u(t,e){null==t[e]&&(t[e]={series:[],values:[]})}function l(t,e,n){if(Array.isArray(t)){const r=Array.isArray(t[0])?t[n]:t,i=[];for(let t=0;t<r.length;t++){const n=r[t];i.push({x:t,y:n[e]})}return i}return t.history[e].map(((t,e)=>({x:e,y:t})))}function c(t,e,n){return null==t[e]&&(t[e]={}),null==t[e][n]&&(t[e][n]=[]),t[e][n]}e.history=s,e.fitCallbacks=function(t,e,n={}){const i={},u=n.callbacks||["onEpochEnd","onBatchEnd"],l=o.getDrawArea(t),f=Object.assign({},n);delete f.callbacks;const h={};return u.forEach((t=>{h[t]=function(t){return(n,u)=>r(this,void 0,void 0,(function*(){/batch/i.test(t)?f.xLabel="Batch":/epoch/i.test(t)&&(f.xLabel="Epoch");const n=[],r=[];for(const o of e)if(null!=u[o]){r.push(o);const e=c(i,t,o);e.push({[o]:u[o]}),n.push(e)}s(a.subSurface(l,t,{title:t}),n,r,f),yield o.nextFrame()}))}(t)})),h}},1753:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2007),o=n(1295),a=n(8296),s=n(9117),u=n(3209);function l(t){let e;return e=Array.isArray(t.outputShape[0])?`[${t.outputShape.map((t=>c(t))).join(", ")}]`:c(t.outputShape),{name:t.name,trainable:t.trainable,parameters:t.countParams(),outputShape:e}}function c(t){const e=t.slice();return 0===e.length?"Scalar":(null===e[0]&&(e[0]="batch"),`[${e.join(",")}]`)}e.modelSummary=function(t,e){return r(this,void 0,void 0,(function*(){const n=o.getDrawArea(t),r=function(t){return{layers:t.layers.map(l)}}(e).layers.map((t=>[t.name,t.outputShape,t.parameters,t.trainable]));a.table(n,{headers:["Layer Name","Output Shape","# Of Params","Trainable"],values:r})}))},e.layer=function(t,e){return r(this,void 0,void 0,(function*(){const n=o.getDrawArea(t),l=yield function(t){return r(this,void 0,void 0,(function*(){const e=t.getWeights(),n=t.weights,r=e.map(u.tensorStats),i=yield Promise.all(r),o=e.map((t=>t.shape));return e.map(((t,e)=>({name:n[e].name,stats:i[e],shape:c(o[e]),weight:t})))}))}(e),f=s.subSurface(n,"layer-weights-info"),h=l.map((t=>[t.name,t.shape,t.stats.min,t.stats.max,t.weight.size,t.stats.numZeros,t.stats.numNans,t.stats.numInfs]));a.table(f,{headers:["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],values:h});const d=s.subSurface(n,"select-layer"),p=s.subSurface(n,"param-distribution");!function(t,e,n){const r=`<div><button>Show Values Distribution for:</button>${`\n    <select>\n      ${t.map((t=>`<option value=${t}>${t}</option>`))}\n    </select>\n  `}</div>`;e.innerHTML=r;const i=e.querySelector("button"),o=e.querySelector("select");i.addEventListener("click",(()=>{n(o.selectedOptions[0].label)}))}(l.map((t=>t.name)),d,(t=>r(this,void 0,void 0,(function*(){const e=l.filter((e=>e.name===t))[0],n=yield e.weight.data();i.histogram(p,n,{height:150,width:460,stats:!1})}))))}))}},7194:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(1295),o=n(8296);e.perClassAccuracy=function(t,e,n){return r(this,void 0,void 0,(function*(){const r=i.getDrawArea(t),a=[];for(let t=0;t<e.length;t++){const r=n?n[t]:t.toString(),i=e[t];a.push([r,i.accuracy,i.count])}return o.table(r,{headers:["Class","Accuracy","# Samples"],values:a})}))}},2194:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2007),o=n(1295),a=n(3209);e.valuesDistribution=function(t,e){return r(this,void 0,void 0,(function*(){const n=o.getDrawArea(t),r=yield a.tensorStats(e),s=yield e.data();i.histogram(n,s,{height:150,stats:r})}))}},985:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSurfaceInfo=function(t){return null!=t.name},e.isSurface=function(t){return t.drawArea instanceof HTMLElement}},9117:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(6113),i=n(1295),o={prepend:!1};e.subSurface=function(t,e,n={}){const a=i.getDrawArea(t),s=r.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),u=r.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),l=Object.assign({},o,n);let c=a.querySelector(`div[data-name=${e}]`);if(!c){if(c=document.createElement("div"),c.setAttribute("class",`${s}`),c.dataset.name=e,l.title){const t=document.createElement("div");t.setAttribute("class",`subsurface-title ${u}`),t.innerText=l.title,c.appendChild(t)}l.prepend?a.insertBefore(c,a.firstChild):a.appendChild(c)}return c},e.getDefaultWidth=function(t){let e=0,n=t;for(;n&&0===n.clientWidth;)n=n.parentElement,e=50;return n.clientWidth-e},e.getDefaultHeight=function(t){return 0===t.clientHeight?200:t.clientHeight}},3209:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(8903),o=n(5807);e.arrayStats=function(t){if(!Array.isArray(t))throw new Error("input must be an array");if(0===t.length)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const e=t.length;let n=-1/0,r=1/0,i=0,o=0,a=0;for(let s=0;s<e;s++){const e=t[s];e>n&&(n=e),e<r&&(r=e),0===e&&(i+=1),isNaN(e)?o+=1:isFinite(e)||(a+=1)}const s={numVals:e,numZeros:i,numNans:o,max:n,min:r,numInfs:a};return s.max===-1/0&&(s.max=NaN),s.min===1/0&&(s.min=NaN),s},e.tensorStats=function(t){return r(this,void 0,void 0,(function*(){const[e,n,r]=i.tidy((()=>{const e=i.scalar(0,t.dtype);return[t.min(),t.max(),t.equal(e).sum()]}));return Promise.all([t.data(),e.data(),n.data(),r.data()]).then((([t,e,n,r])=>{const i=t.length;let o=0,a=0;for(let e=0;e<i;e++){const n=t[e];isNaN(n)?o+=1:isFinite(n)||(a+=1)}let s=e[0],u=n[0];return o===i&&(s=NaN,u=NaN),{numVals:i,numZeros:r[0],numNans:o,min:s,max:u,numInfs:a}}))}))},e.confusionMatrix=function(t,e,n,a){return r(this,void 0,void 0,(function*(){o.assert(1===t.rank,"labels must be a 1D tensor"),o.assert(1===e.rank,"predictions must be a 1D tensor"),o.assert(t.size===e.size,"labels and predictions must be the same length"),null!=a&&o.assert(a.size===e.size,"labels and predictions must be the same length");const r=t.cast("int32"),s=e.cast("int32");null==n&&(n=i.tidy((()=>i.maximum(r.max(),s.max()).cast("int32").dataSync()[0]+1)));let u=Promise.resolve(null);return null!=a&&(u=a.data()),Promise.all([r.data(),s.data(),u]).then((([t,e,r])=>{const i=Array(n).fill(0);for(let t=0;t<n;t++)i[t]=Array(n).fill(0);for(let n=0;n<t.length;n++){const o=t[n],a=e[n];i[o][a]+=null!=r?r[n]:1}return i}))}))},e.accuracy=function(t,e){return r(this,void 0,void 0,(function*(){o.assertShapesMatch(t.shape,e.shape,"Error computing accuracy.");const n=t.equal(e),r=n.mean(),a=(yield r.data())[0];return i.dispose([n,r]),a}))},e.perClassAccuracy=function(t,e,n){return r(this,void 0,void 0,(function*(){return o.assert(1===t.rank,"labels must be a 1D tensor"),o.assert(1===e.rank,"predictions must be a 1D tensor"),o.assert(t.size===e.size,"labels and predictions must be the same length"),null==n&&(n=i.tidy((()=>i.maximum(t.max(),e.max()).dataSync()[0]+1))),Promise.all([t.data(),e.data()]).then((([t,e])=>{const r=Array(n).fill(0),i=Array(n).fill(0);for(let n=0;n<t.length;n++){const o=t[n],a=e[n];r[o]+=1,o===a&&(i[o]+=1)}const o=[];for(let t=0;t<r.length;t++)o.push({count:r[t],accuracy:0===r[t]?0:i[t]/r[t]});return o}))}))}},5807:(t,e)=>{"use strict";function n(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function r(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=n,e.assertShapesMatch=function(t,e,i=""){n(r(t,e),i+` Shapes ${t} and ${e} must match`)},e.arraysEqual=r,e.DECIMAL_PLACES_TO_CHECK=4},14:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.version="1.5.1"},1811:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(619);let i;const o="tfjs-visor-container";e.visor=function(){if("undefined"==typeof document)throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(o)&&null!=i)return i;let t,e=document.getElementById(o);function n(e,n){let i=null;return t=r.VisorComponent.render(e,t,{ref:t=>i=t,surfaceList:Array.from(n.values())}),i}null==e&&(e=document.createElement("div"),e.id=o,document.body.appendChild(e));const s=new Map,u=n(e,s);return i=new a(u,e,s,n),i};class a{constructor(t,e,n,r){this.visorComponent=t,this.el=e,this.surfaceList=n,this.renderVisor=r}surface(t){const{name:e}=t,n=null==t.tab?"Visor":t.tab;if(null==e||!("string"==typeof e||e instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const r=Object.assign({},t,{tab:n}),i=`${e}-${n}`;return this.surfaceList.has(i)||this.surfaceList.set(i,r),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(e,n)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}e.Visor=a},8713:(t,e,n)=>{"use strict";n.d(e,{JL:()=>r,Zu:()=>i});class r{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class i{refCount(t){return o("refCount")}incRef(t){return o("incRef")}timerAvailable(){return!0}time(t){return o("time")}read(t){return o("read")}readSync(t){return o("readSync")}numDataIds(){return o("numDataIds")}disposeData(t,e){return o("disposeData")}write(t,e,n){return o("write")}move(t,e,n,r,i){return o("move")}memory(){return o("memory")}floatPrecision(){return o("floatPrecision")}epsilon(){return 32===this.floatPrecision()?1e-7:1e-4}dispose(){return o("dispose")}}function o(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}},7097:(t,e,n)=>{"use strict";n.d(e,{BV:()=>b,wv:()=>v});var r=n(8713),i=n(2885),o=n(5938),a=n(9121),s=n(6151),u=n(9155),l=n(569);class c{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new h)}profileKernel(t,e,n){let r;const o=()=>{r=n()};let a;const s=u.now();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(o);else{o();for(const t of r)t.dataSync();a=Promise.resolve({kernelMs:u.now()-s})}if((0,i.OB)().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let e=0;e<r.length;e++){const n=r[e];n.data().then((e=>{f(e,n.dtype,t)}))}return{kernelName:t,outputs:r,inputs:e,timeMs:a.then((t=>t.kernelMs)),extraInfo:a.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))}}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:r,inputs:i,extraInfo:o}=t;n.forEach((t=>{Promise.all([t.data(),r,o]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function f(t,e,n){if("float32"!==e)return!1;for(let e=0;e<t.length;e++){const r=t[e];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class h{logKernelProfile(t,e,n,r,i,o){const a="number"==typeof r?l.oj(`${r}ms`,9):r.error,s=l.oj(t,25),u=e.rank,c=e.size,f=l.oj(e.shape.toString(),14);let h="";for(const t in i){const n=i[t];if(null!=n){const r=n.shape||e.shape,i=r.length;h+=`${t}: ${i}D ${i>0?r:""} `}}console.log(`%c${s}\t%c${a}\t%c${u}D ${f}\t%c${c}\t%c${h}\t%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}var d=n(4077),p=n(747);function g(t){return null!=t.kernelName}class m{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class y{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new m}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e];if(await this.initializeBackend(n).success)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(console.warn(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t);if(!(n?await e:e))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new c(this.backendInstance),!0}setupRegisteredKernels(){(0,s.tr)(this.backendName).forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){(0,s.tr)(t).forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof r.Zu||"function"!=typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,r=n.then((n=>!(e<this.pendingBackendInitId||(this.registry[t]=n,this.pendingBackendInit=null,0)))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message)),!1)));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}}catch(e){return console.warn(`Initialization of backend ${t} failed`),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e),o=r.refCount(e);r.disposeData(e,!0),n.backend=t,t.move(e,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,r=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}return this.scopedRun((()=>this.startScope(r)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(t){throw e(),t}}nextTensorId(){return y.nextTensorId++}nextVariableId(){return y.nextVariableId++}clone(t){const e=b.runKernel(a.iJ,{x:t}),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(t=>({x:()=>{const e={x:t};return b.runKernel(a.RF,e,{dtype:"float32"})}})),[],{}),e}runKernel(t,e,n){if(null==(0,s.pI)(t,this.backendName))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:e,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const r=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let e,n=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;let a,u;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const c=g(t)?t.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(g(t)){const{kernelName:e,inputs:i,attrs:o}=t;null==this.backendName&&this.backend;const c=(0,s.pI)(e,this.backendName);l.hu(null!=c,(()=>`Cannot find registered kernel '${e}' for backend '${this.backendName}'`)),a=()=>{const t=this.backend.numDataIds();u=c.kernelFunc({inputs:i,attrs:o,backend:this.backend});const a=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(e,t,a);const s=a.map((t=>{if(null!=t.rank)return t;const{dataId:e,shape:n,dtype:r}=t;return this.makeTensorFromDataId(e,n,r)}));if(r){const t=this.getTensorsForGradient(e,i,s);n=this.saveTensorsForBackwardMode(t)}return s}}else{const{forwardFunc:e}=t,i=t=>{r&&(n=t.map((t=>this.keep(this.clone(t)))))};a=()=>{const t=this.backend.numDataIds();u=this.tidy((()=>e(this.backend,i)));const n=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,t,n),n}}const{inputs:f,attrs:h}=t,d=g(t)?null:t.backwardsFunc;let p;return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(p=this.profiler.profileKernel(c,f,(()=>a())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),e=p.outputs):e=a()})),r&&this.addTapeNode(c,f,e,d,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(f).map((t=>null!=f[t]?f[t].shape:null)),outputShapes:e.map((t=>t.shape)),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?e:e[0]}saveTensorsForBackwardMode(t){return t.map((t=>this.keep(this.clone(t))))}getTensorsForGradient(t,e,n){const r=(0,s.uk)(t);if(null!=r){const t=r.inputsToSave||[],i=r.outputsToSave||[];let o;r.saveAllInputs?(l.hu(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),o=Object.keys(e).map((t=>e[t]))):o=t.map((t=>e[t]));const a=n.filter(((t,e)=>i[e]));return o.concat(a)}return[]}makeTensor(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=t;"string"===n&&l.HD(t[0])&&(i=t.map((t=>u.encodeString(t))));const o=r.write(i,e,n),a=new d.es(e,n,o,this.nextTensorId());if(this.trackTensor(a,r),"string"===n){const t=this.state.tensorInfo.get(o),e=(0,l.Ub)(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return a}makeTensorFromDataId(t,e,n,r){n=n||"float32";const i=new d.es(e,n,t,this.nextTensorId());return this.trackTensor(i,r),i}makeVariable(t,e=!0,n,r){n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.cast(r));const i=new d._w(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,e){this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*l.bT(t.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n})),t instanceof d._w||this.track(t)}incRef(t,e){this.trackTensor(t,e),this.backend.incRef(t.dataId)}removeDataId(t,e){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===e&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const e=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,"string"===t.dtype&&(this.state.numStringTensors--,this.state.numBytes-=e.bytes),"complex64"!==t.dtype&&"string"!==t.dtype){const e=t.size*l.bT(t.dtype);this.state.numBytes-=e}e.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,e.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const t of this.state.activeProfile.kernels)t.kernelTimeMs=await t.kernelTimeMs,t.extraInfo=await t.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},u=(0,s.uk)(t);null!=u&&(r=u.gradFunc),null!=r&&(a.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],r=l.wT(t.size,t.dtype);return this.makeTensor(r,t.shape,t.dtype)}return t})),r(t.length>1?t:t[0],i,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=(0,p.getTensorsInContainer)(t),n=new Set(e.map((t=>t.id)));for(let t=0;t<this.state.activeScope.track.length;t++){const e=this.state.activeScope.track[t];e.kept||n.has(e.id)||e.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==r.id||this.track(t)}))}gradients(t,e,n,r=!1){if(l.hu(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));l.hu(i instanceof d.es,(()=>"The result y returned by f() must be a tensor."));const o=function(t,e,n){const r={},i={};for(let t=0;t<e.length;t++)r[e[t].id]=!0;for(let n=0;n<t.length;n++){const o=t[n],a=o.inputs;for(const t in a){const n=a[t];let s=!1;for(let t=0;t<e.length;t++)if(r[n.id]){o.outputs.forEach((t=>r[t.id]=!0)),s=!0,i[o.id]=!0;break}if(s)break}}const o={};o[n.id]=!0;const a={};for(let e=t.length-1;e>=0;e--){const n=t[e],r=n.inputs;for(let t=0;t<n.outputs.length;t++)if(o[n.outputs[t].id]){for(const t in r)o[r[t].id]=!0,a[n.id]=!0;break}}const s=[];for(let e=0;e<t.length;e++){const n=t[e];if(i[n.id]&&a[n.id]){const t={};for(const e in n.inputs){const i=n.inputs[e];r[i.id]&&(t[e]=i)}const e=Object.assign({},n);e.inputs=t,e.outputs=n.outputs,s.push(e)}}return s}(this.state.activeTape,e,i);if(!r&&0===o.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?function(t){const e=(0,l.p8)((0,l.NA)(t),"float32");return b.makeTensor(e,t,"float32")}(i.shape):n,function(t,e,n,r){for(let i=e.length-1;i>=0;i--){const o=e[i],a=[];if(o.outputs.forEach((e=>{const n=t[e.id];null!=n?a.push(n):a.push(null)})),null==o.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const s=o.gradient(a);for(const e in o.inputs){if(!(e in s))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(s)}.`);const i=n((()=>s[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const a=o.inputs[e];if(!l.cO(i.shape,a.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${a.shape}'`);if(null==t[a.id])t[a.id]=i;else{const e=t[a.id];t[a.id]=r(e,i),e.dispose()}}}}(t,o,(t=>this.tidy(t)),x);const r=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:r}}))}customGrad(t){return l.hu(l.mf(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;l.hu(e.every((t=>t instanceof d.es)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const r={};return e.forEach(((t,e)=>{r[e]=t})),this.runKernelFunc({forwardFunc:(r,i)=>(n=t(...e,i),l.hu(n.value instanceof d.es,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),l.hu(l.mf(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value),backwardsFunc:(t,r)=>{const i=n.gradFunc(t,r),o=Array.isArray(i)?i:[i];l.hu(o.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),l.hu(o.every((t=>t instanceof d.es)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const a={};return o.forEach(((t,e)=>{a[e]=()=>t})),a},inputs:r})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}async time(t){const e=(0,u.now)(),n=await this.backend.time(t);return n.wallMs=(0,u.now)()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new m;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function v(){const t=(0,o.D)();if(null==t._tfengine){const e=new i.qA(t);t._tfengine=new y(e)}return(0,i.iG)(t._tfengine.ENV),(0,d.Vi)((()=>t._tfengine)),t._tfengine}y.nextTensorId=0,y.nextVariableId=0;const b=v();function x(t,e){const n={a:t,b:e};return b.runKernel(a.mm,n)}},2885:(t,e,n)=>{"use strict";n.d(e,{qA:()=>i,OB:()=>a,Vi:()=>s,iG:()=>u});var r=n(569);class i{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=o,this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if((0,r.tI)(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(void 0===this.global||void 0===this.global.location||void 0===this.global.location.search)return;const t=this.getQueryParams(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}(e,n)}))}}function o(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(e,n[0],n[1]),n.join("=")))),e}function a(){return s}let s=null;function u(t){s=t}},5938:(t,e,n)=>{"use strict";let r;function i(){if(null==r){let t;if("undefined"!=typeof window)t=window;else if(void 0!==n.g)t=n.g;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}r=t}return r}function o(t,e){const n=function(){const t=i();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}();if(n.has(t))return n.get(t);{const r=e();return n.set(t,r),n.get(t)}}n.d(e,{D:()=>i,R:()=>o})},633:(t,e,n)=>{"use strict";n.d(e,{cb:()=>h,pn:()=>f,h7:()=>l,fN:()=>c,UQ:()=>s,ti:()=>u});var r=n(7097),i=n(4077),o=n(3740),a=n(569);function s(t){return a.hu(a.mf(t),(()=>"The f passed in grad(f) must be a function")),(e,n)=>{const i=(0,o._1)(e,"x","tf.grad","string_or_numeric"),s=null!=n?(0,o._1)(n,"dy","tf.grad"):null;return r.BV.tidy((()=>{const{value:e,grads:n}=r.BV.gradients((()=>t(i)),[i],s);return null!=s&&a.k5(e.shape,s.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),d(n),n[0]}))}}function u(t){return a.hu(a.mf(t),(()=>"The f passed in grads(f) must be a function")),(e,n)=>{a.hu(Array.isArray(e),(()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"));const i=(0,o.sI)(e,"args","tf.grads","string_or_numeric"),s=null!=n?(0,o._1)(n,"dy","tf.grads"):null;return r.BV.tidy((()=>{const{value:e,grads:n}=r.BV.gradients((()=>t(...i)),i,s);return null!=s&&a.k5(e.shape,s.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),d(n),n}))}}function l(t){return a.hu(a.mf(t),(()=>"The f passed in valueAndGrad(f) must be a function")),(e,n)=>{a.hu(e instanceof i.es,(()=>"The x passed in valueAndGrad(f)(x) must be a tensor")),a.hu(null==n||n instanceof i.es,(()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"));const{grads:o,value:s}=r.BV.gradients((()=>t(e)),[e],n);return d(o),{grad:o[0],value:s}}}function c(t){return a.hu(a.mf(t),(()=>"The f passed in valueAndGrads(f) must be a function")),(e,n)=>{a.hu(Array.isArray(e)&&e.every((t=>t instanceof i.es)),(()=>"The args passed in valueAndGrads(f)(args) must be array of tensors")),a.hu(null==n||n instanceof i.es,(()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"));const o=r.BV.gradients((()=>t(...e)),e,n);return null!=n&&a.k5(o.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),d(o.grads),o}}function f(t,e){a.hu(a.mf(t),(()=>"The f passed in variableGrads(f) must be a function")),a.hu(null==e||Array.isArray(e)&&e.every((t=>t instanceof i._w)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in r.BV.registeredVariables)e.push(r.BV.registeredVariables[t])}const o=n?e.filter((t=>!t.trainable)):null,s=e.length;e=e.filter((t=>t.trainable)),a.hu(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${s} variables is trainable.`));const{value:u,grads:l}=r.BV.gradients(t,e,null,!0);a.hu(l.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),a.hu(0===u.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${u.rank} tensor`));const c={};return e.forEach(((t,e)=>{null!=l[e]&&(c[t.name]=l[e])})),null!=o&&o.forEach((t=>c[t.name]=null)),{value:u,grads:c}}function h(t){return r.BV.customGrad(t)}function d(t){if(t.filter((t=>null==t)).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}},8903:(t,e,n)=>{"use strict";n.r(e),n.d(e,{Abs:()=>Vt.SY,Acos:()=>Vt.VG,Acosh:()=>Vt.Sp,AdadeltaOptimizer:()=>dn,AdagradOptimizer:()=>gn,AdamOptimizer:()=>vn,AdamaxOptimizer:()=>wn,Add:()=>Vt.mm,AddN:()=>Vt.Xz,All:()=>Vt.oT,Any:()=>Vt.IK,ArgMax:()=>Vt.sJ,ArgMin:()=>Vt.aJ,Asin:()=>Vt.M2,Asinh:()=>Vt.qw,Atan:()=>Vt.jM,Atan2:()=>Vt.QC,Atanh:()=>Vt.Oy,AvgPool:()=>Vt.Jh,AvgPool3D:()=>Vt._k,AvgPool3DGrad:()=>Vt.IM,AvgPoolGrad:()=>Vt.RO,BatchMatMul:()=>Vt.XL,BatchToSpaceND:()=>Vt.zw,Bincount:()=>Vt.zv,BroadcastTo:()=>Vt.Ly,Cast:()=>Vt.RF,Ceil:()=>Vt.gJ,ClipByValue:()=>Vt.xn,Complex:()=>Vt.Zz,ComplexAbs:()=>Vt.yj,Concat:()=>Vt.Eh,Conv2D:()=>Vt.mh,Conv2DBackpropFilter:()=>Vt.wU,Conv2DBackpropInput:()=>Vt.wm,Conv3D:()=>Vt.x1,Conv3DBackpropFilterV2:()=>Vt.o2,Conv3DBackpropInputV2:()=>Vt.ik,Cos:()=>Vt.mc,Cosh:()=>Vt.TR,CropAndResize:()=>Vt.Vc,Cumsum:()=>Vt.iH,DataStorage:()=>Is.JL,DenseBincount:()=>Vt.QR,DepthToSpace:()=>Vt.T0,DepthwiseConv2dNative:()=>Vt.ci,DepthwiseConv2dNativeBackpropFilter:()=>Vt.sL,DepthwiseConv2dNativeBackpropInput:()=>Vt.y7,Diag:()=>Vt.$w,Dilation2D:()=>Vt.p4,Dilation2DBackpropFilter:()=>Vt.Vn,Dilation2DBackpropInput:()=>Vt.ek,ENV:()=>b.Vi,Einsum:()=>Vt.$g,Elu:()=>Vt.SX,EluGrad:()=>Vt.HE,Environment:()=>b.qA,Equal:()=>Vt.hd,Erf:()=>Vt.Om,Exp:()=>Vt.NE,ExpandDims:()=>Vt.YF,Expm1:()=>Vt.Y0,FFT:()=>Vt.vw,Fill:()=>Vt.de,FlipLeftRight:()=>Vt.Uy,Floor:()=>Vt.OR,FloorDiv:()=>Vt.je,FromPixels:()=>Vt.eB,FusedBatchNorm:()=>Vt.sH,FusedConv2D:()=>Vt._V,FusedDepthwiseConv2D:()=>Vt.lu,GatherNd:()=>Vt.q1,GatherV2:()=>Vt.qi,Greater:()=>Vt.iZ,GreaterEqual:()=>Vt.Ac,IFFT:()=>Vt.Qg,Identity:()=>Vt.iJ,Imag:()=>Vt.J_,IsFinite:()=>Vt.av,IsInf:()=>Vt.iW,IsNan:()=>Vt.r7,KernelBackend:()=>Is.Zu,LRN:()=>Vt.eZ,LRNGrad:()=>Vt.Hh,LeakyRelu:()=>Vt.J$,Less:()=>Vt.vt,LessEqual:()=>Vt.CA,LinSpace:()=>Vt.e7,Log:()=>Vt.Zb,Log1p:()=>Vt.kU,LogSoftmax:()=>Vt.qC,LogicalAnd:()=>Vt.PY,LogicalNot:()=>Vt.Vf,LogicalOr:()=>Vt.MZ,Max:()=>Vt.Yo,MaxPool:()=>Vt.mT,MaxPool3D:()=>Vt.OA,MaxPool3DGrad:()=>Vt.OU,MaxPoolGrad:()=>Vt.OV,MaxPoolWithArgmax:()=>Vt.vF,Maximum:()=>Vt.BM,Mean:()=>Vt.q2,Min:()=>Vt.c1,Minimum:()=>Vt.q8,MirrorPad:()=>Vt.jQ,Mod:()=>Vt.Vb,MomentumOptimizer:()=>kn,Multinomial:()=>Vt.NZ,Multiply:()=>Vt.wY,Neg:()=>Vt.ku,NonMaxSuppressionV3:()=>Vt.uv,NonMaxSuppressionV4:()=>Vt.cy,NonMaxSuppressionV5:()=>Vt.W0,NotEqual:()=>Vt.yQ,OP_SCOPE_SUFFIX:()=>qt.z,OneHot:()=>Vt.we,OnesLike:()=>Vt.qW,Optimizer:()=>hn,Pack:()=>Vt.Qi,PadV2:()=>Vt.ly,Pool:()=>Vt.Kg,Pow:()=>Vt.pe,Prelu:()=>Vt.o0,Prod:()=>Vt.Dl,RMSPropOptimizer:()=>An,Range:()=>Vt.e6,Rank:()=>En.yw,Real:()=>Vt.xJ,RealDiv:()=>Vt.oH,Reciprocal:()=>Vt.$H,Reduction:()=>Oa,Relu:()=>Vt.qk,Relu6:()=>Vt.Sb,Reshape:()=>Vt.HZ,ResizeBilinear:()=>Vt._Y,ResizeBilinearGrad:()=>Vt.zb,ResizeNearestNeighbor:()=>Vt.dp,ResizeNearestNeighborGrad:()=>Vt.Hm,Reverse:()=>Vt.mK,RotateWithOffset:()=>Vt.b9,Round:()=>Vt.e0,Rsqrt:()=>Vt.bV,SGDOptimizer:()=>_n,ScatterNd:()=>Vt.xQ,Select:()=>Vt.Ph,Selu:()=>Vt.oF,Sigmoid:()=>Vt.a5,Sign:()=>Vt.i5,Sin:()=>Vt.RQ,Sinh:()=>Vt.w3,Slice:()=>Vt.p2,Softmax:()=>Vt.Gc,Softplus:()=>Vt.MR,SpaceToBatchND:()=>Vt.TQ,SparseReshape:()=>Vt.nh,SparseToDense:()=>Vt.D2,SplitV:()=>Vt.L8,Sqrt:()=>Vt.FK,Square:()=>Vt.bK,SquaredDifference:()=>Vt._t,Step:()=>Vt.h8,StridedSlice:()=>Vt.m2,Sub:()=>Vt.Tr,Sum:()=>Vt.GB,Tan:()=>Vt.sE,Tanh:()=>Vt.MI,Tensor:()=>yt.es,TensorBuffer:()=>yt.YD,Tile:()=>Vt.n9,TopK:()=>Vt.cW,Transform:()=>Vt.wx,Transpose:()=>Vt.G3,Unique:()=>Vt.kp,Unpack:()=>Vt.To,UnsortedSegmentSum:()=>Vt.Qv,Variable:()=>yt._w,ZerosLike:()=>Vt.Ru,_FusedMatMul:()=>Vt.us,abs:()=>bn.W,acos:()=>Dn.K,acosh:()=>Sn._,add:()=>rn.I,addN:()=>Cn,all:()=>On.$,any:()=>Fn.Y,argMax:()=>Mn.N,argMin:()=>$n.v,asin:()=>Nn.Z,asinh:()=>Bn.V,atan:()=>Tn.z,atan2:()=>jn.f,atanh:()=>In.C,avgPool:()=>zn.w,avgPool3d:()=>Pn,backend:()=>en,backend_util:()=>p,basicLSTMCell:()=>Vn,batchNorm:()=>Gn.t,batchNorm2d:()=>Xn,batchNorm3d:()=>Kn,batchNorm4d:()=>Yn,batchToSpaceND:()=>Hn.E,bincount:()=>Jn,booleanMaskAsync:()=>Bo,broadcastTo:()=>Zn.U,browser:()=>a,buffer:()=>vt,cast:()=>bt.p,ceil:()=>Qn.m,clipByValue:()=>tr.i,clone:()=>xt.d,complex:()=>w.P,concat:()=>Ln.z,concat1d:()=>er,concat2d:()=>nr,concat3d:()=>rr,concat4d:()=>ir,conv1d:()=>or.P,conv2d:()=>ar.T,conv2dTranspose:()=>sr.b,conv3d:()=>lr,conv3dTranspose:()=>fr,copyRegisteredKernels:()=>Ht.T3,cos:()=>hr.m,cosh:()=>dr.f,cosineWindow:()=>qo,cumsum:()=>pr.z,customGrad:()=>cn.cb,denseBincount:()=>gr,deprecationWarn:()=>Re,depthToSpace:()=>mr.n,depthwiseConv2d:()=>yr.B,device_util:()=>r,diag:()=>vr,dilation2d:()=>br.W,disableDeprecationWarnings:()=>ze,dispose:()=>Ve,disposeVariables:()=>Pe,div:()=>on.h,divNoNan:()=>xr.N,dot:()=>wr.A,dropout:()=>Po,einsum:()=>_r,elu:()=>kr.p,enableDebugMode:()=>Ie,enableProdMode:()=>je,enclosingPowerOfTwo:()=>Lo,engine:()=>Le,env:()=>b.OB,equal:()=>Ar.D,erf:()=>Er.q,exp:()=>Dr.Q,expandDims:()=>Sr.d,expm1:()=>Cr.t,eye:()=>Fr,fft:()=>so.k,fill:()=>pn,findBackend:()=>Ze,findBackendFactory:()=>Qe,floor:()=>Mr.G,floorDiv:()=>$r.q,fused:()=>h,gather:()=>Nr.I,gatherND:()=>Ro,gather_util:()=>s,getBackend:()=>Ye,getGradient:()=>Ht.uk,getKernel:()=>Ht.pI,getKernelsForBackend:()=>Ht.tr,grad:()=>cn.UQ,grads:()=>cn.ti,greater:()=>Br.p,greaterEqual:()=>Tr.b,ifft:()=>uo.S,imag:()=>jr.a,image:()=>qa,inTopKAsync:()=>Uo,io:()=>i,irfft:()=>lo.w,isFinite:()=>Ir.x,isInf:()=>zr.U,isNaN:()=>Rr.i,keep:()=>He,kernel_impls:()=>g,leakyRelu:()=>Pr.h,less:()=>Lr.d,lessEqual:()=>qr.z,linalg:()=>Ua,linspace:()=>Ur,localResponseNormalization:()=>Wr.G,log:()=>Vr.c,log1p:()=>Hr.K,logSigmoid:()=>Gr.e,logSoftmax:()=>Xr.C,logSumExp:()=>Kr.l,logicalAnd:()=>Yr.H,logicalNot:()=>Jr.h,logicalOr:()=>Zr.K,logicalXor:()=>Qr.e,losses:()=>Wa,matMul:()=>Pt.O,math:()=>o,max:()=>ti.F,maxPool:()=>ei._,maxPool3d:()=>ni,maxPoolWithArgmax:()=>ri,maximum:()=>xn.g,mean:()=>ii.J,memory:()=>qe,meshgrid:()=>si,min:()=>ui.V,minimum:()=>li.L,mirrorPad:()=>ci.V,mod:()=>fi.w,moments:()=>di,movingAverage:()=>jo,mul:()=>an.d,multiRNNCell:()=>pi,multinomial:()=>gi,neg:()=>mi.W,nextFrame:()=>Ka,norm:()=>To.K,notEqual:()=>yi.Q,oneHot:()=>Lt.l,ones:()=>ai,onesLike:()=>vi.J,op:()=>qt.op,outerProduct:()=>bi,pad:()=>xi.v,pad1d:()=>wi,pad2d:()=>_i,pad3d:()=>ki,pad4d:()=>Ai,pool:()=>Ei.d,pow:()=>mn.s,prelu:()=>Di.A,print:()=>wt,prod:()=>Si.W,profile:()=>Ue,rand:()=>Ci,randomGamma:()=>Ni,randomNormal:()=>Bi,randomUniform:()=>Ti,range:()=>ji,ready:()=>Ke,real:()=>Ii.k,reciprocal:()=>zi.M,registerBackend:()=>tn,registerGradient:()=>Ht.Li,registerKernel:()=>Ht.wC,relu:()=>Ri.U,relu6:()=>Pi.b,removeBackend:()=>Je,reshape:()=>Rn.X,reverse:()=>Li.G,reverse1d:()=>qi,reverse2d:()=>Ui,reverse3d:()=>Wi,reverse4d:()=>Vi,rfft:()=>co.Q,round:()=>Hi.N,rsqrt:()=>Gi.b,scalar:()=>fn.i,scatterND:()=>Io,scatter_util:()=>u,selu:()=>Xi.U,separableConv2d:()=>Ki.U,serialization:()=>c,setBackend:()=>Xe,setPlatform:()=>nn,setdiff1dAsync:()=>Yi,sigmoid:()=>qn.X,sign:()=>Ji.X,signal:()=>La,sin:()=>Zi.O,sinh:()=>Qi.R,slice:()=>Un.t,slice1d:()=>to,slice2d:()=>eo,slice3d:()=>no,slice4d:()=>ro,slice_util:()=>l,softmax:()=>io.X,softplus:()=>oo.W,spaceToBatchND:()=>ao.f,sparse:()=>Va,sparseToDense:()=>zo,spectral:()=>Pa,split:()=>fo.V,sqrt:()=>sn._,square:()=>un.h,squaredDifference:()=>ho.$,squeeze:()=>po.L,stack:()=>go.k,step:()=>mo.N,stridedSlice:()=>yo.N,sub:()=>yn.l,sum:()=>vo.S,sumOutType:()=>En.z4,tan:()=>bo.O,tanh:()=>Wn.A,tensor:()=>A,tensor1d:()=>xo,tensor2d:()=>wo,tensor3d:()=>Gt,tensor4d:()=>_o,tensor5d:()=>ko,tensor6d:()=>Ao,tensor_util:()=>_e,test_util:()=>f,tidy:()=>We,tile:()=>Or.G,time:()=>Ge,topk:()=>Eo.h,train:()=>Ga,transpose:()=>Ut.p,truncatedNormal:()=>Do,unique:()=>So.T,unregisterGradient:()=>Ht.bt,unregisterKernel:()=>Ht.nE,unsortedSegmentSum:()=>Co.p,unstack:()=>Oo.H,upcastType:()=>En.x8,util:()=>ke,valueAndGrad:()=>cn.h7,valueAndGrads:()=>cn.fN,variable:()=>Fo,variableGrads:()=>cn.pn,version_core:()=>Te,where:()=>Mo.a,whereAsync:()=>No,zeros:()=>oi.l,zerosLike:()=>ln.P});var r={};n.r(r),n.d(r,{isBrowser:()=>v,isMobile:()=>y});var i={};n.r(i),n.d(i,{browserFiles:()=>Dt,browserHTTPRequest:()=>Tt,concatenateArrayBuffers:()=>$,copyModel:()=>dt,decodeWeights:()=>C,encodeWeights:()=>S,fromMemory:()=>zt,getLoadHandlers:()=>P,getModelArtifactsInfoForJSON:()=>B,getSaveHandlers:()=>R,http:()=>Bt,isHTTPScheme:()=>$t,listModels:()=>ft,loadWeights:()=>Ot,moveModel:()=>pt,registerLoadRouter:()=>z,registerSaveRouter:()=>I,removeModel:()=>ht,weightsLoaderFactory:()=>Ft,withSaveHandler:()=>Rt});var o={};n.r(o),n.d(o,{confusionMatrix:()=>Wt});var a={};n.r(a),n.d(a,{fromPixels:()=>Zt,fromPixelsAsync:()=>Yt,toPixels:()=>Jt});var s={};n.r(s),n.d(s,{prepareAndValidate:()=>Qt});var u={};n.r(u),n.d(u,{calculateShapes:()=>ne,validateInput:()=>ee,validateUpdateShape:()=>te});var l={};n.r(l),n.d(l,{assertParamsValid:()=>re,computeFlatOffset:()=>me,computeOutShape:()=>oe,getNormalizedAxes:()=>le,isSliceContinous:()=>ge,maskToAxes:()=>ie,parseSliceParams:()=>ye,sliceInfo:()=>ve,startForAxis:()=>de,startIndicesWithElidedDims:()=>ce,stopForAxis:()=>pe,stopIndicesWithElidedDims:()=>fe,stridesForAxis:()=>he,stridesWithElidedDims:()=>ae});var c={};n.r(c),n.d(c,{Serializable:()=>be,SerializationMap:()=>xe,registerClass:()=>we});var f={};n.r(f),n.d(f,{TEST_EPSILON_FLOAT16:()=>Ae,encodeStrings:()=>Be,expectArrayBuffersEqual:()=>Ne,expectArraysClose:()=>Ee,expectArraysEqual:()=>Oe,expectNumbersClose:()=>Fe,expectPromiseToFail:()=>Ce,expectValuesInRange:()=>$e,testEpsilon:()=>De});var h={};n.r(h),n.d(h,{conv2d:()=>Jo,depthwiseConv2d:()=>ta,matMul:()=>ea});var d={};n.r(d),n.d(d,{collectGatherOpShapeInfo:()=>Bs,computeOutShape:()=>Ns,segOpComputeOptimalWindowSize:()=>$s});var p={};n.r(p),n.d(p,{ERF_A1:()=>ls,ERF_A2:()=>cs,ERF_A3:()=>fs,ERF_A4:()=>hs,ERF_A5:()=>ds,ERF_P:()=>us,PARALLELIZE_THRESHOLD:()=>Za,SELU_SCALE:()=>ss,SELU_SCALEALPHA:()=>as,applyActivation:()=>Ko,assertAndGetBroadcastShape:()=>Wo.$N,assertAxesAreInnerMostDims:()=>hi.lB,assertParamsConsistent:()=>Ya,assignToTypedArray:()=>ws,axesAreInnerMostDims:()=>hi.YB,calculateShapes:()=>ne,checkEinsumDimSizes:()=>Ss,combineLocations:()=>hi.Vh,complexWithEvenIndex:()=>vs,complexWithOddIndex:()=>bs,computeConv2DInfo:()=>ur.Ix,computeConv3DInfo:()=>ur.jw,computeDefaultPad:()=>ur.aO,computeDilation2DInfo:()=>ur.Rf,computeOptimalWindowSize:()=>Qa,computeOutAndReduceShapes:()=>hi.kz,computeOutShape:()=>Ja,computePool2DInfo:()=>ur.Xw,computePool3DInfo:()=>ur.pl,convertConv2DDataFormat:()=>ur.sl,decodeEinsumEquation:()=>Es,eitherStridesOrDilationsAreOne:()=>ur.jT,expandShapeToKeepDim:()=>hi.rv,exponent:()=>ks,exponents:()=>_s,fromStringArrayToUint8:()=>js,fromUint8ToStringArray:()=>Ts,getAxesPermutation:()=>hi.Q3,getBroadcastDims:()=>Wo.XF,getComplexWithIndex:()=>xs,getEinsumComputePath:()=>Cs,getEinsumPermutation:()=>Ds,getFusedBiasGradient:()=>Xo,getFusedDyActivation:()=>Go,getImageCenter:()=>ts,getInnerMostAxes:()=>hi.sY,getPermuted:()=>ns,getReductionAxes:()=>Wo.RR,getReshaped:()=>es,getReshapedPermuted:()=>rs,getSliceBeginCoords:()=>is,getSliceSize:()=>os,getUndoAxesPermutation:()=>hi.LJ,isIdentityPermutation:()=>Os,log:()=>gs,mergeRealAndImagArrays:()=>ms,prepareAndValidate:()=>Qt,prepareSplitSize:()=>Ms,segment_util:()=>d,shouldFuse:()=>Yo,slice_util:()=>l,splitRealAndImagArrays:()=>ys,tupleValuesAreOne:()=>ur.I0,upcastType:()=>En.x8,validateInput:()=>ee,validateUpdateShape:()=>te,warn:()=>ps});var g={};n.r(g),n.d(g,{nonMaxSuppressionV3Impl:()=>da,nonMaxSuppressionV4Impl:()=>pa,nonMaxSuppressionV5Impl:()=>ga,whereImpl:()=>$o});var m=n(7097);function y(t){if(t||"undefined"!=typeof navigator&&null!=navigator){if(t||(t=navigator),"ReactNative"===t.product)return!0;const e=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function v(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var b=n(2885);const x=(0,b.OB)();x.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),x.registerFlag("IS_BROWSER",(()=>v())),x.registerFlag("IS_NODE",(()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node)),x.registerFlag("IS_CHROME",(()=>"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),x.registerFlag("PROD",(()=>!1)),x.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>x.getBool("DEBUG"))),x.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),x.registerFlag("IS_TEST",(()=>!1)),x.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0)),x.registerFlag("WRAP_TO_IMAGEBITMAP",(()=>!1));var w=n(1661),_=n(3740),k=n(7852);function A(t,e,n){const r=(0,_.C)(t,n);return(0,k.H)(t,e,r,n)}var E=n(569);const D={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};async function S(t,e){const n=[],r=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<i.length;++o){const a=i[o],s=Array.isArray(t)?t[o].tensor:t[a];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error(`Unsupported dtype in weight '${a}': ${s.dtype}`);const u={name:a,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){const t=new Promise((async t=>{const e=await s.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+4*e.length,r=new Uint8Array(n);let i=0;for(let t=0;t<e.length;t++){const n=e[t],o=new Uint8Array(new Uint32Array([n.length]).buffer);r.set(o,i),i+=4,r.set(n,i),i+=n.length}t(r)}));r.push(t)}else r.push(s.data());null!=e&&(u.group=e),n.push(u)}return{data:O(await Promise.all(r)),specs:n}}function C(t,e){const n={};let r,i=0;for(const o of e){const e=o.name,a=o.dtype,s=o.shape,u=(0,E.NA)(s);let l;if("quantization"in o){const n=o.quantization;if("uint8"===n.dtype||"uint16"===n.dtype){if(!("min"in n)||!("scale"in n))throw new Error(`Weight ${o.name} with quantization ${n.dtype} doesn't have corresponding metadata min and scale.`)}else{if("float16"!==n.dtype)throw new Error(`Weight ${o.name} has unknown quantization dtype ${n.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);if("float32"!==a)throw new Error(`Weight ${o.name} is quantized with ${n.dtype} which only supports weights of type float32 not ${a}.`)}const s=D[n.dtype],c=t.slice(i,i+u*s),f="uint8"===n.dtype?new Uint8Array(c):new Uint16Array(c);if("float32"===a)if("uint8"===n.dtype||"uint16"===n.dtype){l=new Float32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];l[t]=e*n.scale+n.min}}else{if("float16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type float32.`);void 0===r&&(r=T()),l=r(f)}else{if("int32"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);if("uint8"!==n.dtype&&"uint16"!==n.dtype)throw new Error(`Unsupported quantization type ${n.dtype} for weight type int32.`);l=new Int32Array(f.length);for(let t=0;t<f.length;t++){const e=f[t];l[t]=Math.round(e*n.scale+n.min)}}i+=u*s}else if("string"===a){const e=(0,E.NA)(o.shape);l=[];for(let n=0;n<e;n++){const e=new Uint32Array(t.slice(i,i+4))[0];i+=4;const n=new Uint8Array(t.slice(i,i+e));l.push(n),i+=e}}else{const r=D[a],o=t.slice(i,i+u*r);if("float32"===a)l=new Float32Array(o);else if("int32"===a)l=new Int32Array(o);else if("bool"===a)l=new Uint8Array(o);else{if("complex64"!==a)throw new Error(`Unsupported dtype in weight '${e}': ${a}`);{l=new Float32Array(o);const t=new Float32Array(l.length/2),r=new Float32Array(l.length/2);for(let e=0;e<t.length;e++)t[e]=l[2*e],r[e]=l[2*e+1];const i=A(t,s,"float32"),a=A(r,s,"float32");n[e]=(0,w.P)(i,a),i.dispose(),a.dispose()}}i+=u*r}"complex64"!==a&&(n[e]=A(l,s,a))}return n}function O(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const r=new Uint8Array(e);let i=0;return n.forEach((t=>{r.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),r.buffer}const F="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function M(t){return F?Buffer.byteLength(t):new Blob([t]).size}function $(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let r=0;return t.forEach((t=>{n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function N(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);const e=t.split("/");return e[e.length-1]}function B(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:M(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:M(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function T(){const t=function(){const t=t=>{let e=t<<13,n=0;for(;0==(8388608&e);)n-=8388608,e<<=1;return e&=-8388609,n+=947912704,e|n},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}(),e=function(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}(),n=function(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}();return r=>{const i=new ArrayBuffer(4*r.length),o=new Uint32Array(i);for(let i=0;i<r.length;i++){const a=r[i],s=t[n[a>>10]+(1023&a)]+e[a>>10];o[i]=s}return new Float32Array(i)}}class j{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==j.instance&&(j.instance=new j),j.instance}static registerSaveRouter(t){j.getInstance().saveRouters.push(t)}static registerLoadRouter(t){j.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return j.getHandlers(t,"save")}static getLoadHandlers(t,e){return j.getHandlers(t,"load",e)}static getHandlers(t,e,n){const r=[];return("load"===e?j.getInstance().loadRouters:j.getInstance().saveRouters).forEach((e=>{const i=e(t,n);null!==i&&r.push(i)})),r}}const I=t=>j.registerSaveRouter(t),z=t=>j.registerLoadRouter(t),R=t=>j.getSaveHandlers(t),P=(t,e)=>j.getLoadHandlers(t,e),L="tensorflowjs",q="models_store",U="model_info_store";function W(){if(!(0,b.OB)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"==typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function V(t){const e=t.result;e.createObjectStore(q,{keyPath:"modelPath"}),e.createObjectStore(U,{keyPath:"modelPath"})}class H{constructor(t){if(this.indexedDB=W(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const r=this.indexedDB.open(L,1);r.onupgradeneeded=()=>V(r),r.onsuccess=()=>{const i=r.result;if(null==e){const e=i.transaction(q,"readonly"),r=e.objectStore(q).get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const r=B(e),o=i.transaction(U,"readwrite");let a=o.objectStore(U);const s=a.put({modelPath:this.modelPath,modelArtifactsInfo:r});let u;s.onsuccess=()=>{u=i.transaction(q,"readwrite");const s=u.objectStore(q).put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:r});s.onsuccess=()=>t({modelArtifactsInfo:r}),s.onerror=t=>{a=o.objectStore(U);const e=a.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(s.error)),e.onerror=t=>(i.close(),n(s.error))}},s.onerror=t=>(i.close(),n(s.error)),o.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}}},r.onerror=t=>n(r.error)}))}}H.URL_SCHEME="indexeddb://";const G=t=>{return(0,b.OB)().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(H.URL_SCHEME)?(e=t.slice(H.URL_SCHEME.length),new H(e)):null;var e};j.registerSaveRouter(G),j.registerLoadRouter(G);class X{constructor(){this.indexedDB=W()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open(L,1);n.onupgradeneeded=()=>V(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(U,"readonly"),o=i.objectStore(U).getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(r.close(),e(o.error)),i.oncomplete=()=>r.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){var e;return t=(e=t).startsWith(H.URL_SCHEME)?e.slice(H.URL_SCHEME.length):e,new Promise(((e,n)=>{const r=this.indexedDB.open(L,1);r.onupgradeneeded=()=>V(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(U,"readwrite"),a=o.objectStore(U),s=a.get(t);let u;s.onsuccess=()=>{if(null==s.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const r=a.delete(t),o=()=>{u=i.transaction(q,"readwrite");const r=u.objectStore(q).delete(t);r.onsuccess=()=>e(s.result.modelArtifactsInfo),r.onerror=t=>n(s.error)};r.onsuccess=o,r.onerror=t=>(o(),i.close(),n(s.error))}},s.onerror=t=>(i.close(),n(s.error)),o.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}},r.onerror=t=>n(r.error)}))}}const K="/",Y="tensorflowjs_models",J="info",Z="model_topology",Q="weight_specs",tt="weight_data",et="model_metadata";function nt(t){return{info:[Y,t,J].join(K),topology:[Y,t,Z].join(K),weightSpecs:[Y,t,Q].join(K),weightData:[Y,t,tt].join(K),modelMetadata:[Y,t,et].join(K)}}function rt(t){const e=t.split(K);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(K)}class it{constructor(t){if(!(0,b.OB)().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=nt(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=B(t);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(F)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let t=0,r=e.length;t<r;t++)n+=String.fromCharCode(e[t]);return btoa(n)}(t.weightData));const i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};return null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==r)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t.format,e.generatedBy=t.generatedBy,e.convertedBy=t.convertedBy,null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer)}const o=this.LS.getItem(this.keys.weightData);if(null==o)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=function(t){if(F){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;++t)n.set([e.charCodeAt(t)],t);return n.buffer}(o),e}}it.URL_SCHEME="localstorage://";const ot=t=>{return(0,b.OB)().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(it.URL_SCHEME)?(e=t.slice(it.URL_SCHEME.length),new it(e)):null;var e};j.registerSaveRouter(ot),j.registerLoadRouter(ot);class at{constructor(){(0,E.hu)((0,b.OB)().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),(0,E.hu)("undefined"==typeof window||void 0!==window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Y+K,n=K+J;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);i.startsWith(e)&&i.endsWith(n)&&(t[rt(i)]=JSON.parse(this.LS.getItem(i)))}return t}async removeModel(t){var e;const n=nt(t=(e=t).startsWith(it.URL_SCHEME)?e.slice(it.URL_SCHEME.length):e);if(null==this.LS.getItem(n.info))throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),r}}const st="://";class ut{constructor(){this.managers={}}static getInstance(){return null==ut.instance&&(ut.instance=new ut),ut.instance}static registerManager(t,e){(0,E.hu)(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith(st)&&(t=t.slice(0,t.indexOf(st))),(0,E.hu)(t.length>0,(()=>"scheme must not be an empty string."));const n=ut.getInstance();(0,E.hu)(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}function lt(t){if(-1===t.indexOf(st))throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ut.getSchemes().join(",")}`);return{scheme:t.split(st)[0],path:t.split(st)[1]}}async function ct(t,e,n=!1){(0,E.hu)(t!==e,(()=>`Old path and new path are the same: '${t}'`));const r=j.getLoadHandlers(t);(0,E.hu)(r.length>0,(()=>`Copying failed because no load handler is found for source URL ${t}.`)),(0,E.hu)(r.length<2,(()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`));const i=r[0],o=j.getSaveHandlers(e);(0,E.hu)(o.length>0,(()=>`Copying failed because no save handler is found for destination URL ${e}.`)),(0,E.hu)(o.length<2,(()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${e}.`));const a=o[0],s=lt(t).scheme,u=lt(t).path,l=s===lt(t).scheme,c=await i.load();n&&l&&await ut.getManager(s).removeModel(u);const f=await a.save(c);return n&&!l&&await ut.getManager(s).removeModel(u),f.modelArtifactsInfo}async function ft(){const t=ut.getSchemes(),e={};for(const n of t){const t=await ut.getManager(n).listModels();for(const r in t)e[n+st+r]=t[r]}return e}async function ht(t){const e=lt(t);return ut.getManager(e.scheme).removeModel(e.path)}async function dt(t,e){return ct(t,e,!1)}async function pt(t,e){return ct(t,e,!0)}class gt{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if((0,b.OB)().get("IS_BROWSER")){(0,b.OB)().setPlatform("browser",new gt);try{ut.registerManager(it.URL_SCHEME,new at)}catch(t){}try{ut.registerManager(H.URL_SCHEME,new X)}catch(t){}}let mt;(0,b.OB)().get("IS_NODE")&&(0,b.OB)().setPlatform("node",new class{constructor(){this.util=n(8628),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=(0,b.OB)().global.fetch?(0,b.OB)().global.fetch(t,e):(null==mt&&(mt=n(5410)),mt(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}});var yt=n(4077);function vt(t,e="float32",n){return e=e||"float32",E.Mu(t),new yt.YD(t,e,n)}var bt=n(2271),xt=n(8723);function wt(t,e=!1){console.log(t.toString(e))}(0,m.wv)();const _t={buffer:vt,cast:bt.p,clone:xt.d,print:wt};function kt(t){return new Promise((t=>setTimeout(t))).then(t)}(0,yt.Vp)(_t);class At{constructor(t){if(!(0,b.OB)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(At.URL_SCHEME)&&(t=t.slice(At.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}async save(t){if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer);const i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(o.download=this.modelTopologyFileName,o.href=i,await kt((()=>o.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await kt((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:B(t)}}}}At.URL_SCHEME="downloads://";class Et{constructor(t){if(null==t||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.files=t}async load(){const t=this.files[0],e=this.files.slice(1);return new Promise(((n,r)=>{const i=new FileReader;i.onload=i=>{const o=JSON.parse(i.target.result),a=o.modelTopology;if(null==a)return void r(new Error(`modelTopology field is missing from file ${t.name}`));0===e.length&&n({modelTopology:a});const s=o.weightsManifest;if(null==s)return void r(new Error(`weightManifest field is missing from file ${t.name}`));let u;try{u=this.checkManifestAndWeightFiles(s,e)}catch(t){return void r(t)}const l=[],c=[],f=[];s.forEach((t=>{t.paths.forEach((t=>{c.push(t),f.push(null)})),l.push(...t.weights)})),s.forEach((t=>{t.paths.forEach((t=>{const e=new FileReader;e.onload=e=>{const r=e.target.result,i=c.indexOf(t);if(f[i]=r,-1===f.indexOf(null)){const t={modelTopology:a,weightSpecs:l,weightData:$(f),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy};null!=o.signature&&(t.signature=o.signature),null!=o.userDefinedMetadata&&(t.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(t.modelInitializer=o.modelInitializer),n(t)}},e.onerror=e=>r(`Failed to weights data from file of path '${t}'.`),e.readAsArrayBuffer(u[t])}))}))},i.onerror=e=>r(`Failed to read model topology and weights manifest JSON from file '${t.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(t)}))}checkManifestAndWeightFiles(t,e){const n=[],r=e.map((t=>N(t.name))),i={};for(const o of t)o.paths.forEach((t=>{const o=N(t);if(-1!==n.indexOf(o))throw new Error(`Duplicate file basename found in weights manifest: '${o}'`);if(n.push(o),-1===r.indexOf(o))throw new Error(`Weight file with basename '${o}' is not provided.`);i[t]=e[r.indexOf(o)]}));if(n.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${e.length}).`);return i}}function Dt(t){return new Et(t)}function St(t,e,n,r){!function(t){(0,E.hu)(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}(t),function(t,e){(0,E.hu)(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),(0,E.hu)(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),(0,E.hu)(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}(n=null==n?0:n,r=null==r?1:r);let i=0;return Promise.all(t.map((o=>(o.then((o=>{const a=n+ ++i/t.length*(r-n);return e(a),o})),o))))}async function Ct(t,e){null==e&&(e={});const n=null==e.fetchFunc?(0,b.OB)().platform.fetch:e.fetchFunc,r=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=(null==e.onProgress?await Promise.all(r):await St(r,e.onProgress,0,.5)).map((t=>t.arrayBuffer()));return null==e.onProgress?await Promise.all(i):await St(i,e.onProgress,.5,1)}async function Ot(t,e="",n,r){return Ft((t=>Ct(t,{requestInit:r})))(t,e,n)}function Ft(t){return async(e,n="",r)=>{const i=e.map((()=>!1)),o={},a=null!=r?r.map((()=>!1)):[],s=[];if(e.forEach(((t,e)=>{let n=0;t.weights.forEach((t=>{const u="quantization"in t?t.quantization.dtype:t.dtype,l=D[u]*E.NA(t.shape),c=()=>{i[e]=!0,null==o[e]&&(o[e]=[]),o[e].push({manifestEntry:t,groupOffset:n,sizeBytes:l})};null!=r?r.forEach(((e,n)=>{e===t.name&&(c(),a[n]=!0)})):c(),s.push(t.name),n+=l}))})),!a.every((t=>t))){const t=r.filter(((t,e)=>!a[e]));throw new Error(`Could not find weights in manifest with names: ${t.join(", ")}. \nManifest JSON has weights with names: ${s.join(", ")}.`)}const u=i.reduce(((t,e,n)=>(e&&t.push(n),t)),[]),l=[];u.forEach((t=>{e[t].paths.forEach((t=>{const e=n+(n.endsWith("/")?"":"/")+t;l.push(e)}))}));const c=await t(l),f={};let h=0;return u.forEach((t=>{const n=e[t].paths.length;let r=0;for(let t=0;t<n;t++)r+=c[h+t].byteLength;const i=new ArrayBuffer(r),a=new Uint8Array(i);let s=0;for(let t=0;t<n;t++){const e=new Uint8Array(c[h+t]);a.set(e,s),s+=e.byteLength}o[t].forEach((t=>{const e=C(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(const t in e)f[t]=e[t]})),h+=n})),f}}j.registerSaveRouter((t=>(0,b.OB)().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(At.URL_SCHEME)?function(t="model"){return new At(t)}(t.slice(At.URL_SCHEME.length)):null));class Mt{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?((0,E.hu)("function"==typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=(0,b.OB)().platform.fetch,(0,E.hu)(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&(0,E.hu)(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin");const i=await this.fetch(this.path,e);if(i.ok)return{modelArtifactsInfo:B(t),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(t){let e=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?e+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":e+=" Please make sure the server is serving valid JSON for this request.",new Error(e)}const n=e.modelTopology,r=e.weightsManifest,i=e.generatedBy,o=e.convertedBy,a=e.format,s=e.signature,u=e.userDefinedMetadata;if(null==n&&null==r)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let l,c;if(null!=r){const t=await this.loadWeights(r);[l,c]=t}const f={modelTopology:n,weightSpecs:l,weightData:c,generatedBy:i,convertedBy:o,format:a};null!=s&&(f.signature=s),null!=u&&(f.userDefinedMetadata=u);const h=e.modelInitializer;return h&&(f.modelInitializer=h),f}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=function(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),i=this.weightPathPrefix||n,o=[];for(const e of t)o.push(...e.weights);const a=[],s=[];for(const e of t)for(const t of e.paths)null!=this.weightUrlConverter?s.push(this.weightUrlConverter(t)):a.push(i+t+r);return this.weightUrlConverter&&a.push(...await Promise.all(s)),[o,$(await Ct(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress}))]}}function $t(t){return null!=t.match(Mt.URL_SCHEME_REGEX)}Mt.URL_SCHEME_REGEX=/^https?:\/\//;const Nt=(t,e)=>{if("undefined"==typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>$t(t))):$t(t),n)return Bt(t,e)}return null};function Bt(t,e){return new Mt(t,e)}function Tt(t,e){return Bt(t,e)}j.registerSaveRouter(Nt),j.registerLoadRouter(Nt);class jt{constructor(t){this.modelArtifacts=t}async load(){return this.modelArtifacts}}class It{constructor(t){this.saveHandler=t}async save(t){return this.saveHandler(t)}}function zt(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new jt(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new jt({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new jt({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))}function Rt(t){return new It(t)}var Pt=n(8687),Lt=n(6708),qt=n(2668),Ut=n(9065);const Wt=(0,qt.op)({confusionMatrix_:function(t,e,n){const r=(0,_._1)(t,"labels","confusionMatrix"),i=(0,_._1)(e,"predictions","confusionMatrix");E.hu(null==n||n>0&&Number.isInteger(n),(()=>`If provided, numClasses must be a positive integer, but got ${n}`)),E.hu(1===r.rank,(()=>`Expected the rank of labels to be 1, but got ${r.rank}`)),E.hu(1===i.rank,(()=>`Expected the rank of predictions to be 1, but got ${i.rank}`)),E.hu(r.shape[0]===i.shape[0],(()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`)),E.hu(n>0&&Number.isInteger(n),(()=>`numClasses is required to be a positive integer, but got ${n}`));const o=(0,Lt.l)((0,bt.p)(r,"int32"),n),a=(0,Lt.l)((0,bt.p)(i,"int32"),n),s=(0,Ut.p)(o),u=(0,Pt.O)(s,a);return(0,bt.p)(u,"int32")}});var Vt=n(9121),Ht=n(6151);function Gt(t,e,n){if((0,E.Cq)(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const r=(0,_.C)(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return(0,k.H)(t,e,r,n)}let Xt;function Kt(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,o=!1,a=!1,s=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else if(null!=t.getContext)a=!0;else{if(!("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);s=!0}if(i){const e=2;if(i&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=(0,Ht.pI)(Vt.eB,m.BV.backendName)){const n={pixels:t},r={numChannels:e};return m.BV.runKernel(Vt.eB,n,r)}const[u,l]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let c,f;if(a?c=t.getContext("2d").getImageData(0,0,u,l).data:r||n?c=t.data:(o||i||s)&&(null==Xt&&(Xt=document.createElement("canvas").getContext("2d")),Xt.canvas.width=u,Xt.canvas.height=l,Xt.drawImage(t,0,0,u,l),c=Xt.getImageData(0,0,u,l).data),4===e)f=new Int32Array(c);else{const t=u*l;f=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)f[n*e+t]=c[4*n+t]}return Gt(f,[l,u,e],"int32")}async function Yt(t,e=3){let n=null;if((0,b.OB)().getBool("WRAP_TO_IMAGEBITMAP")&&function(t){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(t instanceof ImageBitmap)&&function(t){return null!=t&&0!==t.width&&0!==t.height}(t)&&!function(t){return null!=t&&t.data instanceof Uint8Array}(t)}(t)){let e;try{e=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch(t){e=null}n=null!=e&&e.width===t.width&&e.height===t.height?e:t}else n=t;return Kt(n,e)}async function Jt(t,e){let n=(0,_._1)(t,"img","toPixels");if(!(t instanceof yt.es)){const t=n;n=(0,bt.p)(t,"int32"),t.dispose()}if(2!==n.rank&&3!==n.rank)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[r,i]=n.shape.slice(0,2),o=2===n.rank?1:n.shape[2];if(o>4||2===o)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${o}`);if("float32"!==n.dtype&&"int32"!==n.dtype)throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const a=await n.data(),s="float32"===n.dtype?255:1,u=new Uint8ClampedArray(i*r*4);for(let t=0;t<r*i;++t){const e=[0,0,0,255];for(let r=0;r<o;r++){const i=a[t*o+r];if("float32"===n.dtype){if(i<0||i>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${i}.`)}else if("int32"===n.dtype&&(i<0||i>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${i}.`);1===o?(e[0]=i*s,e[1]=i*s,e[2]=i*s):e[r]=i*s}const r=4*t;u[r+0]=Math.round(e[0]),u[r+1]=Math.round(e[1]),u[r+2]=Math.round(e[2]),u[r+3]=Math.round(e[3])}if(null!=e){e.width=i,e.height=r;const t=e.getContext("2d"),n=new ImageData(u,i,r);t.putImageData(n,0,0)}return n!==t&&n.dispose(),u}const Zt=(0,qt.op)({fromPixels_:Kt});function Qt(t,e){const n=t.shape.length,r=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[r-1]} vs. ${n}`);if(0===(0,E.NA)(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,o=i[i.length-1];let a=1;for(let t=0;t<i.length-1;++t)a*=i[t];const s=t.shape,u=i.slice();u.pop();let l=1;for(let t=o;t<n;++t)l*=s[t],u.push(s[t]);const c=[...(0,E.e3)(t.shape).map((t=>t/l)),1].slice(0,o);return[u,a,l,c]}function te(t,e,n){const r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(o+` update.rank < ${i}. `);if(t.length<r+(n.rank-i))throw new Error(o+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(let t=0;t<i;++t)if(n.shape[t]!==e.shape[t])throw new Error(o+` updates.shape[${t}] (${n.shape[t]}) != indices.shape[${t}] (${e.shape[t]}).`);for(let e=0;e<n.rank-i;++e)if(n.shape[e+i]!==t[e+r])throw new Error(o+` updates.shape[${e+i}] (${n.shape[e+i]}) != shape[${e+i}] (${t[e+i]})`)}function ee(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}te(n,e,t)}function ne(t,e,n){const r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length;let a=1;for(let t=i;t<o;++t)a*=n[t];const s=i<1?1:i;return{sliceRank:i,numUpdates:(0,E.NA)(e.shape)/s,sliceSize:a,strides:[...(0,E.e3)(n.slice(0,i)),1],outputSize:(0,E.NA)(n)}}function re(t,e,n){const r=t.shape.length;E.hu(r===e.length,(()=>`Error in slice${r}D: Length of begin ${e} must match the rank of the array (${r}).`)),E.hu(r===n.length,(()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`));for(let i=0;i<r;++i)E.hu(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function ie(t){const e=[];let n=0;for(;t>0;)1&t&&e.push(n),t/=2,n++;return e}function oe(t,e,n){const r=[];for(let i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function ae(t,e,n,r){const i=[...t];for(let t=i.length;t<r.length;t++)i.push(1);for(let t=0;t<n;t++)0===t?i[e]=1:(i.splice(e,0,1),i.pop());return i}function se(t,e,n){return n<=t?n:n-(e-1)}function ue(t,e){const n=[];for(let r=0;r<t;r++)n.push(e+r);return n}function le(t,e,n,r,i,o,a,s,u){const l=t.length;let c=new Array(l),f=new Array(l),h=new Array(l);if(e.length&&n>0){const u=e[0],l=n+1;c=ce(a,u,l,r,t),f=fe(s,u,l,i,t),h=ae(o,u,l,t)}else for(let e=0;e<l;e++)c[e]=de(a,r,o,t,e,u),f[e]=pe(s,i,o,t,e,u),h[e]=he(o,e,u);return{begin:c,end:f,strides:h}}function ce(t,e,n,r,i){const o=[...i],a=ue(n,e);for(let i=0;i<o.length;i++)if(a.indexOf(i)>-1)o[i]=0;else{const a=se(e,n,i);let s=r[a];t&1<<a&&(s=0),o[i]=s}return o}function fe(t,e,n,r,i){const o=[...i],a=ue(n,e);for(let i=0;i<o.length;i++)if(a.indexOf(i)>-1)o[i]=Number.MAX_SAFE_INTEGER;else{const a=se(e,n,i);let s=r[a];t&1<<a&&(s=Number.MAX_SAFE_INTEGER),o[i]=s}for(let t=0;t<o.length;t++){const e=i[t];o[t]<0&&(o[t]+=e),o[t]=E.uZ(0,o[t],i[t])}return o}function he(t,e,n){let r=t[e];return(n&1<<e||null==r)&&(r=1),r}function de(t,e,n,r,i,o){let a=e[i];const s=n[i]||1;(t&1<<i||o&1<<i||null==a)&&(a=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=r[i];return a<0&&(a+=u),a=E.uZ(0,a,u-1),a}function pe(t,e,n,r,i,o){let a=e[i];const s=n[i]||1;(t&1<<i||o&1<<i||null==a)&&(a=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=r[i];return a<0&&(a+=u),a=s>0?E.uZ(0,a,u):E.uZ(-1,a,u-1),a}function ge(t,e,n){let r=n.length;for(let t=0;t<n.length;t++)if(n[t]>1){r=t;break}for(let i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function me(t,e){let n=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function ye(t,e,n){let r;const i=t.shape.length;let o;return r="number"==typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),r.forEach((t=>{E.hu(-1!==t,(()=>"slice() does not support negative begin indexing."))})),o=null==n?new Array(i).fill(-1):"number"==typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,o=o.map(((e,n)=>e>=0?e:(E.hu(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-r[n]))),[r,o]}function ve(t,e,n,r,i,o,a,s,u){let l=e.slice(),c=n.slice(),f=r;null==r&&(f=new Array(l.length));const h=ie(a);if(h.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==a&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==a&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const d=t.length-l.length,p=ie(s),g=t.slice();p.forEach((t=>{l[t]=0,c[t]=1,g.splice(t,0,1)}));const{begin:m,end:y,strides:v}=le(g,h,d,l,c,f,i,o,a);l=m,c=y,f=v;const b=ie(u);b.forEach((t=>{c[t]=l[t]+1,f[t]=1}));const x=oe(l,c,f),w=x.filter(((t,e)=>-1===b.indexOf(e)));return{nonStrided:f.every((t=>1===t)),$begin:l,$end:c,$strides:f,size:x,newShape:g,outShape:w}}class be{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class xe{constructor(){this.classNameMap={}}static getMap(){return null==xe.instance&&(xe.instance=new xe),xe.instance}static register(t){xe.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function we(t){(0,E.hu)(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),(0,E.hu)("string"==typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),(0,E.hu)(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),xe.register(t)}var _e=n(747),ke=n(9155);const Ae=.1;function Ee(t,e,n){return null==n&&(n=De()),Se(t,e,((t,e)=>Me(t,e,n)))}function De(){return 32===m.BV.backend.floatPrecision()?.001:Ae}function Se(t,e,n){let r=!0;if(((0,E.fU)(t)||(0,E.fU)(e))&&(r=!1),(0,E.fU)(t)&&(0,E.fU)(e)&&(r=!0),r){const n=t.constructor.name,r=e.constructor.name;if(n!==r)throw new Error(`Arrays are of different type. Actual: ${n}. Expected: ${r}`)}if(Array.isArray(t)&&Array.isArray(e)){const n=(0,_.C)(t),r=(0,_.C)(e);if(!(0,E.cO)(n,r))throw new Error(`Arrays have different shapes. Actual: [${n}]. Expected: [${r}]`)}const i=(0,E.fU)(t)?t:(0,E.xH)(t),o=(0,E.fU)(e)?e:(0,E.xH)(e);if(i.length!==o.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${o.length}.\nActual:   ${i}.\nExpected: ${o}.`);for(let t=0;t<o.length;++t){const e=i[t],r=o[t];if(!n(e,r))throw new Error(`Arrays differ: actual[${t}] = ${e}, expected[${t}] = ${r}.\nActual:   ${i}.\nExpected: ${o}.`)}}function Ce(t,e){t().then((()=>e.fail()),(()=>e()))}function Oe(t,e){const n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return(0,E.HD)(t)||(0,E.HD)(t[0])||(0,E.HD)(e)||(0,E.HD)(e[0])?Se(t,n,((t,e)=>t==e)):Se(t,e,((t,e)=>Me(t,e,0)))}function Fe(t,e,n){if(null==n&&(n=De()),!Me(t,e,n))throw new Error(`Numbers differ: actual === ${t}, expected === ${e}`)}function Me(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function $e(t,e,n){for(let r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error(`Value out of range:${t[r]} low: ${e}, high: ${n}`)}function Ne(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}function Be(t){for(let e=0;e<t.length;e++){const n=t[e];Array.isArray(n)?Be(n):t[e]=(0,ke.encodeString)(n)}return t}const Te="3.5.0";function je(){(0,b.OB)().set("PROD",!0)}function Ie(){(0,b.OB)().set("DEBUG",!0)}function ze(){(0,b.OB)().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Re(t){(0,b.OB)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Pe(){m.BV.disposeVariables()}function Le(){return m.BV}function qe(){return m.BV.memory()}function Ue(t){return m.BV.profile(t)}function We(t,e){return m.BV.tidy(t,e)}function Ve(t){(0,_e.getTensorsInContainer)(t).forEach((t=>t.dispose()))}function He(t){return m.BV.keep(t)}function Ge(t){return m.BV.time(t)}function Xe(t){return m.BV.setBackend(t)}function Ke(){return m.BV.ready()}function Ye(){return m.BV.backendName}function Je(t){m.BV.removeBackend(t)}function Ze(t){return m.BV.findBackend(t)}function Qe(t){return m.BV.findBackendFactory(t)}function tn(t,e,n=1){return m.BV.registerBackend(t,e,n)}function en(){return m.BV.backend}function nn(t,e){(0,b.OB)().setPlatform(t,e)}(0,yt.FZ)(Re);var rn=n(6407),on=n(1274),an=n(4841),sn=n(3261),un=n(248),ln=n(6577),cn=n(633),fn=n(9494);class hn extends be{minimize(t,e=!1,n){const{value:r,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return Ve(i),e?r:(r.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return(0,cn.pn)(t,e)}dispose(){null!=this.iterations_&&Ve(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:(0,fn.i)(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(hn,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});class dn extends hn{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=m.BV.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=m.BV.registeredVariables[e];null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:We((()=>(0,ln.P)(r).variable(!1)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:We((()=>(0,ln.P)(r).variable(!1)))});const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const o=this.accumulatedGrads[n].variable,a=this.accumulatedUpdates[n].variable;We((()=>{const t=(0,rn.I)((0,an.d)(o,this.rho),(0,an.d)((0,un.h)(i),1-this.rho)),e=(0,an.d)((0,on.h)((0,sn._)((0,rn.I)(a,this.epsilon)),(0,sn._)((0,rn.I)(o,this.epsilon))),i),n=(0,rn.I)((0,an.d)(a,this.rho),(0,an.d)((0,un.h)(e),1-this.rho));o.assign(t),a.assign(n);const s=(0,rn.I)((0,an.d)(e,-this.learningRate),r);r.assign(s)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(Ve(this.accumulatedGrads.map((t=>t.variable))),Ve(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){const e=(t=await this.extractIterations(t)).length/2;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(!1)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.rho,e.epsilon)}}function pn(t,e,n){const r={shape:t,value:e,dtype:n};return m.BV.runKernel(Vt.de,{},r)}dn.className="Adadelta",we(dn);class gn extends hn{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=m.BV.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:We((()=>pn(r.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const o=this.accumulatedGrads[n].variable;We((()=>{const t=(0,rn.I)(o,(0,un.h)(i));o.assign(t);const e=(0,rn.I)((0,an.d)((0,on.h)(i,(0,sn._)((0,rn.I)(t,m.BV.backend.epsilon()))),-this.learningRate),r);r.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&Ve(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e.learningRate,e.initialAccumulatorValue)}}gn.className="Adagrad",we(gn);var mn=n(3453),yn=n(827);class vn extends hn{constructor(t,e,n,r=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],We((()=>{this.accBeta1=(0,fn.i)(e).variable(),this.accBeta2=(0,fn.i)(n).variable()})),null==r&&(this.epsilon=m.BV.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);We((()=>{const n=(0,yn.l)(1,this.accBeta1),r=(0,yn.l)(1,this.accBeta2);e.forEach(((e,i)=>{const o=m.BV.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:We((()=>(0,ln.P)(o).variable(!1)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:We((()=>(0,ln.P)(o).variable(!1)))});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const s=this.accumulatedFirstMoment[i].variable,u=this.accumulatedSecondMoment[i].variable,l=(0,rn.I)((0,an.d)(s,this.beta1),(0,an.d)(a,1-this.beta1)),c=(0,rn.I)((0,an.d)(u,this.beta2),(0,an.d)((0,un.h)(a),1-this.beta2)),f=(0,on.h)(l,n),h=(0,on.h)(c,r);s.assign(l),u.assign(c);const d=(0,rn.I)((0,an.d)((0,on.h)(f,(0,rn.I)((0,sn._)(h),this.epsilon)),-this.learningRate),o);o.assign(d)})),this.accBeta1.assign((0,an.d)(this.accBeta1,this.beta1)),this.accBeta2.assign((0,an.d)(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ve(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&Ve(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),We((()=>{this.accBeta1.assign((0,mn.s)(this.beta1,this.iterations_+1)),this.accBeta2.assign((0,mn.s)(this.beta2,this.iterations_+1))}));const e=t.length/2;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(!1)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)}}vn.className="Adam",we(vn);var bn=n(6235),xn=n(632);class wn extends hn{constructor(t,e,n,r=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],We((()=>{this.iteration=(0,fn.i)(0).variable(),this.accBeta1=(0,fn.i)(e).variable()})),null==r&&(this.epsilon=m.BV.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);We((()=>{const n=(0,yn.l)(1,this.accBeta1),r=(0,on.h)(-this.learningRate,(0,rn.I)((0,an.d)(this.iteration,this.decay),1));e.forEach(((e,i)=>{const o=m.BV.registeredVariables[e];null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:(0,ln.P)(o).variable(!1)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:(0,ln.P)(o).variable(!1)});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const s=this.accumulatedFirstMoment[i].variable,u=this.accumulatedWeightedInfNorm[i].variable,l=(0,rn.I)((0,an.d)(s,this.beta1),(0,an.d)(a,1-this.beta1)),c=(0,an.d)(u,this.beta2),f=(0,bn.W)(a),h=(0,xn.g)(c,f);s.assign(l),u.assign(h);const d=(0,rn.I)((0,an.d)((0,on.h)(r,n),(0,on.h)(l,(0,rn.I)(h,this.epsilon))),o);o.assign(d)})),this.iteration.assign((0,rn.I)(this.iteration,1)),this.accBeta1.assign((0,an.d)(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ve(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&Ve(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}}wn.className="Adamax",we(wn);class _n extends hn{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const i=m.BV.registeredVariables[e];We((()=>{const t=(0,rn.I)((0,an.d)(this.c,r),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=He((0,fn.i)(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(0!==(t=await this.extractIterations(t)).length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e.learningRate)}}_n.className="SGD",we(_n);class kn extends _n{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=(0,fn.i)(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=m.BV.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:We((()=>(0,ln.P)(r).variable(t)))}}const i=this.accumulations[n].variable,o=Array.isArray(t)?t[n].tensor:t[e];null!=o&&We((()=>{let t;const e=(0,rn.I)((0,an.d)(this.m,i),o);t=this.useNesterov?(0,rn.I)((0,an.d)(this.c,(0,rn.I)(o,(0,an.d)(e,this.m))),r):(0,rn.I)((0,an.d)(this.c,e),r),i.assign(e),r.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&Ve(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(!1)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)}}kn.className="Momentum",we(kn);class An extends hn{constructor(t,e=.9,n=0,r=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==r&&(this.epsilon=m.BV.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map((t=>t.name)):Object.keys(t)).forEach(((e,n)=>{const r=m.BV.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:We((()=>(0,ln.P)(r).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:We((()=>(0,ln.P)(r).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:We((()=>(0,ln.P)(r).variable(i)))});const o=Array.isArray(t)?t[n].tensor:t[e];if(null==o)return;const a=this.accumulatedMeanSquares[n].variable,s=this.accumulatedMoments[n].variable;We((()=>{const t=(0,rn.I)((0,an.d)(a,this.decay),(0,an.d)((0,un.h)(o),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=(0,rn.I)((0,an.d)(e,this.decay),(0,an.d)(o,1-this.decay)),u=(0,on.h)((0,an.d)(o,this.learningRate),(0,sn._)((0,yn.l)(t,(0,rn.I)((0,un.h)(i),this.epsilon)))),l=(0,rn.I)((0,an.d)(s,this.momentum),u);a.assign(t),e.assign(i),s.assign(l);const c=(0,yn.l)(r,l);r.assign(c)}else{const t=(0,rn.I)((0,an.d)(a,this.decay),(0,an.d)((0,un.h)(o),1-this.decay)),e=(0,rn.I)((0,an.d)(s,this.momentum),(0,on.h)((0,an.d)(o,this.learningRate),(0,sn._)((0,rn.I)(t,this.epsilon))));a.assign(t),s.assign(e);const n=(0,yn.l)(r,e);r.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&Ve(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&Ve(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&Ve(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}}An.className="RMSProp",we(An);var En=n(1221),Dn=n(7839),Sn=n(1470);const Cn=(0,qt.op)({addN_:function(t){E.hu(Array.isArray(t),(()=>"The argument passed to tf.addN() must be a list of tensors")),E.hu(t.length>=1,(()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`));const e=t.map(((t,e)=>(0,_._1)(t,`tensors${e}`,"addN"))),n=e[0];e.forEach((t=>{if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((t=>{if(!E.cO(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));const r=e;return m.BV.runKernel(Vt.Xz,r)}});var On=n(781),Fn=n(2998),Mn=n(47),$n=n(7394),Nn=n(2421),Bn=n(1891),Tn=n(7037),jn=n(9812),In=n(369),zn=n(5176),Rn=n(4968);const Pn=(0,qt.op)({avgPool3d_:function(t,e,n,r,i,o="NDHWC"){const a=(0,_._1)(t,"x","avgPool3d","float32");let s=a,u=!1;4===a.rank&&(u=!0,s=(0,Rn.X)(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E.hu(5===s.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${s.rank}.`)),E.hu("NDHWC"===o,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),null!=i&&E.hu(E.GN(r),(()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`));const l={x:s},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:o};let f=m.BV.runKernel(Vt._k,l,c);return f=(0,bt.p)(f,s.dtype),u?(0,Rn.X)(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var Ln=n(6884),qn=n(625),Un=n(2676),Wn=n(1869);const Vn=(0,qt.op)({basicLSTMCell_:function(t,e,n,r,i,o){const a=(0,_._1)(t,"forgetBias","basicLSTMCell"),s=(0,_._1)(e,"lstmKernel","basicLSTMCell"),u=(0,_._1)(n,"lstmBias","basicLSTMCell"),l=(0,_._1)(r,"data","basicLSTMCell"),c=(0,_._1)(i,"c","basicLSTMCell"),f=(0,_._1)(o,"h","basicLSTMCell"),h=(0,Ln.z)([l,f],1),d=(0,Pt.O)(h,s),p=(0,rn.I)(d,u),g=p.shape[0],m=p.shape[1]/4,y=[g,m],v=(0,Un.t)(p,[0,0],y),b=(0,Un.t)(p,[0,m],y),x=(0,Un.t)(p,[0,2*m],y),w=(0,Un.t)(p,[0,3*m],y),k=(0,rn.I)((0,an.d)((0,qn.X)(v),(0,Wn.A)(b)),(0,an.d)(c,(0,qn.X)((0,rn.I)(a,x))));return[k,(0,an.d)((0,Wn.A)(k),(0,qn.X)(w))]}});var Hn=n(8441),Gn=n(7505);const Xn=(0,qt.op)({batchNorm2d_:function(t,e,n,r,i,o){const a=(0,_._1)(t,"x","batchNorm"),s=(0,_._1)(e,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),E.hu(2===a.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${a.rank}.`)),E.hu(2===s.rank||1===s.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`)),E.hu(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=l&&E.hu(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`)),null!=c&&E.hu(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`)),(0,Gn.t)(a,s,u,c,l,o)}}),Kn=(0,qt.op)({batchNorm3d_:function(t,e,n,r,i,o){const a=(0,_._1)(t,"x","batchNorm"),s=(0,_._1)(e,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),E.hu(3===a.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${a.rank}.`)),E.hu(3===s.rank||1===s.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`)),E.hu(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=l&&E.hu(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`)),null!=c&&E.hu(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`)),(0,Gn.t)(a,s,u,c,l,o)}}),Yn=(0,qt.op)({batchNorm4d_:function(t,e,n,r,i,o){const a=(0,_._1)(t,"x","batchNorm"),s=(0,_._1)(e,"mean","batchNorm"),u=(0,_._1)(n,"variance","batchNorm");let l,c;return null!=i&&(l=(0,_._1)(i,"scale","batchNorm")),null!=r&&(c=(0,_._1)(r,"offset","batchNorm")),E.hu(4===a.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${a.rank}.`)),E.hu(4===s.rank||1===s.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`)),E.hu(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=l&&E.hu(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`)),null!=c&&E.hu(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`)),(0,Gn.t)(a,s,u,c,l,o)}}),Jn=(0,qt.op)({bincount_:function(t,e,n){const r=(0,_._1)(t,"x","bincount"),i=(0,_._1)(e,"weights","bincount");E.hu("int32"===r.dtype,(()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`)),E.hu(n>=0,(()=>`size must be non-negative, but got ${n}.`)),E.hu(i.size===r.size||0===i.size,(()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`));const o={x:r,weights:i},a={size:n};return m.BV.runKernel(Vt.zv,o,a)}});var Zn=n(8247),Qn=n(6825),tr=n(2279);const er=(0,qt.op)({concat1d_:function(t){return(0,Ln.z)(t,0)}}),nr=(0,qt.op)({concat2d_:function(t,e){return(0,Ln.z)(t,e)}}),rr=(0,qt.op)({concat3d_:function(t,e){return(0,Ln.z)(t,e)}}),ir=(0,qt.op)({concat4d_:function(t,e){return(0,Ln.z)(t,e)}});var or=n(1355),ar=n(4794),sr=n(1405),ur=n(2582);const lr=(0,qt.op)({conv3d_:function(t,e,n,r,i="NDHWC",o=[1,1,1]){const a=(0,_._1)(t,"x","conv3d"),s=(0,_._1)(e,"filter","conv3d");let u=a,l=!1;4===a.rank&&(l=!0,u=(0,Rn.X)(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E.hu(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),E.hu(5===s.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${s.rank}.`)),E.hu(u.shape[4]===s.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${s.shape[3]}.`)),E.hu((0,ur.jT)(n,o),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),E.hu("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`));const c={x:u,filter:s},f={strides:n,pad:r,dataFormat:i,dilations:o},h=m.BV.runKernel(Vt.x1,c,f);return l?(0,Rn.X)(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),cr=(0,qt.op)({conv3DBackpropInput_:function(t,e,n,r,i){E.hu(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let o=t,a=e,s=!1;4===e.rank&&(s=!0,a=(0,Rn.X)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const u=o[4],l=a.shape[4];E.hu(5===o.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`)),E.hu(5===a.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${a.rank}`)),E.hu(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),E.hu(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),E.hu(l===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`));const c={dy:a,filter:n},f={pad:i,strides:r,inputShape:o},h=m.BV.runKernel(Vt.ik,c,f);return s?(0,Rn.X)(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),fr=(0,qt.op)({conv3dTranspose_:function(t,e,n,r,i){const o=(0,_._1)(t,"x","conv3dTranspose"),a=(0,_._1)(e,"filter","conv3dTranspose");return cr(n,o,a,r,i)}});var hr=n(173),dr=n(2699),pr=n(7405);const gr=(0,qt.op)({denseBincount_:function(t,e,n,r=!1){const i=(0,_._1)(t,"x","denseBincount"),o=(0,_._1)(e,"weights","denseBincount");E.hu("int32"===i.dtype,(()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`)),E.hu(i.rank<=2,(()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`)),E.hu(n>=0,(()=>`size must be non-negative, but got ${n}.`)),E.hu(o.size===i.size||0===o.size,(()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${o.shape}.`));const a={x:i,weights:o},s={size:n,binaryOutput:r};return m.BV.runKernel(Vt.QR,a,s)}});var mr=n(9112),yr=n(4718);const vr=(0,qt.op)({diag_:function(t){const e={x:(0,_._1)(t,"x","diag")};return m.BV.runKernel(Vt.$w,e)}});var br=n(557),xr=n(9322),wr=n(548);const _r=(0,qt.op)({einsum_:function(t,...e){const n=e.map(((t,e)=>(0,_._1)(t,`tensors${e}`,"einsum"))),r={equation:t};return m.BV.runKernel(Vt.$g,n,r)}});var kr=n(3233),Ar=n(6477),Er=n(4650),Dr=n(4842),Sr=n(1300),Cr=n(3426),Or=n(7501);const Fr=(0,qt.op)({eye_:function(t,e,n,r="float32"){null==e&&(e=t);const i=vt([t,e],r),o=t<=e?t:e;for(let t=0;t<o;++t)i.set(1,t,t);const a=(0,Rn.X)(i.toTensor(),[t,e]);if(null==n)return a;if(1===n.length)return(0,Or.G)((0,Sr.d)(a,0),[n[0],1,1]);if(2===n.length)return(0,Or.G)((0,Sr.d)((0,Sr.d)(a,0),0),[n[0],n[1],1,1]);if(3===n.length)return(0,Or.G)((0,Sr.d)((0,Sr.d)((0,Sr.d)(a,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}});var Mr=n(6943),$r=n(9165),Nr=n(4926),Br=n(636),Tr=n(7630),jr=n(4386),Ir=n(3963),zr=n(4365),Rr=n(6230),Pr=n(9133),Lr=n(6573),qr=n(624);function Ur(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:t,stop:e,num:n};return m.BV.runKernel(Vt.e7,{},r)}var Wr=n(9648),Vr=n(2597),Hr=n(7474),Gr=n(3888),Xr=n(1510),Kr=n(1391),Yr=n(2856),Jr=n(8651),Zr=n(5750),Qr=n(596),ti=n(3307),ei=n(1174);const ni=(0,qt.op)({maxPool3d_:function(t,e=[1,1,1],n,r,i,o="NDHWC"){const a=(0,_._1)(t,"x","maxPool3d");let s=a,u=!1;4===a.rank&&(u=!0,s=(0,Rn.X)(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E.hu(5===s.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${s.rank}.`)),E.hu("NDHWC"===o,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`)),null!=i&&E.hu(E.GN(r),(()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${r}.`));const l={x:s},c={filterSize:e,strides:n,pad:r,dimRoundingMode:i,dataFormat:o},f=m.BV.runKernel(Vt.OA,l,c);return u?(0,Rn.X)(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),ri=(0,qt.op)({maxPoolWithArgmax_:function(t,e,n,r,i=!1){const o={x:(0,_._1)(t,"x","maxPoolWithArgmax")},a={filterSize:e,strides:n,pad:r,includeBatchInIndex:i},s=m.BV.runKernel(Vt.vF,o,a);return{result:s[0],indexes:s[1]}}});var ii=n(5130),oi=n(9640);function ai(t,e="float32"){if("complex64"===e){const e=ai(t,"float32"),n=(0,oi.l)(t,"float32");return(0,w.P)(e,n)}const n=(0,E.p8)((0,E.NA)(t),e);return m.BV.makeTensor(n,t,e)}function si(t,e,{indexing:n="xy"}={}){if("xy"!==n&&"ij"!==n)throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(void 0===t)return[];let r=(0,_._1)(t,"x","meshgrid",t instanceof yt.es?t.dtype:"float32");if(void 0===e)return[r];let i=(0,_._1)(e,"y","meshgrid",e instanceof yt.es?e.dtype:"float32");const o=(0,E.NA)(r.shape),a=(0,E.NA)(i.shape);return"xy"===n?(r=(0,Rn.X)(r,[1,-1]),i=(0,Rn.X)(i,[-1,1]),[(0,Pt.O)(ai([a,1],r.dtype),r),(0,Pt.O)(i,ai([1,o],i.dtype))]):(r=(0,Rn.X)(r,[-1,1]),i=(0,Rn.X)(i,[1,-1]),[(0,Pt.O)(r,ai([1,a],r.dtype)),(0,Pt.O)(ai([o,1],i.dtype),i)])}var ui=n(5735),li=n(4513),ci=n(1483),fi=n(5228),hi=n(3591);const di=(0,qt.op)({moments_:function(t,e=null,n=!1){t=(0,_._1)(t,"x","moments");const r=(0,E.EC)(e,t.shape),i=(0,ii.J)(t,r,n);let o=i.shape;n||(o=(0,hi.rv)(i.shape,r));const a=(0,un.h)((0,yn.l)((0,bt.p)(t,"float32"),(0,Rn.X)(i,o)));return{mean:i,variance:(0,ii.J)(a,r,n)}}}),pi=(0,qt.op)({multiRNNCell_:function(t,e,n,r){const i=(0,_._1)(e,"data","multiRNNCell"),o=(0,_.sI)(n,"c","multiRNNCell"),a=(0,_.sI)(r,"h","multiRNNCell");let s=i;const u=[];for(let e=0;e<t.length;e++){const n=t[e](s,o[e],a[e]);u.push(n[0]),u.push(n[1]),s=n[1]}const l=[],c=[];for(let t=0;t<u.length;t+=2)l.push(u[t]),c.push(u[t+1]);return[l,c]}}),gi=(0,qt.op)({multinomial_:function(t,e,n,r=!1){const i=(0,_._1)(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${o}.`);if(a>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${a}`);n=n||Math.random();const s={logits:1===a?(0,Rn.X)(i,[1,-1]):i},u={numSamples:e,seed:n,normalized:r},l=m.BV.runKernel(Vt.NZ,s,u);return 1===a?(0,Rn.X)(l,[l.size]):l}});var mi=n(7370),yi=n(6500),vi=n(7846);const bi=(0,qt.op)({outerProduct_:function(t,e){const n=(0,_._1)(t,"v1","outerProduct"),r=(0,_._1)(e,"v2","outerProduct");E.hu(1===n.rank&&1===r.rank,(()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`));const i=(0,Rn.X)(n,[-1,1]),o=(0,Rn.X)(r,[1,-1]);return(0,Pt.O)(i,o)}});var xi=n(9682);const wi=(0,qt.op)({pad1d_:function(t,e,n=0){return(0,E.hu)(2===e.length,(()=>"Invalid number of paddings. Must be length of 2.")),(0,xi.v)(t,[e],n)}}),_i=(0,qt.op)({pad2d_:function(t,e,n=0){return(0,E.hu)(2===e.length&&2===e[0].length&&2===e[1].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,xi.v)(t,e,n)}}),ki=(0,qt.op)({pad3d_:function(t,e,n=0){return(0,E.hu)(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,xi.v)(t,e,n)}}),Ai=(0,qt.op)({pad4d_:function(t,e,n=0){return(0,E.hu)(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),(0,xi.v)(t,e,n)}});var Ei=n(5860),Di=n(8151),Si=n(9451);const Ci=(0,qt.op)({rand_:function(t,e,n){const r=(0,E.NA)(t);let i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error(`Unknown data type ${n}`);i=new Uint8Array(r)}for(let t=0;t<r;t++)i[t]=e();return m.BV.makeTensor(i,t,n)}});var Oi=n(6377);class Fi{constructor(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const o=i||Math.random();this.random=Oi.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;for(;!n;){let r,i,o;do{r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i}while(o>=1||0===o);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*r*a,e=this.mean+this.stdDev*i*a,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class Mi{constructor(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;const i=r||Math.random();this.randu=Oi.alea(i.toString()),this.randn=new Fi(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,e,n,r,i,o;for(;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,t=r*r,e=1-.331*t*t,n=.5*t+this.d*(1-o+Math.log(o)),i=this.randu(),i<e||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return"float32"===this.dtype?t:Math.round(t)}}class $i{constructor(t=0,e=1,n,r){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=Oi.alea(r)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}const Ni=(0,qt.op)({randomGamma_:function(t,e,n=1,r="float32",i){if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error(`Unsupported data type ${r}`);const o=new Mi(e,n,r,i),a=vt(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}}),Bi=(0,qt.op)({randomNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error(`Unsupported data type ${r}`);const o=new Fi(e,n,r,!1,i),a=vt(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}}),Ti=(0,qt.op)({randomUniform_:function(t,e=0,n=1,r="float32",i){const o=vt(t,r),a=new $i(e,n,null,i);for(let t=0;t<o.values.length;t++)o.values[t]=a.nextValue();return o.toTensor()}});function ji(t,e,n=1,r="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:r};return m.BV.runKernel(Vt.e6,{},i)}var Ii=n(766),zi=n(9036),Ri=n(7409),Pi=n(3582),Li=n(7486);const qi=(0,qt.op)({reverse1d_:function(t){const e=(0,_._1)(t,"x","reverse");return E.hu(1===e.rank,(()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`)),(0,Li.G)(e,0)}}),Ui=(0,qt.op)({reverse2d_:function(t,e){const n=(0,_._1)(t,"x","reverse");return E.hu(2===n.rank,(()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`)),(0,Li.G)(n,e)}}),Wi=(0,qt.op)({reverse3d_:function(t,e){const n=(0,_._1)(t,"x","reverse");return E.hu(3===n.rank,(()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`)),(0,Li.G)(n,e)}}),Vi=(0,qt.op)({reverse4d_:function(t,e){const n=(0,_._1)(t,"x","reverse");return E.hu(4===n.rank,(()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`)),(0,Li.G)(n,e)}});var Hi=n(7809),Gi=n(2634),Xi=n(5503),Ki=n(8678);const Yi=async function(t,e){const n=(0,_._1)(t,"x","setdiff1d"),r=(0,_._1)(e,"y","setdiff1d");E.hu(n.dtype===r.dtype,(()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`)),E.hu(1===n.rank,(()=>`x should be 1D tensor, but got x (${n.shape}).`)),E.hu(1===r.rank,(()=>`y should be 1D tensor, but got y (${r.shape}).`));const i=await n.data(),o=await r.data(),a=new Set(o);let s=0;for(let t=0;t<i.length;t++)a.has(i[t])||s++;const u=new yt.YD([s],n.dtype),l=new yt.YD([s],"int32");for(let t=0,e=0;t<i.length;t++)a.has(i[t])||(u.values[e]=i[t],l.values[e]=t,e++);return[u.toTensor(),l.toTensor()]};var Ji=n(4434),Zi=n(9331),Qi=n(3254);const to=(0,qt.op)({slice1d_:function(t,e,n){const r=(0,_._1)(t,"x","slice1d");return E.hu(1===r.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`)),(0,Un.t)(r,[e],[n])}}),eo=(0,qt.op)({slice2d_:function(t,e,n){const r=(0,_._1)(t,"x","slice2d");return E.hu(2===r.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`)),(0,Un.t)(r,e,n)}}),no=(0,qt.op)({slice3d_:function(t,e,n){const r=(0,_._1)(t,"x","slice3d");return E.hu(3===r.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`)),(0,Un.t)(r,e,n)}}),ro=(0,qt.op)({slice4d_:function(t,e,n){const r=(0,_._1)(t,"x","slice4d");return E.hu(4===r.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`)),(0,Un.t)(r,e,n)}});var io=n(682),oo=n(3694),ao=n(7918),so=n(7020),uo=n(8447),lo=n(4415),co=n(3710),fo=n(8644),ho=n(5265),po=n(9590),go=n(2991),mo=n(1901),yo=n(5158),vo=n(5475),bo=n(1173);function xo(t,e){(0,E.Cq)(t);const n=(0,_.C)(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return(0,k.H)(t,null,n,e)}function wo(t,e,n){if((0,E.Cq)(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const r=(0,_.C)(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return(0,k.H)(t,e,r,n)}function _o(t,e,n){if((0,E.Cq)(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");const r=(0,_.C)(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return(0,k.H)(t,e,r,n)}function ko(t,e,n){if((0,E.Cq)(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");const r=(0,_.C)(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return(0,k.H)(t,e,r,n)}function Ao(t,e,n){if((0,E.Cq)(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");const r=(0,_.C)(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,(0,k.H)(t,e,r,n)}var Eo=n(3243);const Do=(0,qt.op)({truncatedNormal_:function(t,e=0,n=1,r,i){if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");const o=new Fi(e,n,r,!0,i),a=vt(t,r);for(let t=0;t<a.values.length;t++)a.values[t]=o.nextValue();return a.toTensor()}});var So=n(9608),Co=n(8749),Oo=n(4136);function Fo(t,e=!0,n,r){return m.BV.makeVariable(t,e,n,r)}var Mo=n(5912);function $o(t,e){const n=[];for(let t=0;t<e.length;t++)e[t]&&n.push(t);const r=vt(t,"int32"),i=vt([n.length,t.length],"int32");for(let e=0;e<n.length;e++){const o=r.indexToLoc(n[e]),a=e*t.length;i.values.set(o,a)}return i.toTensor()}const No=async function(t){const e=(0,_._1)(t,"condition","whereAsync","bool"),n=await e.data(),r=$o(e.shape,n);return t!==e&&e.dispose(),r},Bo=async function(t,e,n){const r=(0,_._1)(t,"tensor","boolMask"),i=(0,_._1)(e,"mask","boolMask","bool"),o=null==n?0:n,a=i.rank,s=r.shape;E.hu(a>0,(()=>"mask cannot be scalar")),E.k5(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let t=o;t<o+a;t++)u*=s[t];const l=s.slice(0,o).concat([u],s.slice(o+a)),c=(0,Rn.X)(r,l),f=(0,Rn.X)(i,[-1]),h=await No(f),d=(0,po.L)(h,[1]),p=(0,Nr.I)(c,d,o);return t!==r&&r.dispose(),e!==i&&i.dispose(),d.dispose(),c.dispose(),f.dispose(),h.dispose(),p};var To=n(3561);const jo=(0,qt.op)({movingAverage_:function(t,e,n,r,i=!0){const o=(0,_._1)(t,"v","movingAverage"),a=(0,_._1)(e,"x","movingAverage"),s=(0,_._1)(n,"decay","movingAverage");(0,_e.assertTypesMatch)(o,a),E.hu(E.cO(o.shape,a.shape),(()=>"Shape mismatch in v and x"));const u=(0,fn.i)(1),l=(0,yn.l)(u,s);let c=(0,an.d)((0,yn.l)(a,o),l);if(i){E.hu(null!=r,(()=>"When using zeroDebias: true, step is required."));const t=(0,_._1)(r,"step","movingAverage");c=(0,on.h)(c,(0,yn.l)(u,(0,mn.s)(s,t)))}return(0,rn.I)(o,c)}}),Io=(0,qt.op)({scatterND_:function(t,e,n){const r=(0,_._1)(t,"indices","scatterND","int32"),i=(0,_._1)(e,"updates","scatterND");ee(i,r,n);const o={indices:r,updates:i},a={shape:n};return m.BV.runKernel(Vt.xQ,o,a)}}),zo=(0,qt.op)({sparseToDense_:function(t,e,n,r=0){const i=(0,_._1)(t,"sparseIndices","sparseToDense","int32"),o=(0,_._1)(e,"sparseValues","sparseToDense"),a=(0,_._1)(r,"defaultValue","sparseToDense",o.dtype);!function(t,e,n,r){if("int32"!==t.dtype)throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${o}.`);const a=e.size;if(0!==e.rank&&(1!==e.rank||a!==i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,a);const s={sparseIndices:i,sparseValues:o,defaultValue:a},u={outputShape:n};return m.BV.runKernel(Vt.D2,s,u)}}),Ro=(0,qt.op)({gatherND_:function(t,e){const n=(0,_._1)(e,"indices","gatherND","int32"),r={params:(0,_._1)(t,"x","gatherND"),indices:n};return m.BV.runKernel(Vt.q1,r)}}),Po=(0,qt.op)({dropout_:function(t,e,n,r){const i=(0,_._1)(t,"x","dropout");if(E.hu("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),E.hu(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof yt.es?i.clone():i;const o=function(t,e){if(null==e)return t.shape.slice();if(E.cO(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),a=1-e,s=(0,on.h)((0,Mr.G)((0,rn.I)(Ti(o,0,1,"float32",r),a)),a);return(0,an.d)(i,s)}});function Lo(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function qo(t,e,n){const r=1-t%2,i=new Float32Array(t);for(let o=0;o<t;++o){const a=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(a)}return xo(i,"float32")}const Uo=async function(t,e,n=1){const r=(0,_._1)(t,"predictions","inTopK"),i=(0,_._1)(e,"targets","inTopK");(0,E.hu)(r.rank>1,(()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`)),(0,E.hu)(r.rank-1===i.rank,(()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`)),(0,E.k5)(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const o=r.shape[r.shape.length-1];(0,E.hu)(n>0&&n<=o,(()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${o}), but got ${n}`));const a=await r.data(),s=await i.data(),[u,l]=[a.length/o,o],c=(0,E.WP)("bool",u);for(let t=0;t<u;t++){const e=t*l,r=a.subarray(e,e+l),i=[];for(let t=0;t<r.length;t++)i.push({value:r[t],index:t});i.sort(((t,e)=>e.value-t.value)),c[t]=0;for(let e=0;e<n;e++)if(i[e].index===s[t]){c[t]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),A(c,i.shape,"bool")};var Wo=n(2200);const Vo=(0,qt.op)({conv2DBackpropFilter_:function(t,e,n,r,i,o="NHWC",a){let s=t;3===t.rank&&(s=(0,Rn.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=(0,Rn.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]])),E.hu(4===s.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`)),E.hu(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),E.hu(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const l="NHWC"===o?s.shape[3]:s.shape[1],c="NHWC"===o?u.shape[3]:u.shape[1];E.hu(l===n[2],(()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`)),E.hu(c===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`)),null!=a&&E.hu(E.GN(i),(()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${a} but got pad ${i}.`));const f={x:s,dy:u},h={strides:r,pad:i,dataFormat:o,dimRoundingMode:a,filterShape:n};return m.BV.runKernel(Vt.wU,f,h)}});var Ho=n(9832);function Go(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return(0,an.d)(t,(0,mo.N)(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Xo(t,e){let n=e;const r=Wo.RR(t.shape,e.shape);return r.length>0&&(n=(0,vo.S)(n,r)),(0,Rn.X)(n,t.shape)}function Ko(t,e,n,r){if("linear"===e)return t;if("relu"===e)return(0,Ri.U)(t);if("elu"===e)return(0,kr.p)(t);if("relu6"===e)return(0,Pi.b)(t);if("prelu"===e)return(0,Di.A)(t,n);if("leakyrelu"===e)return(0,Pr.h)(t,r);if("sigmoid"===e)return(0,qn.X)(t);throw new Error(`Unknown fused activation ${e}.`)}const Yo=(t,e)=>!(t>0)||"linear"===e,Jo=(0,qt.op)({fusedConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",!1===Yo(m.BV.state.gradientDepth,u)){let f=(0,ar.T)(t,e,n,r,i,o,a);return null!=s&&(f=(0,rn.I)(f,s)),Ko(f,u,l,c)}const f=(0,_._1)(t,"x","conv2d"),h=(0,_._1)(e,"filter","conv2d");let d=f,p=!1;3===f.rank&&(p=!0,d=(0,Rn.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),E.hu(4===d.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`)),E.hu(4===h.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`)),null!=a&&E.hu(E.GN(r),(()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${a} but got pad ${r}.`)),E.hu(d.shape[3]===h.shape[2],(()=>`Error in conv2d: depth of input (${d.shape[3]}) must match input depth for filter ${h.shape[2]}.`)),E.hu(ur.jT(n,o),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),E.hu("NHWC"===i,(()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`));const g=ur.Ix(d.shape,h.shape,n,o,r,a);let y,v;null!=s&&(y=(0,_._1)(s,"bias","fused conv2d"),[y]=(0,_e.makeTypesMatch)(y,f),Wo.$N(g.outShape,y.shape)),null!=l&&(v=(0,_._1)(l,"prelu weights","fused conv2d"));const b=(t,e)=>{const[i,a,s,l]=e,c=Go(t,s,u);E.hu(ur.I0(o),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`));const f=[(0,Ho._)(a.shape,c,i,n,r),Vo(a,c,i.shape,n,r)];if(null!=l){const t=Xo(l,c);f.push(t)}return f},x={x:d,filter:h,bias:y,preluActivationWeights:v},w={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:a,activation:u,leakyreluAlpha:c};return null==s?(0,cn.cb)(((t,e,n)=>{let r=m.BV.runKernel(Vt._V,x,w);return n([e,t,r]),p&&(r=(0,Rn.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(d,h):(0,cn.cb)(((t,e,n,r)=>{let i=m.BV.runKernel(Vt._V,x,w);return r([e,t,i,n]),p&&(i=(0,Rn.X)(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}))(d,h,y)}}),Zo=(0,qt.op)({depthwiseConv2dNativeBackpropFilter_:function(t,e,n,r,i,o=[1,1],a){let s=t;3===t.rank&&(s=(0,Rn.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=(0,Rn.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={x:s,dy:u},c={strides:r,pad:i,dimRoundingMode:a,dilations:o,filterShape:n};return m.BV.runKernel(Vt.sL,l,c)}}),Qo=(0,qt.op)({depthwiseConv2dNativeBackpropInput_:function(t,e,n,r,i,o=[1,1],a){let s=e,u=!1;3===e.rank&&(u=!0,s=(0,Rn.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const l={dy:s,filter:n},c={strides:r,pad:i,dimRoundingMode:a,dilations:o,inputShape:t},f=m.BV.runKernel(Vt.y7,l,c);return u?(0,Rn.X)(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),ta=(0,qt.op)({fusedDepthwiseConv2d_:function({x:t,filter:e,strides:n,pad:r,dataFormat:i="NHWC",dilations:o=[1,1],dimRoundingMode:a,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(!1===Yo(m.BV.state.gradientDepth,u)){let f=(0,yr.B)(t,e,n,r,i,o,a);return null!=s&&(f=(0,rn.I)(f,s)),Ko(f,u,l,c)}const f=(0,_._1)(t,"x","depthwiseConv2d"),h=(0,_._1)(e,"filter","depthwiseConv2d");let d=f,p=!1;3===f.rank&&(p=!0,d=(0,Rn.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),E.hu(4===d.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`)),E.hu(4===h.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`)),E.hu(d.shape[3]===h.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`)),null==o&&(o=[1,1]),E.hu(ur.jT(n,o),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),null!=a&&E.hu(E.GN(r),(()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${a} but got pad ${r}.`));const g=ur.Ix(d.shape,h.shape,n,o,r,a,!0);let y,v;null!=s&&(y=(0,_._1)(s,"bias","fused conv2d"),[y]=(0,_e.makeTypesMatch)(y,f),Wo.$N(g.outShape,y.shape)),null!=l&&(v=(0,_._1)(l,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{E.hu(ur.I0(o),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${o}'`));const[i,s,l,c]=e,f=Go(t,l,u),h=Qo(s.shape,f,i,n,r,o,a),d=Zo(s,f,i.shape,n,r,o,a);return null!=c?[h,d,Xo(y,f)]:[h,d]},x={x:d,filter:h,bias:y,preluActivationWeights:v},w={strides:n,pad:r,dataFormat:i,dilations:o,dimRoundingMode:a,activation:u,leakyreluAlpha:c};return null==s?(0,cn.cb)(((t,e,n)=>{let r=m.BV.runKernel(Vt.lu,x,w);return n([e,t,r]),p&&(r=(0,Rn.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:b}}))(d,h):(0,cn.cb)(((t,e,n,r)=>{let i=m.BV.runKernel(Vt.lu,x,w);return r([e,t,i,n]),p&&(i=(0,Rn.X)(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}))(d,h,y)}}),ea=(0,qt.op)({fusedMatMul_:function({a:t,b:e,transposeA:n=!1,transposeB:r=!1,bias:i,activation:o="linear",preluActivationWeights:a,leakyreluAlpha:s}){if(!1===Yo(m.BV.state.gradientDepth,o)){let u=(0,Pt.O)(t,e,n,r);return null!=i&&(u=(0,rn.I)(u,i)),Ko(u,o,a,s)}let u=(0,_._1)(t,"a","fused matMul"),l=(0,_._1)(e,"b","fused matMul");[u,l]=(0,_e.makeTypesMatch)(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),g=l.shape.slice(0,-2),y=E.NA(p),v=E.NA(g);E.hu(u.rank>=2&&l.rank>=2&&u.rank===l.rank,(()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${u.rank} and ${l.rank}.`)),E.hu(E.cO(p,g),(()=>`Error in fused matMul: outer dimensions (${p}) and (${g}) of Tensors with shapes ${u.shape} and ${l.shape} must match.`)),E.hu(c===f,(()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`));const b=u.shape.slice(0,-2).concat([h,d]),x=n?(0,Rn.X)(u,[y,c,h]):(0,Rn.X)(u,[y,h,c]),w=r?(0,Rn.X)(l,[v,d,f]):(0,Rn.X)(l,[v,f,d]);let k,A;null!=i&&(k=(0,_._1)(i,"bias","fused matMul"),[k]=(0,_e.makeTypesMatch)(k,u),Wo.$N(b,k.shape)),null!=a&&(A=(0,_._1)(a,"prelu weights","fused matMul"));const D=(t,e)=>{const[a,s,u,l]=e,c=Go((0,Rn.X)(t,u.shape),u,o);let f,h;return n||r?!n&&r?(f=(0,Pt.O)(c,s,!1,!1),h=(0,Pt.O)(c,a,!0,!1)):n&&!r?(f=(0,Pt.O)(s,c,!1,!0),h=(0,Pt.O)(a,c,!1,!1)):(f=(0,Pt.O)(s,c,!0,!0),h=(0,Pt.O)(c,a,!0,!0)):(f=(0,Pt.O)(c,s,!1,!0),h=(0,Pt.O)(a,c,!0,!1)),null!=i?[f,h,Xo(l,c)]:[f,h]},S={a:x,b:w,bias:k,preluActivationWeights:A},C={transposeA:n,transposeB:r,activation:o,leakyreluAlpha:s};return null==i?(0,cn.cb)(((t,e,n)=>{const r=m.BV.runKernel(Vt.us,S,C);return n([t,e,r]),{value:(0,Rn.X)(r,b),gradFunc:D}}))(x,w):(0,cn.cb)(((t,e,n,r)=>{const i=m.BV.runKernel(Vt.us,S,C);return r([t,e,i,n]),{value:(0,Rn.X)(i,b),gradFunc:D}}))(x,w,k)}}),na=(0,qt.op)({hammingWindow_:function(t){return qo(t,.54,.46)}}),ra=(0,qt.op)({hannWindow_:function(t){return qo(t,.5,.5)}}),ia=(0,qt.op)({frame_:function(t,e,n,r=!1,i=0){let o=0;const a=[];for(;o+e<=t.size;)a.push((0,Un.t)(t,o,e)),o+=n;if(r)for(;o<t.size;){const r=o+e-t.size,s=(0,Ln.z)([(0,Un.t)(t,o,e-r),pn([r],i)]);a.push(s),o+=n}return 0===a.length?wo([],[0,e]):(0,Rn.X)((0,Ln.z)(a),[a.length,e])}}),oa=(0,qt.op)({stft_:function(t,e,n,r,i=ra){null==r&&(r=Lo(e));const o=ia(t,e,n),a=(0,an.d)(o,i(e));return(0,co.Q)(a,r)}}),aa=(0,qt.op)({cropAndResize_:function(t,e,n,r,i="bilinear",o=0){const a=(0,_._1)(t,"image","cropAndResize"),s=(0,_._1)(e,"boxes","cropAndResize","float32"),u=(0,_._1)(n,"boxInd","cropAndResize","int32"),l=s.shape[0];E.hu(4===a.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${a.rank}.`)),E.hu(2===s.rank&&4===s.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${s.shape}.`)),E.hu(1===u.rank&&u.shape[0]===l,(()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${s.shape}.`)),E.hu(2===r.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`)),E.hu(r[0]>=1&&r[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${r}`)),E.hu("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const c={image:a,boxes:s,boxInd:u},f={method:i,extrapolationValue:o,cropSize:r};return m.BV.runKernel(Vt.Vc,c,f)}}),sa=(0,qt.op)({flipLeftRight_:function(t){const e=(0,_._1)(t,"image","flipLeftRight","float32");E.hu(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e};return m.BV.runKernel(Vt.Uy,n,{})}}),ua=(0,qt.op)({rotateWithOffset_:function(t,e,n=0,r=.5){const i=(0,_._1)(t,"image","rotateWithOffset","float32");E.hu(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const o={image:i},a={radians:e,fillValue:n,center:r};return m.BV.runKernel(Vt.b9,o,a)}});function la(t,e,n,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);const a=t.shape[0];return n=Math.min(n,a),E.hu(0<=r&&r<=1,(()=>`iouThreshold must be in [0, 1], but was '${r}'`)),E.hu(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),E.hu(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),E.hu(1===e.rank,(()=>"scores must be a 1D tensor")),E.hu(e.shape[0]===a,(()=>`scores has incompatible shape with boxes. Expected ${a}, but was ${e.shape[0]}`)),E.hu(0<=o&&o<=1,(()=>`softNmsSigma must be in [0, 1], but was '${o}'`)),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}const ca=(0,qt.op)({nonMaxSuppression_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const o=(0,_._1)(t,"boxes","nonMaxSuppression"),a=(0,_._1)(e,"scores","nonMaxSuppression"),s=la(o,a,n,r,i),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold};return m.BV.runKernel(Vt.uv,{boxes:o,scores:a},u)}});function fa(t,e,n){const r=function(t,e,n){return function(t,e,n){let r=0,i=t.length,o=0,a=!1;for(;r<i;){o=r+(i-r>>>1);const s=n(e,t[o]);s>0?r=o+1:(i=o,a=!s)}return a?r:-r-1}(t,e,n||ha)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function ha(t,e){return t>e?1:t<e?-1:0}function da(t,e,n,r,i){return ma(t,e,n,r,i,0)}function pa(t,e,n,r,i,o){return ma(t,e,n,r,i,0,!1,o,!0)}function ga(t,e,n,r,i,o){return ma(t,e,n,r,i,o,!0)}function ma(t,e,n,r,i,o,a=!1,s=!1,u=!1){const l=[];for(let t=0;t<e.length;t++)e[t]>i&&l.push({score:e[t],boxIndex:t,suppressBeginIndex:0});l.sort(ba);const c=o>0?-.5/o:0,f=[],h=[];for(;f.length<n&&l.length>0;){const e=l.pop(),{score:n,boxIndex:o,suppressBeginIndex:a}=e;if(n<i)break;let s=!1;for(let n=f.length-1;n>=a;--n){const a=ya(t,o,f[n]);if(a>=r){s=!0;break}if(e.score=e.score*va(r,c,a),e.score<=i)break}e.suppressBeginIndex=f.length,s||(e.score===n?(f.push(o),h.push(e.score)):e.score>i&&fa(l,e,ba))}const d=f.length,p=n-d;s&&p>0&&(f.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const g={selectedIndices:f};return a&&(g.selectedScores=h),u&&(g.validOutputs=d),g}function ya(t,e,n){const r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),d=(s-o)*(u-a),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;const g=Math.max(o,l),m=Math.max(a,c),y=Math.min(s,f),v=Math.min(u,h),b=Math.max(y-g,0)*Math.max(v-m,0);return b/(d+p-b)}function va(t,e,n){const r=Math.exp(e*n*n);return n<=t?r:0}function ba(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}const xa=(0,qt.op)({nonMaxSuppressionWithScore_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=0){const a=(0,_._1)(t,"boxes","nonMaxSuppression"),s=(0,_._1)(e,"scores","nonMaxSuppression"),u=la(a,s,n,r,i,o),l={boxes:a,scores:s},c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},f=m.BV.runKernel(Vt.W0,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}}),wa=(0,qt.op)({nonMaxSuppressionPadded_:function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=!1){const a=(0,_._1)(t,"boxes","nonMaxSuppression"),s=(0,_._1)(e,"scores","nonMaxSuppression"),u=la(a,s,n,r,i,null),l={boxes:a,scores:s},c={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},f=m.BV.runKernel(Vt.cy,l,c);return{selectedIndices:f[0],validOutputs:f[1]}}});var _a=n(3305),ka=n(5098);const Aa=(0,qt.op)({transform_:function(t,e,n="nearest",r="constant",i=0,o){const a=(0,_._1)(t,"image","transform","float32"),s=(0,_._1)(e,"transforms","transform","float32");E.hu(4===a.rank,(()=>`Error in transform: image must be rank 4,but got rank ${a.rank}.`)),E.hu(2===s.rank&&(s.shape[0]===a.shape[0]||1===s.shape[0])&&8===s.shape[1],(()=>"Error in transform: Input transform should be batch x 8 or 1 x 8")),E.hu(null==o||2===o.length,(()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`));const u={image:a,transforms:s},l={interpolation:n,fillMode:r,fillValue:i,outputShape:o};return m.BV.runKernel(Vt.wx,u,l)}}),Ea=(0,qt.op)({bandPart_:function(t,e,n){(0,E.hu)(e%1==0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),(0,E.hu)(n%1==0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const r=(0,_._1)(t,"a","bandPart");(0,E.hu)(r.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`));const i=r.shape,[o,a]=r.shape.slice(-2);if(!(e<=o))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`);if(!(n<=a))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${a}).`);e<0&&(e=o),n<0&&(n=a);const s=(0,Rn.X)(ji(0,o,1,"int32"),[-1,1]),u=ji(0,a,1,"int32"),l=(0,yn.l)(s,u),c=(0,Yr.H)((0,qr.z)(l,(0,fn.i)(+e,"int32")),(0,Tr.b)(l,(0,fn.i)(-n,"int32"))),f=(0,oi.l)([o,a],r.dtype);return(0,Rn.X)((0,go.k)((0,Oo.H)((0,Rn.X)(r,[-1,o,a])).map((t=>(0,Mo.a)(c,t,f)))),i)}}),Da=(0,qt.op)({gramSchmidt_:function(t){let e;if(Array.isArray(t)){e=!1,(0,E.hu)(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)(0,E.hu)(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=(0,fo.V)(t,t.shape[0],0).map((t=>(0,po.L)(t,[0])));(0,E.hu)(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],r=t;for(let e=0;e<t.length;++e)n.push(m.BV.tidy((()=>{let t=r[e];if(e>0)for(let r=0;r<e;++r){const e=(0,an.d)((0,vo.S)((0,an.d)(n[r],t)),n[r]);t=(0,yn.l)(t,e)}return(0,on.h)(t,(0,To.K)(t,"euclidean"))})));return e?(0,go.k)(n,0):n}});function Sa(t,e=!1){return m.BV.tidy((()=>{(0,E.hu)(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],r=t.shape[1];let i=Fr(n),o=(0,xt.d)(t);const a=wo([[1]],[1,1]);let s=(0,xt.d)(a);const u=n>=r?r:n;for(let t=0;t<u;++t){const e=o,u=s,l=i;[s,o,i]=m.BV.tidy((()=>{const e=(0,Un.t)(o,[t,t],[n-t,1]),u=(0,To.K)(e),l=(0,Un.t)(o,[t,t],[1,1]),c=(0,Mo.a)((0,Br.p)(l,0),wo([[-1]]),wo([[1]])),f=(0,yn.l)(l,(0,an.d)(c,u)),h=(0,on.h)(e,f);s=1===h.shape[0]?(0,xt.d)(a):(0,Ln.z)([a,(0,Un.t)(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);const d=(0,mi.W)((0,on.h)((0,Pt.O)(c,f),u)),p=(0,Un.t)(o,[t,0],[n-t,r]),g=(0,an.d)(d,s),m=(0,Ut.p)(s);if(0===t)o=(0,yn.l)(p,(0,Pt.O)(g,(0,Pt.O)(m,p)));else{const e=(0,yn.l)(p,(0,Pt.O)(g,(0,Pt.O)(m,p)));o=(0,Ln.z)([(0,Un.t)(o,[0,0],[t,r]),e],0)}const y=(0,Ut.p)(g),v=(0,Un.t)(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=(0,yn.l)(v,(0,Pt.O)((0,Pt.O)(v,s),y));else{const e=(0,yn.l)(v,(0,Pt.O)((0,Pt.O)(v,s),y));i=(0,Ln.z)([(0,Un.t)(i,[0,0],[n,t]),e],1)}return[s,o,i]})),Ve([e,u,l])}return!e&&n>r&&(i=(0,Un.t)(i,[0,0],[n,r]),o=(0,Un.t)(o,[0,0],[r,r])),[i,o]}))}const Ca=(0,qt.op)({qr_:function(t,e=!1){if((0,E.hu)(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Sa(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),r=(0,Oo.H)((0,Rn.X)(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach((t=>{const[n,r]=Sa(t,e);i.push(n),o.push(r)})),[(0,Rn.X)((0,go.k)(i,0),t.shape),(0,Rn.X)((0,go.k)(o,0),t.shape)]}}});var Oa;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Oa||(Oa={}));const Fa=(0,qt.op)({computeWeightedLoss_:function(t,e,n=Oa.SUM_BY_NONZERO_WEIGHTS){const r=(0,_._1)(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=(0,_._1)(e,"weights","computeWeightedLoss"));const o=null==i?r:(0,an.d)(r,i);if(n===Oa.NONE)return o;if(n===Oa.SUM)return(0,vo.S)(o);if(n===Oa.MEAN){if(null==i)return(0,ii.J)(o);{const t=r.size/i.size,e=(0,on.h)((0,vo.S)(o),(0,vo.S)(i));return t>1?(0,on.h)(e,(0,fn.i)(t)):e}}if(n===Oa.SUM_BY_NONZERO_WEIGHTS){if(null==i)return(0,on.h)((0,vo.S)(o),(0,fn.i)(r.size));{const t=(0,an.d)(i,ai(r.shape)),e=(0,bt.p)((0,vo.S)((0,yi.Q)(t,(0,fn.i)(0))),"float32");return(0,on.h)((0,vo.S)(o),e)}}throw Error(`Unknown reduction: ${n}`)}}),Ma=(0,qt.op)({absoluteDifference_:function(t,e,n,r=Oa.SUM_BY_NONZERO_WEIGHTS){const i=(0,_._1)(t,"labels","absoluteDifference"),o=(0,_._1)(e,"predictions","absoluteDifference");let a=null;null!=n&&(a=(0,_._1)(n,"weights","absoluteDifference")),(0,E.k5)(i.shape,o.shape,"Error in absoluteDifference: ");const s=(0,bn.W)((0,yn.l)(i,o));return Fa(s,a,r)}}),$a=(0,qt.op)({cosineDistance_:function(t,e,n,r,i=Oa.SUM_BY_NONZERO_WEIGHTS){const o=(0,_._1)(t,"labels","cosineDistance"),a=(0,_._1)(e,"predictions","cosineDistance");let s=null;null!=r&&(s=(0,_._1)(r,"weights","cosineDistance")),(0,E.k5)(o.shape,a.shape,"Error in cosineDistance: ");const u=(0,fn.i)(1),l=(0,yn.l)(u,(0,vo.S)((0,an.d)(o,a),n,!0));return Fa(l,s,i)}}),Na=(0,qt.op)({hingeLoss_:function(t,e,n,r=Oa.SUM_BY_NONZERO_WEIGHTS){let i=(0,_._1)(t,"labels","hingeLoss");const o=(0,_._1)(e,"predictions","hingeLoss");let a=null;null!=n&&(a=(0,_._1)(n,"weights","hingeLoss")),(0,E.k5)(i.shape,o.shape,"Error in hingeLoss: ");const s=(0,fn.i)(1);i=(0,yn.l)((0,an.d)((0,fn.i)(2),i),s);const u=(0,Ri.U)((0,yn.l)(s,(0,an.d)(i,o)));return Fa(u,a,r)}}),Ba=(0,qt.op)({huberLoss_:function(t,e,n,r=1,i=Oa.SUM_BY_NONZERO_WEIGHTS){const o=(0,_._1)(t,"labels","huberLoss"),a=(0,_._1)(e,"predictions","huberLoss");let s=null;null!=n&&(s=(0,_._1)(n,"weights","huberLoss")),(0,E.k5)(o.shape,a.shape,"Error in huberLoss: ");const u=(0,fn.i)(r),l=(0,bn.W)((0,yn.l)(a,o)),c=(0,li.L)(l,u),f=(0,yn.l)(l,c),h=(0,rn.I)((0,an.d)((0,fn.i)(.5),(0,un.h)(c)),(0,an.d)(u,f));return Fa(h,s,i)}}),Ta=(0,qt.op)({logLoss_:function(t,e,n,r=1e-7,i=Oa.SUM_BY_NONZERO_WEIGHTS){const o=(0,_._1)(t,"labels","logLoss"),a=(0,_._1)(e,"predictions","logLoss");let s=null;null!=n&&(s=(0,_._1)(n,"weights","logLoss")),(0,E.k5)(o.shape,a.shape,"Error in logLoss: ");const u=(0,fn.i)(1),l=(0,fn.i)(r),c=(0,mi.W)((0,an.d)(o,(0,Vr.c)((0,rn.I)(a,l)))),f=(0,an.d)((0,yn.l)(u,o),(0,Vr.c)((0,rn.I)((0,yn.l)(u,a),l))),h=(0,yn.l)(c,f);return Fa(h,s,i)}}),ja=(0,qt.op)({meanSquaredError_:function(t,e,n,r=Oa.SUM_BY_NONZERO_WEIGHTS){const i=(0,_._1)(t,"labels","meanSquaredError"),o=(0,_._1)(e,"predictions","meanSquaredError");let a=null;null!=n&&(a=(0,_._1)(n,"weights","meanSquaredError")),(0,E.k5)(i.shape,o.shape,"Error in meanSquaredError: ");const s=(0,ho.$)(i,o);return Fa(s,a,r)}}),Ia=(0,qt.op)({sigmoidCrossEntropy_:function(t,e,n,r=0,i=Oa.SUM_BY_NONZERO_WEIGHTS){let o=(0,_._1)(t,"multiClassLabels","sigmoidCrossEntropy");const a=(0,_._1)(e,"logits","sigmoidCrossEntropy");let s=null;if(null!=n&&(s=(0,_._1)(n,"weights","sigmoidCrossEntropy")),(0,E.k5)(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){const t=(0,fn.i)(r),e=(0,fn.i)(1),n=(0,fn.i)(.5);o=(0,rn.I)((0,an.d)(o,(0,yn.l)(e,t)),(0,an.d)(n,t))}const u=function(t,e){const n=(0,_._1)(t,"labels","sigmoidCrossEntropyWithLogits"),r=(0,_._1)(e,"logits","sigmoidCrossEntropyWithLogits");(0,E.k5)(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=(0,Ri.U)(r),o=(0,an.d)(r,n),a=(0,Hr.K)((0,Dr.Q)((0,mi.W)((0,bn.W)(r))));return(0,rn.I)((0,yn.l)(i,o),a)}(o,a);return Fa(u,s,i)}}),za=(0,qt.op)({softmaxCrossEntropy_:function(t,e,n,r=0,i=Oa.SUM_BY_NONZERO_WEIGHTS){let o=(0,_._1)(t,"onehotLabels","softmaxCrossEntropy");const a=(0,_._1)(e,"logits","softmaxCrossEntropy");let s=null;if(null!=n&&(s=(0,_._1)(n,"weights","softmaxCrossEntropy")),(0,E.k5)(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){const t=(0,fn.i)(r),e=(0,fn.i)(1),n=(0,fn.i)(o.shape[1]);o=(0,rn.I)((0,an.d)(o,(0,yn.l)(e,t)),(0,on.h)(t,n))}const u=function(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return(0,cn.cb)(((t,e,r)=>{const i=(0,Kr.l)(e,[n],!0),o=(0,yn.l)((0,bt.p)(e,"float32"),i);r([t,o]);const a=(0,mi.W)((0,an.d)(o,t));return{value:(0,vo.S)(a,[n]),gradFunc:(t,e)=>{const[r,i]=e,o=(0,hi.rv)(t.shape,[n]);return[(0,an.d)((0,Rn.X)(t,o),(0,yn.l)((0,bt.p)(r,"float32"),(0,Dr.Q)(i))),(0,an.d)((0,Rn.X)(t,o),(0,yn.l)((0,Dr.Q)(i),(0,bt.p)(r,"float32")))]}}}))(t,e)}(o,a);return Fa(u,s,i)}}),Ra=(0,qt.op)({sparseReshape_:function(t,e,n){const r=(0,_._1)(t,"inputIndices","sparseReshape"),i=(0,_._1)(e,"inputShape","sparseReshape"),o=(0,_._1)(n,"newShape","sparseReshape");if(2!==r.rank)throw new Error(`Input indices should be Tensor2D but received shape\n        ${r.shape}`);if(1!==i.rank)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(1!==o.rank)throw new Error(`New shape should be Tensor1D but received shape ${o.shape}`);const a={inputIndices:r,inputShape:i,newShape:o},s=m.BV.runKernel(Vt.nh,a);return{outputIndices:s[0],outputShape:s[1]}}}),Pa={fft:so.k,ifft:uo.S,rfft:co.Q,irfft:lo.w},La={hammingWindow:na,hannWindow:ra,frame:ia,stft:oa},qa={flipLeftRight:sa,resizeNearestNeighbor:ka.j,resizeBilinear:_a.I,rotateWithOffset:ua,cropAndResize:aa,nonMaxSuppression:ca,nonMaxSuppressionAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY){const o=(0,_._1)(t,"boxes","nonMaxSuppressionAsync"),a=(0,_._1)(e,"scores","nonMaxSuppressionAsync"),s=la(o,a,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;const u=await Promise.all([o.data(),a.data()]),l=u[0],c=u[1],{selectedIndices:f}=da(l,c,n,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),xo(f,"int32")},nonMaxSuppressionWithScore:xa,nonMaxSuppressionWithScoreAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=0){const a=(0,_._1)(t,"boxes","nonMaxSuppressionAsync"),s=(0,_._1)(e,"scores","nonMaxSuppressionAsync"),u=la(a,s,n,r,i,o);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma;const l=await Promise.all([a.data(),s.data()]),c=l[0],f=l[1],{selectedIndices:h,selectedScores:d}=ga(c,f,n,r,i,o);return a!==t&&a.dispose(),s!==e&&s.dispose(),{selectedIndices:xo(h,"int32"),selectedScores:xo(d)}},nonMaxSuppressionPadded:wa,nonMaxSuppressionPaddedAsync:async function(t,e,n,r=.5,i=Number.NEGATIVE_INFINITY,o=!1){const a=(0,_._1)(t,"boxes","nonMaxSuppressionAsync"),s=(0,_._1)(e,"scores","nonMaxSuppressionAsync"),u=la(a,s,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[h,d]=await Promise.all([a.data(),s.data()]),{selectedIndices:p,validOutputs:g}=pa(h,d,l,c,f,o);return a!==t&&a.dispose(),s!==e&&s.dispose(),{selectedIndices:xo(p,"int32"),validOutputs:(0,fn.i)(g,"int32")}},transform:Aa},Ua={bandPart:Ea,gramSchmidt:Da,qr:Ca},Wa={absoluteDifference:Ma,computeWeightedLoss:Fa,cosineDistance:$a,hingeLoss:Na,huberLoss:Ba,logLoss:Ta,meanSquaredError:ja,sigmoidCrossEntropy:Ia,softmaxCrossEntropy:za},Va={sparseReshape:Ra};class Ha{static sgd(t){return new _n(t)}static momentum(t,e,n=!1){return new kn(t,e,n)}static rmsprop(t,e=.9,n=0,r=null,i=!1){return new An(t,e,n,r,i)}static adam(t=.001,e=.9,n=.999,r=null){return new vn(t,e,n,r)}static adadelta(t=.001,e=.95,n=null){return new dn(t,e,n)}static adamax(t=.002,e=.9,n=.999,r=null,i=0){return new wn(t,e,n,r,i)}static adagrad(t,e=.1){return new gn(t,e)}}const Ga={sgd:Ha.sgd,momentum:Ha.momentum,adadelta:Ha.adadelta,adagrad:Ha.adagrad,rmsprop:Ha.rmsprop,adamax:Ha.adamax,adam:Ha.adam},Xa="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:t=>t();function Ka(){return new Promise((t=>Xa((()=>t()))))}function Ya(t,e){const n=t[0].length;t.forEach(((t,e)=>{E.hu(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),E.hu(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const r=t[0];t.forEach(((t,i)=>{for(let o=0;o<n;o++)E.hu(o===e||t[o]===r[o],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`))}))}function Ja(t,e){const n=t[0].slice();for(let r=1;r<t.length;r++)n[e]+=t[r][e];return n}const Za=30;function Qa(t){return t<=Za?t:(0,E.jP)(t,Math.floor(Math.sqrt(t)))}function ts(t,e,n){return[n*("number"==typeof t?t:t[0]),e*("number"==typeof t?t:t[1])]}function es(t,e,n,r=!0){let i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let r=0;r<n;++r)i=i.concat([t[r+1]/e[r],e[r]]);i=i.concat(t.slice(n+1))}return i}function ns(t,e,n=!0){const r=[];if(n){r.push(e);for(let n=e+1;n<t;++n)n<=2*e?(r.push(n),r.push(n-(e+1))):r.push(n)}else{const n=[],i=[];for(let r=1;r<t;++r)r>=2*e+1||r%2==1?i.push(r):n.push(r);r.push(...n),r.push(0),r.push(...i)}return r}function rs(t,e,n,r=!0){const i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(let n=1;n<t.length;++n)n<=e.length?r?i.push(e[n-1]*t[n]):i.push(t[n]/e[n-1]):i.push(t[n]);return i}function is(t,e){const n=[0];for(let r=0;r<e;++r)n.push(t[r][0]);return n}function os(t,e,n){const r=t.slice(0,1);for(let i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}const as=1.7580993408473768,ss=1.0507009873554805,us=.3275911,ls=.254829592,cs=-.284496736,fs=1.421413741,hs=-1.453152027,ds=1.061405429;function ps(...t){(0,b.OB)().getBool("IS_TEST")||console.warn(...t)}function gs(...t){(0,b.OB)().getBool("IS_TEST")||console.log(...t)}function ms(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function ys(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function vs(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=0;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function bs(t){const e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e);for(let e=2;e<t.length;e+=4)n[Math.floor(e/4)]=t[e],r[Math.floor(e/4)]=t[e+1];return{real:n,imag:r}}function xs(t,e){return{real:t[2*e],imag:t[2*e+1]}}function ws(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function _s(t,e){const n=new Float32Array(t/2),r=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const o=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}function ks(t,e,n){const r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}const As=/->/g;function Es(t,e){const n=((t=t.replace(/\s/g,"")).length-t.replace(As,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("->").');const[r,i]=t.split("->");(0,E.hu)(-1===r.indexOf("..."),(()=>'The ellipsis notation ("...") is not supported yet.'));const o=r.split(","),a=o.length;if(e!==a)throw new Error(`Expected ${a} input tensors, received ${e}`);if(a>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const s=[];for(let t=0;t<i.length;++t){const e=i[t];if(!o.some((t=>-1!==t.indexOf(e))))throw new Error(`Output subscripts contain the label ${e} not present in the input subscripts.`);-1===s.indexOf(e)&&s.push(e)}for(let t=0;t<r.length;++t){const e=r[t];-1===s.indexOf(e)&&","!==e&&s.push(e)}const u=new Array(o.length);for(let t=0;t<a;++t){if(new Set(o[t].split("")).size!==o[t].length)throw new Error(`Found duplicate axes in input component ${o[t]}. Support for duplicate axes in input is not implemented yet.`);u[t]=[];for(let e=0;e<o[t].length;++e)u[t].push(s.indexOf(o[t][e]))}const l=s.length,c=[];for(let t=i.length;t<l;++t)c.push(t);return{allDims:s,summedDims:c,idDims:u}}function Ds(t,e){let n=new Array(t);n.fill(-1);for(let t=0;t<e.length;++t)n[e[t]]=t;const r=[];for(let e=0;e<t;++e)-1===n[e]&&r.push(e);return n=n.filter((t=>-1!==t)),{permutationIndices:n,expandDims:r}}function Ss(t,e,n){const r=new Array(t);for(let t=0;t<n.length;++t){const i=n[t].shape;for(let n=0;n<e[t].length;++n)void 0===r[e[t][n]]?r[e[t][n]]=i[n]:(0,E.hu)(r[e[t][n]]===i[n],(()=>`Expected dimension ${r[e[t][n]]} at axis ${n} of input shaped ${JSON.stringify(i)}, but got dimension ${i[n]}`))}}function Cs(t,e){const n=t,r=[];let i=0;0===t.length&&n.push(-1),i=t.length+1;for(let t=0;t<i;++t)r.push([]);const o=[];for(let t=0;t<n.length;++t){const i=Fs(e,n[t]);for(const e of i)-1===o.indexOf(e)&&(r[t].push(e),o.push(e))}return{path:n,steps:r}}function Os(t){return t.every(((t,e)=>t===e))}function Fs(t,e){const n=[];for(let r=0;r<t.length;++r)0!==t[r].length&&-1===t[r].indexOf(e)&&-1!==e||n.push(r);return n}function Ms(t,e,n=0){let r=[];if("number"==typeof e)(0,E.hu)(t.shape[n]%e==0,(()=>"Number of splits must evenly divide the axis.")),r=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0);(0,E.hu)(i<=1,(()=>"There should be only one negative value in split array."));const o=e.indexOf(-1);if(-1!==o){const r=e.reduce(((t,e)=>e>0?t+e:t));e[o]=t.shape[n]-r}(0,E.hu)(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),r=e}return r}function $s(t,e){let n,r=!1;for(t<=Za?(n=t,r=!0):n=(0,E.jP)(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=(0,E.jP)(t,n+1);return n}function Ns(t,e,n){const r=[],i=t.length;for(let o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}function Bs(t,e,n,r){const i=e.shape.length,o=t.shape.length;if(0!==r&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>o)throw new Error(`batchDims (${r}) must be less than rank(x) (\n    ${o}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let n=0;n<r;++n)if(t.shape[n]!==e.shape[n])throw new Error(`x.shape[${n}]: ${t.shape[n]} should be equal to indices.shape[${n}]: ${e.shape[n]}.`);const a=t.shape[n],s=[];let u=1,l=1,c=1;for(let e=0;e<r;++e)s.push(t.shape[e]),u*=t.shape[e];for(let e=r;e<n;e++)s.push(t.shape[e]),l*=t.shape[e];for(let t=r;t<i;t++)s.push(e.shape[t]);for(let e=n+1;e<o;e++)s.push(t.shape[e]),c*=t.shape[e];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:a,outputShape:s}}function Ts(t){try{return t.map((t=>(0,ke.decodeString)(t)))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function js(t){return t.map((t=>(0,ke.encodeString)(t)))}var Is=n(8713)},9121:(t,e,n)=>{"use strict";n.d(e,{SY:()=>r,VG:()=>i,Sp:()=>o,mm:()=>a,Xz:()=>s,oT:()=>u,IK:()=>l,sJ:()=>c,aJ:()=>f,M2:()=>h,qw:()=>d,jM:()=>p,Oy:()=>g,QC:()=>m,Jh:()=>y,RO:()=>v,_k:()=>b,IM:()=>x,XL:()=>w,zw:()=>_,zv:()=>k,Ly:()=>A,RF:()=>E,gJ:()=>D,xn:()=>S,Zz:()=>C,yj:()=>O,Eh:()=>F,mh:()=>M,wU:()=>$,wm:()=>N,x1:()=>B,o2:()=>T,ik:()=>j,mc:()=>I,TR:()=>z,iH:()=>R,Vc:()=>P,QR:()=>L,T0:()=>q,ci:()=>U,sL:()=>W,y7:()=>V,$w:()=>H,p4:()=>G,ek:()=>X,Vn:()=>K,oH:()=>Y,$g:()=>J,SX:()=>Z,HE:()=>Q,Om:()=>tt,hd:()=>et,NE:()=>nt,YF:()=>rt,Y0:()=>it,vw:()=>ot,de:()=>at,Uy:()=>st,OR:()=>ut,je:()=>lt,sH:()=>ct,qi:()=>ft,q1:()=>ht,iZ:()=>dt,Ac:()=>pt,iJ:()=>gt,Qg:()=>mt,J_:()=>yt,av:()=>vt,iW:()=>bt,r7:()=>xt,J$:()=>wt,vt:()=>_t,CA:()=>kt,e7:()=>At,Zb:()=>Et,kU:()=>Dt,PY:()=>St,Vf:()=>Ct,MZ:()=>Ot,qC:()=>Ft,eZ:()=>Mt,Hh:()=>$t,Yo:()=>Nt,BM:()=>Bt,mT:()=>Tt,OV:()=>jt,OA:()=>It,OU:()=>zt,vF:()=>Rt,q2:()=>Pt,c1:()=>Lt,q8:()=>qt,jQ:()=>Ut,Vb:()=>Wt,NZ:()=>Vt,wY:()=>Ht,ku:()=>Gt,yQ:()=>Xt,uv:()=>Kt,cy:()=>Yt,W0:()=>Jt,qW:()=>Zt,we:()=>Qt,Qi:()=>te,ly:()=>ee,Kg:()=>ne,pe:()=>re,o0:()=>ie,Dl:()=>oe,e6:()=>ae,xJ:()=>se,$H:()=>ue,qk:()=>le,HZ:()=>ce,dp:()=>fe,Hm:()=>he,_Y:()=>de,zb:()=>pe,Sb:()=>ge,mK:()=>me,e0:()=>ye,bV:()=>ve,xQ:()=>be,Ph:()=>xe,oF:()=>we,p2:()=>_e,RQ:()=>ke,w3:()=>Ae,i5:()=>Ee,a5:()=>De,MR:()=>Se,FK:()=>Ce,GB:()=>Oe,TQ:()=>Fe,L8:()=>Me,Gc:()=>$e,nh:()=>Ne,D2:()=>Be,_t:()=>Te,bK:()=>je,m2:()=>Ie,Tr:()=>ze,sE:()=>Re,MI:()=>Pe,n9:()=>Le,cW:()=>qe,wx:()=>Ue,G3:()=>We,kp:()=>Ve,To:()=>He,Qv:()=>Ge,Ru:()=>Xe,h8:()=>Ke,eB:()=>Ye,b9:()=>Je,us:()=>Ze,_V:()=>Qe,lu:()=>tn});const r="Abs",i="Acos",o="Acosh",a="Add",s="AddN",u="All",l="Any",c="ArgMax",f="ArgMin",h="Asin",d="Asinh",p="Atan",g="Atanh",m="Atan2",y="AvgPool",v="AvgPoolGrad",b="AvgPool3D",x="AvgPool3DGrad",w="BatchMatMul",_="BatchToSpaceND",k="Bincount",A="BroadcastTo",E="Cast",D="Ceil",S="ClipByValue",C="Complex",O="ComplexAbs",F="Concat",M="Conv2D",$="Conv2DBackpropFilter",N="Conv2DBackpropInput",B="Conv3D",T="Conv3DBackpropFilterV2",j="Conv3DBackpropInputV2",I="Cos",z="Cosh",R="Cumsum",P="CropAndResize",L="DenseBincount",q="DepthToSpace",U="DepthwiseConv2dNative",W="DepthwiseConv2dNativeBackpropFilter",V="DepthwiseConv2dNativeBackpropInput",H="Diag",G="Dilation2D",X="Dilation2DBackpropInput",K="Dilation2DBackpropFilter",Y="RealDiv",J="Einsum",Z="Elu",Q="EluGrad",tt="Erf",et="Equal",nt="Exp",rt="ExpandDims",it="Expm1",ot="FFT",at="Fill",st="FlipLeftRight",ut="Floor",lt="FloorDiv",ct="FusedBatchNorm",ft="GatherV2",ht="GatherNd",dt="Greater",pt="GreaterEqual",gt="Identity",mt="IFFT",yt="Imag",vt="IsFinite",bt="IsInf",xt="IsNan",wt="LeakyRelu",_t="Less",kt="LessEqual",At="LinSpace",Et="Log",Dt="Log1p",St="LogicalAnd",Ct="LogicalNot",Ot="LogicalOr",Ft="LogSoftmax",Mt="LRN",$t="LRNGrad",Nt="Max",Bt="Maximum",Tt="MaxPool",jt="MaxPoolGrad",It="MaxPool3D",zt="MaxPool3DGrad",Rt="MaxPoolWithArgmax",Pt="Mean",Lt="Min",qt="Minimum",Ut="MirrorPad",Wt="Mod",Vt="Multinomial",Ht="Multiply",Gt="Neg",Xt="NotEqual",Kt="NonMaxSuppressionV3",Yt="NonMaxSuppressionV4",Jt="NonMaxSuppressionV5",Zt="OnesLike",Qt="OneHot",te="Pack",ee="PadV2",ne="Pool",re="Pow",ie="Prelu",oe="Prod",ae="Range",se="Real",ue="Reciprocal",le="Relu",ce="Reshape",fe="ResizeNearestNeighbor",he="ResizeNearestNeighborGrad",de="ResizeBilinear",pe="ResizeBilinearGrad",ge="Relu6",me="Reverse",ye="Round",ve="Rsqrt",be="ScatterNd",xe="Select",we="Selu",_e="Slice",ke="Sin",Ae="Sinh",Ee="Sign",De="Sigmoid",Se="Softplus",Ce="Sqrt",Oe="Sum",Fe="SpaceToBatchND",Me="SplitV",$e="Softmax",Ne="SparseReshape",Be="SparseToDense",Te="SquaredDifference",je="Square",Ie="StridedSlice",ze="Sub",Re="Tan",Pe="Tanh",Le="Tile",qe="TopK",Ue="Transform",We="Transpose",Ve="Unique",He="Unpack",Ge="UnsortedSegmentSum",Xe="ZerosLike",Ke="Step",Ye="FromPixels",Je="RotateWithOffset",Ze="_FusedMatMul",Qe="FusedConv2D",tn="FusedDepthwiseConv2D"},6151:(t,e,n)=>{"use strict";n.d(e,{pI:()=>s,uk:()=>u,tr:()=>l,wC:()=>c,Li:()=>f,nE:()=>h,bt:()=>d,T3:()=>p});var r=n(2885),i=n(5938);const o=(0,i.R)("kernelRegistry",(()=>new Map)),a=(0,i.R)("gradRegistry",(()=>new Map));function s(t,e){const n=g(t,e);return o.get(n)}function u(t){return a.get(t)}function l(t){const e=o.entries(),n=[];for(;;){const{done:r,value:i}=e.next();if(r)break;const[o,a]=i,[s]=o.split("_");s===t&&n.push(a)}return n}function c(t){const{kernelName:e,backendName:n}=t,r=g(e,n);o.has(r)&&console.warn(`The kernel '${e}' for backend '${n}' is already registered`),o.set(r,t)}function f(t){const{kernelName:e}=t;a.has(e)&&(0,r.OB)().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${e}'`),a.set(e,t)}function h(t,e){const n=g(t,e);if(!o.has(n))throw new Error(`The kernel '${t}' for backend '${e}' is not registered`);o.delete(n)}function d(t){if(!a.has(t))throw new Error(`The gradient '${t}' for backend is not registered`);a.delete(t)}function p(t,e){l(t).forEach((t=>{c(Object.assign({},t,{backendName:e}))}))}function g(t,e){return`${e}_${t}`}},6235:(t,e,n)=>{"use strict";n.d(e,{W:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({abs_:function(t){const e=(0,o._1)(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return r.BV.runKernel(i.yj,t)}{const t={x:e};return r.BV.runKernel(i.SY,t)}}})},7839:(t,e,n)=>{"use strict";n.d(e,{K:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({acos_:function(t){const e={x:(0,o._1)(t,"x","acos")};return r.BV.runKernel(i.VG,e)}})},1470:(t,e,n)=>{"use strict";n.d(e,{_:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({acosh_:function(t){const e={x:(0,o._1)(t,"x","acosh")};return r.BV.runKernel(i.Sp,e)}})},6407:(t,e,n)=>{"use strict";n.d(e,{I:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({add_:function(t,e){let n=(0,a._1)(t,"a","add"),s=(0,a._1)(e,"b","add");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.mm,u)}})},781:(t,e,n)=>{"use strict";n.d(e,{$:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({all_:function(t,e=null,n=!1){const a={x:(0,o._1)(t,"x","all","bool")},s={axis:e,keepDims:n};return r.BV.runKernel(i.oT,a,s)}})},2998:(t,e,n)=>{"use strict";n.d(e,{Y:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({any_:function(t,e=null,n=!1){const a={x:(0,o._1)(t,"x","any","bool")},s={axis:e,keepDims:n};return r.BV.runKernel(i.IK,a,s)}})},47:(t,e,n)=>{"use strict";n.d(e,{N:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({argMax_:function(t,e=0){const n={x:(0,o._1)(t,"x","argMax")},a={axis:e};return r.BV.runKernel(i.sJ,n,a)}})},7394:(t,e,n)=>{"use strict";n.d(e,{v:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({argMin_:function(t,e=0){const n={x:(0,o._1)(t,"x","argMin")},a={axis:e};return r.BV.runKernel(i.aJ,n,a)}})},2421:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({asin_:function(t){const e={x:(0,o._1)(t,"x","asin")};return r.BV.runKernel(i.M2,e)}})},1891:(t,e,n)=>{"use strict";n.d(e,{V:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({asinh_:function(t){const e={x:(0,o._1)(t,"x","asinh")};return r.BV.runKernel(i.qw,e)}})},7037:(t,e,n)=>{"use strict";n.d(e,{z:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({atan_:function(t){const e={x:(0,o._1)(t,"x","atan")};return r.BV.runKernel(i.jM,e)}})},9812:(t,e,n)=>{"use strict";n.d(e,{f:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({atan2_:function(t,e){let n=(0,a._1)(t,"a","atan2"),s=(0,a._1)(e,"b","atan2");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.QC,u)}})},369:(t,e,n)=>{"use strict";n.d(e,{C:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({atanh_:function(t){const e={x:(0,o._1)(t,"x","atanh")};return r.BV.runKernel(i.Oy,e)}})},5176:(t,e,n)=>{"use strict";n.d(e,{w:()=>f});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2271),u=n(2582),l=n(2668),c=n(4968);const f=(0,l.op)({avgPool_:function(t,e,n,l,f){const h=(0,o._1)(t,"x","avgPool","float32");a.hu(u.jT(n,1),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`));let d=h,p=!1;3===h.rank&&(p=!0,d=(0,c.X)(h,[1,h.shape[0],h.shape[1],h.shape[2]])),a.hu(4===d.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${d.rank}.`)),null!=f&&a.hu(a.GN(l),(()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${f} but got pad ${l}.`));const g={x:d},m={filterSize:e,strides:n,pad:l,dimRoundingMode:f};let y=r.BV.runKernel(i.Jh,g,m);return y=(0,s.p)(y,h.dtype),p?(0,c.X)(y,[y.shape[1],y.shape[2],y.shape[3]]):y}})},3591:(t,e,n)=>{"use strict";n.d(e,{YB:()=>i,Vh:()=>o,kz:()=>a,rv:()=>s,lB:()=>u,Q3:()=>l,LJ:()=>c,sY:()=>f});var r=n(569);function i(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function o(t,e,n){const r=t.length+e.length,i=[];let o=0,a=0;for(let s=0;s<r;s++)-1===n.indexOf(s)?i.push(t[o++]):i.push(e[a++]);return i}function a(t,e){const n=[],r=t.length;for(let i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map((e=>t[e]))]}function s(t,e){return o(t,e.map((t=>1)),e)}function u(t,e,n){r.hu(i(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function l(t,e){if(i(t,e))return null;const n=[];for(let r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((t=>n.push(t))),n}function c(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function f(t,e){const n=[];for(let r=e-t;r<e;++r)n.push(r);return n}},8441:(t,e,n)=>{"use strict";n.d(e,{E:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({batchToSpaceND_:function(t,e,n){const s=(0,o._1)(t,"x","batchToSpaceND"),u=e.reduce(((t,e)=>t*e));a.hu(s.rank>=1+e.length,(()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`)),a.hu(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),a.hu(s.shape[0]%u==0,(()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${u}`));const l={x:s},c={blockShape:e,crops:n};return r.BV.runKernel(i.zw,l,c)}})},7505:(t,e,n)=>{"use strict";n.d(e,{t:()=>u});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(4968);const u=(0,n(2668).op)({batchNorm_:function(t,e,n,u,l,c){null==c&&(c=.001);const f=(0,o._1)(t,"x","batchNorm"),h=(0,o._1)(e,"mean","batchNorm"),d=(0,o._1)(n,"variance","batchNorm");let p,g;null!=l&&(p=(0,o._1)(l,"scale","batchNorm")),null!=u&&(g=(0,o._1)(u,"offset","batchNorm")),a.hu(h.rank===d.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),a.hu(null==g||h.rank===g.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),a.hu(null==p||h.rank===p.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const m={x:function(t){let e;return e=0===t.rank||1===t.rank?(0,s.X)(t,[1,1,1,t.size]):2===t.rank?(0,s.X)(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?(0,s.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}(f),scale:p,offset:g,mean:h,variance:d},y={varianceEpsilon:c},v=r.BV.runKernel(i.sH,m,y);return(0,s.X)(v,f.shape)}})},8247:(t,e,n)=>{"use strict";n.d(e,{U:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(8723),s=n(2668),u=n(4968);const l=(0,s.op)({broadcastTo_:function(t,e){let n=(0,o._1)(t,"broadcastTo","x");const s=n.shape;if(e.some((t=>!(t>0)||t%1!=0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();for(;t.length<e.length;)t.unshift(1);n=(0,u.X)(n,t)}const l=n.shape,c=Array.from(e);for(let t=e.length-1;t>=0;t--)if(l[t]===e[t])c[t]=1;else if(1!==n.shape[t])throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(0===c.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0)).length)return(0,a.d)(n);const f={x:n},h={reps:c};return r.BV.runKernel(i.n9,f,h)}})},2200:(t,e,n)=>{"use strict";function r(t,e){const n=t.length,r=[];for(let i=0;i<n;i++){const o=n-1-i,a=t[o]||1;(e[e.length-1-i]||1)>1&&1===a&&r.unshift(o)}return r}function i(t,e){const n=[];for(let r=0;r<e.length;r++){const i=t[t.length-r-1],o=e.length-r-1,a=e[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n}function o(t,e){const n=[],r=Math.max(t.length,e.length);for(let i=0;i<r;i++){let r=t[t.length-i-1];null==r&&(r=1);let o=e[e.length-i-1];if(null==o&&(o=1),1===r)n.unshift(o);else if(1===o)n.unshift(r);else{if(r!==o)throw Error(`Operands could not be broadcast together with shapes ${t} and ${e}.`);n.unshift(r)}}return n}n.d(e,{XF:()=>r,RR:()=>i,$N:()=>o})},2271:(t,e,n)=>{"use strict";n.d(e,{p:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({cast_:function(t,e){const n=(0,o._1)(t,"x","cast");if(!a.LP(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const s={x:n},u={dtype:e};return r.BV.runKernel(i.RF,s,u)}})},6825:(t,e,n)=>{"use strict";n.d(e,{m:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({ceil_:function(t){const e={x:(0,o._1)(t,"x","ceil")};return r.BV.runKernel(i.gJ,e)}})},2279:(t,e,n)=>{"use strict";n.d(e,{i:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({clipByValue_:function(t,e,n){const s=(0,o._1)(t,"x","clipByValue");a.hu(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const u={x:s},l={clipValueMin:e,clipValueMax:n};return r.BV.runKernel(i.xn,u,l)}})},8723:(t,e,n)=>{"use strict";n.d(e,{d:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({clone_:function(t){const e={x:(0,o._1)(t,"x","clone","string_or_numeric")};return r.BV.runKernel(i.iJ,e)}})},1661:(t,e,n)=>{"use strict";n.d(e,{P:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({complex_:function(t,e){const n=(0,o._1)(t,"real","complex"),s=(0,o._1)(e,"imag","complex");a.k5(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const u={real:n,imag:s};return r.BV.runKernel(i.Zz,u)}})},6884:(t,e,n)=>{"use strict";n.d(e,{z:()=>u});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(8723);const u=(0,n(2668).op)({concat_:function(t,e=0){(0,a.hu)(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=(0,o.sI)(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return(0,s.d)(n[0]);const u=n,l={axis:e};return r.BV.runKernel(i.Eh,u,l)}})},1355:(t,e,n)=>{"use strict";n.d(e,{P:()=>l});var r=n(3740),i=n(569),o=n(4794),a=n(2582),s=n(2668),u=n(4968);const l=(0,s.op)({conv1d_:function(t,e,n,s,l="NWC",c=1,f){const h=(0,r._1)(t,"x","conv1d"),d=(0,r._1)(e,"filter","conv1d");let p=h,g=!1;2===h.rank&&(g=!0,p=(0,u.X)(h,[1,h.shape[0],h.shape[1]])),i.hu(3===p.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${p.rank}.`)),i.hu(3===d.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${d.rank}.`)),null!=f&&i.hu(i.GN(s),(()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${f} but got pad ${s}.`)),i.hu(p.shape[2]===d.shape[1],(()=>`Error in conv1d: depth of input (${p.shape[2]}) must match input depth for filter ${d.shape[1]}.`)),i.hu(a.jT(n,c),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${c}'`)),i.hu("NWC"===l,(()=>`Error in conv1d: got dataFormat of ${l} but only NWC is currently supported.`));const m=(0,u.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]]),y=(0,u.X)(p,[p.shape[0],1,p.shape[1],p.shape[2]]),v=[1,n],b=[1,c],x=(0,o.T)(y,m,v,s,"NHWC",b,f);return g?(0,u.X)(x,[x.shape[2],x.shape[3]]):(0,u.X)(x,[x.shape[0],x.shape[2],x.shape[3]])}})},4794:(t,e,n)=>{"use strict";n.d(e,{T:()=>c});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2582),u=n(2668),l=n(4968);const c=(0,u.op)({conv2d_:function(t,e,n,u,c="NHWC",f=[1,1],h){const d=(0,o._1)(t,"x","conv2d"),p=(0,o._1)(e,"filter","conv2d");let g=d,m=!1;3===d.rank&&(m=!0,g=(0,l.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),a.hu(4===g.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${g.rank}.`)),a.hu(4===p.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${p.rank}.`)),null!=h&&a.hu(a.GN(u),(()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${h} but got pad ${u}.`));const y="NHWC"===c?g.shape[3]:g.shape[1];a.hu(y===p.shape[2],(()=>`Error in conv2d: depth of input (${y}) must match input depth for filter ${p.shape[2]}.`)),a.hu(s.jT(n,f),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${f}'`));const v={x:g,filter:p},b={strides:n,pad:u,dataFormat:c,dilations:f,dimRoundingMode:h},x=r.BV.runKernel(i.mh,v,b);return m?(0,l.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},9832:(t,e,n)=>{"use strict";n.d(e,{_:()=>u});var r=n(7097),i=n(9121),o=n(569),a=n(2668),s=n(4968);const u=(0,a.op)({conv2DBackpropInput_:function(t,e,n,a,u,l="NHWC",c){o.hu(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let f=t,h=e,d=!1;3===e.rank&&(d=!0,h=(0,s.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]),f=[1,t[0],t[1],t[2]]),o.hu(4===f.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${f.length}.`)),o.hu(4===h.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${h.rank}`)),o.hu(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const p="NHWC"===l?f[3]:f[1],g="NHWC"===l?h.shape[3]:h.shape[1];o.hu(p===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${p}) must match input depth for filter ${n.shape[2]}.`)),o.hu(g===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${g}) must match output depth for filter ${n.shape[3]}.`)),null!=c&&o.hu(o.GN(u),(()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${c} but got pad ${u}.`));const m={dy:h,filter:n},y={strides:a,pad:u,dataFormat:l,dimRoundingMode:c,inputShape:f},v=r.BV.runKernel(i.wm,m,y);return d?(0,s.X)(v,[v.shape[1],v.shape[2],v.shape[3]]):v}})},1405:(t,e,n)=>{"use strict";n.d(e,{b:()=>o});var r=n(3740),i=n(9832);const o=(0,n(2668).op)({conv2dTranspose_:function(t,e,n,o,a,s){const u=(0,r._1)(t,"x","conv2dTranspose"),l=(0,r._1)(e,"filter","conv2dTranspose");return(0,i._)(n,u,l,o,a,"NHWC",s)}})},2582:(t,e,n)=>{"use strict";function r(t,e,n,r,i="NHWC",o){return a(t,[...e,t[3]],n,o,r,null,null,g(i))}function i(t,e,n,r,i,o,s="channelsLast"){const[u,c]=l(e);let f;if("channelsLast"===s)f=[u,c,t[3],t[3]];else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);f=[u,c,t[1],t[1]]}return a(t,f,n,r,i,o,!1,s)}function o(t,e,n,r,i,o,a="NDHWC"){const[u,l,f]=c(e);let h,d;if("NDHWC"===a)d="channelsLast",h=[u,l,f,t[4],t[4]];else{if("NCDHW"!==a)throw new Error(`Unknown dataFormat ${a}`);d="channelsFirst",h=[u,l,f,t[1],t[1]]}return s(t,h,n,r,i,!1,d,o)}function a(t,e,n,r,i,o,a=!1,s="channelsLast"){let[c,d,p,g]=[-1,-1,-1,-1];if("channelsLast"===s)[c,d,p,g]=t;else{if("channelsFirst"!==s)throw new Error(`Unknown dataFormat ${s}`);[c,g,d,p]=t}const[m,y,,v]=e,[b,x]=l(n),[w,_]=l(r),k=f(m,w),A=f(y,_),{padInfo:E,outHeight:D,outWidth:S}=function(t,e,n,r,i,o,a,s,l){let c,f,d;if("number"==typeof t){c={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};const i=function(t,e,n,r,i){null==r&&(r=u(t,e,n));const o=t[1];return[h((t[0]-e+2*r)/n+1,i),h((o-e+2*r)/n+1,i)]}([e,n],o,r,t,s);f=i[0],d=i[1]}else if("same"===t){f=Math.ceil(e/r),d=Math.ceil(n/i);const t=Math.max(0,(f-1)*r+o-e),s=Math.max(0,(d-1)*i+a-n),u=Math.floor(t/2),l=t-u,h=Math.floor(s/2);c={top:u,bottom:l,left:h,right:s-h,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},f=Math.ceil((e-o+1)/r),d=Math.ceil((n-a+1)/i);else{if("object"!=typeof t)throw Error(`Unknown padding parameter: ${t}`);{const u="channelsLast"===l?t[1][0]:t[2][0],p="channelsLast"===l?t[1][1]:t[2][1],g="channelsLast"===l?t[2][0]:t[3][0],m="channelsLast"===l?t[2][1]:t[3][1];c={top:u,bottom:p,left:g,right:m,type:0===u&&0===p&&0===g&&0===m?"VALID":"EXPLICIT"},f=h((e-o+u+p)/r+1,s),d=h((n-a+g+m)/i+1,s)}}return{padInfo:c,outHeight:f,outWidth:d}}(i,d,p,b,x,k,A,o,s),C=a?v*g:v;let O;return"channelsFirst"===s?O=[c,C,D,S]:"channelsLast"===s&&(O=[c,D,S,C]),{batchSize:c,dataFormat:s,inHeight:d,inWidth:p,inChannels:g,outHeight:D,outWidth:S,outChannels:C,padInfo:E,strideHeight:b,strideWidth:x,filterHeight:m,filterWidth:y,effectiveFilterHeight:k,effectiveFilterWidth:A,dilationHeight:w,dilationWidth:_,inShape:t,outShape:O,filterShape:e}}function s(t,e,n,r,i,o=!1,a="channelsLast",s){let[l,d,p,g,m]=[-1,-1,-1,-1,-1];if("channelsLast"===a)[l,d,p,g,m]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[l,m,d,p,g]=t}const[y,v,b,,x]=e,[w,_,k]=c(n),[A,E,D]=c(r),S=f(y,A),C=f(v,E),O=f(b,D),{padInfo:F,outDepth:M,outHeight:$,outWidth:N}=function(t,e,n,r,i,o,a,s,l,c,f){let d,p,g,m;if("number"==typeof t){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};const o=function(t,e,n,r,i,o){null==i&&(i=u(t,e,r));const a=t[1],s=t[2];return[h((t[0]-e+2*i)/r+1,o),h((a-e+2*i)/r+1,o),h((s-e+2*i)/r+1,o),1]}([e,n,r,1],s,0,i,t,f);p=o[0],g=o[1],m=o[2]}else if("same"===t){p=Math.ceil(e/i),g=Math.ceil(n/o),m=Math.ceil(r/a);const t=(p-1)*i+s-e,u=(g-1)*o+l-n,f=(m-1)*a+c-r,h=Math.floor(t/2),y=t-h,v=Math.floor(u/2),b=u-v,x=Math.floor(f/2);d={top:v,bottom:b,left:x,right:f-x,front:h,back:y,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((e-s+1)/i),g=Math.ceil((n-l+1)/o),m=Math.ceil((r-c+1)/a)}return{padInfo:d,outDepth:p,outHeight:g,outWidth:m}}(i,d,p,g,w,_,k,S,C,O,s),B=o?x*m:x;let T;return"channelsFirst"===a?T=[l,B,M,$,N]:"channelsLast"===a&&(T=[l,M,$,N,B]),{batchSize:l,dataFormat:a,inDepth:d,inHeight:p,inWidth:g,inChannels:m,outDepth:M,outHeight:$,outWidth:N,outChannels:B,padInfo:F,strideDepth:w,strideHeight:_,strideWidth:k,filterDepth:y,filterHeight:v,filterWidth:b,effectiveFilterDepth:S,effectiveFilterHeight:C,effectiveFilterWidth:O,dilationDepth:A,dilationHeight:E,dilationWidth:D,inShape:t,outShape:T,filterShape:e}}function u(t,e,n,r=1){const i=f(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function l(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function c(t){return"number"==typeof t?[t,t,t]:t}function f(t,e){return e<=1?t:t+(t-1)*(e-1)}function h(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function d(t){const[e,n,r]=l(t);return 1===e&&1===n&&1===r}function p(t,e){return d(t)||d(e)}function g(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}n.d(e,{Rf:()=>r,Xw:()=>i,pl:()=>o,Ix:()=>a,jw:()=>s,aO:()=>u,I0:()=>d,jT:()=>p,sl:()=>g})},173:(t,e,n)=>{"use strict";n.d(e,{m:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({cos_:function(t){const e={x:(0,o._1)(t,"x","cos")};return r.BV.runKernel(i.mc,e)}})},2699:(t,e,n)=>{"use strict";n.d(e,{f:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({cosh_:function(t){const e={x:(0,o._1)(t,"x","cosh")};return r.BV.runKernel(i.TR,e)}})},7405:(t,e,n)=>{"use strict";n.d(e,{z:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({cumsum_:function(t,e=0,n=!1,a=!1){const s={x:(0,o._1)(t,"x","cumsum")},u={axis:e,exclusive:n,reverse:a};return r.BV.runKernel(i.iH,s,u)}})},9112:(t,e,n)=>{"use strict";n.d(e,{n:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({depthToSpace_:function(t,e,n="NHWC"){const s=(0,o._1)(t,"x","depthToSpace"),u="NHWC"===n?s.shape[1]:s.shape[2],l="NHWC"===n?s.shape[2]:s.shape[3],c="NHWC"===n?s.shape[3]:s.shape[1];a.hu(u*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${u} and ${e}  for depthToSpace with input shape\n    ${s.shape}`)),a.hu(l*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${l} and ${e} for depthToSpace with input shape\n        ${s.shape}`)),a.hu(c%(e*e)==0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${c} for depthToSpace with input shape ${s.shape}`));const f={x:s},h={blockSize:e,dataFormat:n};return r.BV.runKernel(i.T0,f,h)}})},4718:(t,e,n)=>{"use strict";n.d(e,{B:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2668),u=n(4968);const l=(0,s.op)({depthwiseConv2d_:function(t,e,n,s,l="NHWC",c=[1,1],f){const h=(0,o._1)(t,"x","depthwiseConv2d"),d=(0,o._1)(e,"filter","depthwiseConv2d");let p=h,g=!1;3===h.rank&&(g=!0,p=(0,u.X)(h,[1,h.shape[0],h.shape[1],h.shape[2]])),a.hu(4===p.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`)),a.hu(4===d.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`)),a.hu(p.shape[3]===d.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`)),null!=f&&a.hu(a.GN(s),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${f} but got pad ${s}.`));const m={x:p,filter:d},y={strides:n,pad:s,dataFormat:l,dilations:c,dimRoundingMode:f},v=r.BV.runKernel(i.ci,m,y);return g?(0,u.X)(v,[v.shape[1],v.shape[2],v.shape[3]]):v}})},557:(t,e,n)=>{"use strict";n.d(e,{W:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2668),u=n(4968);const l=(0,s.op)({dilation2d_:function(t,e,n,s,l=[1,1],c="NHWC"){const f=(0,o._1)(t,"x","dilation2d"),h=(0,o._1)(e,"filter","dilation2d");a.hu(3===f.rank||4===f.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${f.rank}.`)),a.hu(3===h.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${h.rank}.`)),a.hu("NHWC"===c,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${c}`));let d=f,p=!1;3===f.rank&&(d=(0,u.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]]),p=!0);const g={x:d,filter:h},m={strides:n,pad:s,dilations:l},y=r.BV.runKernel(i.p4,g,m);return p?(0,u.X)(y,[y.shape[1],y.shape[2],y.shape[3]]):y}})},1274:(t,e,n)=>{"use strict";n.d(e,{h:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(9165);const u=(0,n(2668).op)({div_:function(t,e){let n=(0,a._1)(t,"a","div"),u=(0,a._1)(e,"b","div");if([n,u]=(0,o.makeTypesMatch)(n,u),"int32"===n.dtype&&"int32"===u.dtype)return(0,s.q)(n,u);const l={a:n,b:u};return r.BV.runKernel(i.oH,l,{})}})},9322:(t,e,n)=>{"use strict";n.d(e,{N:()=>c});var r=n(747),i=n(3740),o=n(1274),a=n(6477),s=n(2668),u=n(5912),l=n(6577);const c=(0,s.op)({divNoNan_:function(t,e){let n=(0,i._1)(t,"a","div"),s=(0,i._1)(e,"b","div");[n,s]=(0,r.makeTypesMatch)(n,s);const c=(0,o.h)(n,s),f=(0,l.P)(c),h=(0,a.D)(s,f);return(0,u.a)(h,f,c)}})},548:(t,e,n)=>{"use strict";n.d(e,{A:()=>u});var r=n(3740),i=n(569),o=n(8687),a=n(2668),s=n(4968);const u=(0,a.op)({dot_:function(t,e){const n=(0,r._1)(t,"t1","dot"),a=(0,r._1)(e,"t2","dot");i.hu(!(1!==n.rank&&2!==n.rank||1!==a.rank&&2!==a.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${a.rank}.`));const u=1===n.rank?n.size:n.shape[1],l=1===a.rank?a.size:a.shape[0];if(i.hu(u===l,(()=>`Error in dot: inner dimensions of inputs must match, but got ${u} and ${l}.`)),1===n.rank&&1===a.rank){const t=(0,s.X)(n,[1,-1]),e=(0,s.X)(a,[-1,1]),r=(0,o.O)(t,e);return(0,s.X)(r,[])}if(1===n.rank&&2===a.rank){const t=(0,s.X)(n,[1,-1]),e=(0,s.X)(a,[a.shape[0],a.shape[1]]),r=(0,o.O)(t,e);return(0,s.X)(r,[r.size])}if(2===n.rank&&1===a.rank){const t=(0,s.X)(a,[-1,1]),e=(0,o.O)(n,t);return(0,s.X)(e,[e.size])}{const t=(0,s.X)(a,[a.shape[0],a.shape[1]]);return(0,o.O)(n,t)}}})},3233:(t,e,n)=>{"use strict";n.d(e,{p:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({elu_:function(t){const e={x:(0,o._1)(t,"x","elu")};return r.BV.runKernel(i.SX,e)}})},6477:(t,e,n)=>{"use strict";n.d(e,{D:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({equal_:function(t,e){let n=(0,a._1)(t,"a","equal"),u=(0,a._1)(e,"b","equal");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.hd,l)}})},4650:(t,e,n)=>{"use strict";n.d(e,{q:()=>u});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2271);const u=(0,n(2668).op)({erf_:function(t){let e=(0,o._1)(t,"x","erf");a.hu("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=(0,s.p)(e,"float32"));const n={x:e};return r.BV.runKernel(i.Om,n)}})},4842:(t,e,n)=>{"use strict";n.d(e,{Q:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({exp_:function(t){const e={x:(0,o._1)(t,"x","exp")};return r.BV.runKernel(i.NE,e)}})},1300:(t,e,n)=>{"use strict";n.d(e,{d:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({expandDims_:function(t,e=0){const n=(0,o._1)(t,"x","expandDims","string_or_numeric");a.hu(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const s={input:n},u={dim:e};return r.BV.runKernel(i.YF,s,u)}})},3426:(t,e,n)=>{"use strict";n.d(e,{t:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({expm1_:function(t){const e={x:(0,o._1)(t,"x","expm1")};return r.BV.runKernel(i.Y0,e)}})},6943:(t,e,n)=>{"use strict";n.d(e,{G:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({floor_:function(t){const e={x:(0,o._1)(t,"x","floor")};return r.BV.runKernel(i.OR,e)}})},9165:(t,e,n)=>{"use strict";n.d(e,{q:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({floorDiv_:function(t,e){let n=(0,a._1)(t,"a","floorDiv"),s=(0,a._1)(e,"b","floorDiv");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.je,u)}})},4926:(t,e,n)=>{"use strict";n.d(e,{I:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({gather_:function(t,e,n=0,a=0){const s={x:(0,o._1)(t,"x","gather"),indices:(0,o._1)(e,"indices","gather","int32")},u={axis:n,batchDims:a};return r.BV.runKernel(i.qi,s,u)}})},636:(t,e,n)=>{"use strict";n.d(e,{p:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({greater_:function(t,e){let n=(0,a._1)(t,"a","greater"),u=(0,a._1)(e,"b","greater");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.iZ,l)}})},7630:(t,e,n)=>{"use strict";n.d(e,{b:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({greaterEqual_:function(t,e){let n=(0,a._1)(t,"a","greaterEqual"),u=(0,a._1)(e,"b","greaterEqual");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.Ac,l)}})},4386:(t,e,n)=>{"use strict";n.d(e,{a:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({imag_:function(t){const e={input:(0,o._1)(t,"input","imag")};return r.BV.runKernel(i.J_,e)}})},3305:(t,e,n)=>{"use strict";n.d(e,{I:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2668),u=n(4968);const l=(0,s.op)({resizeBilinear_:function(t,e,n=!1,s=!1){const l=(0,o._1)(t,"images","resizeBilinear");a.hu(3===l.rank||4===l.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${l.rank}.`)),a.hu(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),a.hu(!1===s||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let c=l,f=!1;3===l.rank&&(f=!0,c=(0,u.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));const[]=e,h={images:c},d={alignCorners:n,halfPixelCenters:s,size:e},p=r.BV.runKernel(i._Y,h,d);return f?(0,u.X)(p,[p.shape[1],p.shape[2],p.shape[3]]):p}})},5098:(t,e,n)=>{"use strict";n.d(e,{j:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2668),u=n(4968);const l=(0,s.op)({resizeNearestNeighbor_:function(t,e,n=!1,s=!1){const l=(0,o._1)(t,"images","resizeNearestNeighbor");a.hu(3===l.rank||4===l.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${l.rank}.`)),a.hu(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),a.hu("float32"===l.dtype||"int32"===l.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),a.hu(!1===s||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let c=l,f=!1;3===l.rank&&(f=!0,c=(0,u.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));const[]=e,h={images:c},d={alignCorners:n,halfPixelCenters:s,size:e},p=r.BV.runKernel(i.dp,h,d);return f?(0,u.X)(p,[p.shape[1],p.shape[2],p.shape[3]]):p}})},3963:(t,e,n)=>{"use strict";n.d(e,{x:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({isFinite_:function(t){const e={x:(0,o._1)(t,"x","isFinite")};return r.BV.runKernel(i.av,e)}})},4365:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({isInf_:function(t){const e={x:(0,o._1)(t,"x","isInf")};return r.BV.runKernel(i.iW,e)}})},6230:(t,e,n)=>{"use strict";n.d(e,{i:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({isNaN_:function(t){const e={x:(0,o._1)(t,"x","isNaN")};return r.BV.runKernel(i.r7,e)}})},9133:(t,e,n)=>{"use strict";n.d(e,{h:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({leakyRelu_:function(t,e=.2){const n={x:(0,o._1)(t,"x","leakyRelu")},a={alpha:e};return r.BV.runKernel(i.J$,n,a)}})},6573:(t,e,n)=>{"use strict";n.d(e,{d:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({less_:function(t,e){let n=(0,a._1)(t,"a","less"),u=(0,a._1)(e,"b","less");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.vt,l)}})},624:(t,e,n)=>{"use strict";n.d(e,{z:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({lessEqual_:function(t,e){let n=(0,a._1)(t,"a","lessEqual"),u=(0,a._1)(e,"b","lessEqual");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.CA,l)}})},9648:(t,e,n)=>{"use strict";n.d(e,{G:()=>l});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2668),u=n(4968);const l=(0,s.op)({localResponseNormalization_:function(t,e=5,n=1,s=1,l=.5){const c=(0,o._1)(t,"x","localResponseNormalization");a.hu(4===c.rank||3===c.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${c.rank}.`)),a.hu(a.GN(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let f=c,h=!1;3===c.rank&&(h=!0,f=(0,u.X)(c,[1,c.shape[0],c.shape[1],c.shape[2]]));const d={x:f},p={depthRadius:e,bias:n,alpha:s,beta:l},g=r.BV.runKernel(i.eZ,d,p);return h?(0,u.X)(g,[g.shape[1],g.shape[2],g.shape[3]]):g}})},2597:(t,e,n)=>{"use strict";n.d(e,{c:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({log_:function(t){const e={x:(0,o._1)(t,"x","log")};return r.BV.runKernel(i.Zb,e)}})},7474:(t,e,n)=>{"use strict";n.d(e,{K:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({log1p_:function(t){const e={x:(0,o._1)(t,"x","log1p")};return r.BV.runKernel(i.kU,e)}})},3888:(t,e,n)=>{"use strict";n.d(e,{e:()=>c});var r=n(633),i=n(3740),o=n(4841),a=n(7370),s=n(2668),u=n(625),l=n(3694);const c=(0,s.op)({logSigmoid_:function(t){const e=(0,i._1)(t,"x","logSigmoid");return(0,r.cb)((t=>({value:(0,a.W)((0,l.W)((0,a.W)(t))),gradFunc:e=>(0,o.d)(e,(0,u.X)((0,a.W)(t)))})))(e)}})},1510:(t,e,n)=>{"use strict";n.d(e,{C:()=>d});var r=n(633),i=n(3740),o=n(2271),a=n(4842),s=n(2597),u=n(3307),l=n(4841),c=n(2668),f=n(827),h=n(5475);const d=(0,c.op)({logSoftmax_:function(t,e=-1){const n=(0,i._1)(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return(0,r.cb)(((t,n)=>{const r=(0,u.F)(t,e,!0),i=(0,f.l)(t,r),c=(0,f.l)((0,o.p)(i,"float32"),(0,s.c)((0,h.S)((0,a.Q)(i),e,!0)));return n([c]),{value:c,gradFunc:(t,n)=>{const[r]=n,i=(0,a.Q)(r);return(0,f.l)(t,(0,l.d)((0,h.S)(t,e,!0),i))}}}))(n)}})},1391:(t,e,n)=>{"use strict";n.d(e,{l:()=>p});var r=n(3740),i=n(569),o=n(6407),a=n(3591),s=n(4842),u=n(2597),l=n(3307),c=n(2668),f=n(4968),h=n(827),d=n(5475);const p=(0,c.op)({logSumExp_:function(t,e=null,n=!1){const c=(0,r._1)(t,"x","logSumExp"),p=(0,i.EC)(e,c.shape),g=(0,l.F)(c,p,!0),m=(0,h.l)(c,g),y=(0,s.Q)(m),v=(0,d.S)(y,p),b=(0,u.c)(v),x=(0,o.I)((0,f.X)(g,b.shape),b);if(n){const t=(0,a.rv)(x.shape,p);return(0,f.X)(x,t)}return x}})},2856:(t,e,n)=>{"use strict";n.d(e,{H:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(2200);const s=(0,n(2668).op)({logicalAnd_:function(t,e){const n=(0,o._1)(t,"a","logicalAnd","bool"),s=(0,o._1)(e,"b","logicalAnd","bool");(0,a.$N)(n.shape,s.shape);const u={a:n,b:s};return r.BV.runKernel(i.PY,u)}})},8651:(t,e,n)=>{"use strict";n.d(e,{h:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({logicalNot_:function(t){const e={x:(0,o._1)(t,"x","logicalNot","bool")};return r.BV.runKernel(i.Vf,e)}})},5750:(t,e,n)=>{"use strict";n.d(e,{K:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(2200);const s=(0,n(2668).op)({logicalOr_:function(t,e){const n=(0,o._1)(t,"a","logicalOr","bool"),s=(0,o._1)(e,"b","logicalOr","bool");(0,a.$N)(n.shape,s.shape);const u={a:n,b:s};return r.BV.runKernel(i.MZ,u)}})},596:(t,e,n)=>{"use strict";n.d(e,{e:()=>u});var r=n(3740),i=n(2200),o=n(2856),a=n(8651),s=n(5750);const u=(0,n(2668).op)({logicalXor_:function(t,e){const n=(0,r._1)(t,"a","logicalXor","bool"),u=(0,r._1)(e,"b","logicalXor","bool");return(0,i.$N)(n.shape,u.shape),(0,o.H)((0,s.K)(t,e),(0,a.h)((0,o.H)(t,e)))}})},8687:(t,e,n)=>{"use strict";n.d(e,{O:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({matMul_:function(t,e,n=!1,s=!1){let u=(0,a._1)(t,"a","matMul"),l=(0,a._1)(e,"b","matMul");[u,l]=(0,o.makeTypesMatch)(u,l);const c={a:u,b:l},f={transposeA:n,transposeB:s};return r.BV.runKernel(i.XL,c,f)}})},3307:(t,e,n)=>{"use strict";n.d(e,{F:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({max_:function(t,e=null,n=!1){const a={x:(0,o._1)(t,"x","max")},s={reductionIndices:e,keepDims:n};return r.BV.runKernel(i.Yo,a,s)}})},1174:(t,e,n)=>{"use strict";n.d(e,{_:()=>c});var r=n(7097),i=n(9121),o=n(3740),a=n(569),s=n(2582),u=n(2668),l=n(4968);const c=(0,u.op)({maxPool_:function(t,e,n,u,c){const f=(0,o._1)(t,"x","maxPool");let h=f,d=!1;3===f.rank&&(d=!0,h=(0,l.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),a.hu(4===h.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${h.rank}.`)),a.hu(s.jT(n,1),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '1'`)),null!=c&&a.hu(a.GN(u),(()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${c} but got pad ${u}.`));const p={x:h},g={filterSize:e,strides:n,pad:u,dimRoundingMode:c},m=r.BV.runKernel(i.mT,p,g);return d?(0,l.X)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},632:(t,e,n)=>{"use strict";n.d(e,{g:()=>l});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200),u=n(2271);const l=(0,n(2668).op)({maximum_:function(t,e){let n=(0,a._1)(t,"a","maximum"),l=(0,a._1)(e,"b","maximum");[n,l]=(0,o.makeTypesMatch)(n,l),"bool"===n.dtype&&(n=(0,u.p)(n,"int32"),l=(0,u.p)(l,"int32")),(0,s.$N)(n.shape,l.shape);const c={a:n,b:l};return r.BV.runKernel(i.BM,c)}})},5130:(t,e,n)=>{"use strict";n.d(e,{J:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({mean_:function(t,e=null,n=!1){const a={x:(0,o._1)(t,"x","mean")},s={axis:e,keepDims:n};return r.BV.runKernel(i.q2,a,s)}})},5735:(t,e,n)=>{"use strict";n.d(e,{V:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({min_:function(t,e=null,n=!1){const a={x:(0,o._1)(t,"x","min")},s={axis:e,keepDims:n};return r.BV.runKernel(i.c1,a,s)}})},4513:(t,e,n)=>{"use strict";n.d(e,{L:()=>l});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200),u=n(2271);const l=(0,n(2668).op)({minimum_:function(t,e){let n=(0,a._1)(t,"a","minimum"),l=(0,a._1)(e,"b","minimum");[n,l]=(0,o.makeTypesMatch)(n,l),"bool"===n.dtype&&(n=(0,u.p)(n,"int32"),l=(0,u.p)(l,"int32")),(0,s.$N)(n.shape,l.shape);const c={a:n,b:l};return r.BV.runKernel(i.q8,c)}})},1483:(t,e,n)=>{"use strict";n.d(e,{V:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({mirrorPad_:function(t,e,n){a.hu("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const s=(0,o._1)(t,"x","mirrorPad");if(0===s.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");a.hu(e.length===s.rank,(()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`));const u="reflect"===n?1:0;for(let t=0;t<s.rank;t++)a.hu(2===e[t].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),a.hu(e[t][0]>=0&&e[t][0]<=s.shape[t]-u&&e[t][1]>=0&&e[t][1]<=s.shape[t]-u,(()=>`Padding in dimension ${t} cannot be greater than or equal to ${s.shape[t]-u} or less than 0 for input of shape ${s.shape}`));const l={paddings:e,mode:n},c={x:s};return r.BV.runKernel(i.jQ,c,l)}})},5228:(t,e,n)=>{"use strict";n.d(e,{w:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({mod_:function(t,e){let n=(0,a._1)(t,"a","mod"),s=(0,a._1)(e,"b","mod");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.Vb,u)}})},4841:(t,e,n)=>{"use strict";n.d(e,{d:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({mul_:function(t,e){let n=(0,a._1)(t,"a","mul"),s=(0,a._1)(e,"b","mul");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.wY,u)}})},7370:(t,e,n)=>{"use strict";n.d(e,{W:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({neg_:function(t){const e={x:(0,o._1)(t,"x","neg")};return r.BV.runKernel(i.ku,e)}})},3561:(t,e,n)=>{"use strict";n.d(e,{K:()=>y});var r=n(3740),i=n(569),o=n(6235),a=n(3591),s=n(3307),u=n(5735),l=n(2668),c=n(3453),f=n(4968),h=n(9494),d=n(3261),p=n(248),g=n(5475);function m(t,e,n=null){if(0===t.rank)return(0,o.W)(t);if(1!==t.rank&&null===n)return m((0,f.X)(t,[-1]),e,n);if(1===t.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===e)return(0,g.S)((0,o.W)(t),n);if(e===1/0)return(0,s.F)((0,o.W)(t),n);if(e===-1/0)return(0,u.V)((0,o.W)(t),n);if("euclidean"===e||2===e)return(0,d._)((0,g.S)((0,c.s)((0,o.W)(t),(0,h.i)(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return(0,s.F)((0,g.S)((0,o.W)(t),n[0]),n[1]-1);if(e===1/0)return(0,s.F)((0,g.S)((0,o.W)(t),n[1]),n[0]);if(e===-1/0)return(0,u.V)((0,g.S)((0,o.W)(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return(0,d._)((0,g.S)((0,p.h)(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const y=(0,l.op)({norm_:function(t,e="euclidean",n=null,o=!1){const s=m(t=(0,r._1)(t,"x","norm"),e,n);let u=s.shape;if(o){const e=(0,i.EC)(n,t.shape);u=a.rv(s.shape,e)}return(0,f.X)(s,u)}})},6500:(t,e,n)=>{"use strict";n.d(e,{Q:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({notEqual_:function(t,e){let n=(0,a._1)(t,"a","notEqual"),u=(0,a._1)(e,"b","notEqual");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i.yQ,l)}})},6708:(t,e,n)=>{"use strict";n.d(e,{l:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({oneHot_:function(t,e,n=1,a=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const s={indices:(0,o._1)(t,"indices","oneHot","int32")},u={depth:e,onValue:n,offValue:a};return r.BV.runKernel(i.we,s,u)}})},7846:(t,e,n)=>{"use strict";n.d(e,{J:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({onesLike_:function(t){const e={x:(0,o._1)(t,"x","onesLike")};return r.BV.runKernel(i.qW,e)}})},2668:(t,e,n)=>{"use strict";n.d(e,{z:()=>o,op:()=>a});var r=n(7097),i=n(569);const o="__op";function a(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const a=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=o;const s=(...t)=>{r.BV.startScope(n);try{const e=a(...t);return(0,i.tI)(e)&&console.error("Cannot return a Promise inside of tidy."),r.BV.endScope(e),e}catch(t){throw r.BV.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}},9682:(t,e,n)=>{"use strict";n.d(e,{v:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({pad_:function(t,e,n=0){const a=(0,o._1)(t,"x","pad");if(0===a.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const s={paddings:e,constantValue:n},u={x:a};return r.BV.runKernel(i.ly,u,s)}})},5860:(t,e,n)=>{"use strict";n.d(e,{d:()=>h});var r=n(3740),i=n(569),o=n(5176),a=n(8441),s=n(2582),u=n(1174),l=n(2668),c=n(4968),f=n(7918);const h=(0,l.op)({pool_:function(t,e,n,l,h,d){null==h&&(h=[1,1]),null==d&&(d=1),0===l&&(l="valid");const p=(0,r._1)(t,"x","maxPool");let g=p,m=!1;3===p.rank&&(m=!0,g=(0,c.X)(p,[1,p.shape[0],p.shape[1],p.shape[2]])),i.hu(s.jT(d,h),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${d} and dilations '${h}'`));const y=s.Xw(g.shape,e,d,h,l),v=[y.dilationHeight,y.dilationWidth];let b;b="same"===l?function(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))).map((t=>t-1)),r=n.map((t=>Math.floor(t/2))),i=n.map(((t,e)=>t-r[e]));return n.map(((t,e)=>[r[e],i[e]]))}([y.filterHeight,y.filterWidth],v):[[0,0],[0,0]];const x=1===v[0]&&1===v[1],[w,_]=function(t,e,n){const r=n.map((t=>t[0])),i=n.map((t=>t[1])),o=t.concat(r,i),a=e.map(((t,e)=>(t-o[e]%t)%t)),s=i.map(((t,e)=>t+a[e]));return[e.map(((t,e)=>[r[e],s[e]])),e.map(((t,e)=>[0,a[e]]))]}([y.inHeight,y.inWidth],v,b),k=x?l:"valid",A=x?g:(0,f.f)(g,v,w),E=("avg"===n?()=>(0,o.w)(A,e,d,k):()=>(0,u._)(A,e,d,k))(),D=x?E:(0,a.E)(E,v,_);return m?(0,c.X)(D,[D.shape[1],D.shape[2],D.shape[3]]):D}})},3453:(t,e,n)=>{"use strict";n.d(e,{s:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({pow_:function(t,e){let n=(0,a._1)(t,"base","pow"),s=(0,a._1)(e,"exp","pow");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.pe,u)}})},8151:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({prelu_:function(t,e){const n={x:(0,o._1)(t,"x","prelu"),alpha:(0,o._1)(e,"alpha","prelu")};return r.BV.runKernel(i.o0,n)}})},9451:(t,e,n)=>{"use strict";n.d(e,{W:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(2271);const s=(0,n(2668).op)({prod_:function(t,e=null,n=!1){let s=(0,o._1)(t,"x","prod");"bool"===s.dtype&&(s=(0,a.p)(s,"int32"));const u={x:s},l={axis:e,keepDims:n};return r.BV.runKernel(i.Dl,u,l)}})},766:(t,e,n)=>{"use strict";n.d(e,{k:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({real_:function(t){const e={input:(0,o._1)(t,"input","real")};return r.BV.runKernel(i.xJ,e)}})},9036:(t,e,n)=>{"use strict";n.d(e,{M:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({reciprocal_:function(t){const e={x:(0,o._1)(t,"x","reciprocal")};return r.BV.runKernel(i.$H,e)}})},7409:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({relu_:function(t){const e={x:(0,o._1)(t,"x","relu")};return r.BV.runKernel(i.qk,e)}})},3582:(t,e,n)=>{"use strict";n.d(e,{b:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({relu6_:function(t){const e={x:(0,o._1)(t,"x","relu6")};return r.BV.runKernel(i.Sb,e)}})},4968:(t,e,n)=>{"use strict";n.d(e,{X:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({reshape_:function(t,e){const n={x:(0,o._1)(t,"x","reshape","string_or_numeric")},a={shape:e};return r.BV.runKernel(i.HZ,n,a)}})},7486:(t,e,n)=>{"use strict";n.d(e,{G:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({reverse_:function(t,e){const n={x:(0,o._1)(t,"x","reverse")},a={dims:e};return r.BV.runKernel(i.mK,n,a)}})},7809:(t,e,n)=>{"use strict";n.d(e,{N:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({round_:function(t){const e={x:(0,o._1)(t,"x","round")};return r.BV.runKernel(i.e0,e)}})},2634:(t,e,n)=>{"use strict";n.d(e,{b:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({rsqrt_:function(t){const e={x:(0,o._1)(t,"x","rsqrt")};return r.BV.runKernel(i.bV,e)}})},9494:(t,e,n)=>{"use strict";n.d(e,{i:()=>o});var r=n(569),i=n(7852);function o(t,e){if(((0,r.fU)(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&(0,r.fU)(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return(0,i.H)(t,[],[],e)}},5503:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({selu_:function(t){const e={x:(0,o._1)(t,"x","selu")};return r.BV.runKernel(i.oF,e)}})},8678:(t,e,n)=>{"use strict";n.d(e,{U:()=>l});var r=n(3740),i=n(569),o=n(4794),a=n(4718),s=n(2668),u=n(4968);const l=(0,s.op)({separableConv2d_:function(t,e,n,s,l,c=[1,1],f="NHWC"){const h=(0,r._1)(t,"x","separableConv2d"),d=(0,r._1)(e,"depthwiseFilter","separableConv2d"),p=(0,r._1)(n,"pointwiseFilter","separableConv2d");let g=h,m=!1;if(3===h.rank&&(m=!0,g=(0,u.X)(h,[1,h.shape[0],h.shape[1],h.shape[2]])),"NCHW"===f)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");i.hu(4===g.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${g.rank}.`)),i.hu(4===d.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${d.rank}.`)),i.hu(4===p.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${d.rank}.`)),i.hu(1===p.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${p.shape[0]}.`)),i.hu(1===p.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${p.shape[1]}.`));const y=d.shape[2],v=d.shape[3];i.hu(p.shape[2]===y*v,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${y*v}, but got ${p.shape[2]}.`));const b=(0,a.B)(g,d,s,l,f,c),x=(0,o.T)(b,p,1,"valid",f);return m?(0,u.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},625:(t,e,n)=>{"use strict";n.d(e,{X:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({sigmoid_:function(t){const e={x:(0,o._1)(t,"x","sigmoid")};return r.BV.runKernel(i.a5,e)}})},4434:(t,e,n)=>{"use strict";n.d(e,{X:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({sign_:function(t){const e={x:(0,o._1)(t,"x","sign")};return r.BV.runKernel(i.i5,e)}})},9331:(t,e,n)=>{"use strict";n.d(e,{O:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({sin_:function(t){const e={x:(0,o._1)(t,"x","sin")};return r.BV.runKernel(i.RQ,e)}})},3254:(t,e,n)=>{"use strict";n.d(e,{R:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({sinh_:function(t){const e={x:(0,o._1)(t,"x","sinh")};return r.BV.runKernel(i.w3,e)}})},2676:(t,e,n)=>{"use strict";n.d(e,{t:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({slice_:function(t,e,n){const a=(0,o._1)(t,"x","slice","string_or_numeric");if(0===a.rank)throw new Error("Slicing scalar is not possible");const s={x:a},u={begin:e,size:n};return r.BV.runKernel(i.p2,s,u)}})},682:(t,e,n)=>{"use strict";n.d(e,{X:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({softmax_:function(t,e=-1){const n=(0,o._1)(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const a={logits:n},s={dim:e};return r.BV.runKernel(i.Gc,a,s)}})},3694:(t,e,n)=>{"use strict";n.d(e,{W:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({softplus_:function(t){const e={x:(0,o._1)(t,"x","softplus")};return r.BV.runKernel(i.MR,e)}})},7918:(t,e,n)=>{"use strict";n.d(e,{f:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({spaceToBatchND_:function(t,e,n){const s=(0,o._1)(t,"x","spaceToBatchND");a.hu(s.rank>=1+e.length,(()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`)),a.hu(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),a.hu(s.shape.reduce(((t,r,i)=>i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t),!0),(()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const u={x:s},l={blockShape:e,paddings:n};return r.BV.runKernel(i.TQ,u,l)}})},7020:(t,e,n)=>{"use strict";n.d(e,{k:()=>a});var r=n(7097),i=n(9121),o=n(569);const a=(0,n(2668).op)({fft_:function(t){(0,o.hu)("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return r.BV.runKernel(i.vw,e)}})},8447:(t,e,n)=>{"use strict";n.d(e,{S:()=>a});var r=n(7097),i=n(9121),o=n(569);const a=(0,n(2668).op)({ifft_:function(t){(0,o.hu)("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return r.BV.runKernel(i.Qg,e)}})},4415:(t,e,n)=>{"use strict";n.d(e,{w:()=>p});var r=n(1661),i=n(6884),o=n(4386),a=n(4841),s=n(2668),u=n(766),l=n(4968),c=n(7486),f=n(9494),h=n(2676),d=n(8447);const p=(0,s.op)({irfft_:function(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=(0,l.X)(t,[n,e]);s=(0,d.S)(r)}else{const p=[n,2*(e-1)],g=(0,l.X)((0,u.k)(t),[n,e]),m=(0,l.X)((0,o.a)(t),[n,e]),y=(0,c.G)((0,h.t)(g,[0,1],[n,e-2]),1),v=(0,a.d)((0,c.G)((0,h.t)(m,[0,1],[n,e-2]),1),(0,f.i)(-1)),b=(0,i.z)([g,y],1),x=(0,i.z)([m,v],1),w=(0,l.X)((0,r.P)(b,x),[p[0],p[1]]);s=(0,d.S)(w)}if(s=(0,u.k)(s),3===t.rank&&0!==t.shape[0]){const e=s,n=t.shape[0];s=(0,l.X)(s,[n,s.shape[0]/n,s.shape[1]]),e.dispose()}return s}})},3710:(t,e,n)=>{"use strict";n.d(e,{Q:()=>g});var r=n(569),i=n(1661),o=n(6884),a=n(4386),s=n(2668),u=n(766),l=n(4968),c=n(2676),f=n(8644),h=n(9640),d=n(6577),p=n(7020);const g=(0,s.op)({rfft_:function(t,e){(0,r.hu)("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const s=t.size/n;let g;if(null!=e&&e<n){const r=t.shape.map((t=>0)),i=t.shape.map((t=>t));i[t.shape.length-1]=e,g=(0,c.t)(t,r,i),n=e}else if(null!=e&&e>n){const r=t.shape.map((t=>t));r[t.shape.length-1]=e-n,g=(0,o.z)([t,(0,h.l)(r)],t.shape.length-1),n=e}else g=t;const m=(0,d.P)(g),y=(0,l.X)((0,i.P)(g,m),[s,n]),v=(0,p.k)(y),b=Math.floor(n/2)+1,x=(0,u.k)(v),w=(0,a.a)(v),_=(0,f.V)(x,[b,n-b],x.shape.length-1),k=(0,f.V)(w,[b,n-b],w.shape.length-1),A=g.shape.slice();return A[g.shape.length-1]=b,(0,l.X)((0,i.P)(_[0],k[0]),A)}})},8644:(t,e,n)=>{"use strict";n.d(e,{V:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({split_:function(t,e,n=0){const a={x:(0,o._1)(t,"x","split")},s={numOrSizeSplits:e,axis:n};return r.BV.runKernel(i.L8,a,s)}})},3261:(t,e,n)=>{"use strict";n.d(e,{_:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({sqrt_:function(t){const e={x:(0,o._1)(t,"x","sqrt")};return r.BV.runKernel(i.FK,e)}})},248:(t,e,n)=>{"use strict";n.d(e,{h:()=>o});var r=n(7097),i=n(3740);const o=(0,n(2668).op)({square_:function(t){const e=(0,i._1)(t,"x","square");return r.BV.runKernel("Square",{x:e},{})}})},5265:(t,e,n)=>{"use strict";n.d(e,{$:()=>u});var r=n(7097),i=n(9121),o=n(747),a=n(3740),s=n(2200);const u=(0,n(2668).op)({squaredDifference_:function(t,e){let n=(0,a._1)(t,"a","squaredDifference"),u=(0,a._1)(e,"b","squaredDifference");[n,u]=(0,o.makeTypesMatch)(n,u),(0,s.$N)(n.shape,u.shape);const l={a:n,b:u};return r.BV.runKernel(i._t,l,{})}})},9590:(t,e,n)=>{"use strict";n.d(e,{L:()=>s});var r=n(3740),i=n(569),o=n(2668),a=n(4968);const s=(0,o.op)({squeeze_:function(t,e){const n=(0,r._1)(t,"x","squeeze");return(0,a.X)(n,(0,i.bp)(n.shape,e).newShape)}})},2991:(t,e,n)=>{"use strict";n.d(e,{k:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({stack_:function(t,e=0){const n=(0,o.sI)(t,"tensors","stack","string_or_numeric");a.hu(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&a.hu(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const s=n,u={axis:e};return r.BV.runKernel(i.Qi,s,u)}})},1901:(t,e,n)=>{"use strict";n.d(e,{N:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({step_:function(t,e=0){const n={x:(0,o._1)(t,"x","step")},a={alpha:e};return r.BV.runKernel(i.h8,n,a)}})},5158:(t,e,n)=>{"use strict";n.d(e,{N:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({stridedSlice_:function(t,e,n,a,s=0,u=0,l=0,c=0,f=0){const h={x:(0,o._1)(t,"x","stridedSlice")},d={begin:e,end:n,strides:a,beginMask:s,endMask:u,ellipsisMask:l,newAxisMask:c,shrinkAxisMask:f};return r.BV.runKernel(i.m2,h,d)}})},827:(t,e,n)=>{"use strict";n.d(e,{l:()=>s});var r=n(7097),i=n(9121),o=n(747),a=n(3740);const s=(0,n(2668).op)({sub_:function(t,e){let n=(0,a._1)(t,"a","sub"),s=(0,a._1)(e,"b","sub");[n,s]=(0,o.makeTypesMatch)(n,s);const u={a:n,b:s};return r.BV.runKernel(i.Tr,u)}})},5475:(t,e,n)=>{"use strict";n.d(e,{S:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(2271);const s=(0,n(2668).op)({sum_:function(t,e=null,n=!1){let s=(0,o._1)(t,"x","sum");"bool"===s.dtype&&(s=(0,a.p)(s,"int32"));const u={x:s},l={axis:e,keepDims:n};return r.BV.runKernel(i.GB,u,l)}})},1173:(t,e,n)=>{"use strict";n.d(e,{O:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({tan_:function(t){const e={x:(0,o._1)(t,"x","tan")};return r.BV.runKernel(i.sE,e)}})},1869:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({tanh_:function(t){const e={x:(0,o._1)(t,"x","tanh")};return r.BV.runKernel(i.MI,e)}})},7852:(t,e,n)=>{"use strict";n.d(e,{H:()=>a});var r=n(7097),i=n(569),o=n(9155);function a(t,e,n,a){if(null==a&&(a=(0,i.D2)(t)),"complex64"===a)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!(0,i.fU)(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){(0,i.Mu)(e);const t=(0,i.NA)(e),r=(0,i.NA)(n);(0,i.hu)(t===r,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${r}`));for(let t=0;t<n.length;++t){const r=n[t],o=t!==n.length-1||r!==(0,i.NA)(e.slice(t));(0,i.hu)(n[t]===e[t]||!o,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return(0,i.fU)(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==a?(0,o.toTypedArray)(t,a):(0,i.xH)(t,[],!0),r.BV.makeTensor(t,e,a)}},7501:(t,e,n)=>{"use strict";n.d(e,{G:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({tile_:function(t,e){const n=(0,o._1)(t,"x","tile","string_or_numeric");a.hu(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const s={x:n},u={reps:e};return r.BV.runKernel(i.n9,s,u)}})},3243:(t,e,n)=>{"use strict";n.d(e,{h:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({topk_:function(t,e=1,n=!0){const a=(0,o._1)(t,"x","topk");if(0===a.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const s=a.shape[a.shape.length-1];if(e>s)throw new Error(`'k' passed to topk() must be <= the last dimension (${s}) but got ${e}`);const u={x:a},l={k:e,sorted:n},[c,f]=r.BV.runKernel(i.cW,u,l);return{values:c,indices:f}}})},9065:(t,e,n)=>{"use strict";n.d(e,{p:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({transpose_:function(t,e){const n=(0,o._1)(t,"x","transpose");if(null==e&&(e=n.shape.map(((t,e)=>e)).reverse()),a.hu(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`)),e.forEach((t=>{a.hu(t>=0&&t<n.rank,(()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+` but got ${e}`))})),n.rank<=1)return n.clone();const s={x:n},u={perm:e};return r.BV.runKernel(i.G3,s,u)}})},9608:(t,e,n)=>{"use strict";n.d(e,{T:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({unique_:function(t,e=0){const n=(0,o._1)(t,"x","unique","string_or_numeric");(0,a.hu)(n.rank>0,(()=>"The input tensor must be at least 1D"));const s={x:n},u={axis:e},[l,c]=r.BV.runKernel(i.kp,s,u);return{values:l,indices:c}}})},8749:(t,e,n)=>{"use strict";n.d(e,{p:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({unsortedSegmentSum_:function(t,e,n){const s=(0,o._1)(t,"x","unsortedSegmentSum"),u=(0,o._1)(e,"segmentIds","unsortedSegmentSum","int32");(0,a.hu)((0,a.GN)(n),(()=>"numSegments must be of dtype int"));const l={x:s,segmentIds:u},c={numSegments:n};return r.BV.runKernel(i.Qv,l,c)}})},4136:(t,e,n)=>{"use strict";n.d(e,{H:()=>s});var r=n(7097),i=n(9121),o=n(3740),a=n(569);const s=(0,n(2668).op)({unstack_:function(t,e=0){const n=(0,o._1)(t,"x","unstack","string_or_numeric");a.hu(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const s={value:n},u={axis:e};return r.BV.runKernel(i.To,s,u)}})},5912:(t,e,n)=>{"use strict";n.d(e,{a:()=>u});var r=n(7097),i=n(9121),o=n(3740),a=n(8247),s=n(2200);const u=(0,n(2668).op)({where_:function(t,e,n){const u=(0,o._1)(e,"a","where"),l=(0,o._1)(n,"b","where"),c=(0,o._1)(t,"condition","where","bool"),f=(0,s.$N)((0,s.$N)(c.shape,u.shape),l.shape),h={condition:(0,a.U)(c,f),t:(0,a.U)(u,f),e:(0,a.U)(l,f)};return r.BV.runKernel(i.Ph,h)}})},9640:(t,e,n)=>{"use strict";n.d(e,{l:()=>a});var r=n(7097),i=n(569),o=n(1661);function a(t,e="float32"){if("complex64"===e){const e=a(t,"float32"),n=a(t,"float32");return(0,o.P)(e,n)}const n=(0,i.wT)((0,i.NA)(t),e);return r.BV.makeTensor(n,t,e)}},6577:(t,e,n)=>{"use strict";n.d(e,{P:()=>a});var r=n(7097),i=n(9121),o=n(3740);const a=(0,n(2668).op)({zerosLike_:function(t){const e={x:(0,o._1)(t,"x","zerosLike")};return r.BV.runKernel(i.Ru,e)}})},7998:(t,e,n)=>{"use strict";n.r(e);var r=n(6235),i=n(4077);(0,i.t3)().prototype.abs=function(){return this.throwIfDisposed(),(0,r.W)(this)};var o=n(7839);(0,i.t3)().prototype.acos=function(){return this.throwIfDisposed(),(0,o.K)(this)};var a=n(1470);(0,i.t3)().prototype.acosh=function(){return this.throwIfDisposed(),(0,a._)(this)};var s=n(6407);(0,i.t3)().prototype.add=function(t){return this.throwIfDisposed(),(0,s.I)(this,t)};var u=n(781);(0,i.t3)().prototype.all=function(t,e){return this.throwIfDisposed(),(0,u.$)(this,t,e)};var l=n(2998);(0,i.t3)().prototype.any=function(t,e){return this.throwIfDisposed(),(0,l.Y)(this,t,e)};var c=n(47);(0,i.t3)().prototype.argMax=function(t){return this.throwIfDisposed(),(0,c.N)(this,t)};var f=n(7394);(0,i.t3)().prototype.argMin=function(t){return this.throwIfDisposed(),(0,f.v)(this,t)};var h=n(4968),d=n(569);(0,i.t3)().prototype.asScalar=function(){return this.throwIfDisposed(),(0,d.hu)(1===this.size,(()=>"The array must have only 1 element.")),(0,h.X)(this,[])};var p=n(2271);(0,i.t3)().prototype.asType=function(t){return this.throwIfDisposed(),(0,p.p)(this,t)},(0,i.t3)().prototype.as1D=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])},(0,i.t3)().prototype.as2D=function(t,e){return this.throwIfDisposed(),(0,h.X)(this,[t,e])},(0,i.t3)().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),(0,h.X)(this,[t,e,n])},(0,i.t3)().prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),(0,h.X)(this,[t,e,n,r])},(0,i.t3)().prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),(0,h.X)(this,[t,e,n,r,i])};var g=n(2421);(0,i.t3)().prototype.asin=function(){return this.throwIfDisposed(),(0,g.Z)(this)};var m=n(1891);(0,i.t3)().prototype.asinh=function(){return this.throwIfDisposed(),(0,m.V)(this)};var y=n(7037);(0,i.t3)().prototype.atan=function(){return this.throwIfDisposed(),(0,y.z)(this)};var v=n(9812);(0,i.t3)().prototype.atan2=function(t){return this.throwIfDisposed(),(0,v.f)(this,t)};var b=n(369);(0,i.t3)().prototype.atanh=function(){return this.throwIfDisposed(),(0,b.C)(this)};var x=n(5176);(0,i.t3)().prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),(0,x.w)(this,t,e,n,r)};var w=n(8441);(0,i.t3)().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),(0,w.E)(this,t,e)};var _=n(7505);(0,i.t3)().prototype.batchNorm=function(t,e,n,r,i){return this.throwIfDisposed(),(0,_.t)(this,t,e,n,r,i)};var k=n(8247);(0,i.t3)().prototype.broadcastTo=function(t){return this.throwIfDisposed(),(0,k.U)(this,t)},(0,i.t3)().prototype.cast=function(t){return this.throwIfDisposed(),(0,p.p)(this,t)};var A=n(6825);(0,i.t3)().prototype.ceil=function(){return this.throwIfDisposed(),(0,A.m)(this)};var E=n(2279);(0,i.t3)().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),(0,E.i)(this,t,e)};var D=n(6884);(0,i.t3)().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof i.es&&(t=[t]),(0,D.z)([this,...t],e)};var S=n(1355);(0,i.t3)().prototype.conv1d=function(t,e,n,r,i,o){return this.throwIfDisposed(),(0,S.P)(this,t,e,n,r,i,o)};var C=n(1405);(0,i.t3)().prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),(0,C.b)(this,t,e,n,r,i)};var O=n(4794);(0,i.t3)().prototype.conv2d=function(t,e,n,r,i,o){return this.throwIfDisposed(),(0,O.T)(this,t,e,n,r,i,o)};var F=n(173);(0,i.t3)().prototype.cos=function(){return this.throwIfDisposed(),(0,F.m)(this)};var M=n(2699);(0,i.t3)().prototype.cosh=function(){return this.throwIfDisposed(),(0,M.f)(this)};var $=n(7405);(0,i.t3)().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),(0,$.z)(this,t,e,n)};var N=n(9112);(0,i.t3)().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),(0,N.n)(this,t,e)};var B=n(4718);(0,i.t3)().prototype.depthwiseConv2d=function(t,e,n,r,i,o){return this.throwIfDisposed(),(0,B.B)(this,t,e,n,r,i,o)};var T=n(557);(0,i.t3)().prototype.dilation2d=function(t,e,n,r,i){return this.throwIfDisposed(),(0,T.W)(this,t,e,n,r,i)};var j=n(9322);(0,i.t3)().prototype.divNoNan=function(t){return this.throwIfDisposed(),(0,j.N)(this,t)};var I=n(1274);(0,i.t3)().prototype.div=function(t){return this.throwIfDisposed(),(0,I.h)(this,t)};var z=n(548);(0,i.t3)().prototype.dot=function(t){return this.throwIfDisposed(),(0,z.A)(this,t)};var R=n(3233);(0,i.t3)().prototype.elu=function(){return this.throwIfDisposed(),(0,R.p)(this)};var P=n(6477);(0,i.t3)().prototype.equal=function(t){return this.throwIfDisposed(),(0,P.D)(this,t)};var L=n(4650);(0,i.t3)().prototype.erf=function(){return this.throwIfDisposed(),(0,L.q)(this)};var q=n(4842);(0,i.t3)().prototype.exp=function(){return this.throwIfDisposed(),(0,q.Q)(this)};var U=n(1300);(0,i.t3)().prototype.expandDims=function(t){return this.throwIfDisposed(),(0,U.d)(this,t)};var W=n(3426);(0,i.t3)().prototype.expm1=function(){return this.throwIfDisposed(),(0,W.t)(this)};var V=n(7020);(0,i.t3)().prototype.fft=function(){return this.throwIfDisposed(),(0,V.k)(this)},(0,i.t3)().prototype.flatten=function(){return this.throwIfDisposed(),(0,h.X)(this,[this.size])};var H=n(6943);(0,i.t3)().prototype.floor=function(){return this.throwIfDisposed(),(0,H.G)(this)};var G=n(9165);(0,i.t3)().prototype.floorDiv=function(t){return this.throwIfDisposed(),(0,G.q)(this,t)};var X=n(4926);(0,i.t3)().prototype.gather=function(t,e){return this.throwIfDisposed(),(0,X.I)(this,t,e)};var K=n(7630);(0,i.t3)().prototype.greaterEqual=function(t){return this.throwIfDisposed(),(0,K.b)(this,t)};var Y=n(636);(0,i.t3)().prototype.greater=function(t){return this.throwIfDisposed(),(0,Y.p)(this,t)};var J=n(8447);(0,i.t3)().prototype.ifft=function(){return this.throwIfDisposed(),(0,J.S)(this)};var Z=n(4415);(0,i.t3)().prototype.irfft=function(){return this.throwIfDisposed(),(0,Z.w)(this)};var Q=n(3963);(0,i.t3)().prototype.isFinite=function(){return this.throwIfDisposed(),(0,Q.x)(this)};var tt=n(4365);(0,i.t3)().prototype.isInf=function(){return this.throwIfDisposed(),(0,tt.U)(this)};var et=n(6230);(0,i.t3)().prototype.isNaN=function(){return this.throwIfDisposed(),(0,et.i)(this)};var nt=n(9133);(0,i.t3)().prototype.leakyRelu=function(t){return this.throwIfDisposed(),(0,nt.h)(this,t)};var rt=n(624);(0,i.t3)().prototype.lessEqual=function(t){return this.throwIfDisposed(),(0,rt.z)(this,t)};var it=n(6573);(0,i.t3)().prototype.less=function(t){return this.throwIfDisposed(),(0,it.d)(this,t)};var ot=n(9648);(0,i.t3)().prototype.localResponseNormalization=function(t,e,n,r){return this.throwIfDisposed(),(0,ot.G)(this,t,e,n,r)};var at=n(3888);(0,i.t3)().prototype.logSigmoid=function(){return this.throwIfDisposed(),(0,at.e)(this)};var st=n(1510);(0,i.t3)().prototype.logSoftmax=function(t){return this.throwIfDisposed(),(0,st.C)(this,t)};var ut=n(1391);(0,i.t3)().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),(0,ut.l)(this,t,e)};var lt=n(2597);(0,i.t3)().prototype.log=function(){return this.throwIfDisposed(),(0,lt.c)(this)};var ct=n(7474);(0,i.t3)().prototype.log1p=function(){return this.throwIfDisposed(),(0,ct.K)(this)};var ft=n(2856);(0,i.t3)().prototype.logicalAnd=function(t){return this.throwIfDisposed(),(0,ft.H)(this,t)};var ht=n(8651);(0,i.t3)().prototype.logicalNot=function(){return this.throwIfDisposed(),(0,ht.h)(this)};var dt=n(5750);(0,i.t3)().prototype.logicalOr=function(t){return this.throwIfDisposed(),(0,dt.K)(this,t)};var pt=n(596);(0,i.t3)().prototype.logicalXor=function(t){return this.throwIfDisposed(),(0,pt.e)(this,t)};var gt=n(8687);(0,i.t3)().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),(0,gt.O)(this,t,e,n)};var mt=n(1174);(0,i.t3)().prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),(0,mt._)(this,t,e,n,r)};var yt=n(3307);(0,i.t3)().prototype.max=function(t,e){return this.throwIfDisposed(),(0,yt.F)(this,t,e)};var vt=n(632);(0,i.t3)().prototype.maximum=function(t){return this.throwIfDisposed(),(0,vt.g)(this,t)};var bt=n(5130);(0,i.t3)().prototype.mean=function(t,e){return this.throwIfDisposed(),(0,bt.J)(this,t,e)};var xt=n(5735);(0,i.t3)().prototype.min=function(t,e){return this.throwIfDisposed(),(0,xt.V)(this,t,e)};var wt=n(4513);(0,i.t3)().prototype.minimum=function(t){return this.throwIfDisposed(),(0,wt.L)(this,t)};var _t=n(1483);(0,i.t3)().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),(0,_t.V)(this,t,e)};var kt=n(5228);(0,i.t3)().prototype.mod=function(t){return this.throwIfDisposed(),(0,kt.w)(this,t)};var At=n(4841);(0,i.t3)().prototype.mul=function(t){return this.throwIfDisposed(),(0,At.d)(this,t)};var Et=n(7370);(0,i.t3)().prototype.neg=function(){return this.throwIfDisposed(),(0,Et.W)(this)};var Dt=n(3561);(0,i.t3)().prototype.norm=function(t,e,n){return this.throwIfDisposed(),(0,Dt.K)(this,t,e,n)};var St=n(6500);(0,i.t3)().prototype.notEqual=function(t){return this.throwIfDisposed(),(0,St.Q)(this,t)};var Ct=n(6708);(0,i.t3)().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),(0,Ct.l)(this,t,e,n)};var Ot=n(7846);(0,i.t3)().prototype.onesLike=function(){return this.throwIfDisposed(),(0,Ot.J)(this)};var Ft=n(9682);(0,i.t3)().prototype.pad=function(t,e){return this.throwIfDisposed(),(0,Ft.v)(this,t,e)};var Mt=n(5860);(0,i.t3)().prototype.pool=function(t,e,n,r,i){return this.throwIfDisposed(),(0,Mt.d)(this,t,e,n,r,i)};var $t=n(3453);(0,i.t3)().prototype.pow=function(t){return this.throwIfDisposed(),(0,$t.s)(this,t)};var Nt=n(8151);(0,i.t3)().prototype.prelu=function(t){return this.throwIfDisposed(),(0,Nt.A)(this,t)};var Bt=n(9451);(0,i.t3)().prototype.prod=function(t,e){return this.throwIfDisposed(),(0,Bt.W)(this,t,e)};var Tt=n(9036);(0,i.t3)().prototype.reciprocal=function(){return this.throwIfDisposed(),(0,Tt.M)(this)};var jt=n(7409);(0,i.t3)().prototype.relu=function(){return this.throwIfDisposed(),(0,jt.U)(this)};var It=n(3582);(0,i.t3)().prototype.relu6=function(){return this.throwIfDisposed(),(0,It.b)(this)},(0,i.t3)().prototype.reshapeAs=function(t){return this.throwIfDisposed(),(0,h.X)(this,t.shape)},(0,i.t3)().prototype.reshape=function(t){return this.throwIfDisposed(),(0,h.X)(this,t)};var zt=n(3305);(0,i.t3)().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),(0,zt.I)(this,t,e,n)};var Rt=n(5098);(0,i.t3)().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),(0,Rt.j)(this,t,e,n)};var Pt=n(7486);(0,i.t3)().prototype.reverse=function(t){return this.throwIfDisposed(),(0,Pt.G)(this,t)};var Lt=n(3710);(0,i.t3)().prototype.rfft=function(){return this.throwIfDisposed(),(0,Lt.Q)(this)};var qt=n(7809);(0,i.t3)().prototype.round=function(){return this.throwIfDisposed(),(0,qt.N)(this)};var Ut=n(2634);(0,i.t3)().prototype.rsqrt=function(){return this.throwIfDisposed(),(0,Ut.b)(this)};var Wt=n(5503);(0,i.t3)().prototype.selu=function(){return this.throwIfDisposed(),(0,Wt.U)(this)};var Vt=n(8678);(0,i.t3)().prototype.separableConv2d=function(t,e,n,r,i,o){return this.throwIfDisposed(),(0,Vt.U)(this,t,e,n,r,i,o)};var Ht=n(625);(0,i.t3)().prototype.sigmoid=function(){return this.throwIfDisposed(),(0,Ht.X)(this)};var Gt=n(4434);(0,i.t3)().prototype.sign=function(){return this.throwIfDisposed(),(0,Gt.X)(this)};var Xt=n(9331);(0,i.t3)().prototype.sin=function(){return this.throwIfDisposed(),(0,Xt.O)(this)};var Kt=n(3254);(0,i.t3)().prototype.sinh=function(){return this.throwIfDisposed(),(0,Kt.R)(this)};var Yt=n(2676);(0,i.t3)().prototype.slice=function(t,e){return this.throwIfDisposed(),(0,Yt.t)(this,t,e)};var Jt=n(682);(0,i.t3)().prototype.softmax=function(t){return this.throwIfDisposed(),(0,Jt.X)(this,t)};var Zt=n(3694);(0,i.t3)().prototype.softplus=function(){return this.throwIfDisposed(),(0,Zt.W)(this)};var Qt=n(7918);(0,i.t3)().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),(0,Qt.f)(this,t,e)};var te=n(8644);(0,i.t3)().prototype.split=function(t,e){return this.throwIfDisposed(),(0,te.V)(this,t,e)};var ee=n(3261);(0,i.t3)().prototype.sqrt=function(){return this.throwIfDisposed(),(0,ee._)(this)};var ne=n(248);(0,i.t3)().prototype.square=function(){return this.throwIfDisposed(),(0,ne.h)(this)};var re=n(5265);(0,i.t3)().prototype.squaredDifference=function(t){return this.throwIfDisposed(),(0,re.$)(this,t)};var ie=n(9590);(0,i.t3)().prototype.squeeze=function(t){return this.throwIfDisposed(),(0,ie.L)(this,t)};var oe=n(2991);(0,i.t3)().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof i.es?[this,t]:[this,...t];return(0,oe.k)(n,e)};var ae=n(1901);(0,i.t3)().prototype.step=function(t){return this.throwIfDisposed(),(0,ae.N)(this,t)};var se=n(5158);(0,i.t3)().prototype.stridedSlice=function(t,e,n,r,i,o,a,s){return this.throwIfDisposed(),(0,se.N)(this,t,e,n,r,i,o,a,s)};var ue=n(827);(0,i.t3)().prototype.sub=function(t){return this.throwIfDisposed(),(0,ue.l)(this,t)};var le=n(5475);(0,i.t3)().prototype.sum=function(t,e){return this.throwIfDisposed(),(0,le.S)(this,t,e)};var ce=n(1173);(0,i.t3)().prototype.tan=function(){return this.throwIfDisposed(),(0,ce.O)(this)};var fe=n(1869);(0,i.t3)().prototype.tanh=function(){return this.throwIfDisposed(),(0,fe.A)(this)};var he=n(7501);(0,i.t3)().prototype.tile=function(t){return this.throwIfDisposed(),(0,he.G)(this,t)},(0,i.t3)().prototype.toBool=function(){return this.throwIfDisposed(),(0,p.p)(this,"bool")},(0,i.t3)().prototype.toFloat=function(){return this.throwIfDisposed(),(0,p.p)(this,"float32")},(0,i.t3)().prototype.toInt=function(){return this.throwIfDisposed(),(0,p.p)(this,"int32")};var de=n(3243);(0,i.t3)().prototype.topk=function(t,e){return this.throwIfDisposed(),(0,de.h)(this,t,e)};var pe=n(9065);(0,i.t3)().prototype.transpose=function(t){return this.throwIfDisposed(),(0,pe.p)(this,t)};var ge=n(9608);(0,i.t3)().prototype.unique=function(t){return this.throwIfDisposed(),(0,ge.T)(this,t)};var me=n(8749);(0,i.t3)().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),(0,me.p)(this,t,e)};var ye=n(4136);(0,i.t3)().prototype.unstack=function(t){return this.throwIfDisposed(),(0,ye.H)(this,t)};var ve=n(5912);(0,i.t3)().prototype.where=function(t,e){return this.throwIfDisposed(),(0,ve.a)(t,this,e)};var be=n(6577);(0,i.t3)().prototype.zerosLike=function(){return this.throwIfDisposed(),(0,be.P)(this)}},4077:(t,e,n)=>{"use strict";n.d(e,{es:()=>v,YD:()=>f,_w:()=>x,t3:()=>b,FZ:()=>y,Vp:()=>m,Vi:()=>g});var r=n(5938),i=n(569);function o(t,e,n,r){const o=(0,i.e3)(e),s=function(t,e,n,r){const o=(0,i.NA)(e),s=r[r.length-1],u=new Array(s).fill(0),c=e.length,f="complex64"===n?l(t):t;if(c>1)for(let t=0;t<o/s;t++){const e=t*s;for(let t=0;t<s;t++)u[t]=Math.max(u[t],a(f[e+t],0,n).length)}return u}(t,e,n,o),c=e.length,f=u(t,e,n,o,s),h=["Tensor"];return r&&(h.push(`  dtype: ${n}`),h.push(`  rank: ${c}`),h.push(`  shape: [${e}]`),h.push("  values:")),h.push(f.map((t=>"    "+t)).join("\n")),h.join("\n")}function a(t,e,n){let r;return r=Array.isArray(t)?`${parseFloat(t[0].toFixed(7))} + ${parseFloat(t[1].toFixed(7))}j`:(0,i.HD)(t)?`'${t}'`:"bool"===n?s(t):parseFloat(t.toFixed(7)).toString(),(0,i.oj)(r,e)}function s(t){return 0===t?"false":"true"}function u(t,e,n,r,i,o=!0){const c="complex64"===n?2:1,f=e[0],h=e.length;if(0===h)return"complex64"===n?[a(l(t)[0],0,n)]:"bool"===n?[s(t[0])]:[t[0].toString()];if(1===h){if(f>20){const e=3*c;let r=Array.from(t.slice(0,e)),o=Array.from(t.slice((f-3)*c,f*c));return"complex64"===n&&(r=l(r),o=l(o)),["["+r.map(((t,e)=>a(t,i[e],n))).join(", ")+", ..., "+o.map(((t,e)=>a(t,i[f-3+e],n))).join(", ")+"]"]}return["["+("complex64"===n?l(t):Array.from(t)).map(((t,e)=>a(t,i[e],n))).join(", ")+"]"]}const d=e.slice(1),p=r.slice(1),g=r[0]*c,m=[];if(f>20){for(let e=0;e<3;e++){const r=e*g,o=r+g;m.push(...u(t.slice(r,o),d,n,p,i,!1))}m.push("...");for(let e=f-3;e<f;e++){const r=e*g,o=r+g;m.push(...u(t.slice(r,o),d,n,p,i,e===f-1))}}else for(let e=0;e<f;e++){const r=e*g,o=r+g;m.push(...u(t.slice(r,o),d,n,p,i,e===f-1))}const y=2===h?",":"";m[0]="["+m[0]+y;for(let t=1;t<m.length-1;t++)m[t]=" "+m[t]+y;let v=",\n";for(let t=2;t<h;t++)v+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":v),m}function l(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var c=n(9155);class f{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=i.NA(t),null!=n){const t=n.length;i.hu(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||i.rQ(e,this.size),this.strides=(0,i.e3)(t)}set(t,...e){0===e.length&&(e=[0]),i.hu(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const n of t){if(n<0||n>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let e=0;e<t.length-1;++e)n+=this.strides[e]*t[e];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return h().makeTensor(this.values,this.shape,this.dtype)}}let h=null,d=null,p=null;function g(t){h=t}function m(t){d=t}function y(t){p=t}class v{constructor(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=i.NA(t),this.strides=(0,i.e3)(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return d.buffer(this.shape,this.dtype,t)}bufferSync(){return d.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return(0,i.GX)(this.shape,t,"complex64"===this.dtype)}arraySync(){return(0,i.GX)(this.shape,this.dataSync(),"complex64"===this.dtype)}async data(){this.throwIfDisposed();const t=h().read(this.dataId);if("string"===this.dtype){const e=await t;try{return e.map((t=>c.decodeString(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataSync(){this.throwIfDisposed();const t=h().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>c.decodeString(t)))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await h().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(h().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return d.print(this,t)}clone(){return this.throwIfDisposed(),d.clone(this)}toString(t=!1){return o(this.dataSync(),this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),d.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),h().makeVariable(this,t,e,n)}}function b(){return(0,r.R)("Tensor",(()=>v))}Object.defineProperty(v,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed}),b();class x extends v{constructor(t,e,n,r){super(t.shape,t.dtype,t.dataId,r),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!i.cO(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);h().disposeTensor(this),this.dataId=t.dataId,h().incRef(this,null)}dispose(){h().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(x,Symbol.hasInstance,{value:t=>t instanceof v&&null!=t.assign&&t.assign instanceof Function})},747:(t,e,n)=>{"use strict";n.r(e),n.d(e,{makeTypesMatch:()=>a,assertTypesMatch:()=>s,isTensorInList:()=>u,getTensorsInContainer:()=>l});var r=n(4077),i=n(1221),o=n(569);function a(t,e){if(t.dtype===e.dtype)return[t,e];const n=(0,i.x8)(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function s(t,e){(0,o.hu)(t.dtype===e.dtype,(()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`))}function u(t,e){return e.some((e=>e.id===t.id))}function l(t){const e=[];return c(t,e,new Set),e}function c(t,e,n){if(null==t)return;if(t instanceof r.es)return void e.push(t);if(i=t,!Array.isArray(i)&&"object"!=typeof i)return;var i;const o=t;for(const t in o){const r=o[t];n.has(r)||(n.add(r),c(r,e,n))}}},3740:(t,e,n)=>{"use strict";n.d(e,{C:()=>u,_1:()=>f,sI:()=>h});var r=n(7097),i=n(2885),o=n(4077),a=n(569),s=n(9155);function u(t,e){let n=t;if((0,a.fU)(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const r=[];for(;Array.isArray(n)||(0,a.fU)(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&(0,i.OB)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&l(t,r,[]),r}function l(t,e,n){if(n=n||[],!Array.isArray(t)&&!(0,a.fU)(t))return void(0,a.hu)(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));(0,a.hu)(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),(0,a.hu)(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const r=e.slice(1);for(let e=0;e<t.length;++e)l(t[e],r,n.concat(e))}function c(t,e,n,r){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${r}' must be ${t} tensor, but got ${e} tensor`)}}function f(t,e,n,i="numeric"){if(t instanceof o.es)return c(i,t.dtype,e,n),t;let l=(0,a.D2)(t);if("string"!==l&&["bool","int32","float32"].indexOf(i)>=0&&(l=i),c(i,l,e,n),null==t||!(0,a.fU)(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){const r=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${r}'`)}const f=u(t,l);(0,a.fU)(t)||Array.isArray(t)||(t=[t]);const h="string"!==l?(0,s.toTypedArray)(t,l):(0,a.xH)(t,[],!0);return r.BV.makeTensor(h,f,l)}function h(t,e,n,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map(((t,i)=>f(t,`${e}[${i}]`,n,r)))}},1221:(t,e,n)=>{"use strict";var r,i,o,a,s;n.d(e,{yw:()=>r,x8:()=>l,z4:()=>c}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(r||(r={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(i||(i={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(o||(o={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(a||(a={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(s||(s={}));const u={float32:a,int32:i,bool:o,complex64:s};function l(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return u[t][e]}function c(t){return l(t,"int32")}},9155:(t,e,n)=>{"use strict";n.r(e),n.d(e,{arraysEqual:()=>i.cO,assert:()=>i.hu,assertNonNegativeIntegerDimensions:()=>i.Mu,assertNonNull:()=>i.Cq,assertShapesMatch:()=>i.k5,bytesFromStringArray:()=>i.Ub,bytesPerElement:()=>i.bT,checkConversionForErrors:()=>i.D5,clamp:()=>i.uZ,computeStrides:()=>i.e3,createShuffledIndices:()=>i.U$,distSquared:()=>i.E7,flatten:()=>i.xH,getArrayFromDType:()=>i.rQ,getTypedArrayFromDType:()=>i.WP,hasEncodingLoss:()=>i.QB,indexToLoc:()=>i.NE,inferDtype:()=>i.D2,inferFromImplicitShape:()=>i.JZ,isBoolean:()=>i.jn,isFunction:()=>i.mf,isInt:()=>i.GN,isNumber:()=>i.hj,isPromise:()=>i.tI,isScalarShape:()=>i.N9,isString:()=>i.HD,isTypedArray:()=>i.fU,isValidDtype:()=>i.LP,locToIndex:()=>i.qy,makeOnesTypedArray:()=>i.p8,makeZerosNestedTypedArray:()=>i.l6,makeZerosTypedArray:()=>i.wT,nearestDivisor:()=>i.jP,nearestLargerEven:()=>i.nY,parseAxisParam:()=>i.EC,randUniform:()=>i.bj,repeatedTry:()=>i.WD,rightPad:()=>i.oj,shuffle:()=>i.TV,shuffleCombo:()=>i.d7,sizeFromShape:()=>i.NA,sizeToSquarishShape:()=>i.YP,squeezeShape:()=>i.bp,sum:()=>i.Sm,tanh:()=>i.AE,toNestedArray:()=>i.GX,createScalarValue:()=>o,toTypedArray:()=>a,now:()=>s,fetch:()=>u,encodeString:()=>l,decodeString:()=>c});var r=n(2885),i=n(569);function o(t,e){return"string"===e?l(t):a([t],e)}function a(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=i.xH(t)),(0,r.OB)().getBool("DEBUG")&&i.D5(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function s(){return(0,r.OB)().platform.now()}function u(t,e){return(0,r.OB)().platform.fetch(t,e)}function l(t,e="utf-8"){return e=e||"utf-8",(0,r.OB)().platform.encode(t,e)}function c(t,e="utf-8"){return e=e||"utf-8",(0,r.OB)().platform.decode(t,e)}},569:(t,e,n)=>{"use strict";function r(t){let e=t.length,n=0,r=0;for(;e>0;)r=Math.random()*e|0,e--,n=t[e],t[e]=t[r],t[r]=n}function i(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let n,r,i=t.length,o=0;for(;i>0;)o=Math.random()*i|0,i--,n=t[i],r=e[i],t[i]=t[o],e[i]=e[o],t[o]=n,e[o]=r}function o(t,e,n){return Math.max(t,Math.min(e,n))}function a(t){return t%2==0?t:t+1}function s(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function u(t,e){const n=Math.random();return e*n+(1-n)*t}function l(t,e){let n=0;for(let r=0;r<t.length;r++){const i=Number(t[r])-Number(e[r]);n+=i*i}return n}function c(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function f(t,e,n=""){c(m(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function h(t){c(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function d(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||M(t)&&!n)for(let r=0;r<t.length;++r)d(t[r],e,n);else e.push(t);return e}function p(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function g(t){return 0===t.length}function m(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function y(t){return t%1==0}function v(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{const e=Math.exp(2*t);return(e-1)/(e+1)}}function b(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function x(t){const e=new Uint32Array(t);for(let n=0;n<t;++n)e[n]=n;return r(e),e}function w(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function _(t,e=(t=>0),n){return new Promise(((r,i)=>{let o=0;const a=()=>{if(t())return void r();o++;const s=e(o);null!=n&&o>=n?i():setTimeout(a,s)};a()}))}function k(t,e){let n=1,r=-1;for(let e=0;e<t.length;++e)if(t[e]>=0)n*=t[e];else if(-1===t[e]){if(-1!==r)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${e}`);r=e}else if(t[e]<0)throw Error(`Shapes can not be < 0. Found ${t[e]} at dim ${e}`);if(-1===r){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!=0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[r]=e/n,i}function A(t,e){const n=e.length;return c((t=null==t?e.map(((t,e)=>e)):[].concat(t)).every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),c(t.every((t=>y(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function E(t,e){const n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||i?null:A(e,t).sort();let a=0;for(let e=0;e<t.length;++e){if(null!=o){if(o[a]===e&&1!==t[e])throw new Error(`Can't squeeze axis ${e} since its dim '${t[e]}' is not 1`);(null==o[a]||o[a]>e)&&1===t[e]&&(n.push(t[e]),r.push(e)),o[a]<=e&&a++}1!==t[e]&&(n.push(t[e]),r.push(e))}return{newShape:n,keptDims:r}}function D(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function S(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function C(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function O(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function F(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function M(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function $(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function N(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function B(t){return"string"==typeof t||t instanceof String}function T(t){return"boolean"==typeof t}function j(t){return"number"==typeof t}function I(t){return Array.isArray(t)?I(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":j(t)?"float32":B(t)?"string":T(t)?"bool":"float32"}function z(t){return!!(t&&t.constructor&&t.call&&t.apply)}function R(t,e){for(let n=e;n<t;++n)if(t%n==0)return n;return t}function P(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function L(t,e,n,r=!1){const i=new Array;if(1===e.length){const o=e[0]*(r?2:1);for(let e=0;e<o;e++)i[e]=n[t+e]}else{const o=e[0],a=e.slice(1),s=a.reduce(((t,e)=>t*e))*(r?2:1);for(let e=0;e<o;e++)i[e]=L(t+e*s,a,n,r)}return i}function q(t,e,n=!1){if(0===t.length)return e[0];const r=t.reduce(((t,e)=>t*e))*(n?2:1);if(0===r)return[];if(r!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return L(0,t,e,n)}function U(t,e){const n=W(t,e);for(let t=0;t<n.length;t++)n[t]=1;return n}function W(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function V(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return q(t,new Float32Array(n));if("int32"===e)return q(t,new Int32Array(n));if("bool"===e)return q(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function H(t){t.forEach((e=>{c(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function G(t,e,n){if(0===e)return 0;if(1===e)return t[0];let r=t[t.length-1];for(let e=0;e<t.length-1;++e)r+=n[e]*t[e];return r}function X(t,e,n){if(0===e)return[];if(1===e)return[t];const r=new Array(e);for(let e=0;e<r.length-1;++e)r[e]=Math.floor(t/n[e]),t-=r[e]*n[e];return r[r.length-1]=t,r}function K(t){return t&&t.then&&"function"==typeof t.then}n.d(e,{TV:()=>r,d7:()=>i,uZ:()=>o,nY:()=>a,Sm:()=>s,bj:()=>u,E7:()=>l,hu:()=>c,k5:()=>f,Cq:()=>h,xH:()=>d,NA:()=>p,N9:()=>g,cO:()=>m,GN:()=>y,AE:()=>v,YP:()=>b,U$:()=>x,oj:()=>w,WD:()=>_,JZ:()=>k,EC:()=>A,bp:()=>E,WP:()=>D,rQ:()=>S,D5:()=>C,LP:()=>O,QB:()=>F,fU:()=>M,bT:()=>$,Ub:()=>N,HD:()=>B,jn:()=>T,hj:()=>j,D2:()=>I,mf:()=>z,jP:()=>R,e3:()=>P,GX:()=>q,p8:()=>U,wT:()=>W,l6:()=>V,Mu:()=>H,qy:()=>G,NE:()=>X,tI:()=>K})},6313:t=>{var e=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,n,r;try{e=Map}catch(t){e=function(){}}try{n=Set}catch(t){n=function(){}}try{r=Promise}catch(t){r=function(){}}function i(o,s,u,l,c){"object"==typeof s&&(u=s.depth,l=s.prototype,c=s.includeNonEnumerable,s=s.circular);var f=[],h=[],d="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===u&&(u=1/0),function o(u,p){if(null===u)return null;if(0===p)return u;var g,m;if("object"!=typeof u)return u;if(t(u,e))g=new e;else if(t(u,n))g=new n;else if(t(u,r))g=new r((function(t,e){u.then((function(e){t(o(e,p-1))}),(function(t){e(o(t,p-1))}))}));else if(i.__isArray(u))g=[];else if(i.__isRegExp(u))g=new RegExp(u.source,a(u)),u.lastIndex&&(g.lastIndex=u.lastIndex);else if(i.__isDate(u))g=new Date(u.getTime());else{if(d&&Buffer.isBuffer(u))return g=Buffer.allocUnsafe?Buffer.allocUnsafe(u.length):new Buffer(u.length),u.copy(g),g;t(u,Error)?g=Object.create(u):void 0===l?(m=Object.getPrototypeOf(u),g=Object.create(m)):(g=Object.create(l),m=l)}if(s){var y=f.indexOf(u);if(-1!=y)return h[y];f.push(u),h.push(g)}for(var v in t(u,e)&&u.forEach((function(t,e){var n=o(e,p-1),r=o(t,p-1);g.set(n,r)})),t(u,n)&&u.forEach((function(t){var e=o(t,p-1);g.add(e)})),u){var b;m&&(b=Object.getOwnPropertyDescriptor(m,v)),b&&null==b.set||(g[v]=o(u[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(u);for(v=0;v<x.length;v++){var w=x[v];(!(k=Object.getOwnPropertyDescriptor(u,w))||k.enumerable||c)&&(g[w]=o(u[w],p-1),k.enumerable||Object.defineProperty(g,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(u);for(v=0;v<_.length;v++){var k,A=_[v];(k=Object.getOwnPropertyDescriptor(u,A))&&k.enumerable||(g[A]=o(u[A],p-1),Object.defineProperty(g,A,{enumerable:!1}))}}return g}(o,u)}function o(t){return Object.prototype.toString.call(t)}function a(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return i.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},i.__objToStr=o,i.__isDate=function(t){return"object"==typeof t&&"[object Date]"===o(t)},i.__isArray=function(t){return"object"==typeof t&&"[object Array]"===o(t)},i.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===o(t)},i.__getRegExpFlags=a,i}();t.exports&&(t.exports=e)},6238:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,i.default)(t)};var r,i=(r=n(5477))&&r.__esModule?r:{default:r};t.exports=e.default},638:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return"string"==typeof t&&n.test(t)};var n=/-webkit-|-moz-|-ms-/;t.exports=e.default},6722:(t,e,n)=>{"use strict";function r(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function i(t){return(t=r(Math.abs(t)))?t[1]:NaN}n.r(e),n.d(e,{format:()=>d,formatDefaultLocale:()=>y,formatLocale:()=>m,formatPrefix:()=>p,formatSpecifier:()=>s,precisionFixed:()=>v,precisionPrefix:()=>b,precisionRound:()=>x});var o,a=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function s(t){return new u(t)}function u(t){if(!(e=a.exec(t)))throw new Error("invalid format: "+t);var e;this.fill=e[1]||" ",this.align=e[2]||">",this.sign=e[3]||"-",this.symbol=e[4]||"",this.zero=!!e[5],this.width=e[6]&&+e[6],this.comma=!!e[7],this.precision=e[8]&&+e[8].slice(1),this.trim=!!e[9],this.type=e[10]||""}function l(t,e){var n=r(t,e);if(!n)return t+"";var i=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}s.prototype=u.prototype,u.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const c={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:function(t){return Math.round(t).toString(10)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return l(100*t,e)},r:l,s:function(t,e){var n=r(t,e);if(!n)return t+"";var i=n[0],a=n[1],s=a-(o=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,u=i.length;return s===u?i:s>u?i+new Array(s-u+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+r(t,Math.max(0,e+s-1))[0]},X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function f(t){return t}var h,d,p,g=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function m(t){var e,n,r=t.grouping&&t.thousands?(e=t.grouping,n=t.thousands,function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}):f,a=t.currency,u=t.decimal,l=t.numerals?function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(t.numerals):f,h=t.percent||"%";function d(t){var e=(t=s(t)).fill,n=t.align,i=t.sign,f=t.symbol,d=t.zero,p=t.width,m=t.comma,y=t.precision,v=t.trim,b=t.type;"n"===b?(m=!0,b="g"):c[b]||(null==y&&(y=12),v=!0,b="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var x="$"===f?a[0]:"#"===f&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===f?a[1]:/[%p]/.test(b)?h:"",_=c[b],k=/[defgprs%]/.test(b);function A(t){var a,s,c,f=x,h=w;if("c"===b)h=_(t)+h,t="";else{var A=(t=+t)<0;if(t=_(Math.abs(t),y),v&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(i>0){if(!+t[r])break t;i=0}}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&(A=!1),f=(A?"("===i?i:"-":"-"===i||"("===i?"":i)+f,h=("s"===b?g[8+o/3]:"")+h+(A&&"("===i?")":""),k)for(a=-1,s=t.length;++a<s;)if(48>(c=t.charCodeAt(a))||c>57){h=(46===c?u+t.slice(a+1):t.slice(a))+h,t=t.slice(0,a);break}}m&&!d&&(t=r(t,1/0));var E=f.length+t.length+h.length,D=E<p?new Array(p-E+1).join(e):"";switch(m&&d&&(t=r(D+t,D.length?p-h.length:1/0),D=""),n){case"<":t=f+t+h+D;break;case"=":t=f+D+t+h;break;case"^":t=D.slice(0,E=D.length>>1)+f+t+h+D.slice(E);break;default:t=D+f+t+h}return l(t)}return y=null==y?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),A.toString=function(){return t+""},A}return{format:d,formatPrefix:function(t,e){var n=d(((t=s(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(i(e)/3))),o=Math.pow(10,-r),a=g[8+r/3];return function(t){return n(o*t)+a}}}}function y(t){return h=m(t),d=h.format,p=h.formatPrefix,h}function v(t){return Math.max(0,-i(Math.abs(t)))}function b(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(i(e)/3)))-i(Math.abs(t)))}function x(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,i(e)-i(t))+1}y({decimal:".",thousands:",",grouping:[3],currency:["$",""]})},4677:(t,e,n)=>{"use strict";n.r(e),n.d(e,{clientPoint:()=>kt,create:()=>vt,creator:()=>u,customEvent:()=>lt,event:()=>rt,local:()=>xt,matcher:()=>m,mouse:()=>At,namespace:()=>o,namespaces:()=>i,select:()=>yt,selectAll:()=>Et,selection:()=>mt,selector:()=>c,selectorAll:()=>h,style:()=>$,touch:()=>Dt,touches:()=>St,window:()=>C});var r="http://www.w3.org/1999/xhtml";const i={svg:"http://www.w3.org/2000/svg",xhtml:r,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function o(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),i.hasOwnProperty(e)?{space:i[e],local:t}:t}function a(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===r&&e.documentElement.namespaceURI===r?e.createElement(t):e.createElementNS(n,t)}}function s(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function u(t){var e=o(t);return(e.local?s:a)(e)}function l(){}function c(t){return null==t?l:function(){return this.querySelector(t)}}function f(){return[]}function h(t){return null==t?f:function(){return this.querySelectorAll(t)}}var d=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var g=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;d=function(t){return function(){return g.call(this,t)}}}}const m=d;function y(t){return new Array(t.length)}function v(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function b(t,e,n,r,i,o){for(var a,s=0,u=e.length,l=o.length;s<l;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new v(t,o[s]);for(;s<u;++s)(a=e[s])&&(i[s]=a)}function x(t,e,n,r,i,o,a){var s,u,l,c={},f=e.length,h=o.length,d=new Array(f);for(s=0;s<f;++s)(u=e[s])&&(d[s]=l="$"+a.call(u,u.__data__,s,e),l in c?i[s]=u:c[l]=u);for(s=0;s<h;++s)(u=c[l="$"+a.call(t,o[s],s,o)])?(r[s]=u,u.__data__=o[s],c[l]=null):n[s]=new v(t,o[s]);for(s=0;s<f;++s)(u=e[s])&&c[d[s]]===u&&(i[s]=u)}function w(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function _(t){return function(){this.removeAttribute(t)}}function k(t){return function(){this.removeAttributeNS(t.space,t.local)}}function A(t,e){return function(){this.setAttribute(t,e)}}function E(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function D(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function S(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function C(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function O(t){return function(){this.style.removeProperty(t)}}function F(t,e,n){return function(){this.style.setProperty(t,e,n)}}function M(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function $(t,e){return t.style.getPropertyValue(e)||C(t).getComputedStyle(t,null).getPropertyValue(e)}function N(t){return function(){delete this[t]}}function B(t,e){return function(){this[t]=e}}function T(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function j(t){return t.trim().split(/^|\s+/)}function I(t){return t.classList||new z(t)}function z(t){this._node=t,this._names=j(t.getAttribute("class")||"")}function R(t,e){for(var n=I(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function P(t,e){for(var n=I(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function L(t){return function(){R(this,t)}}function q(t){return function(){P(this,t)}}function U(t,e){return function(){(e.apply(this,arguments)?R:P)(this,t)}}function W(){this.textContent=""}function V(t){return function(){this.textContent=t}}function H(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function G(){this.innerHTML=""}function X(t){return function(){this.innerHTML=t}}function K(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Y(){this.nextSibling&&this.parentNode.appendChild(this)}function J(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var t=this.parentNode;t&&t.removeChild(this)}function tt(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function et(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}v.prototype={constructor:v,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},z.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var nt={},rt=null;function it(t,e,n){return t=ot(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function ot(t,e,n){return function(r){var i=rt;rt=r;try{t.call(this,this.__data__,e,n)}finally{rt=i}}}function at(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function st(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function ut(t,e,n){var r=nt.hasOwnProperty(t.type)?it:ot;return function(i,o,a){var s,u=this.__on,l=r(e,o,a);if(u)for(var c=0,f=u.length;c<f;++c)if((s=u[c]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=e);this.addEventListener(t.type,l,n),s={type:t.type,name:t.name,value:e,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function lt(t,e,n,r){var i=rt;t.sourceEvent=rt,rt=t;try{return e.apply(n,r)}finally{rt=i}}function ct(t,e,n){var r=C(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ft(t,e){return function(){return ct(this,t,e)}}function ht(t,e){return function(){return ct(this,t,e.apply(this,arguments))}}"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(nt={mouseenter:"mouseover",mouseleave:"mouseout"}));var dt=[null];function pt(t,e){this._groups=t,this._parents=e}function gt(){return new pt([[document.documentElement]],dt)}pt.prototype=gt.prototype={constructor:pt,select:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=e[i],u=s.length,l=r[i]=new Array(u),f=0;f<u;++f)(o=s[f])&&(a=t.call(o,o.__data__,f,s))&&("__data__"in o&&(a.__data__=o.__data__),l[f]=a);return new pt(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=h(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,s=e[o],u=s.length,l=0;l<u;++l)(a=s[l])&&(r.push(t.call(a,a.__data__,l,s)),i.push(a));return new pt(r,i)},filter:function(t){"function"!=typeof t&&(t=m(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],s=a.length,u=r[i]=[],l=0;l<s;++l)(o=a[l])&&t.call(o,o.__data__,l,a)&&u.push(o);return new pt(r,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),c=-1,this.each((function(t){p[++c]=t})),p;var n,r=e?x:b,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),u=new Array(a),l=new Array(a),c=0;c<a;++c){var f=i[c],h=o[c],d=h.length,p=t.call(f,f&&f.__data__,c,i),g=p.length,m=u[c]=new Array(g),y=s[c]=new Array(g);r(f,h,m,y,l[c]=new Array(d),p,e);for(var v,w,_=0,k=0;_<g;++_)if(v=m[_]){for(_>=k&&(k=_+1);!(w=y[k])&&++k<g;);v._next=w||null}}return(s=new pt(s,i))._enter=u,s._exit=l,s},enter:function(){return new pt(this._enter||this._groups.map(y),this._parents)},exit:function(){return new pt(this._exit||this._groups.map(y),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u,l=e[s],c=n[s],f=l.length,h=a[s]=new Array(f),d=0;d<f;++d)(u=l[d]||c[d])&&(h[d]=u);for(;s<r;++s)a[s]=e[s];return new pt(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=w);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,l=i[o]=new Array(u),c=0;c<u;++c)(a=s[c])&&(l[c]=a);l.sort(e)}return new pt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each((function(){t[++e]=this})),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each((function(){++t})),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=o(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?k:_:"function"==typeof e?n.local?S:D:n.local?E:A)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?O:"function"==typeof e?M:F)(t,e,null==n?"":n)):$(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?N:"function"==typeof e?T:B)(t,e)):this.node()[t]},classed:function(t,e){var n=j(t+"");if(arguments.length<2){for(var r=I(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?U:e?L:q)(n,e))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?H:V)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?K:X)(t)):this.node().innerHTML},raise:function(){return this.each(Y)},lower:function(){return this.each(J)},append:function(t){var e="function"==typeof t?t:u(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:u(t),r=null==e?Z:"function"==typeof e?e:c(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Q)},clone:function(t){return this.select(t?et:tt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=at(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?ut:st,null==n&&(n=!1),r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;l<c;++l)for(r=0,u=s[l];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?ht:ft)(t,e))}};const mt=gt;function yt(t){return"string"==typeof t?new pt([[document.querySelector(t)]],[document.documentElement]):new pt([[t]],dt)}function vt(t){return yt(u(t).call(document.documentElement))}var bt=0;function xt(){return new wt}function wt(){this._="@"+(++bt).toString(36)}function _t(){for(var t,e=rt;t=e.sourceEvent;)e=t;return e}function kt(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}function At(t){var e=_t();return e.changedTouches&&(e=e.changedTouches[0]),kt(t,e)}function Et(t){return"string"==typeof t?new pt([document.querySelectorAll(t)],[document.documentElement]):new pt([null==t?[]:t],dt)}function Dt(t,e,n){arguments.length<3&&(n=e,e=_t().changedTouches);for(var r,i=0,o=e?e.length:0;i<o;++i)if((r=e[i]).identifier===n)return kt(t,r);return null}function St(t,e){null==e&&(e=_t().touches);for(var n=0,r=e?e.length:0,i=new Array(r);n<r;++n)i[n]=kt(t,e[n]);return i}wt.prototype=xt.prototype={constructor:wt,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}}},4063:t=>{"use strict";t.exports=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(i=r;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(o=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!=i--;){var a=o[i];if(!t(e[a],n[a]))return!1}return!0}return e!=e&&n!=n}},5035:t=>{"use strict";t.exports=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var n,r="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(n=e.cmp,function(t){return function(e,r){var i={key:e,value:t[e]},o={key:r,value:t[r]};return n(i,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var n,a;if(Array.isArray(e)){for(a="[",n=0;n<e.length;n++)n&&(a+=","),a+=t(e[n])||"null";return a+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=o.push(e)-1,u=Object.keys(e).sort(i&&i(e));for(a="",n=0;n<u.length;n++){var l=u[n],c=t(e[l]);c&&(a&&(a+=","),a+=JSON.stringify(l)+":"+c)}return o.splice(s,1),"{"+a+"}"}}(t)}},2297:t=>{"use strict";var e=/-(.)/g;t.exports=function(t){return t.replace(e,(function(t,e){return e.toUpperCase()}))}},250:(t,e,n)=>{"use strict";var r=n(2297),i=/^-ms-/;t.exports=function(t){return r(t.replace(i,"ms-"))}},139:t=>{"use strict";function e(t){return function(){return t}}var n=function(){};n.thatReturns=e,n.thatReturnsFalse=e(!1),n.thatReturnsTrue=e(!0),n.thatReturnsNull=e(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(t){return t},t.exports=n},9349:t=>{"use strict";var e=/([A-Z])/g;t.exports=function(t){return t.replace(e,"-$1").toLowerCase()}},7100:(t,e,n)=>{"use strict";var r=n(9349),i=/^ms-/;t.exports=function(t){return r(t).replace(i,"-ms-")}},1767:t=>{"use strict";t.exports=function(t){var e={};return function(n){return e.hasOwnProperty(n)||(e[n]=t.call(this,n)),e[n]}}},3620:(t,e,n)=>{"use strict";var r=n(139);t.exports=r},6482:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},r=["Webkit","ms","Moz","O"];Object.keys(n).forEach((function(t){r.forEach((function(e){n[function(t,e){return t+e.charAt(0).toUpperCase()+e.substring(1)}(e,t)]=n[t]}))}));var i={isUnitlessNumber:n,shorthandPropertyExpansions:{background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}}};e.default=i},8511:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(n(6482));function i(t){return t&&t.__esModule?t:{default:t}}i(n(3620));var o=r.default.isUnitlessNumber;e.default=function(t,e,n){return null==e||"boolean"==typeof e||""===e?"":isNaN(e)||0===e||o.hasOwnProperty(t)&&o[t]?""+e:("string"==typeof e&&(e=e.trim()),e+"px")}},6563:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.processStyleName=void 0,e.createMarkupForStyles=function(t,e){var n="";for(var i in t){var o=0===i.indexOf("--");if(t.hasOwnProperty(i)&&"label"!==i){var a=t[i];null!=a&&(o?n+=i+":"+a+";":(n+=s(i)+":",n+=(0,r.default)(i,a,e)+";"))}}return n||null},a(n(250));var r=a(n(8511)),i=a(n(7100)),o=a(n(1767));function a(t){return t&&t.__esModule?t:{default:t}}a(n(3620));var s=e.processStyleName=(0,o.default)(i.default)},5913:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function r(t){return Array.isArray(t)?(i=!1,o=[],(e=t).forEach((function(t){var e=r(t);null!==e&&e===t||(i=!0),null!==e&&o.push(e)})),0==o.length?null:i?o:e):function(t){if(function(t){return null==t||!1===t||"object"===(void 0===t?"undefined":n(t))&&0===Object.keys(t).length}(t))return null;if("object"!==(void 0===t?"undefined":n(t)))return t;for(var e={},i=Object.keys(t),o=!1,a=0;a<i.length;a++){var s=t[i[a]],u=r(s);null!==u&&u===s||(o=!0),null!==u&&(e[i[a]]=u)}return 0===Object.keys(e).length?null:o?e:t}(t);var e,i,o}e.default=r},8108:(t,e)=>{"use strict";function n(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)+(t.charCodeAt(e++)<<16)+(t.charCodeAt(e)<<24)}function r(t,e){return t.charCodeAt(e++)+(t.charCodeAt(e++)<<8)}function i(t,e){return(65535&(t|=0))*(e|=0)+(((t>>>16)*e&65535)<<16)|0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){for(var o=1540483477,a=e^t.length,s=t.length,u=0;s>=4;){var l=n(t,u);l=i(l,o),l=i(l^=l>>>24,o),a=i(a,o),a^=l,u+=4,s-=4}switch(s){case 3:a^=r(t,u),a=i(a^=t.charCodeAt(u+2)<<16,o);break;case 2:a=i(a^=r(t,u),o);break;case 1:a=i(a^=t.charCodeAt(u),o)}return a=i(a^=a>>>13,o),(a^=a>>>15)>>>0}},6113:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compose=e.merge=e.$=e.style=e.presets=e.keyframes=e.fontFace=e.insertGlobal=e.insertRule=e.plugins=e.styleSheet=void 0,e.speedy=function(t){return f.speedy(t)},e.simulations=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];p=!!t},e.simulate=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,a.default)(e))?p?e.reduce((function(t,e){return t["data-simulate-"+v(e)]="",t}),{}):(g||(console.warn("can't simulate without once calling simulations(true)"),g=!0),m||(console.warn("don't use simulation outside dev"),m=!0),{}):{}},e.cssLabels=function(t){y=!!t},e.isLikeRule=x,e.idFor=w,e.css=q,e.rehydrate=function(t){(0,r.default)(C,t.reduce((function(t,e){return t[e]=!0,t}),{}))},e.flush=function(){C=f.inserted={},O=f.registered={},M={},f.flush(),f.inject()},e.select=W,e.parent=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q(c({},t+" &",n))},e.media=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q(c({},"@media "+t,n))},e.pseudo=V,e.active=function(t){return V(":active",t)},e.any=function(t){return V(":any",t)},e.checked=function(t){return V(":checked",t)},e.disabled=function(t){return V(":disabled",t)},e.empty=function(t){return V(":empty",t)},e.enabled=function(t){return V(":enabled",t)},e._default=function(t){return V(":default",t)},e.first=function(t){return V(":first",t)},e.firstChild=function(t){return V(":first-child",t)},e.firstOfType=function(t){return V(":first-of-type",t)},e.fullscreen=function(t){return V(":fullscreen",t)},e.focus=function(t){return V(":focus",t)},e.hover=function(t){return V(":hover",t)},e.indeterminate=function(t){return V(":indeterminate",t)},e.inRange=function(t){return V(":in-range",t)},e.invalid=function(t){return V(":invalid",t)},e.lastChild=function(t){return V(":last-child",t)},e.lastOfType=function(t){return V(":last-of-type",t)},e.left=function(t){return V(":left",t)},e.link=function(t){return V(":link",t)},e.onlyChild=function(t){return V(":only-child",t)},e.onlyOfType=function(t){return V(":only-of-type",t)},e.optional=function(t){return V(":optional",t)},e.outOfRange=function(t){return V(":out-of-range",t)},e.readOnly=function(t){return V(":read-only",t)},e.readWrite=function(t){return V(":read-write",t)},e.required=function(t){return V(":required",t)},e.right=function(t){return V(":right",t)},e.root=function(t){return V(":root",t)},e.scope=function(t){return V(":scope",t)},e.target=function(t){return V(":target",t)},e.valid=function(t){return V(":valid",t)},e.visited=function(t){return V(":visited",t)},e.dir=function(t,e){return V(":dir("+t+")",e)},e.lang=function(t,e){return V(":lang("+t+")",e)},e.not=function(t,e){var n=t.split(",").map((function(t){return t.trim()})).map((function(t){return":not("+t+")"}));return 1===n.length?V(":not("+t+")",e):W(n.join(""),e)},e.nthChild=function(t,e){return V(":nth-child("+t+")",e)},e.nthLastChild=function(t,e){return V(":nth-last-child("+t+")",e)},e.nthLastOfType=function(t,e){return V(":nth-last-of-type("+t+")",e)},e.nthOfType=function(t,e){return V(":nth-of-type("+t+")",e)},e.after=function(t){return V("::after",t)},e.before=function(t){return V("::before",t)},e.firstLetter=function(t){return V("::first-letter",t)},e.firstLine=function(t){return V("::first-line",t)},e.selection=function(t){return V("::selection",t)},e.backdrop=function(t){return V("::backdrop",t)},e.placeholder=function(t){return q({"::placeholder":t})},e.cssFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return(e=(0,a.default)(e))?e.map((function(t){var e={label:[]};return j(e,{src:t}),S(b(e),D(e)).join("")})).join(""):""},e.attribsFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=(e=(0,a.default)(e))?e.map((function(t){w(t);var e=Object.keys(t)[0];return e+'="'+(t[e]||"")+'"'})).join(" "):"";return r};var r=l(n(7418)),i=n(6837),o=n(6563),a=l(n(5913)),s=n(2389),u=l(n(8108));function l(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=e.styleSheet=new i.StyleSheet;f.inject();var h=e.plugins=f.plugins=new s.PluginSet([s.prefixes,s.contentWrap,s.fallbacks]);h.media=new s.PluginSet,h.fontFace=new s.PluginSet,h.keyframes=new s.PluginSet([s.prefixes,s.fallbacks]);var d="undefined"!=typeof window,p=false,g=!1,m=!1,y=false;function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.toLowerCase().replace(/[^a-z0-9]/g,e)}function b(t){var e=JSON.stringify(t),n=(0,u.default)(e).toString(36);return t.label&&t.label.length,n}function x(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));return 1===e.length&&!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0])}function w(t){var e=Object.keys(t).filter((function(t){return"toString"!==t}));if(1!==e.length)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/.exec(e[0]);if(!n)throw new Error("not a rule");return n[1]}var _=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function k(t){if(-1===t.indexOf(","))return[t];for(var e,n=[],r=[],i=0;e=_.exec(t);)switch(e[0]){case"(":i++;break;case")":i--;break;case",":if(i)break;n.push(e.index)}for(e=n.length;e--;)r.unshift(t.slice(n[e]+1)),t=t.slice(0,n[e]);return r.unshift(t),r}function A(t,e){if(!t)return e.replace(/\&/g,"");if(!e)return".css-"+t+",[data-css-"+t+"]";var n=k(e).map((function(e){return e.indexOf("&")>=0?[e.replace(/\&/gm,".css-"+t),e.replace(/\&/gm,"[data-css-"+t+"]")].join(","):".css-"+t+e+",[data-css-"+t+"]"+e})).join(",");return p&&/^\&\:/.exec(e)&&!/\s/.exec(e)&&(n+=",.css-"+t+"[data-simulate-"+v(e)+"],[data-css-"+t+"][data-simulate-"+v(e)+"]"),n}function E(t){var e=t.selector,n=t.style,r=h.transform({selector:e,style:n});return r.selector+"{"+(0,o.createMarkupForStyles)(r.style)+"}"}function D(t){var e=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(t).forEach((function(o){o.indexOf("&")>=0?(n=n||{})[o]=t[o]:0===o.indexOf("@media")?(r=r||{})[o]=D(t[o]):0===o.indexOf("@supports")?(i=i||{})[o]=D(t[o]):"label"===o?t.label.length>0&&((e=e||{}).label=y?t.label.join("."):""):(e=e||{})[o]=t[o]})),{plain:e,selects:n,medias:r,supports:i}}function S(t,e){var n=[],r=e.plain,i=e.selects,o=e.medias,a=e.supports;return r&&n.push(E({style:r,selector:A(t)})),i&&Object.keys(i).forEach((function(e){return n.push(E({style:i[e],selector:A(t,e)}))})),o&&Object.keys(o).forEach((function(e){return n.push(e+"{"+S(t,o[e]).join("")+"}")})),a&&Object.keys(a).forEach((function(e){return n.push(e+"{"+S(t,a[e]).join("")+"}")})),n}var C=f.inserted={},O=f.registered={};function F(t){O[t.id]||(O[t.id]=t)}var M={};function $(t,e){var n=k(t).map((function(t){return t.indexOf("&")>=0?t:"&"+t}));return k(e).map((function(t){return t.indexOf("&")>=0?t:"&"+t})).reduce((function(t,e){return t.concat(n.map((function(t){return e.replace(/\&/g,t)})))}),[]).join(",")}function N(t,e){return t?"@supports "+t.substring(9)+" and "+e.substring(9):e}function B(t){for(var e=[],n=0;n<t.length;n++)e=Array.isArray(t[n])?e.concat(B(t[n])):e.concat(t[n]);return e}var T={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function j(t,e){var n=e.selector,r=void 0===n?"":n,i=e.mq,o=void 0===i?"":i,s=e.supp,u=void 0===s?"":s,l=e.src,c=void 0===l?{}:l;Array.isArray(c)||(c=[c]),(c=B(c)).forEach((function(e){if(x(e)){var n=function(t){if(x(t)){var e=O[w(t)];if(null==e)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return e}return t}(e);if("css"!==n.type)throw new Error("cannot merge this rule");e=n.style}(e=(0,a.default)(e))&&e.composes&&j(t,{selector:r,mq:o,supp:u,src:e.composes}),Object.keys(e||{}).forEach((function(n){if(function(t){for(var e=[":",".","[",">"," "],n=!1,r=t.charAt(0),i=0;i<e.length;i++)if(r===e[i]){n=!0;break}return n||t.indexOf("&")>=0}(n))T[n]&&T[n].forEach((function(i){return j(t,{selector:$(r,i),mq:o,supp:u,src:e[n]})})),j(t,{selector:$(r,n),mq:o,supp:u,src:e[n]});else if(function(t){return 0===t.indexOf("@media")}(n))j(t,{selector:r,mq:(a=o,s=n,a?"@media "+a.substring(6)+" and "+s.substring(6):s),supp:u,src:e[n]});else if(function(t){return 0===t.indexOf("@supports")}(n))j(t,{selector:r,mq:o,supp:N(u,n),src:e[n]});else if("composes"===n);else{var i=t;u&&(i[u]=i[u]||{},i=i[u]),o&&(i[o]=i[o]||{},i=i[o]),r&&(i[r]=i[r]||{},i=i[r]),"label"===n?y&&(t.label=t.label.concat(e.label)):i[n]=e[n]}var a,s}))}))}function I(t){var e={label:[]};return j(e,{src:t}),function(t){if(F(t),function(t){if(!C[t.id]){C[t.id]=!0;var e=D(t.style),n=S(t.id,e);C[t.id]=!!d||n,n.forEach((function(t){return f.insert(t)}))}}(t),M[t.id])return M[t.id];var e=c({},"data-css-"+t.id,y&&t.label||"");return Object.defineProperty(e,"toString",{enumerable:!1,value:function(){return"css-"+t.id}}),M[t.id]=e,e}({id:b(e),style:e,label:y?e.label.join("."):"",type:"css"})}var z={};Object.defineProperty(z,"toString",{enumerable:!1,value:function(){return"css-nil"}});var R,P="undefined"!=typeof WeakMap?[z,new WeakMap,new WeakMap,new WeakMap]:[z],L="undefined"!=typeof WeakMap?(R=I,function(t){if(P[t.length]){for(var e=P[t.length],n=0;n<t.length-1;)e.has(t[n])||e.set(t[n],new WeakMap),e=e.get(t[n]),n++;if(e.has(t[t.length-1])){var r=e.get(t[n]);if(O[r.toString().substring(4)])return r}}var i=R(t);if(P[t.length]){for(var o=0,a=P[t.length];o<t.length-1;)a=a.get(t[o]),o++;try{a.set(t[o],i)}catch(t){}}return i}):I;function q(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]&&e[0].length&&e[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return(e=(0,a.default)(e))?L(e):z}q.insert=function(t){var e={id:b(t),css:t,type:"raw"};F(e),C[e.id]||(f.insert(e.css),C[e.id]=!!d||[e.css])},e.insertRule=q.insert,q.global=function(t,e){if(e=(0,a.default)(e))return q.insert(E({selector:t,style:e}))},e.insertGlobal=q.global,q.keyframes=function(t,e){e||(e=t,t="animation");var n={id:b({name:t,kfs:e=(0,a.default)(e)||{}}),type:"keyframes",name:t,keyframes:e};return F(n),function(t){if(!C[t.id]){var e=Object.keys(t.keyframes).map((function(e){var n=h.keyframes.transform({id:t.id,name:e,style:t.keyframes[e]});return n.name+"{"+(0,o.createMarkupForStyles)(n.style)+"}"})).join(""),n=["-webkit-","-moz-","-o-",""].map((function(n){return"@"+n+"keyframes "+t.name+"_"+t.id+"{"+e+"}"}));n.forEach((function(t){return f.insert(t)})),C[t.id]=!!d||n}}(n),t+"_"+n.id},q.fontFace=function(t){var e={id:b(t=(0,a.default)(t)),type:"font-face",font:t};return F(e),function(t){if(!C[t.id]){var e="@font-face{"+(0,o.createMarkupForStyles)(t.font)+"}";f.insert(e),C[t.id]=!!d||[e]}}(e),t.fontFamily},e.fontFace=q.fontFace,e.keyframes=q.keyframes,e.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var U=e.style=q;function W(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t?q(c({},t,n)):U(n)}function V(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q(c({},t,n))}e.$=W,e.merge=q,e.compose=q},2389:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};e.PluginSet=u,e.fallbacks=function(t){if(Object.keys(t.style).map((function(e){return Array.isArray(t.style[e])})).indexOf(!0)>=0){var e=t.style,n=Object.keys(e).reduce((function(t,n){return t[n]=Array.isArray(e[n])?e[n].join("; "+(0,o.processStyleName)(n)+": "):e[n],t}),{});return(0,i.default)({},t,{style:n})}return t},e.contentWrap=function(t){if(t.style.content){var e=t.style.content;return l.indexOf(e)>=0||/^(attr|calc|counters?|url)\(/.test(e)?t:e.charAt(0)!==e.charAt(e.length-1)||'"'!==e.charAt(0)&&"'"!==e.charAt(0)?r({},t,{style:r({},t.style,{content:'"'+e+'"'})}):t}return t},e.prefixes=function(t){return(0,i.default)({},t,{style:(0,a.default)(r({},t.style))})};var i=s(n(7418)),o=n(6563),a=s(n(4975));function s(t){return t&&t.__esModule?t:{default:t}}function u(t){this.fns=t||[]}(0,i.default)(u.prototype,{add:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach((function(e){t.fns.indexOf(e)>=0||(t.fns=[e].concat(t.fns))}))},remove:function(t){this.fns=this.fns.filter((function(e){return e!==t}))},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce((function(t,e){return e(t)}),t)}});var l=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"]},4975:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e in t){var n=t[e],r=(0,o.default)(y,e,n,t,v);r&&(t[e]=r),(0,i.default)(v,e,t)}return t};var r=m(n(2633)),i=m(n(7901)),o=m(n(1745)),a=m(n(5848)),s=m(n(3207)),u=m(n(7879)),l=m(n(5716)),c=m(n(8544)),f=m(n(7551)),h=m(n(1242)),d=m(n(9686)),p=m(n(1113)),g=m(n(5152));function m(t){return t&&t.__esModule?t:{default:t}}var y=[s.default,a.default,u.default,c.default,f.default,h.default,d.default,p.default,g.default,l.default],v=r.default.prefixMap},6837:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StyleSheet=c;var r,i=(r=n(7418))&&r.__esModule?r:{default:r};function o(t){return t[t.length-1]}function a(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}var s="undefined"!=typeof window,u=function(){if(s){var t=document.createElement("div");return t.innerHTML="\x3c!--[if lt IE 10]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length}}();function l(){var t=document.createElement("style");return t.type="text/css",t.setAttribute("data-glamor",""),t.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.speedy,n=void 0===e||e,r=t.maxLength,i=void 0===r?s&&u?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,i.default)(c.prototype,{getSheet:function(){return a(o(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");s?this.tags[0]=l():this.sheet={cssRules:[],insertRule:function(e){t.sheet.cssRules.push({cssText:e})}},this.injected=!0},speedy:function(t){if(0!==this.ctr)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var e=this.getSheet();e.insertRule(t,-1!==t.indexOf("@import")?0:e.cssRules.length)}catch(t){}},insert:function(t){if(s)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(-1!==t.indexOf("@import")){var e=o(this.tags);e.insertBefore(document.createTextNode(t),e.firstChild)}else o(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,-1!==t.indexOf("@import")?0:this.sheet.cssRules.length);return this.ctr++,s&&this.ctr%this.maxLength==0&&this.tags.push(l()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){s?(this.tags.forEach((function(t){return t.parentNode.removeChild(t)})),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!s)return this.sheet.cssRules;var t=[];return this.tags.forEach((function(e){return t.splice.apply(t,[t.length,0].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.from(a(e).cssRules))))})),t}})},5477:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>s});var r=/[A-Z]/g,i=/^ms-/,o={};function a(t){return"-"+t.toLowerCase()}const s=function(t){if(o.hasOwnProperty(t))return o[t];var e=t.replace(r,a);return o[t]=i.test(e)?"-"+e:e}},3207:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("cross-fade(")>-1)return o.map((function(t){return e.replace(/cross-fade\(/g,t+"cross-fade(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},o=["-webkit-",""];t.exports=e.default},5848:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("cursor"===t&&r.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};t.exports=e.default},7879:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("filter(")>-1)return o.map((function(t){return e.replace(/filter\(/g,t+"filter(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},o=["-webkit-",""];t.exports=e.default},5716:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("display"===t&&n.hasOwnProperty(e))return n[e]};var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};t.exports=e.default},8544:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,i){"flexDirection"===t&&"string"==typeof e&&(e.indexOf("column")>-1?i.WebkitBoxOrient="vertical":i.WebkitBoxOrient="horizontal",e.indexOf("reverse")>-1?i.WebkitBoxDirection="reverse":i.WebkitBoxDirection="normal"),r.hasOwnProperty(t)&&(i[r[t]]=n[e]||e)};var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};t.exports=e.default},7551:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&a.test(e))return o.map((function(t){return t+e}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},o=["-webkit-","-moz-",""],a=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;t.exports=e.default},1242:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("string"==typeof e&&!(0,i.default)(e)&&e.indexOf("image-set(")>-1)return o.map((function(t){return e.replace(/image-set\(/g,t+"image-set(")}))};var r,i=(r=n(638))&&r.__esModule?r:{default:r},o=["-webkit-",""];t.exports=e.default},9686:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if("position"===t&&"sticky"===e)return["-webkit-sticky","sticky"]},t.exports=e.default},1113:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(r.hasOwnProperty(t)&&i.hasOwnProperty(e))return n.map((function(t){return t+e}))};var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};t.exports=e.default},5152:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,a){if("string"==typeof e&&s.hasOwnProperty(t)){var l=function(t,e){if((0,i.default)(t))return t;for(var n=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),o=0,a=n.length;o<a;++o){var s=n[o],l=[s];for(var c in e){var f=(0,r.default)(c);if(s.indexOf(f)>-1&&"order"!==f)for(var h=e[c],d=0,p=h.length;d<p;++d)l.unshift(s.replace(f,u[h[d]]+f))}n[o]=l.join(",")}return n.join(",")}(e,a),c=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-moz-|-ms-/.test(t)})).join(",");if(t.indexOf("Webkit")>-1)return c;var f=l.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(t){return!/-webkit-|-ms-/.test(t)})).join(",");return t.indexOf("Moz")>-1?f:(n["Webkit"+(0,o.default)(t)]=c,n["Moz"+(0,o.default)(t)]=f,l)}};var r=a(n(6238)),i=a(n(638)),o=a(n(2160));function a(t){return t&&t.__esModule?t:{default:t}}var s={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},u={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};t.exports=e.default},2633:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],o=["Webkit","Moz"],a=["Webkit","ms"],s=["Webkit","Moz","ms"];e.default={plugins:[],prefixMap:{appearance:o,userSelect:s,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:s,breakBefore:s,breakInside:s,columnCount:o,columnFill:o,columnGap:o,columnRule:o,columnRuleColor:o,columnRuleStyle:o,columnRuleWidth:o,columns:o,columnSpan:o,columnWidth:o,writingMode:a,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:a,scrollSnapPointsX:a,scrollSnapPointsY:a,scrollSnapDestination:a,scrollSnapCoordinate:a,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:s,flowInto:a,flowFrom:a,regionFragment:a,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:a,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},t.exports=e.default},2160:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.exports=e.default},7901:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){if(t.hasOwnProperty(e))for(var r=t[e],o=0,a=r.length;o<a;++o)n[r[o]+(0,i.default)(e)]=n[e]};var r,i=(r=n(2160))&&r.__esModule?r:{default:r};t.exports=e.default},1745:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n,r,i){for(var o=0,a=t.length;o<a;++o){var s=t[o](e,n,r,i);if(s)return s}},t.exports=e.default},1127:t=>{"use strict";var e=/("(?:[^\\"]|\\.)*")|[:,]/g;t.exports=function(t,n){var r,i,o;return n=n||{},r=JSON.stringify([1],void 0,void 0===n.indent?2:n.indent).slice(2,-3),i=""===r?1/0:void 0===n.maxLength?80:n.maxLength,o=n.replacer,function t(n,a,s){var u,l,c,f,h,d,p,g,m,y,v,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(v=JSON.stringify(n,o)))return v;if(p=i-a.length-s,v.length<=p&&(m=v.replace(e,(function(t,e){return e||t+" "}))).length<=p)return m;if(null!=o&&(n=JSON.parse(v),o=void 0),"object"==typeof n&&null!==n){if(g=a+r,c=[],l=0,Array.isArray(n))for(y="[",u="]",p=n.length;l<p;l++)c.push(t(n[l],g,l===p-1?0:1)||"null");else for(y="{",u="}",p=(d=Object.keys(n)).length;l<p;l++)f=d[l],h=JSON.stringify(f)+": ",void 0!==(b=t(n[f],g,h.length+(l===p-1?0:1)))&&c.push(h+b);if(c.length>0)return[y,r+c.join(",\n"+g),u].join("\n"+a)}return v}(t,"",0)}},9593:(t,e,n)=>{"use strict";const r=n(4411),i=Symbol("max"),o=Symbol("length"),a=Symbol("lengthCalculator"),s=Symbol("allowStale"),u=Symbol("maxAge"),l=Symbol("dispose"),c=Symbol("noDisposeOnSet"),f=Symbol("lruList"),h=Symbol("cache"),d=Symbol("updateAgeOnGet"),p=()=>1,g=(t,e,n)=>{const r=t[h].get(e);if(r){const e=r.value;if(m(t,e)){if(v(t,r),!t[s])return}else n&&(t[d]&&(r.value.now=Date.now()),t[f].unshiftNode(r));return e.value}},m=(t,e)=>{if(!e||!e.maxAge&&!t[u])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[u]&&n>t[u]},y=t=>{if(t[o]>t[i])for(let e=t[f].tail;t[o]>t[i]&&null!==e;){const n=e.prev;v(t,e),e=n}},v=(t,e)=>{if(e){const n=e.value;t[l]&&t[l](n.key,n.value),t[o]-=n.length,t[h].delete(n.key),t[f].removeNode(e)}};class b{constructor(t,e,n,r,i){this.key=t,this.value=e,this.length=n,this.now=r,this.maxAge=i||0}}const x=(t,e,n,r)=>{let i=n.value;m(t,i)&&(v(t,n),t[s]||(i=void 0)),i&&e.call(r,i.value,i.key,t)};t.exports=class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[i]=t.max||1/0;const e=t.length||p;if(this[a]="function"!=typeof e?p:e,this[s]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[u]=t.maxAge||0,this[l]=t.dispose,this[c]=t.noDisposeOnSet||!1,this[d]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[i]=t||1/0,y(this)}get max(){return this[i]}set allowStale(t){this[s]=!!t}get allowStale(){return this[s]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[u]=t,y(this)}get maxAge(){return this[u]}set lengthCalculator(t){"function"!=typeof t&&(t=p),t!==this[a]&&(this[a]=t,this[o]=0,this[f].forEach((t=>{t.length=this[a](t.value,t.key),this[o]+=t.length}))),y(this)}get lengthCalculator(){return this[a]}get length(){return this[o]}get itemCount(){return this[f].length}rforEach(t,e){e=e||this;for(let n=this[f].tail;null!==n;){const r=n.prev;x(this,t,n,e),n=r}}forEach(t,e){e=e||this;for(let n=this[f].head;null!==n;){const r=n.next;x(this,t,n,e),n=r}}keys(){return this[f].toArray().map((t=>t.key))}values(){return this[f].toArray().map((t=>t.value))}reset(){this[l]&&this[f]&&this[f].length&&this[f].forEach((t=>this[l](t.key,t.value))),this[h]=new Map,this[f]=new r,this[o]=0}dump(){return this[f].map((t=>!m(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)})).toArray().filter((t=>t))}dumpLru(){return this[f]}set(t,e,n){if((n=n||this[u])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,s=this[a](e,t);if(this[h].has(t)){if(s>this[i])return v(this,this[h].get(t)),!1;const a=this[h].get(t).value;return this[l]&&(this[c]||this[l](t,a.value)),a.now=r,a.maxAge=n,a.value=e,this[o]+=s-a.length,a.length=s,this.get(t),y(this),!0}const d=new b(t,e,s,r,n);return d.length>this[i]?(this[l]&&this[l](t,e),!1):(this[o]+=d.length,this[f].unshift(d),this[h].set(t,this[f].head),y(this),!0)}has(t){if(!this[h].has(t))return!1;const e=this[h].get(t).value;return!m(this,e)}get(t){return g(this,t,!0)}peek(t){return g(this,t,!1)}pop(){const t=this[f].tail;return t?(v(this,t),t.value):null}del(t){v(this,this[h].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const r=t[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const t=i-e;t>0&&this.set(r.k,r.v,t)}}}prune(){this[h].forEach(((t,e)=>g(this,e,!1)))}}},7418:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,o){for(var a,s,u=i(t),l=1;l<arguments.length;l++){for(var c in a=Object(arguments[l]))n.call(a,c)&&(u[c]=a[c]);if(e){s=e(a);for(var f=0;f<s.length;f++)r.call(a,s[f])&&(u[s[f]]=a[s[f]])}}return u}},9674:(t,e,n)=>{"use strict";function r(){}n.r(e),n.d(e,{default:()=>z,h:()=>s,createElement:()=>s,cloneElement:()=>c,Component:()=>j,render:()=>I,rerender:()=>p,options:()=>i});var i={},o=[],a=[];function s(t,e){var n,s,u,l,c=a;for(l=arguments.length;l-- >2;)o.push(arguments[l]);for(e&&null!=e.children&&(o.length||o.push(e.children),delete e.children);o.length;)if((s=o.pop())&&void 0!==s.pop)for(l=s.length;l--;)o.push(s[l]);else"boolean"==typeof s&&(s=null),(u="function"!=typeof t)&&(null==s?s="":"number"==typeof s?s=String(s):"string"!=typeof s&&(u=!1)),u&&n?c[c.length-1]+=s:c===a?c=[s]:c.push(s),n=u;var f=new r;return f.nodeName=t,f.children=c,f.attributes=null==e?void 0:e,f.key=null==e?void 0:e.key,void 0!==i.vnode&&i.vnode(f),f}function u(t,e){for(var n in e)t[n]=e[n];return t}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function c(t,e){return s(t.nodeName,u(u({},t.attributes),e),arguments.length>2?[].slice.call(arguments,2):t.children)}var f=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,h=[];function d(t){!t._dirty&&(t._dirty=!0)&&1==h.push(t)&&(i.debounceRendering||l)(p)}function p(){var t,e=h;for(h=[];t=e.pop();)t._dirty&&B(t)}function g(t,e,n){return"string"==typeof e||"number"==typeof e?void 0!==t.splitText:"string"==typeof e.nodeName?!t._componentConstructor&&m(t,e.nodeName):n||t._componentConstructor===e.nodeName}function m(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function y(t){var e=u({},t.attributes);e.children=t.children;var n=t.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===e[r]&&(e[r]=n[r]);return e}function v(t){var e=t.parentNode;e&&e.removeChild(t)}function b(t,e,n,r,i){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)n&&n(null),r&&r(t);else if("class"!==e||i)if("style"===e){if(r&&"string"!=typeof r&&"string"!=typeof n||(t.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var o in n)o in r||(t.style[o]="");for(var o in r)t.style[o]="number"==typeof r[o]&&!1===f.test(o)?r[o]+"px":r[o]}}else if("dangerouslySetInnerHTML"===e)r&&(t.innerHTML=r.__html||"");else if("o"==e[0]&&"n"==e[1]){var a=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),r?n||t.addEventListener(e,x,a):t.removeEventListener(e,x,a),(t._listeners||(t._listeners={}))[e]=r}else if("list"!==e&&"type"!==e&&!i&&e in t)!function(t,e,n){try{t[e]=n}catch(t){}}(t,e,null==r?"":r),null!=r&&!1!==r||t.removeAttribute(e);else{var s=i&&e!==(e=e.replace(/^xlink:?/,""));null==r||!1===r?s?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof r&&(s?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),r):t.setAttribute(e,r))}else t.className=r||""}function x(t){return this._listeners[t.type](i.event&&i.event(t)||t)}var w=[],_=0,k=!1,A=!1;function E(){for(var t;t=w.pop();)i.afterMount&&i.afterMount(t),t.componentDidMount&&t.componentDidMount()}function D(t,e,n,r,i,o){_++||(k=null!=i&&void 0!==i.ownerSVGElement,A=null!=t&&!("__preactattr_"in t));var a=S(t,e,n,r,o);return i&&a.parentNode!==i&&i.appendChild(a),--_||(A=!1,o||E()),a}function S(t,e,n,r,i){var o=t,a=k;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||i)?t.nodeValue!=e&&(t.nodeValue=e):(o=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(o,t),C(t,!0))),o.__preactattr_=!0,o;var s,u,l=e.nodeName;if("function"==typeof l)return function(t,e,n,r){for(var i=t&&t._component,o=i,a=t,s=i&&t._componentConstructor===e.nodeName,u=s,l=y(e);i&&!u&&(i=i._parentComponent);)u=i.constructor===e.nodeName;return i&&u&&(!r||i._component)?(N(i,l,3,n,r),t=i.base):(o&&!s&&(T(o),t=a=null),i=M(e.nodeName,l,n),t&&!i.nextBase&&(i.nextBase=t,a=null),N(i,l,1,n,r),t=i.base,a&&t!==a&&(a._component=null,C(a,!1))),t}(t,e,n,r);if(k="svg"===l||"foreignObject"!==l&&k,l=String(l),(!t||!m(t,l))&&(s=l,(u=k?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s)).normalizedNodeName=s,o=u,t)){for(;t.firstChild;)o.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(o,t),C(t,!0)}var c=o.firstChild,f=o.__preactattr_,h=e.children;if(null==f){f=o.__preactattr_={};for(var d=o.attributes,p=d.length;p--;)f[d[p].name]=d[p].value}return!A&&h&&1===h.length&&"string"==typeof h[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=h[0]&&(c.nodeValue=h[0]):(h&&h.length||null!=c)&&function(t,e,n,r,i){var o,a,s,u,l,c=t.childNodes,f=[],h={},d=0,p=0,m=c.length,y=0,b=e?e.length:0;if(0!==m)for(var x=0;x<m;x++){var w=c[x],_=w.__preactattr_;null!=(k=b&&_?w._component?w._component.__key:_.key:null)?(d++,h[k]=w):(_||(void 0!==w.splitText?!i||w.nodeValue.trim():i))&&(f[y++]=w)}if(0!==b)for(x=0;x<b;x++){var k;if(l=null,null!=(k=(u=e[x]).key))d&&void 0!==h[k]&&(l=h[k],h[k]=void 0,d--);else if(!l&&p<y)for(o=p;o<y;o++)if(void 0!==f[o]&&g(a=f[o],u,i)){l=a,f[o]=void 0,o===y-1&&y--,o===p&&p++;break}l=S(l,u,n,r),s=c[x],l&&l!==t&&l!==s&&(null==s?t.appendChild(l):l===s.nextSibling?v(s):t.insertBefore(l,s))}if(d)for(var x in h)void 0!==h[x]&&C(h[x],!1);for(;p<=y;)void 0!==(l=f[y--])&&C(l,!1)}(o,h,n,r,A||null!=f.dangerouslySetInnerHTML),function(t,e,n){var r;for(r in n)e&&null!=e[r]||null==n[r]||b(t,r,n[r],n[r]=void 0,k);for(r in e)"children"===r||"innerHTML"===r||r in n&&e[r]===("value"===r||"checked"===r?t[r]:n[r])||b(t,r,n[r],n[r]=e[r],k)}(o,e.attributes,f),k=a,o}function C(t,e){var n=t._component;n?T(n):(null!=t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),!1!==e&&null!=t.__preactattr_||v(t),O(t))}function O(t){for(t=t.lastChild;t;){var e=t.previousSibling;C(t,!0),t=e}}var F={};function M(t,e,n){var r,i=F[t.name];if(t.prototype&&t.prototype.render?(r=new t(e,n),j.call(r,e,n)):((r=new j(e,n)).constructor=t,r.render=$),i)for(var o=i.length;o--;)if(i[o].constructor===t){r.nextBase=i[o].nextBase,i.splice(o,1);break}return r}function $(t,e,n){return this.constructor(t,n)}function N(t,e,n,r,o){t._disable||(t._disable=!0,(t.__ref=e.ref)&&delete e.ref,(t.__key=e.key)&&delete e.key,!t.base||o?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,r),r&&r!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=r),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==n&&(1!==n&&!1===i.syncComponentUpdates&&t.base?d(t):B(t,1,o)),t.__ref&&t.__ref(t))}function B(t,e,n,r){if(!t._disable){var o,a,s,l=t.props,c=t.state,f=t.context,h=t.prevProps||l,d=t.prevState||c,p=t.prevContext||f,g=t.base,m=t.nextBase,v=g||m,b=t._component,x=!1;if(g&&(t.props=h,t.state=d,t.context=p,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(l,c,f)?x=!0:t.componentWillUpdate&&t.componentWillUpdate(l,c,f),t.props=l,t.state=c,t.context=f),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!x){o=t.render(l,c,f),t.getChildContext&&(f=u(u({},f),t.getChildContext()));var k,A,S=o&&o.nodeName;if("function"==typeof S){var O=y(o);(a=b)&&a.constructor===S&&O.key==a.__key?N(a,O,1,f,!1):(k=a,t._component=a=M(S,O,f),a.nextBase=a.nextBase||m,a._parentComponent=t,N(a,O,0,f,!1),B(a,1,n,!0)),A=a.base}else s=v,(k=b)&&(s=t._component=null),(v||1===e)&&(s&&(s._component=null),A=D(s,o,f,n||!g,v&&v.parentNode,!0));if(v&&A!==v&&a!==b){var F=v.parentNode;F&&A!==F&&(F.replaceChild(A,v),k||(v._component=null,C(v,!1)))}if(k&&T(k),t.base=A,A&&!r){for(var $=t,j=t;j=j._parentComponent;)($=j).base=A;A._component=$,A._componentConstructor=$.constructor}}if(!g||n?w.unshift(t):x||(t.componentDidUpdate&&t.componentDidUpdate(h,d,p),i.afterUpdate&&i.afterUpdate(t)),null!=t._renderCallbacks)for(;t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);_||r||E()}}function T(t){i.beforeUnmount&&i.beforeUnmount(t);var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var n=t._component;n?T(n):e&&(e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t.nextBase=e,v(e),function(t){var e=t.constructor.name;(F[e]||(F[e]=[])).push(t)}(t),O(e)),t.__ref&&t.__ref(null)}function j(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{}}function I(t,e,n){return D(n,t,{},!1,e,!1)}u(j.prototype,{setState:function(t,e){var n=this.state;this.prevState||(this.prevState=u({},n)),u(n,"function"==typeof t?t(n,this.props):t),e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),d(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),B(this,2)},render:function(){}});const z={h:s,createElement:s,cloneElement:c,Component:j,render:I,rerender:p,options:i}},6377:(t,e,n)=>{var r=n(4832),i=n(8652),o=n(801),a=n(2030),s=n(3618),u=n(9049),l=n(1971);l.alea=r,l.xor128=i,l.xorwow=o,l.xorshift7=a,l.xor4096=s,l.tychei=u,t.exports=l},4832:function(t,e,n){var r;!function(t,i,o){function a(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new a(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.alea=u}(0,t=n.nmd(t),n.amdD)},9049:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.tychei=u}(0,t=n.nmd(t),n.amdD)},8652:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor128=u}(0,t=n.nmd(t),n.amdD)},3618:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;t.w=a,t.X=s,t.i=i}(e,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xor4096=u}(0,t=n.nmd(t),n.amdD)},2030:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorshift7=u}(0,t=n.nmd(t),n.amdD)},801:function(t,e,n){var r;!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(e,n,e,i))||(i.exports=r):this.xorwow=u}(0,t=n.nmd(t),n.amdD)},1971:(t,e,n)=>{var r;!function(i,o){var a,s=this,u=256,l=o.pow(u,6),c=o.pow(2,52),f=2*c,h=255;function d(t,e,n){var r=[],h=y(m((e=1==e?{entropy:!0}:e||{}).entropy?[t,v(i)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(u):(t=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(t)),v(t)}catch(t){var e=s.navigator,n=e&&e.plugins;return[+new Date,s,n,s.screen,v(i)]}}():t,3),r),d=new p(r),b=function(){for(var t=d.g(6),e=l,n=0;t<c;)t=(t+n)*u,e*=u,n=d.g(1);for(;t>=f;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|d.g(4)},b.quick=function(){return d.g(4)/4294967296},b.double=b,y(v(d.S),i),(e.pass||n||function(t,e,n,r){return r&&(r.S&&g(r,d),t.state=function(){return g(d,{})}),n?(o.random=t,e):t})(b,h,"global"in e?e.global:this==o,e.state)}function p(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<u;)a[i]=i++;for(i=0;i<u;i++)a[i]=a[o=h&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=h&i+1],n=n*u+a[h&(a[i]=a[o=h&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(u)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(m(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function y(t,e){for(var n,r=t+"",i=0;i<r.length;)e[h&i]=h&(n^=19*e[h&i])+r.charCodeAt(i++);return v(e)}function v(t){return String.fromCharCode.apply(0,t)}if(o.seedrandom=d,y(o.random(),i),t.exports){t.exports=d;try{a=n(5042)}catch(t){}}else void 0===(r=function(){return d}.call(e,n,e,t))||(t.exports=r)}([],Math)},4624:(t,e,n)=>{"use strict";n.r(e),n.d(e,{DEFAULT_ACTIONS:()=>tQ,default:()=>cQ,guessMode:()=>aQ,vega:()=>JZ,vegaLite:()=>ZZ});var r={};n.r(r),n.d(r,{JsonPatchError:()=>$,_areEquals:()=>q,applyOperation:()=>I,applyPatch:()=>z,applyReducer:()=>R,deepClone:()=>N,getValueByPointer:()=>j,validate:()=>L,validator:()=>P});var i={};n.r(i),n.d(i,{compare:()=>Y,generate:()=>X,observe:()=>G,unobserve:()=>H});var o={};n.r(o),n.d(o,{aggregate:()=>ju,bin:()=>Iu,collect:()=>Ru,compare:()=>Pu,countpattern:()=>qu,cross:()=>Uu,density:()=>Hu,dotbin:()=>Ju,expression:()=>Zu,extent:()=>tl,facet:()=>nl,field:()=>rl,filter:()=>ol,flatten:()=>al,fold:()=>sl,formula:()=>ul,generate:()=>ll,impute:()=>hl,joinaggregate:()=>dl,kde:()=>pl,key:()=>gl,load:()=>yl,lookup:()=>bl,multiextent:()=>xl,multivalues:()=>_l,params:()=>Al,pivot:()=>El,prefacet:()=>Dl,project:()=>Sl,proxy:()=>Cl,quantile:()=>Ol,relay:()=>Fl,sample:()=>Ml,sequence:()=>$l,sieve:()=>Nl,subflow:()=>el,timeunit:()=>Bl,tupleindex:()=>jl,values:()=>Il,window:()=>ql});var a={};n.r(a),n.d(a,{interpolate:()=>Mh,interpolateArray:()=>kh,interpolateBasis:()=>fh,interpolateBasisClosed:()=>hh,interpolateCubehelix:()=>cp,interpolateCubehelixLong:()=>fp,interpolateDate:()=>Eh,interpolateDiscrete:()=>md,interpolateHcl:()=>Yd,interpolateHclLong:()=>Jd,interpolateHsl:()=>Cd,interpolateHslLong:()=>Od,interpolateHue:()=>yd,interpolateLab:()=>Xd,interpolateNumber:()=>Dh,interpolateNumberArray:()=>wh,interpolateObject:()=>Sh,interpolateRgb:()=>yh,interpolateRgbBasis:()=>bh,interpolateRgbBasisClosed:()=>xh,interpolateRound:()=>$h,interpolateString:()=>Fh,interpolateTransformCss:()=>kd,interpolateTransformSvg:()=>Ad,interpolateZoom:()=>Dd,piecewise:()=>dd,quantize:()=>hp});var s={};n.r(s),n.d(s,{bound:()=>Dx,identifier:()=>Ox,mark:()=>Fx,overlap:()=>Mx,render:()=>zx,viewlayout:()=>ow});var u={};n.r(u),n.d(u,{axisticks:()=>sw,datajoin:()=>uw,encode:()=>cw,legendentries:()=>fw,linkpath:()=>mw,pie:()=>ww,scale:()=>Aw,sortitems:()=>Cw,stack:()=>Nw});var l={};n.r(l),n.d(l,{contour:()=>cE,geojson:()=>dE,geopath:()=>pE,geopoint:()=>gE,geoshape:()=>mE,graticule:()=>yE,heatmap:()=>vE,isocontour:()=>tE,kde2d:()=>sE,projection:()=>xE});var c={};n.r(c),n.d(c,{force:()=>gD});var f={};n.r(f),n.d(f,{nest:()=>gS,pack:()=>wS,partition:()=>kS,stratify:()=>AS,tree:()=>SS,treelinks:()=>CS,treemap:()=>MS});var h={};n.r(h),n.d(h,{label:()=>YS});var d={};n.r(d),n.d(d,{loess:()=>ZS,regression:()=>tC});var p={};n.r(p),n.d(p,{voronoi:()=>kC});var g={};n.r(g),n.d(g,{wordcloud:()=>IC});var m={};n.r(m),n.d(m,{crossfilter:()=>WC,resolvefilter:()=>VC});var y={};n.r(y),n.d(y,{Bounds:()=>Am,CanvasHandler:()=>Qv,CanvasRenderer:()=>ib,DATE:()=>Pr,DAY:()=>Lr,DAYOFYEAR:()=>qr,Dataflow:()=>hs,Debug:()=>xt,Error:()=>yt,EventStream:()=>Za,Gradient:()=>Mg,GroupItem:()=>Dm,HOURS:()=>Ur,Handler:()=>Tv,Info:()=>bt,Item:()=>Em,MILLISECONDS:()=>Hr,MINUTES:()=>Wr,MONTH:()=>zr,Marks:()=>bv,MultiPulse:()=>us,None:()=>mt,Operator:()=>Ka,Parameters:()=>Ha,Pulse:()=>is,QUARTER:()=>Ir,RenderType:()=>Vb,Renderer:()=>Iv,ResourceLoader:()=>Sm,SECONDS:()=>Vr,SVGHandler:()=>ab,SVGRenderer:()=>Fb,SVGStringRenderer:()=>Wb,Scenegraph:()=>Sv,TIME_UNITS:()=>Gr,Transform:()=>ps,View:()=>K$,WEEK:()=>Rr,Warn:()=>vt,YEAR:()=>jr,accessor:()=>tt,accessorFields:()=>nt,accessorName:()=>et,array:()=>Gt,ascending:()=>Jt,bandwidthNRD:()=>Os,bin:()=>Fs,bootstrapCI:()=>Ns,boundClip:()=>Qb,boundContext:()=>Xm,boundItem:()=>xv,boundMark:()=>_v,boundStroke:()=>Fm,changeset:()=>Wa,clampRange:()=>Xt,codegenExpression:()=>ZO,compare:()=>Yt,constant:()=>ee,cumulativeLogNormal:()=>Xs,cumulativeNormal:()=>qs,cumulativeUniform:()=>tu,dayofyear:()=>ti,debounce:()=>ne,defaultLocale:()=>Sa,definition:()=>ms,densityLogNormal:()=>Gs,densityNormal:()=>Ls,densityUniform:()=>Qs,domChild:()=>Mv,domClear:()=>$v,domCreate:()=>Ov,domFind:()=>Fv,dotbin:()=>Bs,error:()=>at,expressionFunction:()=>JM,extend:()=>re,extent:()=>ie,extentIndex:()=>oe,falsy:()=>pt,fastmap:()=>le,field:()=>ut,flush:()=>ce,font:()=>dv,fontFamily:()=>hv,fontSize:()=>sv,format:()=>mn,formatLocale:()=>ba,formats:()=>yn,hasOwnProperty:()=>se,id:()=>lt,identity:()=>ct,inferType:()=>Xe,inferTypes:()=>Ke,ingest:()=>za,inherits:()=>fe,inrange:()=>he,interpolate:()=>ng,interpolateColors:()=>Qp,interpolateRange:()=>Zp,intersect:()=>Xb,intersectBoxLine:()=>oy,intersectPath:()=>ey,intersectPoint:()=>ny,intersectRule:()=>iy,isArray:()=>_t,isBoolean:()=>de,isDate:()=>pe,isFunction:()=>Kt,isIterable:()=>ge,isNumber:()=>me,isObject:()=>kt,isRegExp:()=>ye,isString:()=>ve,isTuple:()=>Ta,key:()=>be,lerp:()=>xe,lineHeight:()=>uv,loader:()=>Fa,locale:()=>Da,logger:()=>wt,lruCache:()=>we,markup:()=>kb,merge:()=>_e,mergeConfig:()=>Et,multiLineOffset:()=>cv,one:()=>ht,pad:()=>Ae,panLinear:()=>jt,panLog:()=>It,panPow:()=>zt,panSymlog:()=>Rt,parse:()=>qj,parseExpression:()=>KO,parseSelector:()=>iN,pathCurves:()=>Ng,pathEqual:()=>ex,pathParse:()=>jg,pathRectangle:()=>am,pathRender:()=>Gg,pathSymbols:()=>Jg,pathTrail:()=>sm,peek:()=>Ct,point:()=>Bv,projection:()=>qA,quantileLogNormal:()=>Ks,quantileNormal:()=>Us,quantileUniform:()=>eu,quantiles:()=>Ss,quantizeInterpolator:()=>tg,quarter:()=>Vt,quartiles:()=>Cs,random:()=>Ms,randomInteger:()=>js,randomKDE:()=>Vs,randomLCG:()=>Ts,randomLogNormal:()=>Ys,randomMixture:()=>Js,randomNormal:()=>Ws,randomUniform:()=>nu,read:()=>Oa,regressionExp:()=>lu,regressionLinear:()=>su,regressionLoess:()=>pu,regressionLog:()=>uu,regressionPoly:()=>hu,regressionPow:()=>cu,regressionQuad:()=>fu,renderModule:()=>Gb,repeat:()=>ke,resetDefaultLocale:()=>Ca,resetSVGClipId:()=>_m,resetSVGDefIds:()=>nx,responseType:()=>vn,runtimeContext:()=>s$,sampleCurve:()=>vu,sampleLogNormal:()=>Hs,sampleNormal:()=>Ps,sampleUniform:()=>Zs,scale:()=>qp,sceneEqual:()=>tx,sceneFromJSON:()=>Ev,scenePickVisit:()=>my,sceneToJSON:()=>Av,sceneVisit:()=>gy,sceneZOrder:()=>py,scheme:()=>ag,serializeXML:()=>Ab,setRandom:()=>$s,span:()=>Ee,splitAccessPath:()=>st,stringValue:()=>De,textMetrics:()=>ev,timeBin:()=>Ri,timeFloor:()=>mi,timeFormatLocale:()=>Aa,timeInterval:()=>_i,timeOffset:()=>Ei,timeSequence:()=>Ci,timeUnitSpecifier:()=>Jr,timeUnits:()=>Kr,toBoolean:()=>Se,toDate:()=>Oe,toNumber:()=>Ot,toSet:()=>Me,toString:()=>Fe,transform:()=>ys,transforms:()=>gs,truncate:()=>$e,truthy:()=>dt,tupleid:()=>ja,typeParsers:()=>Ve,utcFloor:()=>bi,utcInterval:()=>ki,utcOffset:()=>Di,utcSequence:()=>Oi,utcdayofyear:()=>ai,utcquarter:()=>Ht,utcweek:()=>si,version:()=>Uj,visitArray:()=>Ne,week:()=>ei,writeConfig:()=>Dt,zero:()=>ft,zoomLinear:()=>Lt,zoomLog:()=>qt,zoomPow:()=>Ut,zoomSymlog:()=>Wt});var v={};n.r(v),n.d(v,{compile:()=>oZ,extractTransforms:()=>sZ,normalize:()=>$V,version:()=>uZ});var b={};n.r(b),n.d(b,{dark:()=>fZ,excel:()=>dZ,fivethirtyeight:()=>vZ,ggplot2:()=>xZ,googlecharts:()=>LZ,latimes:()=>DZ,quartz:()=>OZ,urbaninstitute:()=>IZ,version:()=>qZ,vox:()=>MZ});var x,w=(x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),_=Object.prototype.hasOwnProperty;function k(t,e){return _.call(t,e)}function A(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);for(var r in e=[],t)k(t,r)&&e.push(r);return e}function E(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function D(t){for(var e,n=0,r=t.length;n<r;){if(!((e=t.charCodeAt(n))>=48&&e<=57))return!1;n++}return!0}function S(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function C(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function O(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(O(t[e]))return!0}else if("object"==typeof t){var r=A(t),i=r.length;for(e=0;e<i;e++)if(O(t[r[e]]))return!0}return!1}function F(t,e){var n=[t];for(var r in e){var i="object"==typeof e[r]?JSON.stringify(e[r],null,2):e[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var M=function(t){function e(e,n,r,i,o){var a=this.constructor,s=t.call(this,F(e,{name:n,index:r,operation:i,tree:o}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=o,Object.setPrototypeOf(s,a.prototype),s.message=F(e,{name:n,index:r,operation:i,tree:o}),s}return w(e,t),e}(Error),$=M,N=E,B={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=j(n,this.path);r&&(r=E(r));var i=I(n,{op:"remove",path:this.from}).removed;return I(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=j(n,this.from);return I(n,{op:"add",path:this.path,value:E(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:q(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},T={add:function(t,e,n){return D(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){return{newDocument:n,removed:t.splice(e,1)[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:B.move,copy:B.copy,test:B.test,_get:B._get};function j(t,e){if(""==e)return t;var n={op:"_get",path:e};return I(t,n),n.value}function I(t,e,n,r,i,o){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===o&&(o=0),n&&("function"==typeof n?n(e,0,t,e.path):P(e,0)),""===e.path){var a={newDocument:t};if("add"===e.op)return a.newDocument=e.value,a;if("replace"===e.op)return a.newDocument=e.value,a.removed=t,a;if("move"===e.op||"copy"===e.op)return a.newDocument=j(t,e.from),"move"===e.op&&(a.removed=t),a;if("test"===e.op){if(a.test=q(t,e.value),!1===a.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a.newDocument=t,a}if("remove"===e.op)return a.removed=t,a.newDocument=null,a;if("_get"===e.op)return e.value=t,a;if(n)throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return a}r||(t=E(t));var s=(e.path||"").split("/"),u=t,l=1,c=s.length,f=void 0,h=void 0,d=void 0;for(d="function"==typeof n?n:P;;){if(h=s[l],i&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===u[h]?f=s.slice(0,l).join("/"):l==c-1&&(f=e.path),void 0!==f&&d(e,0,t,f)),l++,Array.isArray(u)){if("-"===h)h=u.length;else{if(n&&!D(h))throw new $("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);D(h)&&(h=~~h)}if(l>=c){if(n&&"add"===e.op&&h>u.length)throw new $("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);if(!1===(a=T[e.op].call(e,u,h,t)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}}else if(h&&-1!=h.indexOf("~")&&(h=C(h)),l>=c){if(!1===(a=B[e.op].call(e,u,h,t)).test)throw new $("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return a}u=u[h]}}function z(t,e,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(e))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=E(t));for(var o=new Array(e.length),a=0,s=e.length;a<s;a++)o[a]=I(t,e[a],n,!0,i,a),t=o[a].newDocument;return o.newDocument=t,o}function R(t,e,n){var r=I(t,e);if(!1===r.test)throw new $("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function P(t,e,n,r){if("object"!=typeof t||null===t||Array.isArray(t))throw new $("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(!B[t.op])throw new $("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n);if("string"!=typeof t.path)throw new $("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new $('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new $("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&O(t.value))throw new $("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n)if("add"==t.op){var i=t.path.split("/").length,o=r.split("/").length;if(i!==o+1&&i!==o)throw new $("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new $("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if("move"===t.op||"copy"===t.op){var a=L([{op:"_get",path:t.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new $("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}function L(t,e,n){try{if(!Array.isArray(t))throw new $("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)z(E(e),E(t),n||!0);else{n=n||P;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(t){if(t instanceof $)return t;throw t}}function q(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n,r,i,o=Array.isArray(t),a=Array.isArray(e);if(o&&a){if((r=t.length)!=e.length)return!1;for(n=r;0!=n--;)if(!q(t[n],e[n]))return!1;return!0}if(o!=a)return!1;var s=Object.keys(t);if((r=s.length)!==Object.keys(e).length)return!1;for(n=r;0!=n--;)if(!e.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!q(t[i=s[n]],e[i]))return!1;return!0}return t!=t&&e!=e}var U=new WeakMap,W=function(t){this.observers=new Map,this.obj=t},V=function(t,e){this.callback=t,this.observer=e};function H(t,e){e.unobserve()}function G(t,e){var n,r=function(t){return U.get(t)}(t);if(r){var i=function(t,e){return t.observers.get(e)}(r,e);n=i&&i.observer}else r=new W(t),U.set(t,r);if(n)return n;if(n={},r.value=E(t),e){n.callback=e,n.next=null;var o=function(){X(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=[],n.object=t,n.unobserve=function(){X(n),clearTimeout(n.next),function(t,e){t.observers.delete(e.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(e,new V(e,n)),n}function X(t,e){void 0===e&&(e=!1);var n=U.get(t.object);K(n.value,t.object,t.patches,"",e),t.patches.length&&z(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function K(t,e,n,r,i){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var o=A(e),a=A(t),s=!1,u=a.length-1;u>=0;u--){var l=t[f=a[u]];if(!k(e,f)||void 0===e[f]&&void 0!==l&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+S(f),value:E(l)}),n.push({op:"remove",path:r+"/"+S(f)}),s=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}));else{var c=e[f];"object"==typeof l&&null!=l&&"object"==typeof c&&null!=c?K(l,c,n,r+"/"+S(f),i):l!==c&&(i&&n.push({op:"test",path:r+"/"+S(f),value:E(l)}),n.push({op:"replace",path:r+"/"+S(f),value:E(c)}))}}if(s||o.length!=a.length)for(u=0;u<o.length;u++){var f;k(t,f=o[u])||void 0===e[f]||n.push({op:"add",path:r+"/"+S(f),value:E(e[f])})}}}function Y(t,e,n){void 0===n&&(n=!1);var r=[];return K(t,e,r,"",n),r}Object.assign({},r,i,{JsonPatchError:M,deepClone:E,escapePathComponent:S,unescapePathComponent:C});var J=n(1127),Z=n.n(J),Q=n(2543);function tt(t,e,n){return t.fields=e||[],t.fname=n,t}function et(t){return null==t?null:t.fname}function nt(t){return null==t?null:t.fields}function rt(t){return 1===t.length?it(t[0]):ot(t)}const it=t=>function(e){return e[t]},ot=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function at(t){throw Error(t)}function st(t){const e=[],n=t.length;let r,i,o,a=null,s=0,u="";function l(){e.push(u+t.substring(r,i)),u="",r=i+1}for(t+="",r=i=0;i<n;++i)if(o=t[i],"\\"===o)u+=t.substring(r,i),u+=t.substring(++i,++i),r=i;else if(o===a)l(),a=null,s=-1;else{if(a)continue;r===s&&'"'===o||r===s&&"'"===o?(r=i+1,a=o):"."!==o||s?"["===o?(i>r&&l(),s=r=i+1):"]"===o&&(s||at("Access path missing open bracket: "+t),s>0&&l(),s=0,r=i+1):i>r?l():r=i+1}return s&&at("Access path missing closing bracket: "+t),a&&at("Access path missing closing quote: "+t),i>r&&(i++,l()),e}function ut(t,e,n){const r=st(t);return t=1===r.length?r[0]:t,tt((n&&n.get||rt)(r),[t],e||t)}const lt=ut("id"),ct=tt((t=>t),[],"identity"),ft=tt((()=>0),[],"zero"),ht=tt((()=>1),[],"one"),dt=tt((()=>!0),[],"true"),pt=tt((()=>!1),[],"false");function gt(t,e,n){const r=[e].concat([].slice.call(n));console[t].apply(console,r)}const mt=0,yt=1,vt=2,bt=3,xt=4;function wt(t,e){let n=t||mt;return{level(t){return arguments.length?(n=+t,this):n},error(){return n>=yt&&gt(e||"error","ERROR",arguments),this},warn(){return n>=vt&&gt(e||"warn","WARN",arguments),this},info(){return n>=bt&&gt(e||"log","INFO",arguments),this},debug(){return n>=xt&&gt(e||"log","DEBUG",arguments),this}}}var _t=Array.isArray;function kt(t){return t===Object(t)}const At=t=>"__proto__"!==t;function Et(...t){return t.reduce(((t,e)=>{for(const n in e)if("signals"===n)t.signals=St(t.signals,e.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;Dt(t,n,e[n],r)}return t}),{})}function Dt(t,e,n,r){if(!At(e))return;let i,o;if(kt(n)&&!_t(n))for(i in o=kt(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?Dt(o,i,n[i]):At(i)&&(o[i]=n[i]);else t[e]=n}function St(t,e){if(null==t)return e;const n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}function Ct(t){return t[t.length-1]}function Ot(t){return null==t||""===t?null:+t}const Ft=t=>e=>t*Math.exp(e),Mt=t=>e=>Math.log(t*e),$t=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),Nt=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,Bt=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function Tt(t,e,n,r){const i=n(t[0]),o=n(Ct(t)),a=(o-i)*e;return[r(i-a),r(o-a)]}function jt(t,e){return Tt(t,e,Ot,ct)}function It(t,e){var n=Math.sign(t[0]);return Tt(t,e,Mt(n),Ft(n))}function zt(t,e,n){return Tt(t,e,Bt(n),Bt(1/n))}function Rt(t,e,n){return Tt(t,e,$t(n),Nt(n))}function Pt(t,e,n,r,i){const o=r(t[0]),a=r(Ct(t)),s=null!=e?r(e):(o+a)/2;return[i(s+(o-s)*n),i(s+(a-s)*n)]}function Lt(t,e,n){return Pt(t,e,n,Ot,ct)}function qt(t,e,n){const r=Math.sign(t[0]);return Pt(t,e,n,Mt(r),Ft(r))}function Ut(t,e,n,r){return Pt(t,e,n,Bt(r),Bt(1/r))}function Wt(t,e,n,r){return Pt(t,e,n,$t(r),Nt(r))}function Vt(t){return 1+~~(new Date(t).getMonth()/3)}function Ht(t){return 1+~~(new Date(t).getUTCMonth()/3)}function Gt(t){return null!=t?_t(t)?t:[t]:[]}function Xt(t,e,n){let r,i=t[0],o=t[1];return o<i&&(r=o,o=i,i=r),r=o-i,r>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-r),i+r]}function Kt(t){return"function"==typeof t}function Yt(t,e,n){n=n||{},e=Gt(e)||[];const r=[],i=[],o={},a=n.comparator||Zt;return Gt(t).forEach(((t,a)=>{null!=t&&(r.push("descending"===e[a]?-1:1),i.push(t=Kt(t)?t:ut(t,null,n)),(nt(t)||[]).forEach((t=>o[t]=1)))})),0===i.length?null:tt(a(i,r),Object.keys(o))}const Jt=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e?-1:e!=e&&t==t?1:0),Zt=(t,e)=>1===t.length?Qt(t[0],e[0]):te(t,e,t.length),Qt=(t,e)=>function(n,r){return Jt(t(n),t(r))*e},te=(t,e,n)=>(e.push(0),function(r,i){let o,a=0,s=-1;for(;0===a&&++s<n;)o=t[s],a=Jt(o(r),o(i));return a*e[s]});function ee(t){return Kt(t)?t:()=>t}function ne(t,e){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(e(r),n=null)),t)}}function re(t){for(let e,n,r=1,i=arguments.length;r<i;++r)for(n in e=arguments[r],e)t[n]=e[n];return t}function ie(t,e){let n,r,i,o,a=0;if(t&&(n=t.length))if(null==e){for(r=t[a];a<n&&(null==r||r!=r);r=t[++a]);for(i=o=r;a<n;++a)r=t[a],null!=r&&(r<i&&(i=r),r>o&&(o=r))}else{for(r=e(t[a]);a<n&&(null==r||r!=r);r=e(t[++a]));for(i=o=r;a<n;++a)r=e(t[a]),null!=r&&(r<i&&(i=r),r>o&&(o=r))}return[i,o]}function oe(t,e){const n=t.length;let r,i,o,a,s,u=-1;if(null==e){for(;++u<n;)if(i=t[u],null!=i&&i>=i){r=o=i;break}if(u===n)return[-1,-1];for(a=s=u;++u<n;)i=t[u],null!=i&&(r>i&&(r=i,a=u),o<i&&(o=i,s=u))}else{for(;++u<n;)if(i=e(t[u],u,t),null!=i&&i>=i){r=o=i;break}if(u===n)return[-1,-1];for(a=s=u;++u<n;)i=e(t[u],u,t),null!=i&&(r>i&&(r=i,a=u),o<i&&(o=i,s=u))}return[a,s]}const ae=Object.prototype.hasOwnProperty;function se(t,e){return ae.call(t,e)}const ue={};function le(t){let e,n={};function r(t){return se(n,t)&&n[t]!==ue}const i={size:0,empty:0,object:n,has:r,get:t=>r(t)?n[t]:void 0,set(t,e){return r(t)||(++i.size,n[t]===ue&&--i.empty),n[t]=e,this},delete(t){return r(t)&&(--i.size,++i.empty,n[t]=ue),this},clear(){i.size=i.empty=0,i.object=n={}},test(t){return arguments.length?(e=t,i):e},clean(){const t={};let r=0;for(const i in n){const o=n[i];o===ue||e&&e(o)||(t[i]=o,++r)}i.size=r,i.empty=0,i.object=n=t}};return t&&Object.keys(t).forEach((e=>{i.set(e,t[e])})),i}function ce(t,e,n,r,i,o){if(!n&&0!==n)return o;const a=+n;let s,u=t[0],l=Ct(t);l<u&&(s=u,u=l,l=s),s=Math.abs(e-u);const c=Math.abs(l-e);return s<c&&s<=a?r:c<=a?i:o}function fe(t,e,n){const r=t.prototype=Object.create(e.prototype);return Object.defineProperty(r,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),re(r,n)}function he(t,e,n,r){let i,o=e[0],a=e[e.length-1];return o>a&&(i=o,o=a,a=i),r=void 0===r||r,((n=void 0===n||n)?o<=t:o<t)&&(r?t<=a:t<a)}function de(t){return"boolean"==typeof t}function pe(t){return"[object Date]"===Object.prototype.toString.call(t)}function ge(t){return t&&Kt(t[Symbol.iterator])}function me(t){return"number"==typeof t}function ye(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function ve(t){return"string"==typeof t}function be(t,e,n){t&&(t=e?Gt(t).map((t=>t.replace(/\\(.)/g,"$1"))):Gt(t));const r=t&&t.length,i=n&&n.get||rt,o=t=>i(e?[t]:st(t));let a;if(r)if(1===r){const e=o(t[0]);a=function(t){return""+e(t)}}else{const e=t.map(o);a=function(t){let n=""+e[0](t),i=0;for(;++i<r;)n+="|"+e[i](t);return n}}else a=function(){return""};return tt(a,t,"key")}function xe(t,e){const n=t[0],r=Ct(t),i=+e;return i?1===i?r:n+i*(r-n):n}function we(t){let e,n,r;t=+t||1e4;const i=()=>{e={},n={},r=0},o=(i,o)=>(++r>t&&(n=e,e={},r=1),e[i]=o);return i(),{clear:i,has:t=>se(e,t)||se(n,t),get:t=>se(e,t)?e[t]:se(n,t)?o(t,n[t]):void 0,set:(t,n)=>se(e,t)?e[t]=n:o(t,n)}}function _e(t,e,n,r){const i=e.length,o=n.length;if(!o)return e;if(!i)return n;const a=r||new e.constructor(i+o);let s=0,u=0,l=0;for(;s<i&&u<o;++l)a[l]=t(e[s],n[u])>0?n[u++]:e[s++];for(;s<i;++s,++l)a[l]=e[s];for(;u<o;++u,++l)a[l]=n[u];return a}function ke(t,e){let n="";for(;--e>=0;)n+=t;return n}function Ae(t,e,n,r){const i=n||" ",o=t+"",a=e-o.length;return a<=0?o:"left"===r?ke(i,a)+o:"center"===r?ke(i,~~(a/2))+o+ke(i,Math.ceil(a/2)):o+ke(i,a)}function Ee(t){return t&&Ct(t)-t[0]||0}function De(t){return _t(t)?"["+t.map(De)+"]":kt(t)||ve(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function Se(t){return null==t||""===t?null:!(!t||"false"===t||"0"===t||!t)}const Ce=t=>me(t)||pe(t)?t:Date.parse(t);function Oe(t,e){return e=e||Ce,null==t||""===t?null:e(t)}function Fe(t){return null==t||""===t?null:t+""}function Me(t){const e={},n=t.length;for(let r=0;r<n;++r)e[t[r]]=!0;return e}function $e(t,e,n,r){const i=null!=r?r:"",o=t+"",a=o.length,s=Math.max(0,e-i.length);return a<=e?o:"left"===n?i+o.slice(a-s):"center"===n?o.slice(0,Math.ceil(s/2))+i+o.slice(a-~~(s/2)):o.slice(0,s)+i}function Ne(t,e,n){if(t)if(e){const r=t.length;for(let i=0;i<r;++i){const r=e(t[i]);r&&n(r,i,t)}}else t.forEach(n)}const Be=/^([A-Za-z]+:)?\/\//,Te=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,je=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Ie="file://";async function ze(t,e){const n=await this.sanitize(t,e),r=n.href;return n.localFile?this.file(r):this.http(r,e)}async function Re(t,e){e=re({},this.options,e);const n=this.fileAccess,r={href:null};let i,o,a;const s=Te.test(t.replace(je,""));null!=t&&"string"==typeof t&&s||at("Sanitize failure, invalid URI: "+De(t));const u=Be.test(t);return(a=e.baseURL)&&!u&&(t.startsWith("/")||"/"===a[a.length-1]||(t="/"+t),t=a+t),o=(i=t.startsWith(Ie))||"file"===e.mode||"http"!==e.mode&&!u&&n,i?t=t.slice(Ie.length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),o=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(r,"localFile",{value:!!o}),r.href=t,e.target&&(r.target=e.target+""),e.rel&&(r.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(r.crossOrigin=e.crossOrigin+""),r}function Pe(t){return t?e=>new Promise(((n,r)=>{t.readFile(e,((t,e)=>{t?r(t):n(e)}))})):Le}async function Le(){at("No file system access.")}function qe(t){return t?async function(e,n){const r=re({},this.options.http,n),i=n&&n.response,o=await t(e,r);return o.ok?Kt(o[i])?o[i]():o.text():at(o.status+""+o.statusText)}:Ue}async function Ue(){at("No HTTP fetch method available.")}const We=t=>!(Number.isNaN(+t)||t instanceof Date),Ve={boolean:Se,integer:Ot,number:Ot,date:Oe,string:Fe,unknown:ct},He=[t=>"true"===t||"false"===t||!0===t||!1===t,t=>We(t)&&Number.isInteger(+t),We,t=>!Number.isNaN(Date.parse(t))],Ge=["boolean","integer","number","date"];function Xe(t,e){if(!t||!t.length)return"unknown";const n=t.length,r=He.length,i=He.map(((t,e)=>e+1));for(let a,s,u=0,l=0;u<n;++u)for(s=e?t[u][e]:t[u],a=0;a<r;++a)if(i[a]&&null!=(o=s)&&o==o&&!He[a](s)&&(i[a]=0,++l,l===He.length))return"string";var o;return Ge[i.reduce(((t,e)=>0===t?e:t),0)-1]}function Ke(t,e){return e.reduce(((e,n)=>(e[n]=Xe(t,n),e)),{})}var Ye={},Je={};function Ze(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Qe(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function tn(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function en(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,l=!1;function c(){if(u)return Je;if(l)return l=!1,Ye;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?l=!0:13===r&&(l=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))l=!0;else if(13===r)l=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=c())!==Je;){for(var f=[];r!==Ye&&r!==Je;)f.push(r),r=c();e&&null==(f=e(f,s++))||i.push(f)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?function(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":function(t){return t<0?"-"+tn(-t,6):t>9999?"+"+tn(t,6):tn(t,4)}(t.getUTCFullYear())+"-"+tn(t.getUTCMonth()+1,2)+"-"+tn(t.getUTCDate(),2)+(i?"T"+tn(e,2)+":"+tn(n,2)+":"+tn(r,2)+"."+tn(i,3)+"Z":r?"T"+tn(e,2)+":"+tn(n,2)+":"+tn(r,2)+"Z":n||e?"T"+tn(e,2)+":"+tn(n,2)+"Z":"")}(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=Ze(t);return function(r,i){return e(n(r),i,t)}}(t,e):Ze(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=Qe(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=Qe(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}function nn(t){const e=function(e,n){const r={delimiter:t};return rn(e,n?re(n,r):r)};return e.responseType="text",e}function rn(t,e){return e.header&&(t=e.header.map(De).join(e.delimiter)+"\n"+t),en(e.delimiter).parse(t+"")}function on(t,e){const n=e&&e.property?ut(e.property):ct;return!kt(t)||(r=t,"function"==typeof Buffer&&Kt(Buffer.isBuffer)&&Buffer.isBuffer(r))?n(JSON.parse(t)):function(t,e){return!_t(t)&&ge(t)&&(t=[...t]),e&&e.copy?JSON.parse(JSON.stringify(t)):t}(n(t),e);var r}function an(t){return t}function sn(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map((function(e){return un(t,e)}))}:un(t,e)}function un(t,e){var n=e.id,r=e.bbox,i=null==e.properties?{}:e.properties,o=ln(t,e);return null==n&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:n,properties:i,geometry:o}:{type:"Feature",id:n,bbox:r,properties:i,geometry:o}}function ln(t,e){var n=function(t){if(null==t)return an;var e,n,r=t.scale[0],i=t.scale[1],o=t.translate[0],a=t.translate[1];return function(t,s){s||(e=n=0);var u=2,l=t.length,c=new Array(l);for(c[0]=(e+=t[0])*r+o,c[1]=(n+=t[1])*i+a;u<l;)c[u]=t[u],++u;return c}}(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var i=r[t<0?~t:t],o=0,a=i.length;o<a;++o)e.push(n(i[o],o));t<0&&function(t,e){for(var n,r=t.length,i=r-e;i<--r;)n=t[i],t[i++]=t[r],t[r]=n}(e,a)}function o(t){return n(t)}function a(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function s(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(s)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=o(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(o);break;case"LineString":n=a(e.arcs);break;case"MultiLineString":n=e.arcs.map(a);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(e)}function cn(t,e){var n={},r={},i={},o=[],a=-1;function s(t,e){for(var r in t){var i=t[r];delete e[i.start],delete i.start,delete i.end,i.forEach((function(t){n[t<0?~t:t]=1})),o.push(i)}}return e.forEach((function(n,r){var i,o=t.arcs[n<0?~n:n];o.length<3&&!o[1][0]&&!o[1][1]&&(i=e[++a],e[a]=n,e[r]=i)})),e.forEach((function(e){var n,o,a=function(e){var n,r=t.arcs[e<0?~e:e],i=r[0];return t.transform?(n=[0,0],r.forEach((function(t){n[0]+=t[0],n[1]+=t[1]}))):n=r[r.length-1],e<0?[n,i]:[i,n]}(e),s=a[0],u=a[1];if(n=i[s])if(delete i[n.end],n.push(e),n.end=u,o=r[u]){delete r[o.start];var l=o===n?n:n.concat(o);r[l.start=n.start]=i[l.end=o.end]=l}else r[n.start]=i[n.end]=n;else if(n=r[u])if(delete r[n.start],n.unshift(e),n.start=s,o=i[s]){delete i[o.end];var c=o===n?n:o.concat(n);r[c.start=o.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[e]).start=s]=i[n.end=u]=n})),s(i,r),s(r,i),e.forEach((function(t){n[t<0?~t:t]||o.push([t])})),o}function fn(t){return ln(t,hn.apply(this,arguments))}function hn(t,e,n){var r,i,o;if(arguments.length>1)r=dn(0,e,n);else for(i=0,r=new Array(o=t.arcs.length);i<o;++i)r[i]=i;return{type:"MultiLineString",arcs:cn(t,r)}}function dn(t,e,n){var r,i=[],o=[];function a(t){var e=t<0?~t:t;(o[e]||(o[e]=[])).push({i:t,g:r})}function s(t){t.forEach(a)}function u(t){t.forEach(s)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":u(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(u)}(e.arcs)}}(e),o.forEach(null==n?function(t){i.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&i.push(t[0].i)}),i}rn.responseType="text",on.responseType="json";const pn={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function gn(t,e){let n,r,i,o;return t=on(t,e),e&&e.feature?(n=sn,i=e.feature):e&&e.mesh?(n=fn,i=e.mesh,o=pn[e.filter]):at("Missing TopoJSON feature or mesh parameter."),r=(r=t.objects[i])?n(t,r,o):at("Invalid TopoJSON object: "+i),r&&r.features||[r]}gn.responseType="json";const mn={dsv:rn,csv:nn(","),tsv:nn("\t"),json:on,topojson:gn};function yn(t,e){return arguments.length>1?(mn[t]=e,this):se(mn,t)?mn[t]:null}function vn(t){const e=yn(t);return e&&e.responseType||"text"}var bn=Math.sqrt(50),xn=Math.sqrt(10),wn=Math.sqrt(2);function _n(t,e,n){var r,i,o,a,s=-1;if(n=+n,(t=+t)==(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=kn(t,e,n))||!isFinite(a))return[];if(a>0){let n=Math.round(t/a),r=Math.round(e/a);for(n*a<t&&++n,r*a>e&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)*a}else{a=-a;let n=Math.round(t*a),r=Math.round(e*a);for(n/a<t&&++n,r/a>e&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)/a}return r&&o.reverse(),o}function kn(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=bn?10:o>=xn?5:o>=wn?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=bn?10:o>=xn?5:o>=wn?2:1)}function An(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=bn?i*=10:o>=xn?i*=5:o>=wn&&(i*=2),e<t?-i:i}var En,Dn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sn(t){if(!(e=Dn.exec(t)))throw new Error("invalid format: "+t);var e;return new Cn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Cn(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function On(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Fn(t){return(t=On(Math.abs(t)))?t[1]:NaN}function Mn(t,e){var n=On(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Sn.prototype=Cn.prototype,Cn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const $n={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Mn(100*t,e),r:Mn,s:function(t,e){var n=On(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(En=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+On(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Nn(t){return t}var Bn,Tn,jn,In=Array.prototype.map,zn=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Rn(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Nn:(e=In.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Nn:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(In.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=Sn(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):$n[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===h?o:/[%p]/.test(v)?u:"",w=$n[v],_=/[defgprs%]/.test(v);function k(t){var i,o,u,h=b,k=x;if("c"===v)k=w(t)+k,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:w(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==f&&(A=!1),h=(A?"("===f?f:l:"-"===f||"("===f?"":f)+h,k=("s"===v?zn[8+En/3]:"")+k+(A&&"("===f?")":""),_)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){k=(46===u?a+t.slice(i+1):t.slice(i))+k,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var E=h.length+t.length+k.length,D=E<p?new Array(p-E+1).join(e):"";switch(g&&d&&(t=r(D+t,D.length?p-k.length:1/0),D=""),n){case"<":t=h+t+k+D;break;case"=":t=h+D+t+k;break;case"^":t=D.slice(0,E=D.length>>1)+h+t+k+D.slice(E);break;default:t=D+h+t+k}return s(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:f,formatPrefix:function(t,e){var n=f(((t=Sn(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Fn(e)/3))),i=Math.pow(10,-r),o=zn[8+r/3];return function(t){return n(i*t)+o}}}}Bn=Rn({thousands:",",grouping:[3],currency:["$",""]}),Tn=Bn.format,jn=Bn.formatPrefix;var Pn=new Date,Ln=new Date;function qn(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return qn((function(e){if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)for(;++r<=0;)for(;e(t,-1),!n(t););else for(;--r>=0;)for(;e(t,1),!n(t););}))},n&&(i.count=function(e,r){return Pn.setTime(+e),Ln.setTime(+r),t(Pn),t(Ln),Math.floor(n(Pn,Ln))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t==0}:function(e){return i.count(0,e)%t==0}):i:null}),i}var Un=1e3,Wn=6e4,Vn=36e5,Hn=864e5,Gn=6048e5,Xn=qn((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Wn)/Hn),(t=>t.getDate()-1));const Kn=Xn;function Yn(t){return qn((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Wn)/Gn}))}Xn.range;var Jn=Yn(0),Zn=Yn(1),Qn=Yn(2),tr=Yn(3),er=Yn(4),nr=Yn(5),rr=Yn(6),ir=(Jn.range,Zn.range,Qn.range,tr.range,er.range,nr.range,rr.range,qn((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/Hn}),(function(t){return t.getUTCDate()-1})));const or=ir;function ar(t){return qn((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/Gn}))}ir.range;var sr=ar(0),ur=ar(1),lr=ar(2),cr=ar(3),fr=ar(4),hr=ar(5),dr=ar(6),pr=(sr.range,ur.range,lr.range,cr.range,fr.range,hr.range,dr.range,qn((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()})));pr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?qn((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};const gr=pr;pr.range;var mr=qn((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}));const yr=mr;mr.range;var vr=qn((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Un-t.getMinutes()*Wn)}),(function(t,e){t.setTime(+t+e*Vn)}),(function(t,e){return(e-t)/Vn}),(function(t){return t.getHours()}));const br=vr;vr.range;var xr=qn((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*Un)}),(function(t,e){t.setTime(+t+e*Wn)}),(function(t,e){return(e-t)/Wn}),(function(t){return t.getMinutes()}));const wr=xr;xr.range;var _r=qn((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*Un)}),(function(t,e){return(e-t)/Un}),(function(t){return t.getUTCSeconds()}));const kr=_r;_r.range;var Ar=qn((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t}));Ar.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?qn((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):Ar:null};const Er=Ar;Ar.range;var Dr=qn((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()}));Dr.every=function(t){return isFinite(t=Math.floor(t))&&t>0?qn((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};const Sr=Dr;Dr.range;var Cr=qn((function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCMonth(t.getUTCMonth()+e)}),(function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())}),(function(t){return t.getUTCMonth()}));const Or=Cr;Cr.range;var Fr=qn((function(t){t.setUTCMinutes(0,0,0)}),(function(t,e){t.setTime(+t+e*Vn)}),(function(t,e){return(e-t)/Vn}),(function(t){return t.getUTCHours()}));const Mr=Fr;Fr.range;var $r=qn((function(t){t.setUTCSeconds(0,0)}),(function(t,e){t.setTime(+t+e*Wn)}),(function(t,e){return(e-t)/Wn}),(function(t){return t.getUTCMinutes()}));const Nr=$r;function Br(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Tr(t){let e=t,n=t;function r(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)<0?r=o+1:i=o}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>Br(t(e),n)}(t)),{left:r,center:function(t,n,i,o){null==i&&(i=0),null==o&&(o=t.length);const a=r(t,n,i,o-1);return a>i&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)>0?i=o:r=o+1}return r}}}$r.range;const jr="year",Ir="quarter",zr="month",Rr="week",Pr="date",Lr="day",qr="dayofyear",Ur="hours",Wr="minutes",Vr="seconds",Hr="milliseconds",Gr=[jr,Ir,zr,Rr,Pr,Lr,qr,Ur,Wr,Vr,Hr],Xr=Gr.reduce(((t,e,n)=>(t[e]=1+n,t)),{});function Kr(t){const e=Gt(t).slice(),n={};return e.length||at("Missing time unit."),e.forEach((t=>{se(Xr,t)?n[t]=1:at("Invalid time unit: ".concat(t,"."))})),(n[Rr]||n[Lr]?1:0)+(n[Ir]||n[zr]||n[Pr]?1:0)+(n[qr]?1:0)>1&&at("Incompatible time units: ".concat(t)),e.sort(((t,e)=>Xr[t]-Xr[e])),e}const Yr={[jr]:"%Y ",[Ir]:"Q%q ",[zr]:"%b ",[Pr]:"%d ",[Rr]:"W%U ",[Lr]:"%a ",[qr]:"%j ",[Ur]:"%H:00",[Wr]:"00:%M",[Vr]:":%S",[Hr]:".%L",["".concat(jr,"-").concat(zr)]:"%Y-%m ",["".concat(jr,"-").concat(zr,"-").concat(Pr)]:"%Y-%m-%d ",["".concat(Ur,"-").concat(Wr)]:"%H:%M"};function Jr(t,e){const n=re({},Yr,e),r=Kr(t),i=r.length;let o,a,s="",u=0;for(u=0;u<i;)for(o=r.length;o>u;--o)if(a=r.slice(u,o).join("-"),null!=n[a]){s+=n[a],u=o;break}return s.trim()}const Zr=new Date;function Qr(t){return Zr.setFullYear(t),Zr.setMonth(0),Zr.setDate(1),Zr.setHours(0,0,0,0),Zr}function ti(t){return ni(new Date(t))}function ei(t){return ri(new Date(t))}function ni(t){return Kn.count(Qr(t.getFullYear())-1,t)}function ri(t){return Jn.count(Qr(t.getFullYear())-1,t)}function ii(t){return Qr(t).getDay()}function oi(t,e,n,r,i,o,a){if(0<=t&&t<100){const s=new Date(-1,e,n,r,i,o,a);return s.setFullYear(t),s}return new Date(t,e,n,r,i,o,a)}function ai(t){return ui(new Date(t))}function si(t){return li(new Date(t))}function ui(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return or.count(e-1,t)}function li(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return sr.count(e-1,t)}function ci(t){return Zr.setTime(Date.UTC(t,0,1)),Zr.getUTCDay()}function fi(t,e,n,r,i,o,a){if(0<=t&&t<100){const t=new Date(Date.UTC(-1,e,n,r,i,o,a));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(t,e,n,r,i,o,a))}function hi(t,e,n,r,i){const o=e||1,a=Ct(t),s=(t,e,i)=>function(t,e,n,r){const i=n<=1?t:r?(e,i)=>r+n*Math.floor((t(e,i)-r)/n):(e,r)=>n*Math.floor(t(e,r)/n);return e?(t,n)=>e(i(t,n),n):i}(n[i=i||t],r[i],t===a&&o,e),u=new Date,l=Me(t),c=l[jr]?s(jr):ee(2012),f=l[zr]?s(zr):l[Ir]?s(Ir):ft,h=l[Rr]&&l[Lr]?s(Lr,1,Rr+Lr):l[Rr]?s(Rr,1):l[Lr]?s(Lr,1):l[Pr]?s(Pr,1):l[qr]?s(qr,1):ht,d=l[Ur]?s(Ur):ft,p=l[Wr]?s(Wr):ft,g=l[Vr]?s(Vr):ft,m=l[Hr]?s(Hr):ft;return function(t){u.setTime(+t);const e=c(u);return i(e,f(u),h(u,e),d(u),p(u),g(u),m(u))}}function di(t,e,n){return e+7*t-(n+6)%7}const pi={[jr]:t=>t.getFullYear(),[Ir]:t=>Math.floor(t.getMonth()/3),[zr]:t=>t.getMonth(),[Pr]:t=>t.getDate(),[Ur]:t=>t.getHours(),[Wr]:t=>t.getMinutes(),[Vr]:t=>t.getSeconds(),[Hr]:t=>t.getMilliseconds(),[qr]:t=>ni(t),[Rr]:t=>ri(t),[Rr+Lr]:(t,e)=>di(ri(t),t.getDay(),ii(e)),[Lr]:(t,e)=>di(1,t.getDay(),ii(e))},gi={[Ir]:t=>3*t,[Rr]:(t,e)=>di(t,0,ii(e))};function mi(t,e){return hi(t,e||1,pi,gi,oi)}const yi={[jr]:t=>t.getUTCFullYear(),[Ir]:t=>Math.floor(t.getUTCMonth()/3),[zr]:t=>t.getUTCMonth(),[Pr]:t=>t.getUTCDate(),[Ur]:t=>t.getUTCHours(),[Wr]:t=>t.getUTCMinutes(),[Vr]:t=>t.getUTCSeconds(),[Hr]:t=>t.getUTCMilliseconds(),[qr]:t=>ui(t),[Rr]:t=>li(t),[Lr]:(t,e)=>di(1,t.getUTCDay(),ci(e)),[Rr+Lr]:(t,e)=>di(li(t),t.getUTCDay(),ci(e))},vi={[Ir]:t=>3*t,[Rr]:(t,e)=>di(t,0,ci(e))};function bi(t,e){return hi(t,e||1,yi,vi,fi)}const xi={[jr]:gr,[Ir]:yr.every(3),[zr]:yr,[Rr]:Jn,[Pr]:Kn,[Lr]:Kn,[qr]:Kn,[Ur]:br,[Wr]:wr,[Vr]:kr,[Hr]:Er},wi={[jr]:Sr,[Ir]:Or.every(3),[zr]:Or,[Rr]:sr,[Pr]:or,[Lr]:or,[qr]:or,[Ur]:Mr,[Wr]:Nr,[Vr]:kr,[Hr]:Er};function _i(t){return xi[t]}function ki(t){return wi[t]}function Ai(t,e,n){return t?t.offset(e,n):void 0}function Ei(t,e,n){return Ai(_i(t),e,n)}function Di(t,e,n){return Ai(ki(t),e,n)}function Si(t,e,n,r){return t?t.range(e,n,r):void 0}function Ci(t,e,n,r){return Si(_i(t),e,n,r)}function Oi(t,e,n,r){return Si(ki(t),e,n,r)}const Fi=31536e6,Mi=[jr,zr,Pr,Ur,Wr,Vr,Hr],$i=Mi.slice(0,-1),Ni=$i.slice(0,-1),Bi=Ni.slice(0,-1),Ti=Bi.slice(0,-1),ji=[jr,zr],Ii=[jr],zi=[[$i,1,1e3],[$i,5,5e3],[$i,15,15e3],[$i,30,3e4],[Ni,1,6e4],[Ni,5,3e5],[Ni,15,9e5],[Ni,30,18e5],[Bi,1,36e5],[Bi,3,108e5],[Bi,6,216e5],[Bi,12,432e5],[Ti,1,864e5],[[jr,Rr],1,6048e5],[ji,1,2592e6],[ji,3,7776e6],[Ii,1,Fi]];function Ri(t){const e=t.extent,n=t.maxbins||40,r=Math.abs(Ee(e))/n;let i,o,a=Tr((t=>t[2])).right(zi,r);return a===zi.length?(i=Ii,o=An(e[0]/Fi,e[1]/Fi,n)):a?(a=zi[r/zi[a-1][2]<zi[a][2]/r?a-1:a],i=a[0],o=a[1]):(i=Mi,o=Math.max(An(e[0],e[1],n),1)),{units:i,step:o}}function Pi(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function Li(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function qi(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Ui(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,l=eo(i),c=no(i),f=eo(o),h=no(o),d=eo(a),p=no(a),g=eo(s),m=no(s),y=eo(u),v=no(u),b={a:function(t){return a[t.getDay()]},A:function(t){return o[t.getDay()]},b:function(t){return u[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:Ao,e:Ao,f:Oo,g:Po,G:qo,H:Eo,I:Do,j:So,L:Co,m:Fo,M:Mo,p:function(t){return i[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:fa,s:ha,S:$o,u:No,U:Bo,V:jo,w:Io,W:zo,x:null,X:null,y:Ro,Y:Lo,Z:Uo,"%":ca},x={a:function(t){return a[t.getUTCDay()]},A:function(t){return o[t.getUTCDay()]},b:function(t){return u[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:Wo,e:Wo,f:Ko,g:aa,G:ua,H:Vo,I:Ho,j:Go,L:Xo,m:Yo,M:Jo,p:function(t){return i[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:fa,s:ha,S:Zo,u:Qo,U:ta,V:na,w:ra,W:ia,x:null,X:null,y:oa,Y:sa,Z:la,"%":ca},w={a:function(t,e,n){var r=d.exec(e.slice(n));return r?(t.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(t,e,n){var r=f.exec(e.slice(n));return r?(t.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(t,e,n){var r=y.exec(e.slice(n));return r?(t.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=m.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(t,n,r){return A(t,e,n,r)},d:po,e:po,f:xo,g:lo,G:uo,H:mo,I:mo,j:go,L:bo,m:ho,M:yo,p:function(t,e,n){var r=l.exec(e.slice(n));return r?(t.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:fo,Q:_o,s:ko,S:vo,u:io,U:oo,V:ao,w:ro,W:so,x:function(t,e,r){return A(t,n,e,r)},X:function(t,e,n){return A(t,r,e,n)},y:lo,Y:uo,Z:co,"%":wo};function _(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,l=t.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=Ki[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function k(t,e){return function(n){var r,i,o=qi(1900,void 0,1);if(A(o,t,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=Li(qi(o.y,0,1))).getUTCDay(),r=i>4||0===i?ur.ceil(r):ur(r),r=or.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=Pi(qi(o.y,0,1))).getDay(),r=i>4||0===i?Zn.ceil(r):Zn(r),r=Kn.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?Li(qi(o.y,0,1)).getUTCDay():Pi(qi(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,Li(o)):Pi(o)}}function A(t,e,n,r){for(var i,o,a=0,s=e.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=e.charCodeAt(a++))){if(i=e.charAt(a++),!(o=w[i in Ki?e.charAt(a++):i])||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(e,b),x.x=_(n,x),x.X=_(r,x),x.c=_(e,x),{format:function(t){var e=_(t+="",b);return e.toString=function(){return t},e},parse:function(t){var e=k(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=_(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=k(t+="",!0);return e.toString=function(){return t},e}}}var Wi,Vi,Hi,Gi,Xi,Ki={"-":"",_:" ",0:"0"},Yi=/^\s*\d+/,Ji=/^%/,Zi=/[\\^$*+?|[\]().{}]/g;function Qi(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function to(t){return t.replace(Zi,"\\$&")}function eo(t){return new RegExp("^(?:"+t.map(to).join("|")+")","i")}function no(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function ro(t,e,n){var r=Yi.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function io(t,e,n){var r=Yi.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function oo(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function ao(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function so(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function uo(t,e,n){var r=Yi.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function lo(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function co(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function fo(t,e,n){var r=Yi.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function ho(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function po(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function go(t,e,n){var r=Yi.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function mo(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function yo(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function vo(t,e,n){var r=Yi.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function bo(t,e,n){var r=Yi.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function xo(t,e,n){var r=Yi.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function wo(t,e,n){var r=Ji.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function _o(t,e,n){var r=Yi.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function ko(t,e,n){var r=Yi.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Ao(t,e){return Qi(t.getDate(),e,2)}function Eo(t,e){return Qi(t.getHours(),e,2)}function Do(t,e){return Qi(t.getHours()%12||12,e,2)}function So(t,e){return Qi(1+Kn.count(gr(t),t),e,3)}function Co(t,e){return Qi(t.getMilliseconds(),e,3)}function Oo(t,e){return Co(t,e)+"000"}function Fo(t,e){return Qi(t.getMonth()+1,e,2)}function Mo(t,e){return Qi(t.getMinutes(),e,2)}function $o(t,e){return Qi(t.getSeconds(),e,2)}function No(t){var e=t.getDay();return 0===e?7:e}function Bo(t,e){return Qi(Jn.count(gr(t)-1,t),e,2)}function To(t){var e=t.getDay();return e>=4||0===e?er(t):er.ceil(t)}function jo(t,e){return t=To(t),Qi(er.count(gr(t),t)+(4===gr(t).getDay()),e,2)}function Io(t){return t.getDay()}function zo(t,e){return Qi(Zn.count(gr(t)-1,t),e,2)}function Ro(t,e){return Qi(t.getFullYear()%100,e,2)}function Po(t,e){return Qi((t=To(t)).getFullYear()%100,e,2)}function Lo(t,e){return Qi(t.getFullYear()%1e4,e,4)}function qo(t,e){var n=t.getDay();return Qi((t=n>=4||0===n?er(t):er.ceil(t)).getFullYear()%1e4,e,4)}function Uo(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Qi(e/60|0,"0",2)+Qi(e%60,"0",2)}function Wo(t,e){return Qi(t.getUTCDate(),e,2)}function Vo(t,e){return Qi(t.getUTCHours(),e,2)}function Ho(t,e){return Qi(t.getUTCHours()%12||12,e,2)}function Go(t,e){return Qi(1+or.count(Sr(t),t),e,3)}function Xo(t,e){return Qi(t.getUTCMilliseconds(),e,3)}function Ko(t,e){return Xo(t,e)+"000"}function Yo(t,e){return Qi(t.getUTCMonth()+1,e,2)}function Jo(t,e){return Qi(t.getUTCMinutes(),e,2)}function Zo(t,e){return Qi(t.getUTCSeconds(),e,2)}function Qo(t){var e=t.getUTCDay();return 0===e?7:e}function ta(t,e){return Qi(sr.count(Sr(t)-1,t),e,2)}function ea(t){var e=t.getUTCDay();return e>=4||0===e?fr(t):fr.ceil(t)}function na(t,e){return t=ea(t),Qi(fr.count(Sr(t),t)+(4===Sr(t).getUTCDay()),e,2)}function ra(t){return t.getUTCDay()}function ia(t,e){return Qi(ur.count(Sr(t)-1,t),e,2)}function oa(t,e){return Qi(t.getUTCFullYear()%100,e,2)}function aa(t,e){return Qi((t=ea(t)).getUTCFullYear()%100,e,2)}function sa(t,e){return Qi(t.getUTCFullYear()%1e4,e,4)}function ua(t,e){var n=t.getUTCDay();return Qi((t=n>=4||0===n?fr(t):fr.ceil(t)).getUTCFullYear()%1e4,e,4)}function la(){return"+0000"}function ca(){return"%"}function fa(t){return+t}function ha(t){return Math.floor(+t/1e3)}function da(t){const e={};return n=>e[n]||(e[n]=t(n))}function pa(t){const e=da(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){const n=Sn(t||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(t,e){return n=>{const r=t(n),i=r.indexOf(e);if(i<0)return r;let o=function(t,e){let n,r=t.lastIndexOf("e");if(r>0)return r;for(r=t.length;--r>e;)if(n=t.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const a=o<r.length?r.slice(o):"";for(;--o>i;)if("0"!==r[o]){++o;break}return r.slice(0,o)+a}}(e(n),e(".1f")(1)[1])}return e(n)},formatSpan(t,r,i,o){o=Sn(null==o?",f":o);const a=An(t,r,i),s=Math.max(Math.abs(t),Math.abs(r));let u;if(null==o.precision)switch(o.type){case"s":return isNaN(u=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Fn(e)/3)))-Fn(Math.abs(t)))}(a,s))||(o.precision=u),n(o,s);case"":case"e":case"g":case"p":case"r":isNaN(u=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Fn(e)-Fn(t))+1}(a,s))||(o.precision=u-("e"===o.type));break;case"f":case"%":isNaN(u=function(t){return Math.max(0,-Fn(Math.abs(t)))}(a))||(o.precision=u-2*("%"===o.type))}return e(o)}}}let ga,ma;function ya(){return ga=pa({format:Tn,formatPrefix:jn})}function va(t){return pa(Rn(t))}function ba(t){return arguments.length?ga=va(t):ga}function xa(t,e,n){kt(n=n||{})||at("Invalid time multi-format specifier: ".concat(n));const r=e(Vr),i=e(Wr),o=e(Ur),a=e(Pr),s=e(Rr),u=e(zr),l=e(Ir),c=e(jr),f=t(n[Hr]||".%L"),h=t(n[Vr]||":%S"),d=t(n[Wr]||"%I:%M"),p=t(n[Ur]||"%I %p"),g=t(n[Pr]||n[Lr]||"%a %d"),m=t(n[Rr]||"%b %d"),y=t(n[zr]||"%B"),v=t(n[Ir]||"%B"),b=t(n[jr]||"%Y");return t=>(r(t)<t?f:i(t)<t?h:o(t)<t?d:a(t)<t?p:u(t)<t?s(t)<t?g:m:c(t)<t?l(t)<t?y:v:b)(t)}function wa(t){const e=da(t.format),n=da(t.utcFormat);return{timeFormat:t=>ve(t)?e(t):xa(e,_i,t),utcFormat:t=>ve(t)?n(t):xa(n,ki,t),timeParse:da(t.parse),utcParse:da(t.utcParse)}}function _a(){return ma=wa({format:Vi,parse:Hi,utcFormat:Gi,utcParse:Xi})}function ka(t){return wa(Ui(t))}function Aa(t){return arguments.length?ma=ka(t):ma}Wi=Ui({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Vi=Wi.format,Hi=Wi.parse,Gi=Wi.utcFormat,Xi=Wi.utcParse,ya(),_a();const Ea=(t,e)=>re({},t,e);function Da(t,e){const n=t?va(t):ba(),r=e?ka(e):Aa();return Ea(n,r)}function Sa(t,e){const n=arguments.length;return n&&2!==n&&at("defaultLocale expects either zero or two arguments."),n?Ea(ba(t),Aa(e)):Ea(ba(),Aa())}function Ca(){return ya(),_a(),Sa()}function Oa(t,e,n,r){const i=yn((e=e||{}).type||"json");return i||at("Unknown data format type: "+e.type),t=i(t,e),e.parse&&function(t,e,n,r){if(!t.length)return;const i=Aa();n=n||i.timeParse,r=r||i.utcParse;let o,a,s,u,l,c,f=t.columns||Object.keys(t[0]);"auto"===e&&(e=Ke(t,f)),f=Object.keys(e);const h=f.map((t=>{const i=e[t];let o,a;if(i&&(i.startsWith("date:")||i.startsWith("utc:")))return o=i.split(/:(.+)?/,2),a=o[1],("'"===a[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1)),("utc"===o[0]?r:n)(a);if(!Ve[i])throw Error("Illegal format pattern: "+t+":"+i);return Ve[i]}));for(s=0,l=t.length,c=f.length;s<l;++s)for(o=t[s],u=0;u<c;++u)a=f[u],o[a]=h[u](o[a])}(t,e.parse,n,r),se(t,"columns")&&delete t.columns,t}const Fa=function(t,e){return e=>({options:e||{},sanitize:Re,load:ze,fileAccess:!1,file:Pe(null),http:qe(t)})}("undefined"!=typeof fetch&&fetch);function Ma(t){const e=t||ct,n=[],r={};return n.add=t=>{const i=e(t);return r[i]||(r[i]=1,n.push(t)),n},n.remove=t=>{const i=e(t);if(r[i]){r[i]=0;const e=n.indexOf(t);e>=0&&n.splice(e,1)}return n},n}async function $a(t,e){try{await e(t)}catch(e){t.error(e)}}const Na=Symbol("vega_id");let Ba=1;function Ta(t){return!(!t||!ja(t))}function ja(t){return t[Na]}function Ia(t,e){return t[Na]=e,t}function za(t){const e=t===Object(t)?t:{data:t};return ja(e)?e:Ia(e,Ba++)}function Ra(t){return Pa(t,za({}))}function Pa(t,e){for(const n in t)e[n]=t[n];return e}function La(t,e){return Ia(e,ja(t))}function qa(t,e){return t?e?(n,r)=>t(n,r)||ja(e(n))-ja(e(r)):(e,n)=>t(e,n)||ja(e)-ja(n):null}function Ua(t){return t&&t.constructor===Wa}function Wa(){const t=[],e=[],n=[],r=[],i=[];let o=null,a=!1;return{constructor:Wa,insert(e){const n=Gt(e),r=n.length;for(let e=0;e<r;++e)t.push(n[e]);return this},remove(t){const n=Kt(t)?r:e,i=Gt(t),o=i.length;for(let t=0;t<o;++t)n.push(i[t]);return this},modify(t,e,r){const o={field:e,value:ee(r)};return Kt(t)?(o.filter=t,i.push(o)):(o.tuple=t,n.push(o)),this},encode(t,e){return Kt(t)?i.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean(t){return o=t,this},reflow(){return a=!0,this},pulse(s,u){const l={},c={};let f,h,d,p,g,m;for(f=0,h=u.length;f<h;++f)l[ja(u[f])]=1;for(f=0,h=e.length;f<h;++f)g=e[f],l[ja(g)]=-1;for(f=0,h=r.length;f<h;++f)p=r[f],u.forEach((t=>{p(t)&&(l[ja(t)]=-1)}));for(f=0,h=t.length;f<h;++f)g=t[f],m=ja(g),l[m]?l[m]=1:s.add.push(za(t[f]));for(f=0,h=u.length;f<h;++f)g=u[f],l[ja(g)]<0&&s.rem.push(g);function y(t,e,n){n?t[e]=n(t):s.encode=e,a||(c[ja(t)]=t)}for(f=0,h=n.length;f<h;++f)d=n[f],g=d.tuple,p=d.field,m=l[ja(g)],m>0&&(y(g,p,d.value),s.modifies(p));for(f=0,h=i.length;f<h;++f)d=i[f],p=d.filter,u.forEach((t=>{p(t)&&l[ja(t)]>0&&y(t,d.field,d.value)})),s.modifies(d.field);if(a)s.mod=e.length||r.length?u.filter((t=>l[ja(t)]>0)):u.slice();else for(m in c)s.mod.push(c[m]);return(o||null==o&&(e.length||r.length))&&s.clean(!0),s}}}const Va="_:mod:_";function Ha(){Object.defineProperty(this,Va,{writable:!0,value:{}})}Ha.prototype={set(t,e,n,r){const i=this,o=i[t],a=i[Va];return null!=e&&e>=0?(o[e]!==n||r)&&(o[e]=n,a[e+":"+t]=-1,a[t]=-1):(o!==n||r)&&(i[t]=n,a[t]=_t(n)?1+n.length:-1),i},modified(t,e){const n=this[Va];if(!arguments.length){for(const t in n)if(n[t])return!0;return!1}if(_t(t)){for(let e=0;e<t.length;++e)if(n[t[e]])return!0;return!1}return null!=e&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[Va]={},this}};let Ga=0;const Xa=new Ha;function Ka(t,e,n,r){this.id=++Ga,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,r)}function Ya(t){return function(e){const n=this.flags;return 0===arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}Ka.prototype={targets(){return this._targets||(this._targets=Ma(lt))},set(t){return this.value!==t?(this.value=t,1):0},skip:Ya(1),modified:Ya(2),parameters(t,e,n){e=!1!==e;const r=this._argval=this._argval||new Ha,i=this._argops=this._argops||[],o=[];let a,s,u,l;const c=(t,n,a)=>{a instanceof Ka?(a!==this&&(e&&a.targets().add(this),o.push(a)),i.push({op:a,name:t,index:n})):r.set(t,n,a)};for(a in t)if(s=t[a],"pulse"===a)Gt(s).forEach((t=>{t instanceof Ka?t!==this&&(t.targets().add(this),o.push(t)):at("Pulse parameters must be operator instances.")})),this.source=s;else if(_t(s))for(r.set(a,-1,Array(u=s.length)),l=0;l<u;++l)c(a,l,s[l]);else c(a,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),o},marshall(t){const e=this._argval||Xa,n=this._argops;let r,i,o,a;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],o=r.op,a=o.modified()&&o.stamp===t,e.set(r.name,r.index,o.value,a);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return e},detach(){const t=this._argops;let e,n,r,i;if(t)for(e=0,n=t.length;e<n;++e)r=t[e],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),r=e.call(this,n,t);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return t.StopPropagation}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t}};let Ja=0;function Za(t,e,n){this.id=++Ja,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function Qa(t,e,n){return new Za(t,e,n)}Za.prototype={_filter:dt,_apply:ct,targets(){return this._targets||(this._targets=Ma(lt))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,r=n?n.length:0;for(let t=0;t<r;++t)n[t].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){const e=Qa(t);return this.targets().add(e),e},apply(t){const e=Qa(null,t);return this.targets().add(e),e},merge(){const t=Qa();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter((()=>{const n=Date.now();return n-e>t?(e=n,1):0}))},debounce(t){const e=Qa();return this.targets().add(Qa(null,null,ne(t,(t=>{const n=t.dataflow;e.receive(t),n&&n.run&&n.run()})))),e},between(t,e){let n=!1;return t.targets().add(Qa(null,null,(()=>n=!0))),e.targets().add(Qa(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){this._filter=dt,this._targets=null}};const ts={skip:!0};function es(t,e,n,r,i,o){const a=re({},o,ts);let s,u;Kt(n)||(n=ee(n)),void 0===r?s=e=>t.touch(n(e)):Kt(r)?(u=new Ka(null,r,i,!1),s=e=>{u.evaluate(e);const r=n(e),i=u.value;Ua(i)?t.pulse(r,i,o):t.update(r,i,a)}):s=e=>t.update(n(e),r,a),e.apply(s)}function ns(t,e,n,r,i,o){if(void 0===r)e.targets().add(n);else{const a=o||{},s=new Ka(null,function(t,e){return e=Kt(e)?e:ee(e),t?function(n,r){const i=e(n,r);return t.skip()||(t.skip(i!==this.value).value=i),i}:e}(n,r),i,!1);s.modified(a.force),s.rank=e.rank,e.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),t.connect(n,[s]))}}const rs={};function is(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function os(t,e){const n=[];return Ne(t,e,(t=>n.push(t))),n}function as(t,e){const n={};return t.visit(e,(t=>{n[ja(t)]=1})),t=>n[ja(t)]?null:t}function ss(t,e){return t?(n,r)=>t(n,r)&&e(n,r):e}function us(t,e,n,r){const i=this,o=n.length;let a=0;this.dataflow=t,this.stamp=e,this.fields=null,this.encode=r||null,this.pulses=n;for(let t=0;t<o;++t){const r=n[t];if(r.stamp===e){if(r.fields){const t=i.fields||(i.fields={});for(const e in r.fields)t[e]=1}r.changed(i.ADD)&&(a|=i.ADD),r.changed(i.REM)&&(a|=i.REM),r.changed(i.MOD)&&(a|=i.MOD)}}this.changes=a}function ls(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}is.prototype={StopPropagation:rs,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(t){return new is(this.dataflow).init(this,t)},clone(){const t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},addAll(){let t=this;return!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length||(t=new is(this.dataflow).init(this),t.add=t.source,t.rem=[]),t},init(t,e){const n=this;return n.stamp=t.stamp,n.encode=t.encode,!t.fields||64&e||(n.fields=t.fields),1&e?(n.addF=t.addF,n.add=t.add):(n.addF=null,n.add=[]),2&e?(n.remF=t.remF,n.rem=t.rem):(n.remF=null,n.rem=[]),4&e?(n.modF=t.modF,n.mod=t.mod):(n.modF=null,n.mod=[]),32&e?(n.srcF=null,n.source=null):(n.srcF=t.srcF,n.source=t.source,t.cleans&&(n.cleans=t.cleans)),n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},reflow(t){if(t)return this.fork(7).reflow();const e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,as(this,1))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){const e=this.fields||(this.fields={});return _t(t)?t.forEach((t=>e[t]=!0)):e[t]=!0,this},modified(t,e){const n=this.fields;return!(!e&&!this.mod.length||!n)&&(arguments.length?_t(t)?t.some((t=>n[t])):n[t]:!!n)},filter(t,e){const n=this;return 1&t&&(n.addF=ss(n.addF,e)),2&t&&(n.remF=ss(n.remF,e)),4&t&&(n.modF=ss(n.modF,e)),16&t&&(n.srcF=ss(n.srcF,e)),n},materialize(t){const e=this;return 1&(t=t||7)&&e.addF&&(e.add=os(e.add,e.addF),e.addF=null),2&t&&e.remF&&(e.rem=os(e.rem,e.remF),e.remF=null),4&t&&e.modF&&(e.mod=os(e.mod,e.modF),e.modF=null),16&t&&e.srcF&&(e.source=e.source.filter(e.srcF),e.srcF=null),e},visit(t,e){const n=this,r=e;if(16&t)return Ne(n.source,n.srcF,r),n;1&t&&Ne(n.add,n.addF,r),2&t&&Ne(n.rem,n.remF,r),4&t&&Ne(n.mod,n.modF,r);const i=n.source;if(8&t&&i){const t=n.add.length+n.mod.length;t===i.length||Ne(i,t?as(n,5):n.srcF,r)}return n}},fe(us,is,{fork(t){const e=new is(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,(t=>e.add.push(t))),t&e.REM&&this.visit(e.REM,(t=>e.rem.push(t))),t&e.MOD&&this.visit(e.MOD,(t=>e.mod.push(t)))),e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return n&&e.changes&e.MOD?_t(t)?t.some((t=>n[t])):n[t]:0},filter(){at("MultiPulse does not support filtering.")},materialize(){at("MultiPulse does not support materialization.")},visit(t,e){const n=this,r=n.pulses,i=r.length;let o=0;if(t&n.SOURCE)for(;o<i;++o)r[o].visit(t,e);else for(;o<i;++o)r[o].stamp===n.stamp&&r[o].visit(t,e);return n}});const cs={skip:!1,force:!1};function fs(t,e,n,r){let i,o;const a=t[n];for(;n>e&&(o=n-1>>1,i=t[o],r(a,i)<0);)t[n]=i,n=o;return t[n]=a}function hs(){this.logger(wt()),this.logLevel(yt),this._clock=0,this._rank=0,this._locale=Sa();try{this._loader=Fa()}catch(t){}this._touched=Ma(lt),this._input={},this._pulse=null,this._heap=function(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),fs(e,0,e.length-1,t)),pop:()=>{const n=e.pop();let r;return e.length?(r=e[0],e[0]=n,function(t,e,n){const r=e,i=t.length,o=t[e];let a,s=1+(e<<1);for(;s<i;)a=s+1,a<i&&n(t[s],t[a])>=0&&(s=a),t[e]=t[s],s=1+((e=s)<<1);t[e]=o,fs(t,r,e,n)}(e,0,t)):r=n,r}}}(((t,e)=>t.qrank-e.qrank)),this._postrun=[]}function ds(t){return function(){return this._log[t].apply(this,arguments)}}function ps(t,e){Ka.call(this,t,null,e)}hs.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:ds("error"),warn:ds("warn"),info:ds("info"),debug:ds("debug"),logLevel:ds("level"),cleanThreshold:1e4,add:function(t,e,n,r){let i,o=1;return t instanceof Ka?i=t:t&&t.prototype instanceof Ka?i=new t:Kt(t)?i=new Ka(null,t):(o=0,i=new Ka(t,e)),this.rank(i),o&&(r=n,n=e),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(t,e){const n=t.rank,r=e.length;for(let i=0;i<r;++i)if(n<e[i].rank)return void this.rerank(t)},rank:function(t){t.rank=++this._rank},rerank:function(t){const e=[t];let n,r,i;for(;e.length;)if(this.rank(n=e.pop()),r=n._targets)for(i=r.length;--i>=0;)e.push(n=r[i]),n===t&&at("Cycle detected in dataflow graph.")},pulse:function(t,e,n){this.touch(t,n||cs);const r=new is(this,this._clock+(this._pulse?0:1)),i=t.pulse&&t.pulse.source||[];return r.target=t,this._input[t.id]=e.pulse(r,i),this},touch:function(t,e){const n=e||cs;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},update:function(t,e,n){const r=n||cs;return(t.set(e)||r.force)&&this.touch(t,r),this},changeset:Wa,ingest:function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},parse:function(t,e){const n=this.locale();return Oa(t,e,n.timeParse,n.utcParse)},preload:async function(t,e,n){const r=this,i=r._pending||function(t){let e;const n=new Promise((t=>e=t));return n.requests=0,n.done=()=>{0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(r);i.requests+=1;const o=await r.request(e,n);return r.pulse(t,r.changeset().remove(dt).insert(o.data||[])),i.done(),o},request:async function(t,e){const n=this;let r,i=0;try{r=await n.loader().load(t,{context:"dataflow",response:vn(e&&e.type)});try{r=n.parse(r,e)}catch(e){i=-2,n.warn("Data ingestion failed",t,e)}}catch(e){i=-1,n.warn("Loading failed",t,e)}return{data:r,status:i}},events:function(t,e,n,r){const i=this,o=Qa(n,r),a=function(t){t.dataflow=i;try{o.receive(t)}catch(t){i.error(t)}finally{i.run()}};let s;s="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):Gt(t);const u=s.length;for(let t=0;t<u;++t)s[t].addEventListener(e,a);return o},on:function(t,e,n,r,i){return(t instanceof Ka?ns:es)(this,t,e,n,r,i),this},evaluate:async function(t,e,n){const r=this,i=[];if(r._pulse)return ls(r);if(r._pending&&await r._pending,e&&await $a(r,e),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const o=++r._clock;r._pulse=new is(r,o,t),r._touched.forEach((t=>r._enqueue(t,!0))),r._touched=Ma(lt);let a,s,u,l=0;try{for(;r._heap.size()>0;)a=r._heap.pop(),a.rank===a.qrank?(s=a.run(r._getPulse(a,t)),s.then?s=await s:s.async&&(i.push(s.async),s=rs),s!==rs&&a._targets&&a._targets.forEach((t=>r._enqueue(t))),++l):r._enqueue(a,!0)}catch(t){r._heap.clear(),u=t}if(r._input={},r._pulse=null,r.debug(`Pulse ${o}: ${l} operators`),u&&(r._postrun=[],r.error(u)),r._postrun.length){const t=r._postrun.sort(((t,e)=>e.priority-t.priority));r._postrun=[];for(let e=0;e<t.length;++e)await $a(r,t[e].callback)}return n&&await $a(r,n),i.length&&Promise.all(i).then((t=>r.runAsync(null,(()=>{t.forEach((t=>{try{t(r)}catch(t){r.error(t)}}))})))),r},run:function(t,e,n){return this._pulse?ls(this):(this.evaluate(t,e,n),this)},runAsync:async function(t,e,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(r,r),this._running},runAfter:function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},_enqueue:function(t,e){const n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},_getPulse:function(t,e){const n=t.source,r=this._clock;return n&&_t(n)?new us(this,r,n.map((t=>t.pulse)),e):this._input[t.id]||function(t,e){return e&&e.stamp===t.stamp?e:(t=t.fork(),e&&e!==rs&&(t.source=e.source),t)}(this._pulse,n&&n.pulse)}},fe(ps,Ka,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;return this.skip()?this.skip(!1):e=this.evaluate(t),e=e||t,e.then?e=e.then((t=>this.pulse=t)):e!==t.StopPropagation&&(this.pulse=e),e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});const gs={};function ms(t){const e=ys(t);return e&&e.Definition||null}function ys(t){return t=t&&t.toLowerCase(),se(gs,t)?gs[t]:null}function vs(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function bs(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function xs(t,e,n=0,r=t.length-1,i=Br){for(;r>n;){if(r-n>600){const o=r-n+1,a=e-n+1,s=Math.log(o),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(o-u)/o)*(a-o/2<0?-1:1);xs(t,e,Math.max(n,Math.floor(e-a*u/o+l)),Math.min(r,Math.floor(e+(o-a)*u/o+l)),i)}const o=t[e];let a=n,s=r;for(ws(t,n,e),i(t[r],o)>0&&ws(t,n,r);a<s;){for(ws(t,a,s),++a,--s;i(t[a],o)<0;)++a;for(;i(t[s],o)>0;)--s}0===i(t[n],o)?ws(t,n,s):(++s,ws(t,s,r)),s<=e&&(n=s+1),e<=s&&(r=s-1)}return t}function ws(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function _s(t){return null===t?NaN:+t}function ks(t,e,n){if(r=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)null!=(r=e(r,++n,t))&&(r=+r)>=r&&(yield r)}}(t,n))).length){if((e=+e)<=0||r<2)return bs(t);if(e>=1)return vs(t);var r,i=(r-1)*e,o=Math.floor(i),a=vs(xs(t,o).subarray(0,o+1));return a+(bs(t.subarray(o+1))-a)*(i-o)}}function As(t,e,n=_s){if(r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t);return a+(+n(t[o+1],o+1,t)-a)*(i-o)}}function Es(t,e){return ks(t,.5,e)}function*Ds(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)r=e(r,++n,t),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function Ss(t,e,n){const r=Float64Array.from(Ds(t,n));return r.sort(Br),e.map((t=>As(r,t)))}function Cs(t,e){return Ss(t,[.25,.5,.75],e)}function Os(t,e){const n=t.length,r=function(t,e){const n=function(t,e){let n,r=0,i=0,o=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-i,i+=n/++r,o+=n*(e-i));else{let a=-1;for(let s of t)null!=(s=e(s,++a,t))&&(s=+s)>=s&&(n=s-i,i+=n/++r,o+=n*(s-i))}if(r>1)return o/(r-1)}(t,e);return n?Math.sqrt(n):n}(t,e),i=Cs(t,e),o=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,o)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Fs(t){const e=t.maxbins||20,n=t.base||10,r=Math.log(n),i=t.divide||[5,2];let o,a,s,u,l,c,f=t.extent[0],h=t.extent[1];const d=t.span||h-f||Math.abs(f)||1;if(t.step)o=t.step;else if(t.steps){for(u=d/e,l=0,c=t.steps.length;l<c&&t.steps[l]<u;++l);o=t.steps[Math.max(0,l-1)]}else{for(a=Math.ceil(Math.log(e)/r),s=t.minstep||0,o=Math.max(s,Math.pow(n,Math.round(Math.log(d)/r)-a));Math.ceil(d/o)>e;)o*=n;for(l=0,c=i.length;l<c;++l)u=o/i[l],u>=s&&d/u<=e&&(o=u)}u=Math.log(o);const p=u>=0?0:1+~~(-u/r),g=Math.pow(n,-p-1);return(t.nice||void 0===t.nice)&&(u=Math.floor(f/o+g)*o,f=f<u?u-o:u,h=Math.ceil(h/o)*o),{start:f,stop:h===f?f+o:h,step:o}}var Ms=Math.random;function $s(t){Ms=t}function Ns(t,e,n,r){if(!t.length)return[void 0,void 0];const i=Float64Array.from(Ds(t,r)),o=i.length,a=e;let s,u,l,c;for(l=0,c=Array(a);l<a;++l){for(s=0,u=0;u<o;++u)s+=i[~~(Ms()*o)];c[l]=s/o}return c.sort(Br),[ks(c,n/2),ks(c,1-n/2)]}function Bs(t,e,n,r){r=r||(t=>t);const i=t.length,o=new Float64Array(i);let a,s=0,u=1,l=r(t[0]),c=l,f=l+e;for(;u<i;++u){if(a=r(t[u]),a>=f){for(c=(l+c)/2;s<u;++s)o[s]=c;f=a+e,l=a}c=a}for(c=(l+c)/2;s<u;++s)o[s]=c;return n?function(t,e){const n=t.length;let r,i,o=0,a=1;for(;t[o]===t[a];)++a;for(;a<n;){for(r=a+1;t[a]===t[r];)++r;if(t[a]-t[a-1]<e){for(i=a+(o+r-a-a>>1);i<a;)t[i++]=t[a];for(;i>a;)t[i--]=t[o]}o=a,a=r}return t}(o,e+e/4):o}function Ts(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}}function js(t,e){let n,r,i;null==e&&(e=t,t=0);const o={min(t){return arguments.length?(n=t||0,i=r-n,o):n},max(t){return arguments.length?(r=t||0,i=r-n,o):r},sample:()=>n+Math.floor(i*Ms()),pdf:t=>t===Math.floor(t)&&t>=n&&t<r?1/i:0,cdf(t){const e=Math.floor(t);return e<n?0:e>=r?1:(e-n+1)/i},icdf:t=>t>=0&&t<=1?n-1+Math.floor(t*i):NaN};return o.min(t).max(e)}const Is=Math.sqrt(2*Math.PI),zs=Math.SQRT2;let Rs=NaN;function Ps(t,e){t=t||0,e=null==e?1:e;let n,r,i=0,o=0;if(Rs==Rs)i=Rs,Rs=NaN;else{do{i=2*Ms()-1,o=2*Ms()-1,n=i*i+o*o}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,Rs=o*r}return t+i*e}function Ls(t,e,n){const r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Is)}function qs(t,e,n){const r=(t-(e=e||0))/(n=null==n?1:n),i=Math.abs(r);let o;if(i>37)o=0;else{const t=Math.exp(-i*i/2);let e;i<7.07106781186547?(e=.0352624965998911*i+.700383064443688,e=e*i+6.37396220353165,e=e*i+33.912866078383,e=e*i+112.079291497871,e=e*i+221.213596169931,e=e*i+220.206867912376,o=t*e,e=.0883883476483184*i+1.75566716318264,e=e*i+16.064177579207,e=e*i+86.7807322029461,e=e*i+296.564248779674,e=e*i+637.333633378831,e=e*i+793.826512519948,e=e*i+440.413735824752,o/=e):(e=i+.65,e=i+4/e,e=i+3/e,e=i+2/e,e=i+1/e,o=t/e/2.506628274631)}return r>0?1-o:o}function Us(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*zs*function(t){let e,n=-Math.log((1-t)*(1+t));return n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0,e*t}(2*t-1)}function Ws(t,e){let n,r;const i={mean(t){return arguments.length?(n=t||0,i):n},stdev(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Ps(n,r),pdf:t=>Ls(t,n,r),cdf:t=>qs(t,n,r),icdf:t=>Us(t,n,r)};return i.mean(t).stdev(e)}function Vs(t,e){const n=Ws();let r=0;const i={data(n){return arguments.length?(t=n,r=n?n.length:0,i.bandwidth(e)):t},bandwidth(n){return arguments.length?(!(e=n)&&t&&(e=Os(t)),i):e},sample:()=>t[~~(Ms()*r)]+e*n.sample(),pdf(i){let o=0,a=0;for(;a<r;++a)o+=n.pdf((i-t[a])/e);return o/e/r},cdf(i){let o=0,a=0;for(;a<r;++a)o+=n.cdf((i-t[a])/e);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(t)}function Hs(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+Ps()*e)}function Gs(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*Is*t)}function Xs(t,e,n){return qs(Math.log(t),e,n)}function Ks(t,e,n){return Math.exp(Us(t,e,n))}function Ys(t,e){let n,r;const i={mean(t){return arguments.length?(n=t||0,i):n},stdev(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Hs(n,r),pdf:t=>Gs(t,n,r),cdf:t=>Xs(t,n,r),icdf:t=>Ks(t,n,r)};return i.mean(t).stdev(e)}function Js(t,e){let n,r=0;const i={weights(t){return arguments.length?(n=function(t){const e=[];let n,i=0;for(n=0;n<r;++n)i+=e[n]=null==t[n]?1:+t[n];for(n=0;n<r;++n)e[n]/=i;return e}(e=t||[]),i):e},distributions(n){return arguments.length?(n?(r=n.length,t=n):(r=0,t=[]),i.weights(e)):t},sample(){const e=Ms();let i=t[r-1],o=n[0],a=0;for(;a<r-1;o+=n[++a])if(e<o){i=t[a];break}return i.sample()},pdf(e){let i=0,o=0;for(;o<r;++o)i+=n[o]*t[o].pdf(e);return i},cdf(e){let i=0,o=0;for(;o<r;++o)i+=n[o]*t[o].cdf(e);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(t).weights(e)}function Zs(t,e){return null==e&&(e=null==t?1:t,t=0),t+(e-t)*Ms()}function Qs(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function tu(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function eu(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function nu(t,e){let n,r;const i={min(t){return arguments.length?(n=t||0,i):n},max(t){return arguments.length?(r=null==t?1:t,i):r},sample:()=>Zs(n,r),pdf:t=>Qs(t,n,r),cdf:t=>tu(t,n,r),icdf:t=>eu(t,n,r)};return null==e&&(e=null==t?1:t,t=0),i.min(t).max(e)}function ru(t,e,n,r){const i=r-t*t,o=Math.abs(i)<1e-24?0:(n-t*e)/i;return[e-o*t,o]}function iu(t,e,n,r){t=t.filter((t=>{let r=e(t),i=n(t);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&t.sort(((t,n)=>e(t)-e(n)));const i=t.length,o=new Float64Array(i),a=new Float64Array(i);let s,u,l,c=0,f=0,h=0;for(l of t)o[c]=s=+e(l),a[c]=u=+n(l),++c,f+=(s-f)/c,h+=(u-h)/c;for(c=0;c<i;++c)o[c]-=f,a[c]-=h;return[o,a,f,h]}function ou(t,e,n,r){let i,o,a=-1;for(const s of t)i=e(s),o=n(s),null!=i&&(i=+i)>=i&&null!=o&&(o=+o)>=o&&r(i,o,++a)}function au(t,e,n,r,i){let o=0,a=0;return ou(t,e,n,((t,e)=>{const n=e-i(t),s=e-r;o+=n*n,a+=s*s})),1-o/a}function su(t,e,n){let r=0,i=0,o=0,a=0,s=0;ou(t,e,n,((t,e)=>{++s,r+=(t-r)/s,i+=(e-i)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const u=ru(r,i,o,a),l=t=>u[0]+u[1]*t;return{coef:u,predict:l,rSquared:au(t,e,n,i,l)}}function uu(t,e,n){let r=0,i=0,o=0,a=0,s=0;ou(t,e,n,((t,e)=>{++s,t=Math.log(t),r+=(t-r)/s,i+=(e-i)/s,o+=(t*e-o)/s,a+=(t*t-a)/s}));const u=ru(r,i,o,a),l=t=>u[0]+u[1]*Math.log(t);return{coef:u,predict:l,rSquared:au(t,e,n,i,l)}}function lu(t,e,n){const[r,i,o,a]=iu(t,e,n);let s,u,l,c=0,f=0,h=0,d=0,p=0;ou(t,e,n,((t,e)=>{s=r[p++],u=Math.log(e),l=s*e,c+=(e*u-c)/p,f+=(l-f)/p,h+=(l*u-h)/p,d+=(s*l-d)/p}));const[g,m]=ru(f/a,c/a,h/a,d/a),y=t=>Math.exp(g+m*(t-o));return{coef:[Math.exp(g-m*o),m],predict:y,rSquared:au(t,e,n,a,y)}}function cu(t,e,n){let r=0,i=0,o=0,a=0,s=0,u=0;ou(t,e,n,((t,e)=>{const n=Math.log(t),l=Math.log(e);++u,r+=(n-r)/u,i+=(l-i)/u,o+=(n*l-o)/u,a+=(n*n-a)/u,s+=(e-s)/u}));const l=ru(r,i,o,a),c=t=>l[0]*Math.pow(t,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:au(t,e,n,s,c)}}function fu(t,e,n){const[r,i,o,a]=iu(t,e,n),s=r.length;let u,l,c,f,h=0,d=0,p=0,g=0,m=0;for(u=0;u<s;)l=r[u],c=i[u++],f=l*l,h+=(f-h)/u,d+=(f*l-d)/u,p+=(f*f-p)/u,g+=(l*c-g)/u,m+=(f*c-m)/u;const y=p-h*h,v=h*y-d*d,b=(m*h-g*d)/v,x=(g*y-m*d)/v,w=-b*h,_=t=>b*(t-=o)*t+x*t+w+a;return{coef:[w-x*o+b*o*o+a,x-2*b*o,b],predict:_,rSquared:au(t,e,n,a,_)}}function hu(t,e,n,r){if(1===r)return su(t,e,n);if(2===r)return fu(t,e,n);const[i,o,a,s]=iu(t,e,n),u=i.length,l=[],c=[],f=r+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h)*o[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h+d);m[d]=g}c.push(m)}c.push(l);const y=function(t){const e=t.length-1,n=[];let r,i,o,a,s;for(r=0;r<e;++r){for(a=r,i=r+1;i<e;++i)Math.abs(t[r][i])>Math.abs(t[r][a])&&(a=i);for(o=r;o<e+1;++o)s=t[o][r],t[o][r]=t[o][a],t[o][a]=s;for(i=r+1;i<e;++i)for(o=e;o>=r;o--)t[o][i]-=t[o][r]*t[r][i]/t[r][r]}for(i=e-1;i>=0;--i){for(s=0,o=i+1;o<e;++o)s+=t[o][i]*n[o];n[i]=(t[e][i]-s)/t[i][i]}return n}(c),v=t=>{t-=a;let e=s+y[0]+y[1]*t+y[2]*t*t;for(h=3;h<f;++h)e+=y[h]*Math.pow(t,h);return e};return{coef:du(f,y,-a,s),predict:v,rSquared:au(t,e,n,s,v)}}function du(t,e,n,r){const i=Array(t);let o,a,s,u;for(o=0;o<t;++o)i[o]=0;for(o=t-1;o>=0;--o)for(s=e[o],u=1,i[o]+=s,a=1;a<=o;++a)u*=(o+1-a)/a,i[o-a]+=s*Math.pow(n,a)*u;return i[0]+=r,i}function pu(t,e,n,r){const[i,o,a,s]=iu(t,e,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let t=-1;++t<=2;){const e=[0,l-1];for(let t=0;t<u;++t){const n=i[t],r=e[0],a=e[1],s=n-i[r]>i[a]-n?r:a;let u=0,l=0,d=0,p=0,g=0;const m=1/Math.abs(i[s]-n||1);for(let t=r;t<=a;++t){const e=i[t],r=o[t],a=gu(Math.abs(n-e)*m)*h[t],s=e*a;u+=a,l+=s,d+=r*a,p+=r*s,g+=e*s}const[y,v]=ru(l/u,d/u,p/u,g/u);c[t]=y+v*n,f[t]=Math.abs(o[t]-c[t]),mu(i,t+1,e)}if(2===t)break;const n=Es(f);if(Math.abs(n)<1e-12)break;for(let t,e,r=0;r<u;++r)t=f[r]/(6*n),h[r]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,r){const i=t.length,o=[];let a,s=0,u=0,l=[];for(;s<i;++s)a=t[s]+n,l[0]===a?l[1]+=(e[s]-l[1])/++u:(u=0,l[1]+=r,l=[a,e[s]],o.push(l));return l[1]+=r,o}(i,c,a,s)}function gu(t){return(t=1-t*t*t)*t*t}function mu(t,e,n){const r=t[e];let i=n[0],o=n[1]+1;if(!(o>=t.length))for(;e>i&&t[o]-r<=r-t[i];)n[0]=++i,n[1]=o,++o}const yu=.1*Math.PI/180;function vu(t,e,n,r){n=n||25,r=Math.max(n,r||200);const i=e=>[e,t(e)],o=e[0],a=e[1],s=a-o,u=s/r,l=[i(o)],c=[];if(n===r){for(let t=1;t<r;++t)l.push(i(o+t/n*s));return l.push(i(a)),l}c.push(i(a));for(let t=n;--t>0;)c.push(i(o+t/n*s));let f=l[0],h=c[c.length-1];for(;h;){const t=i((f[0]+h[0])/2);t[0]-f[0]>=u&&bu(f,t,h)>yu?c.push(t):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function bu(t,e,n){const r=Math.atan2(n[1]-t[1],n[0]-t[0]),i=Math.atan2(e[1]-t[1],e[0]-t[0]);return Math.abs(r-i)}function xu(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}function wu(t){return t&&t.length?1===t.length?t[0]:(e=t,t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}):function(){return""};var e}function _u(t,e,n){return n||t+(e?"_"+e:"")}const ku=()=>{},Au={init:ku,add:ku,rem:ku,idx:0},Eu={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3}},Du=Object.keys(Eu);function Su(t,e){return Eu[t](e)}function Cu(t,e){return t.idx-e.idx}function Ou(){this.valid=0,this.missing=0,this._ops.forEach((t=>t.init(this)))}function Fu(t,e){null!=t&&""!==t?t==t&&(++this.valid,this._ops.forEach((n=>n.add(this,t,e)))):++this.missing}function Mu(t,e){null!=t&&""!==t?t==t&&(--this.valid,this._ops.forEach((n=>n.rem(this,t,e)))):--this.missing}function $u(t){return this._out.forEach((e=>t[e.out]=e.value(this))),t}function Nu(t,e){const n=e||ct,r=function(t){const e={};t.forEach((t=>e[t.name]=t));const n=t=>{t.req&&t.req.forEach((t=>{e[t]||n(e[t]=Eu[t]())}))};return t.forEach(n),Object.values(e).sort(Cu)}(t),i=t.slice().sort(Cu);function o(t){this._ops=r,this._out=i,this.cell=t,this.init()}return o.prototype.init=Ou,o.prototype.add=Fu,o.prototype.rem=Mu,o.prototype.set=$u,o.prototype.get=n,o.fields=t.map((t=>t.out)),o}function Bu(t){this._key=t?ut(t):ja,this.reset()}Du.forEach((t=>{Eu[t]=function(t,e){return n=>re({name:t,out:n||t},Au,e)}(t,Eu[t])}));const Tu=Bu.prototype;function ju(t){ps.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function Iu(t){ps.call(this,null,t)}function zu(t,e,n){const r=t;let i=e||[],o=n||[],a={},s=0;return{add:t=>o.push(t),remove:t=>a[r(t)]=++s,size:()=>i.length,data:(t,e)=>(s&&(i=i.filter((t=>!a[r(t)])),a={},s=0),e&&t&&i.sort(t),o.length&&(i=t?_e(t,i,o.sort(t)):i.concat(o),o=[]),i)}}function Ru(t){ps.call(this,[],t)}function Pu(t){Ka.call(this,null,Lu,t)}function Lu(t){return this.value&&!t.modified()?this.value:Yt(t.fields,t.orders)}function qu(t){ps.call(this,null,t)}function Uu(t){ps.call(this,null,t)}Tu.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Tu.add=function(t){this._add.push(t)},Tu.rem=function(t){this._rem.push(t)},Tu.values=function(){if(this._get=null,0===this._rem.length)return this._add;const t=this._add,e=this._rem,n=this._key,r=t.length,i=e.length,o=Array(r-i),a={};let s,u,l;for(s=0;s<i;++s)a[n(e[s])]=1;for(s=0,u=0;s<r;++s)a[n(l=t[s])]?a[n(l)]=0:o[u++]=l;return this._rem=[],this._add=o},Tu.distinct=function(t){const e=this.values(),n={};let r,i=e.length,o=0;for(;--i>=0;)r=t(e[i])+"",se(n,r)||(n[r]=1,++o);return o},Tu.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=oe(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},Tu.argmin=function(t){return this.extent(t)[0]||{}},Tu.argmax=function(t){return this.extent(t)[1]||{}},Tu.min=function(t){const e=this.extent(t)[0];return null!=e?t(e):void 0},Tu.max=function(t){const e=this.extent(t)[1];return null!=e?t(e):void 0},Tu.quartile=function(t){return this._get===t&&this._q||(this._q=Cs(this.values(),t),this._get=t),this._q},Tu.q1=function(t){return this.quartile(t)[0]},Tu.q2=function(t){return this.quartile(t)[1]},Tu.q3=function(t){return this.quartile(t)[2]},Tu.ci=function(t){return this._get===t&&this._ci||(this._ci=Ns(this.values(),1e3,.05,t),this._get=t),this._ci},Tu.ci0=function(t){return this.ci(t)[0]},Tu.ci1=function(t){return this.ci(t)[1]},ju.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Du},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},fe(ju,ps,{transform(t,e){const n=this,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.modified();return n.stamp=r.stamp,n.value&&(i||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(n.value=n.value||n.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),r.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const t=this,e=t.value,n=t._dnames,r=n.map((()=>({}))),i=n.length;function o(t){let e,o,a,s;for(e in t)for(a=t[e].tuple,o=0;o<i;++o)r[o][s=a[n[o]]]=s}o(t._prev),o(e),function o(a,s,u){const l=n[u],c=r[u++];for(const n in c){const r=a?a+"|"+n:n;s[l]=c[n],u<i?o(r,s,u):e[r]||t.cell(r,s)}}("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],r={};function i(t){const n=Gt(nt(t)),i=n.length;let o,a=0;for(;a<i;++a)r[o=n[a]]||(r[o]=1,e.push(o))}this._dims=Gt(t.groupby),this._dnames=this._dims.map((t=>{const e=et(t);return i(t),n.push(e),e})),this.cellkey=t.key?t.key:wu(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const o=t.fields||[null],a=t.ops||["count"],s=t.as||[],u=o.length,l={};let c,f,h,d,p,g;for(u!==a.length&&at("Unmatched number of fields and aggregate ops."),g=0;g<u;++g)c=o[g],f=a[g],null==c&&"count"!==f&&at("Null aggregate field specified."),d=et(c),p=_u(f,d,s[g]),n.push(p),"count"!==f?(h=l[d],h||(i(c),h=l[d]=[],h.field=c,this._measures.push(h)),"count"!==f&&(this._countOnly=!1),h.push(Su(f,p))):this._counts.push(p);return this._measures=this._measures.map((t=>Nu(t,t.field))),{}},cellkey:wu(),cell(t,e){let n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){const t=this._measures,e=t.length;n.agg=Array(e);for(let r=0;r<e;++r)n.agg[r]=new t[r](n)}return n.store&&(n.data=new Bu),n},newtuple(t,e){const n=this._dnames,r=this._dims,i=r.length,o={};for(let e=0;e<i;++e)o[n[e]]=r[e](t);return e?La(e.tuple,o):za(o)},clean(){const t=this.value;for(const e in t)0===t[e].num&&delete t[e]},add(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);const r=n.agg;for(let e=0,n=r.length;e<n;++e)r[e].add(r[e].get(t),t)},rem(t){const e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);const r=n.agg;for(let e=0,n=r.length;e<n;++e)r[e].rem(r[e].get(t),t)},celltuple(t){const e=t.tuple,n=this._counts;t.store&&t.data.values();for(let r=0,i=n.length;r<i;++r)e[n[r]]=t.num;if(!this._countOnly){const n=t.agg;for(let t=0,r=n.length;t<r;++t)n[t].set(e)}return e},changes(t){const e=this._adds,n=this._mods,r=this._prev,i=this._drop,o=t.add,a=t.rem,s=t.mod;let u,l,c,f;if(r)for(l in r)u=r[l],i&&!u.num||a.push(u.tuple);for(c=0,f=this._alen;c<f;++c)o.push(this.celltuple(e[c])),e[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(0===u.num&&i?a:s).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,t}}),Iu.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},fe(Iu,ps,{transform(t,e){const n=!1!==t.interval,r=this._bins(t),i=r.start,o=r.step,a=t.as||["bin0","bin1"],s=a[0],u=a[1];let l;return l=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(nt(t.field))?e.ADD_MOD:e.ADD,e.visit(l,n?t=>{const e=r(t);t[s]=e,t[u]=null==e?null:i+o*(1+(e-i)/o)}:t=>t[s]=r(t)),e.modifies(n?a:s)},_bins(t){if(this.value&&!t.modified())return this.value;const e=t.field,n=Fs(t),r=n.step;let i,o,a=n.start,s=a+Math.ceil((n.stop-a)/r)*r;null!=(i=t.anchor)&&(o=i-(a+r*Math.floor((i-a)/r)),a+=o,s+=o);const u=function(t){let n=Ot(e(t));return null==n?null:n<a?-1/0:n>s?1/0:(n=Math.max(a,Math.min(n,s-r)),a+r*Math.floor(1e-14+(n-a)/r))};return u.start=a,u.stop=n.stop,u.step=r,this.value=tt(u,nt(e),t.name||"bin_"+et(e))}}),Ru.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},fe(Ru,ps,{transform(t,e){const n=e.fork(e.ALL),r=zu(ja,this.value,n.materialize(n.ADD).add),i=t.sort,o=e.changed()||i&&(t.modified("sort")||e.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(o),this.value=n.source=r.data(qa(i),o),e.source&&e.source.root&&(this.value.root=e.source.root),n}}),fe(Pu,Ka),qu.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},fe(qu,ps,{transform(t,e){const n=e=>n=>{for(var r,i=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(s(n),t.case,o)||[],u=0,l=i.length;u<l;++u)a.test(r=i[u])||e(r)},r=this._parameterCheck(t,e),i=this._counts,o=this._match,a=this._stop,s=t.field,u=t.as||["text","count"],l=n((t=>i[t]=1+(i[t]||0))),c=n((t=>i[t]-=1));return r?e.visit(e.SOURCE,l):(e.visit(e.ADD,l),e.visit(e.REM,c)),this._finish(e,u)},_parameterCheck(t,e){let n=!1;return!t.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),!t.modified("pattern")&&this._match||(this._match=new RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){const n=this._counts,r=this._tuples||(this._tuples={}),i=e[0],o=e[1],a=t.fork(t.NO_SOURCE|t.NO_FIELDS);let s,u,l;for(s in n)u=r[s],l=n[s]||0,!u&&l?(r[s]=u=za({}),u[i]=s,u[o]=l,a.add.push(u)):0===l?(u&&a.rem.push(u),n[s]=null,r[s]=null):u[o]!==l&&(u[o]=l,a.mod.push(u));return a.modifies(e)}}),Uu.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},fe(Uu,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.as||["a","b"],i=r[0],o=r[1],a=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let s=this.value;return a?(s&&(n.rem=s),s=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,r){for(var i,o,a=[],s={},u=t.length,l=0;l<u;++l)for(s[e]=o=t[l],i=0;i<u;++i)s[n]=t[i],r(s)&&(a.push(za(s)),(s={})[e]=o);return a}(s,i,o,t.filter||dt)):n.mod=s,n.source=this.value,n.modifies(r)}});const Wu={kde:Vs,mixture:Js,normal:Ws,lognormal:Ys,uniform:nu};function Vu(t,e){const n=t.function;se(Wu,n)||at("Unknown distribution function: "+n);const r=Wu[n]();for(const n in t)"field"===n?r.data((t.from||e()).map(t[n])):"distributions"===n?r[n](t[n].map((t=>Vu(t,e)))):"function"==typeof r[n]&&r[n](t[n]);return r}function Hu(t){ps.call(this,null,t)}const Gu=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Xu={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Gu},{name:"weights",type:"number",array:!0}]};function Ku(t,e){return t?t.map(((t,n)=>e[n]||et(t))):null}function Yu(t,e,n){const r=[],i=t=>t(u);let o,a,s,u,l,c;if(null==e)r.push(t.map(n));else for(o={},a=0,s=t.length;a<s;++a)u=t[a],l=e.map(i),c=o[l],c||(o[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}function Ju(t){ps.call(this,null,t)}function Zu(t){Ka.call(this,null,Qu,t),this.modified(!0)}function Qu(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:tt((n=>e(n,t)),nt(e),et(e))}function tl(t){ps.call(this,[void 0,void 0],t)}function el(t,e){Ka.call(this,t),this.parent=e,this.count=0}function nl(t){ps.call(this,{},t),this._keys=le();const e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,r=e.active;n<r;++n)t(e[n],n,e)}}function rl(t){Ka.call(this,null,il,t)}function il(t){return this.value&&!t.modified()?this.value:_t(t.name)?Gt(t.name).map((t=>ut(t))):ut(t.name,t.as)}function ol(t){ps.call(this,le(),t)}function al(t){ps.call(this,[],t)}function sl(t){ps.call(this,[],t)}function ul(t){ps.call(this,null,t)}function ll(t){ps.call(this,[],t)}Hu.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Gu.concat(Xu)},{name:"as",type:"string",array:!0,default:["value","density"]}]},fe(Hu,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=Vu(t.distribution,function(t){return()=>t.materialize(t.SOURCE).source}(e)),i=t.steps||t.minsteps||25,o=t.steps||t.maxsteps||200;let a=t.method||"pdf";"pdf"!==a&&"cdf"!==a&&at("Invalid density method: "+a),t.extent||r.data||at("Missing density extent parameter."),a=r[a];const s=t.as||["value","density"],u=vu(a,t.extent||ie(r.data()),i,o).map((t=>{const e={};return e[s[0]]=t[0],e[s[1]]=t[1],za(e)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Ju.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]},fe(Ju,ps,{transform(t,e){if(this.value&&!t.modified()&&!e.changed())return e;const n=e.materialize(e.SOURCE).source,r=Yu(e.source,t.groupby,ct),i=t.smooth||!1,o=t.field,a=t.step||((t,e)=>Ee(ie(t,e))/30)(n,o),s=qa(((t,e)=>o(t)-o(e))),u=t.as||"bin",l=r.length;let c,f=1/0,h=-1/0,d=0;for(;d<l;++d){const t=r[d].sort(s);c=-1;for(const e of Bs(t,a,i,o))e<f&&(f=e),e>h&&(h=e),t[++c][u]=e}return this.value={start:f,stop:h,step:a},e.reflow(!0).modifies(u)}}),fe(Zu,Ka),tl.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},fe(tl,ps,{transform(t,e){const n=this.value,r=t.field,i=e.changed()||e.modified(r.fields)||t.modified("field");let o=n[0],a=n[1];if((i||null==o)&&(o=1/0,a=-1/0),e.visit(i?e.SOURCE:e.ADD,(t=>{const e=Ot(r(t));null!=e&&(e<o&&(o=e),e>a&&(a=e))})),!Number.isFinite(o)||!Number.isFinite(a)){let t=et(r);t&&(t=` for field "${t}"`),e.dataflow.warn(`Infinite extent${t}: [${o}, ${a}]`),o=a=void 0}this.value=[o,a]}}),fe(el,Ka,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}}),fe(nl,ps,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,r){const i=this.value;let o,a,s=se(i,t)&&i[t];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[t])&&a.tuple,o=n.dataflow,s=new el(n.fork(n.NO_SOURCE),this),o.add(s).connect(e(o,t,a)),i[t]=s,this.activate(s)),s},clean(){const t=this.value;let e=0;for(const n in t)if(0===t[n].count){const r=t[n].detachSubflow;r&&r(),delete t[n],++e}if(e){const t=this._targets.filter((t=>t&&t.count>0));this.initTargets(t)}},initTargets(t){const e=this._targets,n=e.length,r=t?t.length:0;let i=0;for(;i<r;++i)e[i]=t[i];for(;i<n&&null!=e[i];++i)e[i]=null;e.active=r},transform(t,e){const n=e.dataflow,r=t.key,i=t.subflow,o=this._keys,a=t.modified("key"),s=t=>this.subflow(t,i,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,(t=>{const e=ja(t),n=o.get(e);void 0!==n&&(o.delete(e),s(n).rem(t))})),e.visit(e.ADD,(t=>{const e=r(t);o.set(ja(t),e),s(e).add(t)})),a||e.modified(r.fields)?e.visit(e.MOD,(t=>{const e=ja(t),n=o.get(e),i=r(t);n===i?s(i).mod(t):(o.set(e,i),s(n).rem(t),s(i).add(t))})):e.changed(e.MOD)&&e.visit(e.MOD,(t=>{s(o.get(ja(t))).mod(t)})),a&&e.visit(e.REFLOW,(t=>{const e=ja(t),n=o.get(e),i=r(t);n!==i&&(o.set(e,i),s(n).rem(t),s(i).add(t))})),e.clean()?n.runAfter((()=>{this.clean(),o.clean()})):o.empty>n.cleanThreshold&&n.runAfter(o.clean),e}}),fe(rl,Ka),ol.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},fe(ol,ps,{transform(t,e){const n=e.dataflow,r=this.value,i=e.fork(),o=i.add,a=i.rem,s=i.mod,u=t.expr;let l=!0;function c(e){const n=ja(e),i=u(e,t),c=r.get(n);i&&c?(r.delete(n),o.push(e)):i||c?l&&i&&!c&&s.push(e):(r.set(n,1),a.push(e))}return e.visit(e.REM,(t=>{const e=ja(t);r.has(e)?r.delete(e):a.push(t)})),e.visit(e.ADD,(e=>{u(e,t)?o.push(e):r.set(ja(e),1)})),e.visit(e.MOD,c),t.modified()&&(l=!1,e.visit(e.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),al.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},fe(al,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=Ku(r,t.as||[]),o=t.index||null,a=i.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{const e=r.map((e=>e(t))),s=e.reduce(((t,e)=>Math.max(t,e.length)),0);let u,l,c,f=0;for(;f<s;++f){for(l=Ra(t),u=0;u<a;++u)l[i[u]]=null==(c=e[u][f])?null:c;o&&(l[o]=f),n.add.push(l)}})),this.value=n.source=n.add,o&&n.modifies(o),n.modifies(i)}}),sl.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},fe(sl,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=r.map(et),o=t.as||["key","value"],a=o[0],s=o[1],u=r.length;return n.rem=this.value,e.visit(e.SOURCE,(t=>{for(let e,o=0;o<u;++o)e=Ra(t),e[a]=i[o],e[s]=r[o](t),n.add.push(e)})),this.value=n.source=n.add,n.modifies(o)}}),ul.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},fe(ul,ps,{transform(t,e){const n=t.expr,r=t.as,i=t.modified(),o=t.initonly?e.ADD:i?e.SOURCE:e.modified(n.fields)||e.modified(r)?e.ADD_MOD:e.ADD;return i&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(r),e.visit(o,(e=>e[r]=n(e,t)))}}),fe(ll,ps,{transform(t,e){const n=e.fork(e.ALL),r=t.generator;let i,o,a,s=this.value,u=t.size-s.length;if(u>0){for(i=[];--u>=0;)i.push(a=za(r(t))),s.push(a);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else o=s.slice(0,-u),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(o):o,s=s.slice(-u);return n.source=this.value=s,n}});const cl={value:"value",median:Es,mean:function(t,e){let n=0,r=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,r+=e);else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(o=+o)>=o&&(++n,r+=o)}if(n)return r/n},min:bs,max:vs},fl=[];function hl(t){ps.call(this,[],t)}function dl(t){ju.call(this,t)}function pl(t){ps.call(this,null,t)}function gl(t){Ka.call(this,null,ml,t)}function ml(t){return this.value&&!t.modified()?this.value:be(t.fields,t.flat)}function yl(t){ps.call(this,[],t),this._pending=null}function vl(t,e,n){n.forEach(za);const r=e.fork(e.NO_FIELDS&e.NO_SOURCE);return r.rem=t.value,t.value=r.source=r.add=n,t._pending=null,r.rem.length&&r.clean(!0),r}function bl(t){ps.call(this,{},t)}function xl(t){Ka.call(this,null,wl,t)}function wl(t){if(this.value&&!t.modified())return this.value;const e=t.extents,n=e.length;let r,i,o=1/0,a=-1/0;for(r=0;r<n;++r)i=e[r],i[0]<o&&(o=i[0]),i[1]>a&&(a=i[1]);return[o,a]}function _l(t){Ka.call(this,null,kl,t)}function kl(t){return this.value&&!t.modified()?this.value:t.values.reduce(((t,e)=>t.concat(e)),[])}function Al(t){ps.call(this,null,t)}function El(t){ju.call(this,t)}function Dl(t){nl.call(this,t)}function Sl(t){ps.call(this,null,t)}function Cl(t){ps.call(this,null,t)}function Ol(t){ps.call(this,null,t)}function Fl(t){ps.call(this,null,t)}function Ml(t){ps.call(this,[],t),this.count=0}function $l(t){ps.call(this,null,t)}function Nl(t){ps.call(this,null,t),this.modified(!0)}function Bl(t){ps.call(this,null,t)}hl.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},fe(hl,ps,{transform(t,e){var n,r,i,o,a,s,u,l,c,f,h=e.fork(e.ALL),d=function(t){var e,n=t.method||cl.value;if(null!=cl[n])return n===cl.value?(e=void 0!==t.value?t.value:0,()=>e):cl[n];at("Unrecognized imputation method: "+n)}(t),p=function(t){const e=t.field;return t=>t?e(t):NaN}(t),g=et(t.field),m=et(t.key),y=(t.groupby||[]).map(et),v=function(t,e,n,r){var i,o,a,s,u,l,c,f,h=t=>t(f),d=[],p=r?r.slice():[],g={},m={};for(p.forEach(((t,e)=>g[t]=e+1)),s=0,c=t.length;s<c;++s)l=n(f=t[s]),u=g[l]||(g[l]=p.push(l)),(a=m[o=(i=e?e.map(h):fl)+""])||(a=m[o]=[],d.push(a),a.values=i),a[u-1]=f;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),b=[],x=this.value,w=v.domain.length;for(a=0,l=v.length;a<l;++a)for(i=(n=v[a]).values,r=NaN,u=0;u<w;++u)if(null==n[u]){for(o=v.domain[u],f={_impute:!0},s=0,c=i.length;s<c;++s)f[y[s]]=i[s];f[m]=o,f[g]=Number.isNaN(r)?r=d(n,p):r,b.push(za(f))}return b.length&&(h.add=h.materialize(h.ADD).add.concat(b)),x.length&&(h.rem=h.materialize(h.REM).rem.concat(x)),this.value=b,h}}),dl.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Du},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},fe(dl,ju,{transform(t,e){const n=this,r=t.modified();let i;return n.value&&(r||e.modified(n._inputs,!0))?(i=n.value=r?n.init(t):{},e.visit(e.SOURCE,(t=>n.add(t)))):(i=n.value=n.value||this.init(t),e.visit(e.REM,(t=>n.rem(t))),e.visit(e.ADD,(t=>n.add(t)))),n.changes(),e.visit(e.SOURCE,(t=>{re(t,i[n.cellkey(t)].tuple)})),e.reflow(r).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(t[n]),t[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(e[n]),e[n]=null;this._alen=this._mlen=0}}),pl.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},fe(pl,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=e.materialize(e.SOURCE).source,i=Yu(r,t.groupby,t.field),o=(t.groupby||[]).map(et),a=t.bandwidth,s=t.cumulative?"cdf":"pdf",u=t.as||["value","density"],l=[];let c=t.extent,f=t.steps||t.minsteps||25,h=t.steps||t.maxsteps||200;"pdf"!==s&&"cdf"!==s&&at("Invalid density method: "+s),"shared"===t.resolve&&(c||(c=ie(r,t.field)),f=h=t.steps||h),i.forEach((e=>{const n=Vs(e,a)[s],r=t.counts?e.length:1;vu(n,c||ie(e),f,h).forEach((t=>{const n={};for(let t=0;t<o.length;++t)n[o[t]]=e.dims[t];n[u[0]]=t[0],n[u[1]]=t[1]*r,l.push(za(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),fe(gl,Ka),fe(yl,ps,{transform(t,e){const n=e.dataflow;return this._pending?vl(this,e,this._pending):function(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}(t)?e.StopPropagation:t.values?vl(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then((t=>(this._pending=Gt(t.data),t=>t.touch(this))))}:n.request(t.url,t.format).then((t=>vl(this,e,Gt(t.data))))}}),bl.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},fe(bl,ps,{transform(t,e){const n=t.fields,r=t.index,i=t.values,o=null==t.default?null:t.default,a=t.modified(),s=n.length;let u,l,c,f=a?e.SOURCE:e.ADD,h=e,d=t.as;return i?(l=i.length,s>1&&!d&&at('Multi-field lookup requires explicit "as" parameter.'),d&&d.length!==s*l&&at('The "as" parameter has too few output field names.'),d=d||i.map(et),u=function(t){for(var e,a,u=0,c=0;u<s;++u)if(null==(a=r.get(n[u](t))))for(e=0;e<l;++e,++c)t[d[c]]=o;else for(e=0;e<l;++e,++c)t[d[c]]=i[e](a)}):(d||at("Missing output field names."),u=function(t){for(var e,i=0;i<s;++i)e=r.get(n[i](t)),t[d[i]]=null==e?o:e}),a?h=e.reflow(!0):(c=n.some((t=>e.modified(t.fields))),f|=c?e.MOD:0),e.visit(f,u),h.modifies(d)}}),fe(xl,Ka),fe(_l,Ka),fe(Al,ps,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),El.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Du,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},fe(El,ju,{_transform:ju.prototype.transform,transform(t,e){return this._transform(function(t,e){const n=t.field,r=t.value,i=("count"===t.op?"__count__":t.op)||"sum",o=nt(n).concat(nt(r)),a=function(t,e,n){const r={},i=[];return n.visit(n.SOURCE,(e=>{const n=t(e);r[n]||(r[n]=1,i.push(n))})),i.sort(Jt),e?i.slice(0,e):i}(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:a.map((()=>i)),fields:a.map((t=>function(t,e,n,r){return tt((r=>e(r)===t?n(r):NaN),r,t+"")}(t,n,r,o))),as:a.map((t=>t+"")),modified:t.modified.bind(t)}}(t,e),e)}}),fe(Dl,nl,{transform(t,e){const n=t.subflow,r=t.field,i=t=>this.subflow(ja(t),n,e,t);return(t.modified("field")||r&&e.modified(nt(r)))&&at("PreFacet does not support field modification."),this.initTargets(),r?(e.visit(e.MOD,(t=>{const e=i(t);r(t).forEach((t=>e.mod(t)))})),e.visit(e.ADD,(t=>{const e=i(t);r(t).forEach((t=>e.add(za(t))))})),e.visit(e.REM,(t=>{const e=i(t);r(t).forEach((t=>e.rem(t)))}))):(e.visit(e.MOD,(t=>i(t).mod(t))),e.visit(e.ADD,(t=>i(t).add(t))),e.visit(e.REM,(t=>i(t).rem(t)))),e.clean()&&e.runAfter((()=>this.clean())),e}}),Sl.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},fe(Sl,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.fields,i=Ku(t.fields,t.as||[]),o=r?(t,e)=>function(t,e,n,r){for(let i=0,o=n.length;i<o;++i)e[r[i]]=n[i](t);return e}(t,e,r,i):Pa;let a;return this.value?a=this.value:(e=e.addAll(),a=this.value={}),e.visit(e.REM,(t=>{const e=ja(t);n.rem.push(a[e]),a[e]=null})),e.visit(e.ADD,(t=>{const e=o(t,za({}));a[ja(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{n.mod.push(o(t,a[ja(t)]))})),n}}),fe(Cl,ps,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}}),Ol.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},fe(Ol,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;const i=Yu(e.materialize(e.SOURCE).source,t.groupby,t.field),o=(t.groupby||[]).map(et),a=[],s=t.step||.01,u=t.probs||xu(s/2,1-1e-14,s),l=u.length;return i.forEach((t=>{const e=Ss(t,u);for(let n=0;n<l;++n){const i={};for(let e=0;e<o.length;++e)i[o[e]]=t.dims[e];i[r[0]]=u[n],i[r[1]]=e[n],a.push(za(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}}),fe(Fl,ps,{transform(t,e){let n,r;return this.value?r=this.value:(n=e=e.addAll(),r=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,(t=>{const e=ja(t);n.rem.push(r[e]),r[e]=null})),e.visit(e.ADD,(t=>{const e=Ra(t);r[ja(t)]=e,n.add.push(e)})),e.visit(e.MOD,(t=>{const e=r[ja(t)];for(const r in t)e[r]=t[r],n.modifies(r);n.mod.push(e)}))),n}}),Ml.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},fe(Ml,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE),r=t.modified("size"),i=t.size,o=this.value.reduce(((t,e)=>(t[ja(e)]=1,t)),{});let a=this.value,s=this.count,u=0;function l(t){let e,r;a.length<i?a.push(t):(r=~~((s+1)*Ms()),r<a.length&&r>=u&&(e=a[r],o[ja(e)]&&n.rem.push(e),a[r]=t)),++s}if(e.rem.length&&(e.visit(e.REM,(t=>{const e=ja(t);o[e]&&(o[e]=-1,n.rem.push(t)),--s})),a=a.filter((t=>-1!==o[ja(t)]))),(e.rem.length||r)&&a.length<i&&e.source&&(u=s=a.length,e.visit(e.SOURCE,(t=>{o[ja(t)]||l(t)})),u=-1),r&&a.length>i){const t=a.length-i;for(let e=0;e<t;++e)o[ja(a[e])]=-1,n.rem.push(a[e]);a=a.slice(t)}return e.mod.length&&e.visit(e.MOD,(t=>{o[ja(t)]&&n.mod.push(t)})),e.add.length&&e.visit(e.ADD,l),(e.add.length||u<0)&&(n.add=a.filter((t=>!o[ja(t)]))),this.count=s,this.value=n.source=a,n}}),$l.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},fe($l,ps,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),r=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=xu(t.start,t.stop,t.step||1).map((t=>{const e={};return e[r]=t,za(e)})),n.add=e.add.concat(this.value),n}}),fe(Nl,ps,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});const Tl=["unit0","unit1"];function jl(t){ps.call(this,le(),t)}function Il(t){ps.call(this,null,t)}Bl.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:Gr,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Tl}]},fe(Bl,ps,{transform(t,e){const n=t.field,r=!1!==t.interval,i="utc"===t.timezone,o=this._floor(t,e),a=(i?ki:_i)(o.unit).offset,s=t.as||Tl,u=s[0],l=s[1],c=o.step;let f=o.start||1/0,h=o.stop||-1/0,d=e.ADD;return(t.modified()||e.modified(nt(n)))&&(d=(e=e.reflow(!0)).SOURCE,f=1/0,h=-1/0),e.visit(d,(t=>{const e=n(t);let i,s;null==e?(t[u]=null,r&&(t[l]=null)):(t[u]=i=s=o(e),r&&(t[l]=s=a(i,c)),i<f&&(f=i),s>h&&(h=s))})),o.start=f,o.stop=h,e.modifies(r?s:u)},_floor(t,e){const n="utc"===t.timezone,{units:r,step:i}=t.units?{units:t.units,step:t.step||1}:Ri({extent:t.extent||ie(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),o=Kr(r),a=this.value||{},s=(n?bi:mi)(o,i);return s.unit=Ct(o),s.units=o,s.step=i,s.start=a.start,s.stop=a.stop,this.value=s}}),fe(jl,ps,{transform(t,e){const n=e.dataflow,r=t.field,i=this.value,o=t=>i.set(r(t),t);let a=!0;return t.modified("field")||e.modified(r.fields)?(i.clear(),e.visit(e.SOURCE,o)):e.changed()?(e.visit(e.REM,(t=>i.delete(r(t)))),e.visit(e.ADD,o)):a=!1,this.modified(a),i.empty>n.cleanThreshold&&n.runAfter(i.clean),e.fork()}}),fe(Il,ps,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(qa(t.sort)):e.source).map(t.field))}});const zl={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,r=e.data;return n&&e.compare(r[n-1],r[n])?++t:t}}},percent_rank:function(){const t=zl.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,r=e.compare;let i=e.index;if(t<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;t=i}return(1+t)/n.length}}},ntile:function(t,e){(e=+e)>0||at("ntile num must be greater than zero.");const n=zl.cume_dist(),r=n.next;return{init:n.init,next:t=>Math.ceil(e*r(t))}},lag:function(t,e){return e=+e||1,{next:n=>{const r=n.index-e;return r>=0?t(n.data[r]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{const r=n.index+e,i=n.data;return r<i.length?t(i[r]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||at("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(e-1);return r<n.i1?t(n.data[r]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const r=t(n.data[n.index]);return null!=r?e=r:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:r=>{const i=r.data;return r.index<=n?e:(n=function(t,e,n){for(let r=e.length;n<r;++n)if(null!=t(e[n]))return n;return-1}(t,i,r.index))<0?(n=i.length,e=null):e=t(i[n])}}}},Rl=Object.keys(zl);function Pl(t){const e=Gt(t.ops),n=Gt(t.fields),r=Gt(t.params),i=Gt(t.as),o=this.outputs=[],a=this.windows=[],s={},u={},l=[],c=[];let f=!0;function h(t){Gt(nt(t)).forEach((t=>s[t]=1))}h(t.sort),e.forEach(((t,e)=>{const s=n[e],d=et(s),p=_u(t,d,i[e]);if(h(s),o.push(p),se(zl,t))a.push(function(t,e,n,r){const i=zl[t](e,n);return{init:i.init||ft,update:function(t,e){e[r]=i.next(t)}}}(t,n[e],r[e],p));else{if(null==s&&"count"!==t&&at("Null aggregate field specified."),"count"===t)return void l.push(p);f=!1;let e=u[d];e||(e=u[d]=[],e.field=s,c.push(e)),e.push(Su(t,p))}})),(l.length||c.length)&&(this.cell=function(t,e,n){t=t.map((t=>Nu(t,t.field)));const r={num:0,agg:null,store:!1,count:e};if(!n)for(var i=t.length,o=r.agg=Array(i),a=0;a<i;++a)o[a]=new t[a](r);if(r.store)var s=r.data=new Bu;return r.add=function(t){if(r.num+=1,!n){s&&s.add(t);for(let e=0;e<i;++e)o[e].add(o[e].get(t),t)}},r.rem=function(t){if(r.num-=1,!n){s&&s.rem(t);for(let e=0;e<i;++e)o[e].rem(o[e].get(t),t)}},r.set=function(t){let i,a;for(s&&s.values(),i=0,a=e.length;i<a;++i)t[e[i]]=r.num;if(!n)for(i=0,a=o.length;i<a;++i)o[i].set(t)},r.init=function(){r.num=0,s&&s.reset();for(let t=0;t<i;++t)o[t].init()},r}(c,l,f)),this.inputs=Object.keys(s)}const Ll=Pl.prototype;function ql(t){ps.call(this,{},t),this._mlen=0,this._mods=[]}function Ul(t,e,n,r){const i=r.sort,o=i&&!r.ignorePeers,a=r.frame||[null,0],s=t.data(n),u=s.length,l=o?Tr(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||ee(-1)};e.init();for(let t=0;t<u;++t)Wl(c,a,t,u),o&&Vl(c,l),e.update(c,s[t])}function Wl(t,e,n,r){t.p0=t.i0,t.p1=t.i1,t.i0=null==e[0]?0:Math.max(0,n-Math.abs(e[0])),t.i1=null==e[1]?r:Math.min(r,n+Math.abs(e[1])+1),t.index=n}function Vl(t,e){const n=t.i0,r=t.i1-1,i=t.compare,o=t.data,a=o.length-1;n>0&&!i(o[n],o[n-1])&&(t.i0=e.left(o,o[n])),r<a&&!i(o[r],o[r+1])&&(t.i1=e.right(o,o[r]))}function Hl(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Gl(t){this._context=t}function Xl(){}function Kl(t){this._context=t}function Yl(t){this._context=t}function Jl(t,e){this._basis=new Gl(t),this._beta=e}Ll.init=function(){this.windows.forEach((t=>t.init())),this.cell&&this.cell.init()},Ll.update=function(t,e){const n=this.cell,r=this.windows,i=t.data,o=r&&r.length;let a;if(n){for(a=t.p0;a<t.i0;++a)n.rem(i[a]);for(a=t.p1;a<t.i1;++a)n.add(i[a]);n.set(e)}for(a=0;a<o;++a)r[a].update(t,e)},ql.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Rl.concat(Du)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},fe(ql,ps,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),r=qa(t.sort),i=wu(t.groupby),o=t=>this.group(i(t));let a=this.state;a&&!n||(a=this.state=new Pl(t)),n||e.modified(a.inputs)?(this.value={},e.visit(e.SOURCE,(t=>o(t).add(t)))):(e.visit(e.REM,(t=>o(t).remove(t))),e.visit(e.ADD,(t=>o(t).add(t))));for(let e=0,n=this._mlen;e<n;++e)Ul(this._mods[e],a,r,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(a.outputs)},group(t){let e=this.value[t];return e||(e=this.value[t]=zu(ja),e.stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}}),Gl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Hl(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Hl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Kl.prototype={areaStart:Xl,areaEnd:Xl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:Hl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Yl.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Hl(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Jl.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,s=e[n]-o,u=-1;++u<=n;)r=u/n,this._basis.point(this._beta*t[u]+(1-this._beta)*(i+r*a),this._beta*e[u]+(1-this._beta)*(o+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const Zl=function t(e){function n(t){return 1===e?new Gl(t):new Jl(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function Ql(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function tc(t,e){this._context=t,this._k=(1-e)/6}tc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ql(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Ql(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ec=function t(e){function n(t){return new tc(t,e)}return n.tension=function(e){return t(+e)},n}(0);function nc(t,e){this._context=t,this._k=(1-e)/6}nc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ql(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const rc=function t(e){function n(t){return new nc(t,e)}return n.tension=function(e){return t(+e)},n}(0);function ic(t,e){this._context=t,this._k=(1-e)/6}ic.prototype={areaStart:Xl,areaEnd:Xl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ql(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const oc=function t(e){function n(t){return new ic(t,e)}return n.tension=function(e){return t(+e)},n}(0);var ac=Math.abs,sc=Math.atan2,uc=Math.cos,lc=Math.max,cc=Math.min,fc=Math.sin,hc=Math.sqrt,dc=1e-12,pc=Math.PI,gc=pc/2,mc=2*pc;function yc(t){return t>1?0:t<-1?pc:Math.acos(t)}function vc(t){return t>=1?gc:t<=-1?-gc:Math.asin(t)}function bc(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>dc){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,u=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/u,i=(i*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/u}if(t._l23_a>dc){var l=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*l+t._x1*t._l23_2a-e*t._l12_2a)/c,a=(a*l+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function xc(t,e){this._context=t,this._alpha=e}xc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:bc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const wc=function t(e){function n(t){return e?new xc(t,e):new tc(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function _c(t,e){this._context=t,this._alpha=e}_c.prototype={areaStart:Xl,areaEnd:Xl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:bc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const kc=function t(e){function n(t){return e?new _c(t,e):new ic(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Ac(t,e){this._context=t,this._alpha=e}Ac.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:bc(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Ec=function t(e){function n(t){return e?new Ac(t,e):new nc(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function Dc(t){this._context=t}function Sc(t){return new Dc(t)}function Cc(t){this._context=t}function Oc(t){return t<0?-1:1}function Fc(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),s=(o*i+a*r)/(r+i);return(Oc(o)+Oc(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function Mc(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function $c(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,s=(o-r)/3;t._context.bezierCurveTo(r+s,i+s*e,o-s,a-s*n,o,a)}function Nc(t){this._context=t}function Bc(t){this._context=new Tc(t)}function Tc(t){this._context=t}function jc(t){this._context=t}function Ic(t){var e,n,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(i[r-1]=a[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(a[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}function zc(t,e){this._context=t,this._t=e}Dc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},Cc.prototype={areaStart:Xl,areaEnd:Xl,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},Nc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:$c(this,this._t0,Mc(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,$c(this,Mc(this,n=Fc(this,t,e)),n);break;default:$c(this,this._t0,n=Fc(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(Bc.prototype=Object.create(Nc.prototype)).point=function(t,e){Nc.prototype.point.call(this,e,t)},Tc.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},jc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=Ic(t),i=Ic(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},zc.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};const Rc=Math.PI,Pc=2*Rc,Lc=1e-6,qc=Pc-Lc;function Uc(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Wc(){return new Uc}Uc.prototype=Wc.prototype={constructor:Uc,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,s=n-t,u=r-e,l=o-t,c=a-e,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(f>Lc)if(Math.abs(c*s-u*l)>Lc&&i){var h=n-o,d=r-a,p=s*s+u*u,g=h*h+d*d,m=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((Rc-Math.acos((p+f-g)/(2*m*y)))/2),b=v/y,x=v/m;Math.abs(b-1)>Lc&&(this._+="L"+(t+b*l)+","+(e+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=t+x*s)+","+(this._y1=e+x*u)}else this._+="L"+(this._x1=t)+","+(this._y1=e)},arc:function(t,e,n,r,i,o){t=+t,e=+e,o=!!o;var a=(n=+n)*Math.cos(r),s=n*Math.sin(r),u=t+a,l=e+s,c=1^o,f=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Lc||Math.abs(this._y1-l)>Lc)&&(this._+="L"+u+","+l),n&&(f<0&&(f=f%Pc+Pc),f>qc?this._+="A"+n+","+n+",0,1,"+c+","+(t-a)+","+(e-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):f>Lc&&(this._+="A"+n+","+n+",0,"+ +(f>=Rc)+","+c+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};const Vc=Wc;function Hc(t){return function(){return t}}function Gc(t){return t.innerRadius}function Xc(t){return t.outerRadius}function Kc(t){return t.startAngle}function Yc(t){return t.endAngle}function Jc(t){return t&&t.padAngle}function Zc(t,e,n,r,i,o,a,s){var u=n-t,l=r-e,c=a-i,f=s-o,h=f*u-c*l;if(!(h*h<dc))return[t+(h=(c*(e-o)-f*(t-i))/h)*u,e+h*l]}function Qc(t,e,n,r,i,o,a){var s=t-n,u=e-r,l=(a?o:-o)/hc(s*s+u*u),c=l*u,f=-l*s,h=t+c,d=e+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,v=p-h,b=g-d,x=v*v+b*b,w=i-o,_=h*g-p*d,k=(b<0?-1:1)*hc(lc(0,w*w*x-_*_)),A=(_*b-v*k)/x,E=(-_*v-b*k)/x,D=(_*b+v*k)/x,S=(-_*v+b*k)/x,C=A-m,O=E-y,F=D-m,M=S-y;return C*C+O*O>F*F+M*M&&(A=D,E=S),{cx:A,cy:E,x01:-c,y01:-f,x11:A*(i/w-1),y11:E*(i/w-1)}}function tf(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function ef(t){return t[0]}function nf(t){return t[1]}function rf(t,e){var n=Hc(!0),r=null,i=Sc,o=null;function a(a){var s,u,l,c=(a=tf(a)).length,f=!1;for(null==r&&(o=i(l=Vc())),s=0;s<=c;++s)!(s<c&&n(u=a[s],s,a))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+t(u,s,a),+e(u,s,a));if(l)return o=null,l+""||null}return t="function"==typeof t?t:void 0===t?ef:Hc(t),e="function"==typeof e?e:void 0===e?nf:Hc(e),a.x=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),a):t},a.y=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),a):e},a.defined=function(t){return arguments.length?(n="function"==typeof t?t:Hc(!!t),a):n},a.curve=function(t){return arguments.length?(i=t,null!=r&&(o=i(r)),a):i},a.context=function(t){return arguments.length?(null==t?r=o=null:o=i(r=t),a):r},a}function of(t,e,n){var r=null,i=Hc(!0),o=null,a=Sc,s=null;function u(u){var l,c,f,h,d,p=(u=tf(u)).length,g=!1,m=new Array(p),y=new Array(p);for(null==o&&(s=a(d=Vc())),l=0;l<=p;++l){if(!(l<p&&i(h=u[l],l,u))===g)if(g=!g)c=l,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=l-1;f>=c;--f)s.point(m[f],y[f]);s.lineEnd(),s.areaEnd()}g&&(m[l]=+t(h,l,u),y[l]=+e(h,l,u),s.point(r?+r(h,l,u):m[l],n?+n(h,l,u):y[l]))}if(d)return s=null,d+""||null}function l(){return rf().defined(i).curve(a).context(o)}return t="function"==typeof t?t:void 0===t?ef:Hc(+t),e="function"==typeof e?e:Hc(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?nf:Hc(+n),u.x=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),r=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),u):t},u.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Hc(+t),u):r},u.y=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),n=null,u):e},u.y0=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),u):e},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:Hc(+t),u):n},u.lineX0=u.lineY0=function(){return l().x(t).y(e)},u.lineY1=function(){return l().x(t).y(n)},u.lineX1=function(){return l().x(r).y(e)},u.defined=function(t){return arguments.length?(i="function"==typeof t?t:Hc(!!t),u):i},u.curve=function(t){return arguments.length?(a=t,null!=o&&(s=a(o)),u):a},u.context=function(t){return arguments.length?(null==t?o=s=null:s=a(o=t),u):o},u}Array.prototype.slice;const af={draw:function(t,e){var n=Math.sqrt(e/pc);t.moveTo(n,0),t.arc(0,0,n,0,mc)}};Math.sqrt(1/3);Math.sin(pc/10),Math.sin(7*pc/10);function sf(t,e){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}Math.sin(mc/10),Math.cos(mc/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12);const uf=()=>"undefined"!=typeof Image?Image:null,lf=Tr(Br),cf=lf.right,ff=lf.left,hf=(Tr(_s).center,cf);function df(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function pf(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}const gf=Symbol("implicit");function mf(){var t=new Map,e=[],n=[],r=gf;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==gf)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new Map;for(const r of n){const n=r+"";t.has(n)||t.set(n,e.push(r))}return i},i.range=function(t){return arguments.length?(n=Array.from(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return mf(e,n).unknown(r)},df.apply(i,arguments),i}var yf,vf=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bf(t){if(!(e=vf.exec(t)))throw new Error("invalid format: "+t);var e;return new xf({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function xf(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function wf(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _f(t){return(t=wf(Math.abs(t)))?t[1]:NaN}function kf(t,e){var n=wf(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}bf.prototype=xf.prototype,xf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Af={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>kf(100*t,e),r:kf,s:function(t,e){var n=wf(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(yf=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+wf(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Ef(t){return t}var Df,Sf,Cf,Of=Array.prototype.map,Ff=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Mf(t,e,n,r){var i,o=An(t,e,n);switch((r=bf(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(_f(e)/3)))-_f(Math.abs(t)))}(o,a))||(r.precision=i),Cf(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_f(e)-_f(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-_f(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return Sf(r)}function $f(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Nf(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Bf(){}Df=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Ef:(e=Of.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?Ef:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(Of.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",l=void 0===t.minus?"":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=bf(t)).fill,n=t.align,f=t.sign,h=t.symbol,d=t.zero,p=t.width,g=t.comma,m=t.precision,y=t.trim,v=t.type;"n"===v?(g=!0,v="g"):Af[v]||(void 0===m&&(m=12),y=!0,v="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===h?o:/[%p]/.test(v)?u:"",w=Af[v],_=/[defgprs%]/.test(v);function k(t){var i,o,u,h=b,k=x;if("c"===v)k=w(t)+k,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:w(Math.abs(t),m),y&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==f&&(A=!1),h=(A?"("===f?f:l:"-"===f||"("===f?"":f)+h,k=("s"===v?Ff[8+yf/3]:"")+k+(A&&"("===f?")":""),_)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){k=(46===u?a+t.slice(i+1):t.slice(i))+k,t=t.slice(0,i);break}}g&&!d&&(t=r(t,1/0));var E=h.length+t.length+k.length,D=E<p?new Array(p-E+1).join(e):"";switch(g&&d&&(t=r(D+t,D.length?p-k.length:1/0),D=""),n){case"<":t=h+t+k+D;break;case"=":t=h+D+t+k;break;case"^":t=D.slice(0,E=D.length>>1)+h+t+k+D.slice(E);break;default:t=D+h+t+k}return s(t)}return m=void 0===m?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),k.toString=function(){return t+""},k}return{format:f,formatPrefix:function(t,e){var n=f(((t=bf(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(_f(e)/3))),i=Math.pow(10,-r),o=Ff[8+r/3];return function(t){return n(i*t)+o}}}}({thousands:",",grouping:[3],currency:["$",""]}),Sf=Df.format,Cf=Df.formatPrefix;var Tf=.7,jf=1/Tf,If="\\s*([+-]?\\d+)\\s*",zf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rf="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Pf=/^#([0-9a-f]{3,8})$/,Lf=new RegExp("^rgb\\("+[If,If,If]+"\\)$"),qf=new RegExp("^rgb\\("+[Rf,Rf,Rf]+"\\)$"),Uf=new RegExp("^rgba\\("+[If,If,If,zf]+"\\)$"),Wf=new RegExp("^rgba\\("+[Rf,Rf,Rf,zf]+"\\)$"),Vf=new RegExp("^hsl\\("+[zf,Rf,Rf]+"\\)$"),Hf=new RegExp("^hsla\\("+[zf,Rf,Rf,zf]+"\\)$"),Gf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Xf(){return this.rgb().formatHex()}function Kf(){return this.rgb().formatRgb()}function Yf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Pf.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Jf(e):3===n?new eh(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Zf(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Zf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Lf.exec(t))?new eh(e[1],e[2],e[3],1):(e=qf.exec(t))?new eh(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Uf.exec(t))?Zf(e[1],e[2],e[3],e[4]):(e=Wf.exec(t))?Zf(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Vf.exec(t))?oh(e[1],e[2]/100,e[3]/100,1):(e=Hf.exec(t))?oh(e[1],e[2]/100,e[3]/100,e[4]):Gf.hasOwnProperty(t)?Jf(Gf[t]):"transparent"===t?new eh(NaN,NaN,NaN,0):null}function Jf(t){return new eh(t>>16&255,t>>8&255,255&t,1)}function Zf(t,e,n,r){return r<=0&&(t=e=n=NaN),new eh(t,e,n,r)}function Qf(t){return t instanceof Bf||(t=Yf(t)),t?new eh((t=t.rgb()).r,t.g,t.b,t.opacity):new eh}function th(t,e,n,r){return 1===arguments.length?Qf(t):new eh(t,e,n,null==r?1:r)}function eh(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function nh(){return"#"+ih(this.r)+ih(this.g)+ih(this.b)}function rh(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function ih(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function oh(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new uh(t,e,n,r)}function ah(t){if(t instanceof uh)return new uh(t.h,t.s,t.l,t.opacity);if(t instanceof Bf||(t=Yf(t)),!t)return new uh;if(t instanceof uh)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new uh(a,s,u,t.opacity)}function sh(t,e,n,r){return 1===arguments.length?ah(t):new uh(t,e,n,null==r?1:r)}function uh(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function lh(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function ch(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function fh(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return ch((n-r/e)*e,a,i,o,s)}}function hh(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return ch((n-r/e)*e,i,o,a,s)}}$f(Bf,Yf,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Xf,formatHex:Xf,formatHsl:function(){return ah(this).formatHsl()},formatRgb:Kf,toString:Kf}),$f(eh,th,Nf(Bf,{brighter:function(t){return t=null==t?jf:Math.pow(jf,t),new eh(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Tf:Math.pow(Tf,t),new eh(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nh,formatHex:nh,formatRgb:rh,toString:rh})),$f(uh,sh,Nf(Bf,{brighter:function(t){return t=null==t?jf:Math.pow(jf,t),new uh(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Tf:Math.pow(Tf,t),new uh(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new eh(lh(t>=240?t-240:t+120,i,r),lh(t,i,r),lh(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));const dh=t=>()=>t;function ph(t,e){return function(n){return t+n*e}}function gh(t,e){var n=e-t;return n?ph(t,n>180||n<-180?n-360*Math.round(n/360):n):dh(isNaN(t)?e:t)}function mh(t,e){var n=e-t;return n?ph(t,n):dh(isNaN(t)?e:t)}const yh=function t(e){var n=function(t){return 1==(t=+t)?mh:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):dh(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=th(t)).r,(e=th(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=mh(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function vh(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=th(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var bh=vh(fh),xh=vh(hh);function wh(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function _h(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function kh(t,e){return(_h(e)?wh:Ah)(t,e)}function Ah(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Mh(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function Eh(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Dh(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Sh(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Mh(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Ch=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Oh=new RegExp(Ch.source,"g");function Fh(t,e){var n,r,i,o=Ch.lastIndex=Oh.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=Ch.exec(t))&&(r=Oh.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Dh(n,r)})),o=Oh.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function Mh(t,e){var n,r=typeof e;return null==e||"boolean"===r?dh(e):("number"===r?Dh:"string"===r?(n=Yf(e))?(e=n,yh):Fh:e instanceof Yf?yh:e instanceof Date?Eh:_h(e)?wh:Array.isArray(e)?Ah:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Sh:Dh)(t,e)}function $h(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Nh(t){return+t}var Bh=[0,1];function Th(t){return t}function jh(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:function(t){return function(){return t}}(isNaN(e)?NaN:.5)}function Ih(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=jh(i,r),o=n(a,o)):(r=jh(r,i),o=n(o,a)),function(t){return o(r(t))}}function zh(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=jh(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=hf(t,e,1,r)-1;return o[n](i[n](e))}}function Rh(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ph(){var t,e,n,r,i,o,a=Bh,s=Bh,u=Mh,l=Th;function c(){var t=Math.min(a.length,s.length);return l!==Th&&(l=function(t,e){var n;return t>e&&(n=t,t=e,e=n),function(n){return Math.max(t,Math.min(e,n))}}(a[0],a[t-1])),r=t>2?zh:Ih,i=o=null,f}function f(e){return null==e||isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(l(e)))}return f.invert=function(n){return l(e((o||(o=r(s,a.map(t),Dh)))(n)))},f.domain=function(t){return arguments.length?(a=Array.from(t,Nh),c()):a.slice()},f.range=function(t){return arguments.length?(s=Array.from(t),c()):s.slice()},f.rangeRound=function(t){return s=Array.from(t),u=$h,c()},f.clamp=function(t){return arguments.length?(l=!!t||Th,c()):l!==Th},f.interpolate=function(t){return arguments.length?(u=t,c()):u},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,c()}}function Lh(){return Ph()(Th,Th)}function qh(t){var e=t.domain;return t.ticks=function(t){var n=e();return _n(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Mf(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),a=0,s=o.length-1,u=o[a],l=o[s],c=10;for(l<u&&(i=u,u=l,l=i,i=a,a=s,s=i);c-- >0;){if((i=kn(u,l,n))===r)return o[a]=u,o[s]=l,e(o);if(i>0)u=Math.floor(u/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,l=Math.floor(l*i)/i}r=i}return t},t}function Uh(t,e){var n,r=0,i=(t=t.slice()).length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function Wh(t){return Math.log(t)}function Vh(t){return Math.exp(t)}function Hh(t){return-Math.log(-t)}function Gh(t){return-Math.exp(-t)}function Xh(t){return isFinite(t)?+("1e"+t):t<0?0:t}function Kh(t){return function(e){return-t(-e)}}function Yh(t){var e,n,r=t(Wh,Vh),i=r.domain,o=10;function a(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(o),n=function(t){return 10===t?Xh:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(o),i()[0]<0?(e=Kh(e),n=Kh(n),t(Hh,Gh)):t(Wh,Vh),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var l,c,f,h=e(s),d=e(u),p=null==t?10:+t,g=[];if(!(o%1)&&d-h<p){if(h=Math.floor(h),d=Math.ceil(d),s>0){for(;h<=d;++h)for(c=1,l=n(h);c<o;++c)if(!((f=l*c)<s)){if(f>u)break;g.push(f)}}else for(;h<=d;++h)for(c=o-1,l=n(h);c>=1;--c)if(!((f=l*c)<s)){if(f>u)break;g.push(f)}2*g.length<p&&(g=_n(s,u,p))}else g=_n(h,d,Math.min(d-h,p)).map(n);return r?g.reverse():g},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Sf(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(Uh(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function Jh(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function Zh(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function Qh(t){return t<0?-t*t:t*t}function td(t){var e=t(Th,Th),n=1;function r(){return 1===n?t(Th,Th):.5===n?t(Zh,Qh):t(Jh(n),Jh(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},qh(e)}function ed(){var t=td(Ph());return t.copy=function(){return Rh(t,ed()).exponent(t.exponent())},df.apply(t,arguments),t}function nd(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function rd(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function id(t){var e=1,n=t(nd(e),rd(e));return n.constant=function(n){return arguments.length?t(nd(e=+n),rd(e)):e},qh(n)}var od=31536e6;function ad(t){return new Date(t)}function sd(t){return t instanceof Date?+t:+new Date(+t)}function ud(t,e,n,r,i,o,a,s,u){var l=Lh(),c=l.invert,f=l.domain,h=u(".%L"),d=u(":%S"),p=u("%I:%M"),g=u("%I %p"),m=u("%a %d"),y=u("%b %d"),v=u("%B"),b=u("%Y"),x=[[a,1,1e3],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,6e4],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,od]];function w(s){return(a(s)<s?h:o(s)<s?d:i(s)<s?p:r(s)<s?g:e(s)<s?n(s)<s?m:y:t(s)<s?v:b)(s)}function _(e,n,r){if(null==e&&(e=10),"number"==typeof e){var i,o=Math.abs(r-n)/e,a=Tr((function(t){return t[2]})).right(x,o);return a===x.length?(i=An(n/od,r/od,e),e=t):a?(i=(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a])[1],e=a[0]):(i=Math.max(An(n,r,e),1),e=s),e.every(i)}return e}return l.invert=function(t){return new Date(c(t))},l.domain=function(t){return arguments.length?f(Array.from(t,sd)):f().map(ad)},l.ticks=function(t){var e,n=f(),r=n[0],i=n[n.length-1],o=i<r;return o&&(e=r,r=i,i=e),e=(e=_(t,r,i))?e.range(r,i+1):[],o?e.reverse():e},l.tickFormat=function(t,e){return null==e?w:u(e)},l.nice=function(t){var e=f();return(t=_(t,e[0],e[e.length-1]))?f(Uh(e,t)):l},l.copy=function(){return Rh(l,ud(t,e,n,r,i,o,a,s,u))},l}function ld(){var t,e,n,r,i,o=0,a=1,s=Th,u=!1;function l(e){return null==e||isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,r;return arguments.length?([n,r]=e,s=t(n,r),l):[s(0),s(1)]}}return l.domain=function(i){return arguments.length?([o,a]=i,t=r(o=+o),e=r(a=+a),n=t===e?0:1/(e-t),l):[o,a]},l.clamp=function(t){return arguments.length?(u=!!t,l):u},l.interpolator=function(t){return arguments.length?(s=t,l):s},l.range=c(Mh),l.rangeRound=c($h),l.unknown=function(t){return arguments.length?(i=t,l):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),l}}function cd(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function fd(){var t=qh(ld()(Th));return t.copy=function(){return cd(t,fd())},pf.apply(t,arguments)}function hd(){var t=td(ld());return t.copy=function(){return cd(t,hd()).exponent(t.exponent())},pf.apply(t,arguments)}function dd(t,e){void 0===e&&(e=t,t=Mh);for(var n=0,r=e.length-1,i=e[0],o=new Array(r<0?0:r);n<r;)o[n]=t(i,i=e[++n]);return function(t){var e=Math.max(0,Math.min(r-1,Math.floor(t*=r)));return o[e](t-e)}}function pd(){var t,e,n,r,i,o,a,s=0,u=.5,l=1,c=1,f=Th,h=!1;function d(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(c*t<c*e?r:i),f(h?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,r,i;return arguments.length?([n,r,i]=e,f=dd(t,[n,r,i]),d):[f(0),f(.5),f(1)]}}return d.domain=function(a){return arguments.length?([s,u,l]=a,t=o(s=+s),e=o(u=+u),n=o(l=+l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d):[s,u,l]},d.clamp=function(t){return arguments.length?(h=!!t,d):h},d.interpolator=function(t){return arguments.length?(f=t,d):f},d.range=p(Mh),d.rangeRound=p($h),d.unknown=function(t){return arguments.length?(a=t,d):a},function(a){return o=a,t=a(s),e=a(u),n=a(l),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function gd(){var t=td(pd());return t.copy=function(){return cd(t,gd()).exponent(t.exponent())},pf.apply(t,arguments)}function md(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function yd(t,e){var n=gh(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}}var vd,bd=180/Math.PI,xd={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function wd(t,e,n,r,i,o){var a,s,u;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*bd,skewX:Math.atan(u)*bd,scaleX:a,scaleY:s}}function _d(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],u=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var u=a.push("translate(",null,e,null,n);s.push({i:u-4,x:Dh(t,i)},{i:u-2,x:Dh(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,u),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Dh(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,u),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Dh(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,u),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Dh(t,n)},{i:s-2,x:Dh(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,u),o=a=null,function(t){for(var e,n=-1,r=u.length;++n<r;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var kd=_d((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?xd:wd(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Ad=_d((function(t){return null==t?xd:(vd||(vd=document.createElementNS("http://www.w3.org/2000/svg","g")),vd.setAttribute("transform",t),(t=vd.transform.baseVal.consolidate())?wd((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):xd)}),", ",")",")");function Ed(t){return((t=Math.exp(t))+1/t)/2}const Dd=function t(e,n,r){function i(t,i){var o,a,s=t[0],u=t[1],l=t[2],c=i[0],f=i[1],h=i[2],d=c-s,p=f-u,g=d*d+p*p;if(g<1e-12)a=Math.log(h/l)/e,o=function(t){return[s+t*d,u+t*p,l*Math.exp(e*t*a)]};else{var m=Math.sqrt(g),y=(h*h-l*l+r*g)/(2*l*n*m),v=(h*h-l*l-r*g)/(2*h*n*m),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);a=(x-b)/e,o=function(t){var r=t*a,i=Ed(b),o=l/(n*m)*(i*function(t){return((t=Math.exp(2*t))-1)/(t+1)}(e*r+b)-function(t){return((t=Math.exp(t))-1/t)/2}(b));return[s+o*d,u+o*p,l*i/Ed(e*r+b)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);function Sd(t){return function(e,n){var r=t((e=sh(e)).h,(n=sh(n)).h),i=mh(e.s,n.s),o=mh(e.l,n.l),a=mh(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}const Cd=Sd(gh);var Od=Sd(mh);const Fd=Math.PI/180,Md=180/Math.PI,$d=.96422,Nd=.82521,Bd=4/29,Td=6/29,jd=3*Td*Td;function Id(t){if(t instanceof Rd)return new Rd(t.l,t.a,t.b,t.opacity);if(t instanceof Hd)return Gd(t);t instanceof eh||(t=Qf(t));var e,n,r=Ud(t.r),i=Ud(t.g),o=Ud(t.b),a=Pd((.2225045*r+.7168786*i+.0606169*o)/1);return r===i&&i===o?e=n=a:(e=Pd((.4360747*r+.3850649*i+.1430804*o)/$d),n=Pd((.0139322*r+.0971045*i+.7141733*o)/Nd)),new Rd(116*a-16,500*(e-a),200*(a-n),t.opacity)}function zd(t,e,n,r){return 1===arguments.length?Id(t):new Rd(t,e,n,null==r?1:r)}function Rd(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Pd(t){return t>.008856451679035631?Math.pow(t,1/3):t/jd+Bd}function Ld(t){return t>Td?t*t*t:jd*(t-Bd)}function qd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ud(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wd(t){if(t instanceof Hd)return new Hd(t.h,t.c,t.l,t.opacity);if(t instanceof Rd||(t=Id(t)),0===t.a&&0===t.b)return new Hd(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Md;return new Hd(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function Vd(t,e,n,r){return 1===arguments.length?Wd(t):new Hd(t,e,n,null==r?1:r)}function Hd(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}function Gd(t){if(isNaN(t.h))return new Rd(t.l,0,0,t.opacity);var e=t.h*Fd;return new Rd(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}function Xd(t,e){var n=mh((t=zd(t)).l,(e=zd(e)).l),r=mh(t.a,e.a),i=mh(t.b,e.b),o=mh(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=r(e),t.b=i(e),t.opacity=o(e),t+""}}function Kd(t){return function(e,n){var r=t((e=Vd(e)).h,(n=Vd(n)).h),i=mh(e.c,n.c),o=mh(e.l,n.l),a=mh(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}$f(Rd,zd,Nf(Bf,{brighter:function(t){return new Rd(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Rd(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new eh(qd(3.1338561*(e=$d*Ld(e))-1.6168667*(t=1*Ld(t))-.4906146*(n=Nd*Ld(n))),qd(-.9787684*e+1.9161415*t+.033454*n),qd(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),$f(Hd,Vd,Nf(Bf,{brighter:function(t){return new Hd(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Hd(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Gd(this).rgb()}}));const Yd=Kd(gh);var Jd=Kd(mh),Zd=-.14861,Qd=1.78277,tp=-.29227,ep=-.90649,np=1.97294,rp=np*ep,ip=np*Qd,op=Qd*tp-ep*Zd;function ap(t){if(t instanceof up)return new up(t.h,t.s,t.l,t.opacity);t instanceof eh||(t=Qf(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(op*r+rp*e-ip*n)/(op+rp-ip),o=r-i,a=(np*(n-i)-tp*o)/ep,s=Math.sqrt(a*a+o*o)/(np*i*(1-i)),u=s?Math.atan2(a,o)*Md-120:NaN;return new up(u<0?u+360:u,s,i,t.opacity)}function sp(t,e,n,r){return 1===arguments.length?ap(t):new up(t,e,n,null==r?1:r)}function up(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function lp(t){return function e(n){function r(e,r){var i=t((e=sp(e)).h,(r=sp(r)).h),o=mh(e.s,r.s),a=mh(e.l,r.l),s=mh(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,r.gamma=e,r}(1)}$f(up,sp,Nf(Bf,{brighter:function(t){return t=null==t?jf:Math.pow(jf,t),new up(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Tf:Math.pow(Tf,t),new up(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*Fd,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new eh(255*(e+n*(Zd*r+Qd*i)),255*(e+n*(tp*r+ep*i)),255*(e+n*(np*r)),this.opacity)}}));const cp=lp(gh);var fp=lp(mh);function hp(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t(r/(e-1));return n}function dp(t,e,n){const r=t-e+2*n;return t?r>0?r:1:0}const pp="linear",gp="log",mp="pow",yp="sqrt",vp="symlog",bp="time",xp="utc",wp="sequential",_p="diverging",kp="quantile",Ap="quantize",Ep="threshold",Dp="ordinal",Sp="point",Cp="band",Op="bin-ordinal",Fp="continuous",Mp="discrete",$p="discretizing",Np="interpolating",Bp="temporal";function Tp(){const t=mf().unknown(void 0),e=t.domain,n=t.range;let r,i,o=[0,1],a=!1,s=0,u=0,l=.5;function c(){const t=e().length,c=o[1]<o[0],f=o[1-c],h=dp(t,s,u);let d=o[c-0];r=(f-d)/(h||1),a&&(r=Math.floor(r)),d+=(f-d-r*(t-s))*l,i=r*(1-s),a&&(d=Math.round(d),i=Math.round(i));const p=xu(t).map((t=>d+r*t));return n(c?p.reverse():p)}return delete t.unknown,t.domain=function(t){return arguments.length?(e(t),c()):e()},t.range=function(t){return arguments.length?(o=[+t[0],+t[1]],c()):o.slice()},t.rangeRound=function(t){return o=[+t[0],+t[1]],a=!0,c()},t.bandwidth=function(){return i},t.step=function(){return r},t.round=function(t){return arguments.length?(a=!!t,c()):a},t.padding=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),s=u,c()):s},t.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},t.paddingOuter=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},t.align=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},t.invertRange=function(t){if(null==t[0]||null==t[1])return;const r=o[1]<o[0],a=r?n().reverse():n(),s=a.length-1;let u,l,c,f=+t[0],h=+t[1];return f!=f||h!=h||(h<f&&(c=f,f=h,h=c),h<a[0]||f>o[1-r])?void 0:(u=Math.max(0,cf(a,f)-1),l=f===h?u:cf(a,h)-1,f-a[u]>i+1e-10&&++u,r&&(c=u,u=s-l,l=s-c),u>l?void 0:e().slice(u,l+1))},t.invert=function(e){const n=t.invertRange([e,e]);return n?n[0]:n},t.copy=function(){return Tp().domain(e()).range(o).round(a).paddingInner(s).paddingOuter(u).align(l)},c()}function jp(t){const e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,t.copy=function(){return jp(e())},t}var Ip=Array.prototype.map;function zp(t){return Ip.call(t,Ot)}const Rp=Array.prototype.slice,Pp={};function Lp(t,e,n){const r=function(){const n=e();return n.invertRange||(n.invertRange=n.invert?(r=n,function(t){let e,n=t[0],i=t[1];return i<n&&(e=n,n=i,i=e),[r.invert(n),r.invert(i)]}):n.invertExtent?function(t){return function(e){const n=t.range();let r,i,o,a,s=e[0],u=e[1],l=-1;for(u<s&&(i=s,s=u,u=i),o=0,a=n.length;o<a;++o)n[o]>=s&&n[o]<=u&&(l<0&&(l=o),r=o);if(!(l<0))return s=t.invertExtent(n[l]),u=t.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===u[1]?u[0]:u[1]]}}(n):void 0),n.type=t,n;var r};return r.metadata=Me(Gt(n)),r}function qp(t,e,n){return arguments.length>1?(Pp[t]=Lp(t,e,n),this):Up(t)?Pp[t]:void 0}function Up(t){return se(Pp,t)}function Wp(t,e){const n=Pp[t];return n&&n.metadata[e]}function Vp(t){return Wp(t,Fp)}function Hp(t){return Wp(t,Mp)}function Gp(t){return Wp(t,$p)}function Xp(t){return Wp(t,gp)}function Kp(t){return Wp(t,Np)}function Yp(t){return Wp(t,kp)}qp("identity",(function t(e){var n;function r(t){return null==t||isNaN(t=+t)?n:t}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,Nh),r):e.slice()},r.unknown=function(t){return arguments.length?(n=t,r):n},r.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,Nh):[0,1],qh(r)})),qp(pp,(function t(){var e=Lh();return e.copy=function(){return Rh(e,t())},df.apply(e,arguments),qh(e)}),Fp),qp(gp,(function t(){var e=Yh(Ph()).domain([1,10]);return e.copy=function(){return Rh(e,t()).base(e.base())},df.apply(e,arguments),e}),[Fp,gp]),qp(mp,ed,Fp),qp(yp,(function(){return ed.apply(null,arguments).exponent(.5)}),Fp),qp(vp,(function t(){var e=id(Ph());return e.copy=function(){return Rh(e,t()).constant(e.constant())},df.apply(e,arguments)}),Fp),qp(bp,(function(){return df.apply(ud(gr,yr,Jn,Kn,br,wr,kr,Er,Vi).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[Fp,Bp]),qp(xp,(function(){return df.apply(ud(Sr,Or,sr,or,Mr,Nr,kr,Er,Gi).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[Fp,Bp]),qp(wp,fd,[Fp,Np]),qp("".concat(wp,"-").concat(pp),fd,[Fp,Np]),qp("".concat(wp,"-").concat(gp),(function t(){var e=Yh(ld()).domain([1,10]);return e.copy=function(){return cd(e,t()).base(e.base())},pf.apply(e,arguments)}),[Fp,Np,gp]),qp("".concat(wp,"-").concat(mp),hd,[Fp,Np]),qp("".concat(wp,"-").concat(yp),(function(){return hd.apply(null,arguments).exponent(.5)}),[Fp,Np]),qp("".concat(wp,"-").concat(vp),(function t(){var e=id(ld());return e.copy=function(){return cd(e,t()).constant(e.constant())},pf.apply(e,arguments)}),[Fp,Np]),qp("".concat(_p,"-").concat(pp),(function t(){var e=qh(pd()(Th));return e.copy=function(){return cd(e,t())},pf.apply(e,arguments)}),[Fp,Np]),qp("".concat(_p,"-").concat(gp),(function t(){var e=Yh(pd()).domain([.1,1,10]);return e.copy=function(){return cd(e,t()).base(e.base())},pf.apply(e,arguments)}),[Fp,Np,gp]),qp("".concat(_p,"-").concat(mp),gd,[Fp,Np]),qp("".concat(_p,"-").concat(yp),(function(){return gd.apply(null,arguments).exponent(.5)}),[Fp,Np]),qp("".concat(_p,"-").concat(vp),(function t(){var e=id(pd());return e.copy=function(){return cd(e,t()).constant(e.constant())},pf.apply(e,arguments)}),[Fp,Np]),qp(kp,(function t(){var e,n=[],r=[],i=[];function o(){var t=0,e=Math.max(1,r.length);for(i=new Array(e-1);++t<e;)i[t-1]=As(n,t/e);return a}function a(t){return null==t||isNaN(t=+t)?e:r[hf(i,t)]}return a.invertExtent=function(t){var e=r.indexOf(t);return e<0?[NaN,NaN]:[e>0?i[e-1]:n[0],e<i.length?i[e]:n[n.length-1]]},a.domain=function(t){if(!arguments.length)return n.slice();n=[];for(let e of t)null==e||isNaN(e=+e)||n.push(e);return n.sort(Br),o()},a.range=function(t){return arguments.length?(r=Array.from(t),o()):r.slice()},a.unknown=function(t){return arguments.length?(e=t,a):e},a.quantiles=function(){return i.slice()},a.copy=function(){return t().domain(n).range(r).unknown(e)},df.apply(a,arguments)}),[$p,kp]),qp(Ap,(function t(){var e,n=0,r=1,i=1,o=[.5],a=[0,1];function s(t){return null!=t&&t<=t?a[hf(o,t,0,i)]:e}function u(){var t=-1;for(o=new Array(i);++t<i;)o[t]=((t+1)*r-(t-i)*n)/(i+1);return s}return s.domain=function(t){return arguments.length?([n,r]=t,n=+n,r=+r,u()):[n,r]},s.range=function(t){return arguments.length?(i=(a=Array.from(t)).length-1,u()):a.slice()},s.invertExtent=function(t){var e=a.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,o[0]]:e>=i?[o[i-1],r]:[o[e-1],o[e]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return t().domain([n,r]).range(a).unknown(e)},df.apply(qh(s),arguments)}),$p),qp(Ep,(function t(){var e,n=[.5],r=[0,1],i=1;function o(t){return null!=t&&t<=t?r[hf(n,t,0,i)]:e}return o.domain=function(t){return arguments.length?(n=Array.from(t),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(t){return arguments.length?(r=Array.from(t),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(t){var e=r.indexOf(t);return[n[e-1],n[e]]},o.unknown=function(t){return arguments.length?(e=t,o):e},o.copy=function(){return t().domain(n).range(r).unknown(e)},df.apply(o,arguments)}),$p),qp(Op,(function t(){let e=[],n=[];function r(t){return null==t||t!=t?void 0:n[(hf(e,t)-1)%n.length]}return r.domain=function(t){return arguments.length?(e=zp(t),r):e.slice()},r.range=function(t){return arguments.length?(n=Rp.call(t),r):n.slice()},r.tickFormat=function(t,n){return Mf(e[0],Ct(e),null==t?10:t,n)},r.copy=function(){return t().domain(r.domain()).range(r.range())},r}),[Mp,$p]),qp(Dp,mf,Mp),qp(Cp,Tp,Mp),qp(Sp,(function(){return jp(Tp().paddingInner(1))}),Mp);const Jp=["clamp","base","constant","exponent"];function Zp(t,e){const n=e[0],r=Ct(e)-n;return function(e){return t(n+e*r)}}function Qp(t,e,n){return dd(ng(e||"rgb",n),t)}function tg(t,e){const n=new Array(e),r=e+1;for(let i=0;i<e;)n[i]=t(++i/r);return n}function eg(t,e,n){const r=n-e;let i,o,a;return r&&Number.isFinite(r)?(i=(o=t.type).indexOf("-"),o=i<0?o:o.slice(i+1),a=qp(o)().domain([e,n]).range([0,1]),Jp.forEach((e=>t[e]?a[e](t[e]()):0)),a):ee(.5)}function ng(t,e){const n=a[function(t){return"interpolate"+t.toLowerCase().split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}(t)];return null!=e&&n&&n.gamma?n.gamma(e):n}function rg(t){const e=t.length/6|0,n=new Array(e);for(let r=0;r<e;)n[r]="#"+t.slice(6*r,6*++r);return n}function ig(t,e){for(const n in t)ag(n,e(t[n]))}const og={};function ag(t,e){return t=t&&t.toLowerCase(),arguments.length>1?(og[t]=e,this):og[t]}ig({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},rg),ig({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(t=>Qp(rg(t))));const sg="symbol",ug=t=>_t(t)?t.map((t=>String(t))):String(t),lg=(t,e)=>t[1]-e[1],cg=(t,e)=>e[1]-t[1];function fg(t,e,n){let r;return me(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(Ee(t.domain())/n||1)))),kt(e)&&(r=e.step,e=e.interval),ve(e)&&(e=t.type===bp?_i(e):t.type==xp?ki(e):at("Only time and utc scales accept interval strings."),r&&(e=e.every(r))),e}function hg(t,e,n){let r=t.range(),i=r[0],o=Ct(r),a=lg;if(i>o&&(r=o,o=i,i=r,a=cg),i=Math.floor(i),o=Math.ceil(o),e=e.map((e=>[e,t(e)])).filter((t=>i<=t[1]&&t[1]<=o)).sort(a).map((t=>t[0])),n>0&&e.length>1){const t=[e[0],Ct(e)];for(;e.length>n&&e.length>=3;)e=e.filter(((t,e)=>!(e%2)));e.length<3&&(e=t)}return e}function dg(t,e){return t.bins?hg(t,t.bins):t.ticks?t.ticks(e):t.domain()}function pg(t,e,n,r,i,o){const a=e.type;let s=ug;if(a===bp||i===bp)s=t.timeFormat(r);else if(a===xp||i===xp)s=t.utcFormat(r);else if(Xp(a)){const i=t.formatFloat(r);if(o||e.bins)s=i;else{const t=gg(e,n,!1);s=e=>t(e)?i(e):""}}else if(e.tickFormat){const i=e.domain();s=t.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=t.format(r));return s}function gg(t,e,n){const r=dg(t,e),i=t.base(),o=Math.log(i),a=Math.max(1,i*e/r.length),s=t=>{let e=t/Math.pow(i,Math.round(Math.log(t)/o));return e*i<i-.5&&(e*=i),e<=a};return n?r.filter(s):s}const mg={[kp]:"quantiles",[Ap]:"thresholds",[Ep]:"domain"},yg={[kp]:"quantiles",[Ap]:"domain"};function vg(t,e){return t.bins?function(t){const e=t.slice(0,-1);return e.max=Ct(t),e}(t.bins):t.type===gp?gg(t,e,!0):mg[t.type]?function(t){const e=[-1/0].concat(t);return e.max=1/0,e}(t[mg[t.type]]()):dg(t,e)}function bg(t,e,n,r,i,o,a){const s=yg[e.type]&&o!==bp&&o!==xp?function(t,e,n){const r=e[yg[e.type]](),i=r.length;let o,a=i>1?r[1]-r[0]:r[0];for(o=1;o<i;++o)a=Math.min(a,r[o]-r[o-1]);return t.formatSpan(0,a,30,n)}(t,e,i):pg(t,e,n,i,o,a);return r===sg&&(t=>mg[t.type]||t.bins)(e)?xg(s):"discrete"===r?_g(s):kg(s)}const xg=t=>(e,n,r)=>{const i=wg(r[n+1],wg(r.max,1/0)),o=Ag(e,t),a=Ag(i,t);return o&&a?o+"  "+a:a?"< "+a:" "+o},wg=(t,e)=>null!=t?t:e,_g=t=>(e,n)=>n?t(e):null,kg=t=>e=>t(e),Ag=(t,e)=>Number.isFinite(t)?e(t):null;function Eg(t,e,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=function(t,e,n,r){const i=r||e.type;return ve(n)&&function(t){return Wp(t,Bp)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==bp?n||i!==xp?bg(t,e,5,null,n,r,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}(t,e,n.format,n.formatType);if(Gp(e.type)){const t=vg(e).slice(1).map(i),n=t.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(t.join(", "))}if(Hp(e.type)){const t=e.domain(),n=t.length,o=n>r?t.slice(0,r-2).map(i).join(", ")+", ending with "+t.slice(-1).map(i):t.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(o)}{const t=e.domain();return"values from ".concat(i(t[0])," to ").concat(i(Ct(t)))}}let Dg=0;const Sg="p_";function Cg(t){return t&&t.gradient}function Og(t,e,n){const r=t.gradient;let i=t.id,o="radial"===r?Sg:"";return i||(i=t.id="gradient_"+Dg++,"radial"===r?(t.x1=Fg(t.x1,.5),t.y1=Fg(t.y1,.5),t.r1=Fg(t.r1,0),t.x2=Fg(t.x2,.5),t.y2=Fg(t.y2,.5),t.r2=Fg(t.r2,.5),o=Sg):(t.x1=Fg(t.x1,0),t.y1=Fg(t.y1,0),t.x2=Fg(t.x2,1),t.y2=Fg(t.y2,0))),e[i]=t,"url("+(n||"")+"#"+o+i+")"}function Fg(t,e){return null!=t?t:e}function Mg(t,e){var n,r=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:r,stop:function(t,e){return r.push({offset:t,color:e}),n}}}const $g={basis:{curve:function(t){return new Gl(t)}},"basis-closed":{curve:function(t){return new Kl(t)}},"basis-open":{curve:function(t){return new Yl(t)}},bundle:{curve:Zl,tension:"beta",value:.85},cardinal:{curve:ec,tension:"tension",value:0},"cardinal-open":{curve:rc,tension:"tension",value:0},"cardinal-closed":{curve:oc,tension:"tension",value:0},"catmull-rom":{curve:wc,tension:"alpha",value:.5},"catmull-rom-closed":{curve:kc,tension:"alpha",value:.5},"catmull-rom-open":{curve:Ec,tension:"alpha",value:.5},linear:{curve:Sc},"linear-closed":{curve:function(t){return new Cc(t)}},monotone:{horizontal:function(t){return new Bc(t)},vertical:function(t){return new Nc(t)}},natural:{curve:function(t){return new jc(t)}},step:{curve:function(t){return new zc(t,.5)}},"step-after":{curve:function(t){return new zc(t,1)}},"step-before":{curve:function(t){return new zc(t,0)}}};function Ng(t,e,n){var r=se($g,t)&&$g[t],i=null;return r&&(i=r.curve||r[e||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const Bg={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Tg=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function jg(t){const e=[];let n,r,i,o,a,s,u,l,c,f;const h=t.slice().replace(Tg[0],"###$1").split(Tg[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],r=n.slice(1).trim().replace(Tg[2],"$1###$2").replace(Tg[3],"$1###$2").split(Tg[4]),a=n.charAt(0),i=[a],l=0,f=r.length;l<f;++l)(o=+r[l])===o&&i.push(o);if(s=Bg[a.toLowerCase()],i.length-1>s){const t=i.length;for(l=1,e.push([a].concat(i.slice(l,l+=s))),a="M"===a?"L":"m"===a?"l":a;l<t;l+=s)e.push([a].concat(i.slice(l,l+s)))}else e.push(i)}return e}const Ig=Math.PI/180,zg=Math.PI/2,Rg=2*Math.PI,Pg=Math.sqrt(3)/2;var Lg={},qg={},Ug=[].join;function Wg(t){const e=Ug.call(t);if(qg[e])return qg[e];var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7];const c=l*a,f=-u*s,h=u*a,d=l*s,p=Math.cos(i),g=Math.sin(i),m=Math.cos(o),y=Math.sin(o),v=.5*(o-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*g,_=r+g+x*p,k=n+m,A=r+y,E=k+x*y,D=A-x*m;return qg[e]=[c*w+f*_,h*w+d*_,c*E+f*D,h*E+d*D,c*k+f*A,h*k+d*A]}const Vg=["l",0,0,0,0,0,0,0];function Hg(t,e,n){const r=Vg[0]=t[0];if("a"===r||"A"===r)Vg[1]=e*t[1],Vg[2]=n*t[2],Vg[3]=t[3],Vg[4]=t[4],Vg[5]=t[5],Vg[6]=e*t[6],Vg[7]=n*t[7];else if("h"===r||"H"===r)Vg[1]=e*t[1];else if("v"===r||"V"===r)Vg[1]=n*t[1];else for(var i=1,o=t.length;i<o;++i)Vg[i]=(i%2==1?e:n)*t[i];return Vg}function Gg(t,e,n,r,i,o){var a,s,u,l,c,f=null,h=0,d=0,p=0,g=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==o&&(o=i),t.beginPath&&t.beginPath();for(var m=0,y=e.length;m<y;++m){switch(a=e[m],1===i&&1===o||(a=Hg(a,i,o)),a[0]){case"l":h+=a[1],d+=a[2],t.lineTo(h+n,d+r);break;case"L":h=a[1],d=a[2],t.lineTo(h+n,d+r);break;case"h":h+=a[1],t.lineTo(h+n,d+r);break;case"H":h=a[1],t.lineTo(h+n,d+r);break;case"v":d+=a[1],t.lineTo(h+n,d+r);break;case"V":d=a[1],t.lineTo(h+n,d+r);break;case"m":h+=a[1],d+=a[2],t.moveTo(h+n,d+r);break;case"M":h=a[1],d=a[2],t.moveTo(h+n,d+r);break;case"c":s=h+a[5],u=d+a[6],p=h+a[3],g=d+a[4],t.bezierCurveTo(h+a[1]+n,d+a[2]+r,p+n,g+r,s+n,u+r),h=s,d=u;break;case"C":h=a[5],d=a[6],p=a[3],g=a[4],t.bezierCurveTo(a[1]+n,a[2]+r,p+n,g+r,h+n,d+r);break;case"s":s=h+a[3],u=d+a[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,h+a[1]+n,d+a[2]+r,s+n,u+r),p=h+a[1],g=d+a[2],h=s,d=u;break;case"S":s=a[3],u=a[4],p=2*h-p,g=2*d-g,t.bezierCurveTo(p+n,g+r,a[1]+n,a[2]+r,s+n,u+r),h=s,d=u,p=a[1],g=a[2];break;case"q":s=h+a[3],u=d+a[4],p=h+a[1],g=d+a[2],t.quadraticCurveTo(p+n,g+r,s+n,u+r),h=s,d=u;break;case"Q":s=a[3],u=a[4],t.quadraticCurveTo(a[1]+n,a[2]+r,s+n,u+r),h=s,d=u,p=a[1],g=a[2];break;case"t":s=h+a[1],u=d+a[2],null===f[0].match(/[QqTt]/)?(p=h,g=d):"t"===f[0]?(p=2*h-l,g=2*d-c):"q"===f[0]&&(p=2*h-p,g=2*d-g),l=p,c=g,t.quadraticCurveTo(p+n,g+r,s+n,u+r),d=u,p=(h=s)+a[1],g=d+a[2];break;case"T":s=a[1],u=a[2],p=2*h-p,g=2*d-g,t.quadraticCurveTo(p+n,g+r,s+n,u+r),h=s,d=u;break;case"a":Xg(t,h+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+h+n,a[7]+d+r]),h+=a[6],d+=a[7];break;case"A":Xg(t,h+n,d+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r]),h=a[6],d=a[7];break;case"z":case"Z":t.closePath()}f=a}}function Xg(t,e,n,r){const i=function(t,e,n,r,i,o,a,s,u){const l=Ug.call(arguments);if(Lg[l])return Lg[l];const c=a*Ig,f=Math.sin(c),h=Math.cos(c),d=h*(s-t)*.5+f*(u-e)*.5,p=h*(u-e)*.5-f*(s-t)*.5;let g=d*d/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,v=-f/r,b=h/r,x=m*s+y*u,w=v*s+b*u,_=m*t+y*e,k=v*t+b*e;let A=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;A<0&&(A=0);let E=Math.sqrt(A);o==i&&(E=-E);const D=.5*(x+_)-E*(k-w),S=.5*(w+k)+E*(_-x),C=Math.atan2(w-S,x-D);let O=Math.atan2(k-S,_-D)-C;O<0&&1===o?O+=Rg:O>0&&0===o&&(O-=Rg);const F=Math.ceil(Math.abs(O/(zg+.001))),M=[];for(let t=0;t<F;++t){const e=C+t*O/F,i=C+(t+1)*O/F;M[t]=[D,S,e,i,n,r,f,h]}return Lg[l]=M}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n);for(let e=0;e<i.length;++e){const n=Wg(i[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const Kg=.5773502691896257,Yg={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,Rg)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/2.5;t.moveTo(-n,-r),t.lineTo(-n,r),t.lineTo(-r,r),t.lineTo(-r,n),t.lineTo(r,n),t.lineTo(r,r),t.lineTo(n,r),t.lineTo(n,-r),t.lineTo(r,-r),t.lineTo(r,-n),t.lineTo(-r,-n),t.lineTo(-r,-r),t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),r=-n/2;t.rect(r,r,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,r=n/7,i=n/2.5,o=n/8;t.moveTo(-r,n),t.lineTo(r,n),t.lineTo(r,-o),t.lineTo(i,-o),t.lineTo(0,-n),t.lineTo(-i,-o),t.lineTo(-r,-o),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n,i=r-n*Kg,o=n/4;t.moveTo(0,-r-i),t.lineTo(-o,r-i),t.lineTo(o,r-i),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n,i=r-n*Kg;t.moveTo(0,-r-i),t.lineTo(-n,r-i),t.lineTo(n,r-i),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n;t.moveTo(0,-r),t.lineTo(-n,r),t.lineTo(n,r),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n;t.moveTo(0,r),t.lineTo(-n,-r),t.lineTo(n,-r),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n;t.moveTo(r,0),t.lineTo(-r,-n),t.lineTo(-r,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,r=Pg*n;t.moveTo(-r,0),t.lineTo(r,-n),t.lineTo(r,n),t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function Jg(t){return se(Yg,t)?Yg[t]:function(t){if(!se(Zg,t)){const e=jg(t);Zg[t]={draw:function(t,n){Gg(t,e,0,0,Math.sqrt(n)/2)}}}return Zg[t]}(t)}var Zg={};const Qg=.448084975506;function tm(t){return t.x}function em(t){return t.y}function nm(t){return t.width}function rm(t){return t.height}function im(t){return"function"==typeof t?t:()=>+t}function om(t,e,n){return Math.max(e,Math.min(t,n))}function am(){var t=tm,e=em,n=nm,r=rm,i=im(0),o=i,a=i,s=i,u=null;function l(l,c,f){var h,d=null!=c?c:+t.call(this,l),p=null!=f?f:+e.call(this,l),g=+n.call(this,l),m=+r.call(this,l),y=Math.min(g,m)/2,v=om(+i.call(this,l),0,y),b=om(+o.call(this,l),0,y),x=om(+a.call(this,l),0,y),w=om(+s.call(this,l),0,y);if(u||(u=h=Vc()),v<=0&&b<=0&&x<=0&&w<=0)u.rect(d,p,g,m);else{var _=d+g,k=p+m;u.moveTo(d+v,p),u.lineTo(_-b,p),u.bezierCurveTo(_-Qg*b,p,_,p+Qg*b,_,p+b),u.lineTo(_,k-w),u.bezierCurveTo(_,k-Qg*w,_-Qg*w,k,_-w,k),u.lineTo(d+x,k),u.bezierCurveTo(d+Qg*x,k,d,k-Qg*x,d,k-x),u.lineTo(d,p+v),u.bezierCurveTo(d,p+Qg*v,d+Qg*v,p,d+v,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(e){return arguments.length?(t=im(e),l):t},l.y=function(t){return arguments.length?(e=im(t),l):e},l.width=function(t){return arguments.length?(n=im(t),l):n},l.height=function(t){return arguments.length?(r=im(t),l):r},l.cornerRadius=function(t,e,n,r){return arguments.length?(i=im(t),o=null!=e?im(e):i,s=null!=n?im(n):i,a=null!=r?im(r):o,l):i},l.context=function(t){return arguments.length?(u=null==t?null:t,l):u},l}function sm(){var t,e,n,r,i,o,a,s,u=null;function l(t,e,n){const r=n/2;if(i){var l=a-e,c=t-o;if(l||c){var f=Math.sqrt(l*l+c*c),h=(l/=f)*s,d=(c/=f)*s,p=Math.atan2(c,l);u.moveTo(o-h,a-d),u.lineTo(t-l*r,e-c*r),u.arc(t,e,r,p-Math.PI,p),u.lineTo(o+h,a+d),u.arc(o,a,s,p,p+Math.PI)}else u.arc(t,e,r,0,Rg);u.closePath()}else i=1;o=t,a=e,s=r}function c(o){var a,s,c,f=o.length,h=!1;for(null==u&&(u=c=Vc()),a=0;a<=f;++a)!(a<f&&r(s=o[a],a,o))===h&&(h=!h)&&(i=0),h&&l(+t(s,a,o),+e(s,a,o),+n(s,a,o));if(c)return u=null,c+""||null}return c.x=function(e){return arguments.length?(t=e,c):t},c.y=function(t){return arguments.length?(e=t,c):e},c.size=function(t){return arguments.length?(n=t,c):n},c.defined=function(t){return arguments.length?(r=t,c):r},c.context=function(t){return arguments.length?(u=null==t?null:t,c):u},c}function um(t,e){return null!=t?t:e}const lm=t=>t.x||0,cm=t=>t.y||0,fm=t=>!(!1===t.defined),hm=function(){var t=Gc,e=Xc,n=Hc(0),r=null,i=Kc,o=Yc,a=Jc,s=null;function u(){var u,l,c=+t.apply(this,arguments),f=+e.apply(this,arguments),h=i.apply(this,arguments)-gc,d=o.apply(this,arguments)-gc,p=ac(d-h),g=d>h;if(s||(s=u=Vc()),f<c&&(l=f,f=c,c=l),f>dc)if(p>mc-dc)s.moveTo(f*uc(h),f*fc(h)),s.arc(0,0,f,h,d,!g),c>dc&&(s.moveTo(c*uc(d),c*fc(d)),s.arc(0,0,c,d,h,g));else{var m,y,v=h,b=d,x=h,w=d,_=p,k=p,A=a.apply(this,arguments)/2,E=A>dc&&(r?+r.apply(this,arguments):hc(c*c+f*f)),D=cc(ac(f-c)/2,+n.apply(this,arguments)),S=D,C=D;if(E>dc){var O=vc(E/c*fc(A)),F=vc(E/f*fc(A));(_-=2*O)>dc?(x+=O*=g?1:-1,w-=O):(_=0,x=w=(h+d)/2),(k-=2*F)>dc?(v+=F*=g?1:-1,b-=F):(k=0,v=b=(h+d)/2)}var M=f*uc(v),$=f*fc(v),N=c*uc(w),B=c*fc(w);if(D>dc){var T,j=f*uc(b),I=f*fc(b),z=c*uc(x),R=c*fc(x);if(p<pc&&(T=Zc(M,$,z,R,j,I,N,B))){var P=M-T[0],L=$-T[1],q=j-T[0],U=I-T[1],W=1/fc(yc((P*q+L*U)/(hc(P*P+L*L)*hc(q*q+U*U)))/2),V=hc(T[0]*T[0]+T[1]*T[1]);S=cc(D,(c-V)/(W-1)),C=cc(D,(f-V)/(W+1))}}k>dc?C>dc?(m=Qc(z,R,M,$,f,C,g),y=Qc(j,I,N,B,f,C,g),s.moveTo(m.cx+m.x01,m.cy+m.y01),C<D?s.arc(m.cx,m.cy,C,sc(m.y01,m.x01),sc(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,C,sc(m.y01,m.x01),sc(m.y11,m.x11),!g),s.arc(0,0,f,sc(m.cy+m.y11,m.cx+m.x11),sc(y.cy+y.y11,y.cx+y.x11),!g),s.arc(y.cx,y.cy,C,sc(y.y11,y.x11),sc(y.y01,y.x01),!g))):(s.moveTo(M,$),s.arc(0,0,f,v,b,!g)):s.moveTo(M,$),c>dc&&_>dc?S>dc?(m=Qc(N,B,j,I,c,-S,g),y=Qc(M,$,z,R,c,-S,g),s.lineTo(m.cx+m.x01,m.cy+m.y01),S<D?s.arc(m.cx,m.cy,S,sc(m.y01,m.x01),sc(y.y01,y.x01),!g):(s.arc(m.cx,m.cy,S,sc(m.y01,m.x01),sc(m.y11,m.x11),!g),s.arc(0,0,c,sc(m.cy+m.y11,m.cx+m.x11),sc(y.cy+y.y11,y.cx+y.x11),g),s.arc(y.cx,y.cy,S,sc(y.y11,y.x11),sc(y.y01,y.x01),!g))):s.arc(0,0,c,w,x,g):s.lineTo(N,B)}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-pc/2;return[uc(r)*n,fc(r)*n]},u.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Hc(+e),u):t},u.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),u):e},u.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:Hc(+t),u):n},u.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:Hc(+t),u):r},u.startAngle=function(t){return arguments.length?(i="function"==typeof t?t:Hc(+t),u):i},u.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:Hc(+t),u):o},u.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:Hc(+t),u):a},u.context=function(t){return arguments.length?(s=null==t?null:t,u):s},u}().startAngle((t=>t.startAngle||0)).endAngle((t=>t.endAngle||0)).padAngle((t=>t.padAngle||0)).innerRadius((t=>t.innerRadius||0)).outerRadius((t=>t.outerRadius||0)).cornerRadius((t=>t.cornerRadius||0)),dm=of().x(lm).y1(cm).y0((t=>(t.y||0)+(t.height||0))).defined(fm),pm=of().y(cm).x1(lm).x0((t=>(t.x||0)+(t.width||0))).defined(fm),gm=rf().x(lm).y(cm).defined(fm),mm=am().x(lm).y(cm).width((t=>t.width||0)).height((t=>t.height||0)).cornerRadius((t=>um(t.cornerRadiusTopLeft,t.cornerRadius)||0),(t=>um(t.cornerRadiusTopRight,t.cornerRadius)||0),(t=>um(t.cornerRadiusBottomRight,t.cornerRadius)||0),(t=>um(t.cornerRadiusBottomLeft,t.cornerRadius)||0)),ym=function(t,e){var n=null;function r(){var r;if(n||(n=r=Vc()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return t="function"==typeof t?t:Hc(t||af),e="function"==typeof e?e:Hc(void 0===e?64:+e),r.type=function(e){return arguments.length?(t="function"==typeof e?e:Hc(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:Hc(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r}().type((t=>Jg(t.shape||"circle"))).size((t=>um(t.size,64))),vm=sm().x(lm).y(cm).defined(fm).size((t=>t.size||1));function bm(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function xm(t,e,n,r){return mm.context(t)(e,n,r)}var wm=1;function _m(){wm=1}function km(t,e,n){var r=e.clip,i=t._defs,o=e.clip_id||(e.clip_id="clip"+wm++),a=i.clipping[o]||(i.clipping[o]={id:o});return Kt(r)?a.path=r(null):bm(n)?a.path=xm(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+o+")"}function Am(t){this.clear(),t&&this.union(t)}function Em(t){this.mark=t,this.bounds=this.bounds||new Am}function Dm(t){Em.call(this,t),this.items=this.items||[]}function Sm(t){this._pending=0,this._loader=t||Fa()}function Cm(t){t._pending+=1}function Om(t){t._pending-=1}function Fm(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){const r=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(r+(n?function(t,e){return t.strokeJoin&&"miter"!==t.strokeJoin?0:e}(e,r):0))}return t}Am.prototype={clone(){return new Am(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,r){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){const r=this.rotatedPoints(t,e,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(t,e,n){var{x1:r,y1:i,x2:o,y2:a}=this,s=Math.cos(t),u=Math.sin(t),l=e-e*s+n*u,c=n-e*u-n*s;return[s*r-u*i+l,u*r+s*i+c,s*r-u*a+l,u*r+s*a+c,s*o-u*i+l,u*o+s*i+c,s*o-u*a+l,u*o+s*a+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},fe(Dm,Em),Sm.prototype={pending(){return this._pending},sanitizeURL(t){const e=this;return Cm(e),e._loader.sanitize(t,{context:"href"}).then((t=>(Om(e),t))).catch((()=>(Om(e),null)))},loadImage(t){const e=this,n=uf();return Cm(e),e._loader.sanitize(t,{context:"image"}).then((t=>{const r=t.href;if(!r||!n)throw{url:r};const i=new n,o=se(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=o&&(i.crossOrigin=o),i.onload=()=>Om(e),i.onerror=()=>Om(e),i.src=r,i})).catch((t=>(Om(e),{complete:!1,width:0,height:0,src:t&&t.url||""})))},ready(){const t=this;return new Promise((e=>{!function n(r){t.pending()?setTimeout((()=>{n(!0)}),10):e(r)}(!1)}))}};const Mm=Rg-1e-8;let $m,Nm,Bm,Tm,jm,Im,zm,Rm;const Pm=(t,e)=>$m.add(t,e),Lm=(t,e)=>Pm(Nm=t,Bm=e),qm=t=>Pm(t,$m.y1),Um=t=>Pm($m.x1,t),Wm=(t,e)=>jm*t+zm*e,Vm=(t,e)=>Im*t+Rm*e,Hm=(t,e)=>Pm(Wm(t,e),Vm(t,e)),Gm=(t,e)=>Lm(Wm(t,e),Vm(t,e));function Xm(t,e){return $m=t,e?(Tm=e*Ig,jm=Rm=Math.cos(Tm),Im=Math.sin(Tm),zm=-Im):(jm=Rm=1,Tm=Im=zm=0),Km}const Km={beginPath(){},closePath(){},moveTo:Gm,lineTo:Gm,rect(t,e,n,r){Tm?(Hm(t+n,e),Hm(t+n,e+r),Hm(t,e+r),Gm(t,e)):(Pm(t+n,e+r),Lm(t,e))},quadraticCurveTo(t,e,n,r){const i=Wm(t,e),o=Vm(t,e),a=Wm(n,r),s=Vm(n,r);Ym(Nm,i,a,qm),Ym(Bm,o,s,Um),Lm(a,s)},bezierCurveTo(t,e,n,r,i,o){const a=Wm(t,e),s=Vm(t,e),u=Wm(n,r),l=Vm(n,r),c=Wm(i,o),f=Vm(i,o);Jm(Nm,a,u,c,qm),Jm(Bm,s,l,f,Um),Lm(c,f)},arc(t,e,n,r,i,o){if(r+=Tm,i+=Tm,Nm=n*Math.cos(i)+t,Bm=n*Math.sin(i)+e,Math.abs(i-r)>Mm)Pm(t-n,e-n),Pm(t+n,e+n);else{const a=r=>Pm(n*Math.cos(r)+t,n*Math.sin(r)+e);let s,u;if(a(r),a(i),i!==r)if((r%=Rg)<0&&(r+=Rg),(i%=Rg)<0&&(i+=Rg),i<r&&(o=!o,s=r,r=i,i=s),o)for(i-=Rg,s=r-r%zg,u=0;u<4&&s>i;++u,s-=zg)a(s);else for(s=r-r%zg+zg,u=0;u<4&&s<i;++u,s+=zg)a(s)}}};function Ym(t,e,n,r){const i=(t-e)/(t+n-2*e);0<i&&i<1&&r(t+(e-t)*i)}function Jm(t,e,n,r,i){const o=r-t+3*e-3*n,a=t+n-2*e,s=t-e;let u,l=0,c=0;Math.abs(o)>1e-14?(u=a*a+s*o,u>=0&&(u=Math.sqrt(u),l=(-a+u)/o,c=(-a-u)/o)):l=.5*s/a,0<l&&l<1&&i(Zm(l,t,e,n,r)),0<c&&c<1&&i(Zm(c,t,e,n,r))}function Zm(t,e,n,r,i){const o=1-t,a=o*o,s=t*t;return a*o*e+3*a*t*n+3*o*s*r+s*t*i}var Qm=(Qm=sf(1,1))?Qm.getContext("2d"):null;const ty=new Am;function ey(t){return function(e,n){if(!Qm)return!0;t(Qm,e),ty.clear().union(e.bounds).intersect(n).round();const{x1:r,y1:i,x2:o,y2:a}=ty;for(let t=i;t<=a;++t)for(let e=r;e<=o;++e)if(Qm.isPointInPath(e,t))return!0;return!1}}function ny(t,e){return e.contains(t.x||0,t.y||0)}function ry(t,e){const n=t.x||0,r=t.y||0,i=t.width||0,o=t.height||0;return e.intersects(ty.set(n,r,n+i,r+o))}function iy(t,e){const n=t.x||0,r=t.y||0;return oy(e,n,r,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r)}function oy(t,e,n,r,i){const{x1:o,y1:a,x2:s,y2:u}=t,l=r-e,c=i-n;let f,h,d,p,g=0,m=1;for(p=0;p<4;++p){if(0===p&&(f=-l,h=-(o-e)),1===p&&(f=l,h=s-e),2===p&&(f=-c,h=-(a-n)),3===p&&(f=c,h=u-n),Math.abs(f)<1e-10&&h<0)return!1;if(d=h/f,f<0){if(d>m)return!1;d>g&&(g=d)}else if(f>0){if(d<g)return!1;d<m&&(m=d)}}return!0}function ay(t,e){t.globalCompositeOperation=e.blend||"source-over"}function sy(t,e){return null==t?e:t}function uy(t,e){const n=e.length;for(let r=0;r<n;++r)t.addColorStop(e[r].offset,e[r].color);return t}function ly(t,e,n){return Cg(n)?function(t,e,n){const r=n.width(),i=n.height();let o;if("radial"===e.gradient)o=t.createRadialGradient(n.x1+sy(e.x1,.5)*r,n.y1+sy(e.y1,.5)*i,Math.max(r,i)*sy(e.r1,0),n.x1+sy(e.x2,.5)*r,n.y1+sy(e.y2,.5)*i,Math.max(r,i)*sy(e.r2,.5));else{const a=sy(e.x1,0),s=sy(e.y1,0),u=sy(e.x2,1),l=sy(e.y2,0);if(a!==u&&s!==l&&r!==i){const n=sf(Math.ceil(r),Math.ceil(i)),o=n.getContext("2d");return o.scale(r,i),o.fillStyle=uy(o.createLinearGradient(a,s,u,l),e.stops),o.fillRect(0,0,r,i),t.createPattern(n,"no-repeat")}o=t.createLinearGradient(n.x1+a*r,n.y1+s*i,n.x1+u*r,n.y1+l*i)}return uy(o,e.stops)}(t,n,e.bounds):n}function cy(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=ly(t,e,e.fill),!0)}var fy=[];function hy(t,e,n){var r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&(n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=ly(t,e,e.stroke),t.lineWidth=r,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||fy),t.lineDashOffset=e.strokeDashOffset||0),!0)}function dy(t,e){return t.zindex-e.zindex||t.index-e.index}function py(t){if(!t.zdirty)return t.zitems;var e,n,r,i=t.items,o=[];for(n=0,r=i.length;n<r;++n)(e=i[n]).index=n,e.zindex&&o.push(e);return t.zdirty=!1,t.zitems=o.sort(dy)}function gy(t,e){var n,r,i=t.items;if(!i||!i.length)return;const o=py(t);if(o&&o.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||e(i[n]);i=o}for(n=0,r=i.length;n<r;++n)e(i[n])}function my(t,e){var n,r,i=t.items;if(!i||!i.length)return null;const o=py(t);for(o&&o.length&&(i=o),r=i.length;--r>=0;)if(n=e(i[r]))return n;if(i===o)for(r=(i=t.items).length;--r>=0;)if(!i[r].zindex&&(n=e(i[r])))return n;return null}function yy(t){return function(e,n,r){gy(n,(n=>{r&&!r.intersects(n.bounds)||by(t,e,n,n)}))}}function vy(t){return function(e,n,r){!n.items.length||r&&!r.intersects(n.bounds)||by(t,e,n.items[0],n.items)}}function by(t,e,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(t(e,r)||(ay(e,n),n.fill&&cy(e,n,i)&&e.fill(),n.stroke&&hy(e,n,i)&&e.stroke()))}function xy(t){return t=t||dt,function(e,n,r,i,o,a){return r*=e.pixelRatio,i*=e.pixelRatio,my(n,(n=>{const s=n.bounds;if((!s||s.contains(o,a))&&s)return t(e,n,r,i,o,a)?n:void 0}))}}function wy(t,e){return function(n,r,i,o){var a,s,u=Array.isArray(r)?r[0]:r,l=null==e?u.fill:e,c=u.stroke&&n.isPointInStroke;return c&&(a=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=a?a:1,n.lineCap=null!=s?s:"butt"),!t(n,r)&&(l&&n.isPointInPath(i,o)||c&&n.isPointInStroke(i,o))}}function _y(t){return xy(wy(t))}function ky(t,e){return"translate("+t+","+e+")"}function Ay(t){return"rotate("+t+")"}function Ey(t){return ky(t.x||0,t.y||0)}function Dy(t,e,n){function r(t,n){var r=n.x||0,i=n.y||0,o=n.angle||0;t.translate(r,i),o&&t.rotate(o*=Ig),t.beginPath(),e(t,n),o&&t.rotate(-o),t.translate(-r,-i)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",function(t){return ky(t.x||0,t.y||0)+(t.angle?" "+Ay(t.angle):"")}(n)),t("d",e(null,n))},bound:function(t,n){return e(Xm(t,n.angle),n),Fm(t,n).translate(n.x||0,n.y||0)},draw:yy(r),pick:_y(r),isect:n||ey(r)}}var Sy=Dy("arc",(function(t,e){return hm.context(t)(e)}));function Cy(t,e,n){function r(t,n){t.beginPath(),e(t,n)}const i=wy(r);return{type:t,tag:"path",nested:!0,attr:function(t,n){var r=n.mark.items;r.length&&t("d",e(null,r))},bound:function(t,n){var r=n.items;return 0===r.length?t:(e(Xm(t),r),Fm(t,r[0]))},draw:vy(r),pick:function(t,e,n,r,o,a){var s=e.items,u=e.bounds;return!s||!s.length||u&&!u.contains(o,a)?null:(n*=t.pixelRatio,r*=t.pixelRatio,i(t,s,n,r)?s[0]:null)},isect:ny,tip:n}}var Oy=Cy("area",(function(t,e){const n=e[0],r=n.interpolate||"linear";return("horizontal"===n.orient?pm:dm).curve(Ng(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i="horizontal"===t[0].orient?e[1]:e[0],o="horizontal"===t[0].orient?"y":"x",a=t.length,s=1/0;--a>=0;)!1!==t[a].defined&&(r=Math.abs(t[a][o]-i))<s&&(s=r,n=t[a]);return n}));function Fy(t,e){t.beginPath(),bm(e)?xm(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function My(t){const e=sy(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function $y(t,e){const n=My(e);t("d",xm(null,e,n,n))}function Ny(t,e,n,r){const i=My(e);t.beginPath(),xm(t,e,(n||0)+i,(r||0)+i)}const By=wy(Ny),Ty=wy(Ny,!1),jy=wy(Ny,!0);var Iy={type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",Ey(e))},bound:function(t,e){if(!e.clip&&e.items){const n=e.items,r=n.length;for(let e=0;e<r;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),Fm(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n){gy(e,(e=>{const r=e.x||0,i=e.y||0,o=e.strokeForeground,a=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&a&&(Ny(t,e,r,i),ay(t,e),e.fill&&cy(t,e,a)&&t.fill(),e.stroke&&!o&&hy(t,e,a)&&t.stroke()),t.save(),t.translate(r,i),e.clip&&Fy(t,e),n&&n.translate(-r,-i),gy(e,(e=>{this.draw(t,e,n)})),n&&n.translate(r,i),t.restore(),o&&e.stroke&&a&&(Ny(t,e,r,i),ay(t,e),hy(t,e,a)&&t.stroke())}))},pick:function(t,e,n,r,i,o){if(e.bounds&&!e.bounds.contains(i,o)||!e.items)return null;const a=n*t.pixelRatio,s=r*t.pixelRatio;return my(e,(u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,o))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||o<f||o>p))return;if(t.save(),t.translate(c,f),c=i-c,f=o-f,g&&bm(u)&&!jy(t,u,a,s))return t.restore(),null;const m=u.strokeForeground,y=!1!==e.interactive;return y&&m&&u.stroke&&Ty(t,u,a,s)?(t.restore(),u):(l=my(u,(t=>function(t,e,n){return(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,n)}(t,c,f)?this.pick(t,n,r,c,f):null)),!l&&y&&(u.fill||!m&&u.stroke)&&By(t,u,a,s)&&(l=u),t.restore(),l||null)}))},isect:ry,content:function(t,e,n){t("clip-path",e.clip?km(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),$y(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?$y(t,e):t("d","")}},zy={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Ry(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then((e=>{t.image=e,t.image.url=t.url}))),n}function Py(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function Ly(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function qy(t,e){return"center"===t?e/2:"right"===t?e:0}function Uy(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var Wy={type:"image",tag:"image",nested:!1,attr:function(t,e,n){const r=Ry(e,n),i=Py(e,r),o=Ly(e,r),a=(e.x||0)-qy(e.align,i),s=(e.y||0)-Uy(e.baseline,o);t("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",zy["xmlns:xlink"],"xlink:href"),t("transform",ky(a,s)),t("width",i),t("height",o),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){const n=e.image,r=Py(e,n),i=Ly(e,n),o=(e.x||0)-qy(e.align,r),a=(e.y||0)-Uy(e.baseline,i);return t.set(o,a,o+r,a+i)},draw:function(t,e,n){gy(e,(e=>{if(n&&!n.intersects(e.bounds))return;const r=Ry(e,this);let i=Py(e,r),o=Ly(e,r);if(0===i||0===o)return;let a,s,u,l,c=(e.x||0)-qy(e.align,i),f=(e.y||0)-Uy(e.baseline,o);!1!==e.aspect&&(s=r.width/r.height,u=e.width/e.height,s==s&&u==u&&s!==u&&(u<s?(l=i/s,f+=(o-l)/2,o=l):(l=o*s,c+=(i-l)/2,i=l))),(r.complete||r.toDataURL)&&(ay(t,e),t.globalAlpha=null!=(a=e.opacity)?a:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(r,c,f,i,o))}))},pick:xy(),isect:dt,get:Ry,xOffset:qy,yOffset:Uy},Vy=Cy("line",(function(t,e){const n=e[0],r=n.interpolate||"linear";return gm.curve(Ng(r,n.orient,n.tension)).context(t)(e)}),(function(t,e){for(var n,r,i=Math.pow(t[0].strokeWidth||1,2),o=t.length;--o>=0;)if(!1!==t[o].defined&&(n=t[o].x-e[0])*n+(r=t[o].y-e[1])*r<i)return t[o];return null}));function Hy(t,e){var n=e.path;if(null==n)return!0;var r=e.x||0,i=e.y||0,o=e.scaleX||1,a=e.scaleY||1,s=(e.angle||0)*Ig,u=e.pathCache;u&&u.path===n||((e.pathCache=u=jg(n)).path=n),s&&t.rotate&&t.translate?(t.translate(r,i),t.rotate(s),Gg(t,u,0,0,o,a),t.rotate(-s),t.translate(-r,-i)):Gg(t,u,r,i,o,a)}var Gy={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,r=e.scaleY||1;1===n&&1===r||t("vector-effect","non-scaling-stroke"),t("transform",function(t){return ky(t.x||0,t.y||0)+(t.angle?" "+Ay(t.angle):"")+(t.scaleX||t.scaleY?" "+("scale("+(t.scaleX||1)+","+(t.scaleY||1)+")"):"")}(e)),t("d",e.path)},bound:function(t,e){return Hy(Xm(t,e.angle),e)?t.set(0,0,0,0):Fm(t,e,!0)},draw:yy(Hy),pick:_y(Hy),isect:ey(Hy)};function Xy(t,e){t.beginPath(),xm(t,e)}var Ky={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",xm(null,e))},bound:function(t,e){var n,r;return Fm(t.set(n=e.x||0,r=e.y||0,n+e.width||0,r+e.height||0),e)},draw:yy(Xy),pick:_y(Xy),isect:ry};function Yy(t,e,n){var r,i,o,a;return!(!e.stroke||!hy(t,e,n)||(r=e.x||0,i=e.y||0,o=null!=e.x2?e.x2:r,a=null!=e.y2?e.y2:i,t.beginPath(),t.moveTo(r,i),t.lineTo(o,a),0))}var Jy={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",Ey(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,r;return Fm(t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e)},draw:function(t,e,n){gy(e,(e=>{if(!n||n.intersects(e.bounds)){var r=null==e.opacity?1:e.opacity;r&&Yy(t,e,r)&&(ay(t,e),t.stroke())}}))},pick:xy((function(t,e,n,r){return!!t.isPointInStroke&&Yy(t,e,1)&&t.isPointInStroke(n,r)})),isect:iy},Zy=Dy("shape",(function(t,e){return(e.mark.shape||e.shape).context(t)(e)})),Qy=Dy("symbol",(function(t,e){return ym.context(t)(e)}),ny);const tv=we();var ev={height:sv,measureWidth:ov,estimateWidth:rv,width:rv,canvas:nv};function nv(t){ev.width=t&&Qm?ov:rv}function rv(t,e){return iv(fv(t,e),sv(t))}function iv(t,e){return~~(.8*t.length*e)}function ov(t,e){return sv(t)<=0||!(e=fv(t,e))?0:av(e,dv(t))}function av(t,e){const n=`(${e}) ${t}`;let r=tv.get(n);return void 0===r&&(Qm.font=e,r=Qm.measureText(t).width,tv.set(n,r)),r}function sv(t){return null!=t.fontSize?+t.fontSize||0:11}function uv(t){return null!=t.lineHeight?t.lineHeight:sv(t)+2}function lv(t){return e=t.lineBreak&&t.text&&!_t(t.text)?t.text.split(t.lineBreak):t.text,_t(e)?e.length>1?e:e[0]:e;var e}function cv(t){const e=lv(t);return(_t(e)?e.length-1:0)*uv(t)}function fv(t,e){const n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,r=function(t){if(ev.width===ov){const e=dv(t);return t=>av(t,e)}{const e=sv(t);return t=>iv(t,e)}}(t);if(r(e)<n)return e;var i,o=t.ellipsis||"",a="rtl"===t.dir,s=0,u=e.length;if(n-=r(o),a){for(;s<u;)i=s+u>>>1,r(e.slice(i))>n?s=i+1:u=i;return o+e.slice(s)}for(;s<u;)i=1+(s+u>>>1),r(e.slice(0,i))<n?s=i:u=i-1;return e.slice(0,s)+o}(t,n):n}function hv(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function dv(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+sv(t)+"px "+hv(t,e)}function pv(t){var e=t.baseline,n=sv(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*uv(t):"line-bottom"===e?.29*n-.5*uv(t):0)}nv(!0);const gv={left:"start",center:"middle",right:"end"},mv=new Am;function yv(t){var e,n=t.x||0,r=t.y||0,i=t.radius||0;return i&&(e=(t.theta||0)-zg,n+=i*Math.cos(e),r+=i*Math.sin(e)),mv.x1=n,mv.y1=r,mv}function vv(t,e,n){var r,i=ev.height(e),o=e.align,a=yv(e),s=a.x1,u=a.y1,l=e.dx||0,c=(e.dy||0)+pv(e)-Math.round(.8*i),f=lv(e);if(_t(f)?(i+=uv(e)*(f.length-1),r=f.reduce(((t,n)=>Math.max(t,ev.width(e,n))),0)):r=ev.width(e,f),"center"===o?l-=r/2:"right"===o&&(l-=r),t.set(l+=s,c+=u,l+r,c+i),e.angle&&!n)t.rotate(e.angle*Ig,s,u);else if(2===n)return t.rotatedPoints(e.angle*Ig,s,u);return t}var bv={arc:Sy,area:Oy,group:Iy,image:Wy,line:Vy,path:Gy,rect:Ky,rule:Jy,shape:Zy,symbol:Qy,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,r=e.dx||0,i=(e.dy||0)+pv(e),o=yv(e),a=o.x1,s=o.y1,u=e.angle||0;t("text-anchor",gv[e.align]||"start"),u?(n=ky(a,s)+" "+Ay(u),(r||i)&&(n+=" "+ky(r,i))):n=ky(a+r,s+i),t("transform",n)},bound:vv,draw:function(t,e,n){gy(e,(e=>{var r,i,o,a,s,u,l,c=null==e.opacity?1:e.opacity;if(!(n&&!n.intersects(e.bounds)||0===c||e.fontSize<=0||null==e.text||0===e.text.length)){if(t.font=dv(e),t.textAlign=e.align||"left",i=(r=yv(e)).x1,o=r.y1,e.angle&&(t.save(),t.translate(i,o),t.rotate(e.angle*Ig),i=o=0),i+=e.dx||0,o+=(e.dy||0)+pv(e),u=lv(e),ay(t,e),_t(u))for(s=uv(e),a=0;a<u.length;++a)l=fv(e,u[a]),e.fill&&cy(t,e,c)&&t.fillText(l,i,o),e.stroke&&hy(t,e,c)&&t.strokeText(l,i,o),o+=s;else l=fv(e,u),e.fill&&cy(t,e,c)&&t.fillText(l,i,o),e.stroke&&hy(t,e,c)&&t.strokeText(l,i,o);e.angle&&t.restore()}}))},pick:xy((function(t,e,n,r,i,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var a=yv(e),s=a.x1,u=a.y1,l=vv(mv,e,1),c=-e.angle*Ig,f=Math.cos(c),h=Math.sin(c),d=f*i-h*o+(s-f*s+h*u),p=h*i+f*o+(u-h*s-f*u);return l.contains(d,p)})),isect:function(t,e){const n=vv(mv,t,2);return oy(e,n[0],n[1],n[2],n[3])||oy(e,n[0],n[1],n[4],n[5])||oy(e,n[4],n[5],n[6],n[7])||oy(e,n[2],n[3],n[6],n[7])}},trail:Cy("trail",(function(t,e){return vm.context(t)(e)}),(function(t,e){for(var n,r,i=t.length;--i>=0;)if(!1!==t[i].defined&&(n=t[i].x-e[0])*n+(r=t[i].y-e[1])*r<(n=t[i].size||1)*n)return t[i];return null}))};function xv(t,e,n){var r=bv[t.mark.marktype],i=e||r.bound;return r.nested&&(t=t.mark),i(t.bounds||(t.bounds=new Am),t,n)}var wv={mark:null};function _v(t,e,n){var r,i,o,a,s=bv[t.marktype],u=s.bound,l=t.items,c=l&&l.length;if(s.nested)return c?o=l[0]:(wv.mark=t,o=wv),a=xv(o,u,n),e&&e.union(a)||a;if(e=e||t.bounds&&t.bounds.clear()||new Am,c)for(r=0,i=l.length;r<i;++r)e.union(xv(l[r],u,n));return t.bounds=e}const kv=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Av(t,e){return JSON.stringify(t,kv,e)}function Ev(t){return Dv("string"==typeof t?JSON.parse(t):t)}function Dv(t){var e,n,r,i=t.marktype,o=t.items;if(o)for(n=0,r=o.length;n<r;++n)e=i?"mark":"group",o[n][e]=t,o[n].zindex&&(o[n][e].zdirty=!0),"group"===(i||e)&&Dv(o[n]);return i&&_v(t),t}function Sv(t){arguments.length?this.root=Ev(t):(this.root=Cv({marktype:"group",name:"root",role:"frame"}),this.root.items=[new Dm(this.root)])}function Cv(t,e){const n={bounds:new Am,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function Ov(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function Fv(t,e){e=e.toLowerCase();for(var n=t.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===e)return n[r]}function Mv(t,e,n,r){var i,o=t.childNodes[e];return o&&o.tagName.toLowerCase()===n.toLowerCase()||(i=o||null,o=Ov(t.ownerDocument,n,r),t.insertBefore(o,i)),o}function $v(t,e){for(var n=t.childNodes,r=n.length;r>e;)t.removeChild(n[--r]);return t}function Nv(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function Bv(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function Tv(t,e){this._active=null,this._handlers={},this._loader=t||Fa(),this._tooltip=e||jv}function jv(t,e,n,r){t.element().setAttribute("title",r||"")}function Iv(t){this._el=null,this._bgcolor=null,this._loader=new Sm(t)}Sv.prototype={toJSON(t){return Av(this.root,t||0)},mark(t,e,n){const r=Cv(t,e=e||this.root.items[0]);return e.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},Tv.prototype={initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,e,n){for(let r=t?t.length:0;--r>=0;)if(t[r].type===e&&(!n||t[r].handler===n))return r;return-1},handlers(t){const e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(const t in e)n.push(...e[t]);return n},eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),r=Ov(null,"a");for(const t in e)r.setAttribute(t,e[t]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,r){var i,o,a=t&&t.mark;if(a&&(i=bv[a.marktype]).tip){for((o=Bv(e,n))[0]-=r[0],o[1]-=r[1];t=t.mark.group;)o[0]-=t.x||0,o[1]-=t.y||0;t=i.tip(a.items,o)}return t}(e,t,this.canvas(),this._origin);const r=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,r)}},getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),r=this._origin,i=t.bounds,o=i.width(),a=i.height();let s=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;t.mark&&(t=t.mark.group);)s+=t.x||0,u+=t.y||0;return{x:s,y:u,width:o,height:a,left:s,top:u,right:s+o,bottom:u+a}}},Iv.prototype={initialize(t,e,n,r,i){return this._el=t,this.resize(e,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},resize(t,e,n,r){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(t){const e=this;return e._call=function(){e._render(t)},e._call(),e._call=null,e},_render(){},renderAsync(t){const e=this.render(t);return this._ready?this._ready.then((()=>e)):Promise.resolve(e)},_load(t,e){var n=this,r=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{e&&t(),n._ready=null}))}return r},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const zv="dragenter",Rv="dragleave",Pv="dragover",Lv="mousedown",qv="mousemove",Uv="mouseout",Wv="mouseover",Vv="click",Hv="mousewheel",Gv="touchstart",Xv="touchmove",Kv="touchend",Yv=qv,Jv=Uv,Zv=Vv;function Qv(t,e){Tv.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}function tb(t,e){(t=>t===Gv||t===Xv||t===Kv?[Gv,Xv,Kv]:[t])(e).forEach((e=>function(t,e){const n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))}(t,e)))}function eb(t,e,n){return function(r){const i=this._active,o=this.pickEvent(r);o===i||(i&&i.exit||this.fire(n,r),this._active=o,this.fire(e,r)),this.fire(t,r)}}function nb(t){return function(e){this.fire(t,e),this._active=null}}fe(Qv,Tv,{initialize(t,e,n){return this._canvas=t&&Fv(t,"canvas"),[Vv,Lv,qv,Uv,Rv].forEach((t=>tb(this,t))),Tv.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",zv,Rv,Pv,Lv,"mouseup",qv,Uv,Wv,Vv,"dblclick","wheel",Hv,Gv,Xv,Kv],DOMMouseScroll(t){this.fire(Hv,t)},mousemove:eb(qv,Wv,Uv),dragover:eb(Pv,zv,Rv),mouseout:nb(Uv),dragleave:nb(Rv),mousedown(t){this._down=this._active,this.fire(Lv,t)},click(t){this._down===this._active&&(this.fire(Vv,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Gv,t,!0)},touchmove(t){this.fire(Xv,t,!0)},touchend(t){this.fire(Kv,t,!0),this._touch=null},fire(t,e,n){const r=n?this._touch:this._active,i=this._handlers[t];if(e.vegaType=t,t===Zv&&r&&r.href?this.handleHref(e,r,r.href):t!==Yv&&t!==Jv||this.handleTooltip(e,r,t!==Jv),i)for(let t=0,n=i.length;t<n;++t)i[t].handler.call(this._obj,e,r)},on(t,e){const n=this.eventName(t),r=this._handlers;return this._handlerIndex(r[n],t,e)<0&&(tb(this,t),(r[n]||(r[n]=[])).push({type:t,handler:e})),this},off(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&r.splice(i,1),this},pickEvent(t){const e=Bv(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,r,i){const o=this.context();return bv[t.marktype].pick.call(this,o,t,e,n,r,i)}});var rb="undefined"!=typeof window&&window.devicePixelRatio||1;function ib(t){Iv.call(this,t),this._options={},this._redraw=!1,this._dirty=new Am,this._tempb=new Am}const ob=Iv.prototype;function ab(t,e){Tv.call(this,t,e);const n=this;n._hrefHandler=sb(n,((t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)})),n._tooltipHandler=sb(n,((t,e)=>{n.handleTooltip(t,e,t.type!==Jv)}))}fe(ib,Iv,{initialize(t,e,n,r,i,o){return this._options=o||{},this._canvas=this._options.externalContext?null:sf(1,1,this._options.type),t&&this._canvas&&($v(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),ob.initialize.call(this,t,e,n,r,i)},resize(t,e,n,r){if(ob.resize.call(this,t,e,n,r),this._canvas)!function(t,e,n,r,i,o){const a="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,s=t.getContext("2d"),u=a?rb:i;t.width=e*u,t.height=n*u;for(const t in o)s[t]=o[t];a&&1!==u&&(t.style.width=e+"px",t.style.height=n+"px"),s.pixelRatio=u,s.setTransform(u,0,0,u,u*r[0],u*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const t=this._options.externalContext;t||at("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},_render(t){const e=this.context(),n=this._origin,r=this._width,i=this._height,o=this._dirty,a=((t,e,n)=>(new Am).set(0,0,e,n).translate(-t[0],-t[1]))(n,r,i);e.save();const s=this._redraw||o.empty()?(this._redraw=!1,a.expand(1)):function(t,e,n){return e.expand(1).round(),t.pixelRatio%1&&e.scale(t.pixelRatio).round().scale(1/t.pixelRatio),e.translate(-n[0]%1,-n[1]%1),t.beginPath(),t.rect(e.x1,e.y1,e.width(),e.height()),t.clip(),e}(e,a.intersect(o),n);return this.clear(-n[0],-n[1],r,i),this.draw(e,t,s),e.restore(),o.clear(),this},draw(t,e,n){const r=bv[e.marktype];e.clip&&function(t,e){var n=e.clip;t.save(),Kt(n)?(t.beginPath(),n(t),t.clip()):Fy(t,e.group)}(t,e),r.draw.call(this,t,e,n),e.clip&&t.restore()},clear(t,e,n,r){const i=this._options,o=this.context();"pdf"===i.type||i.externalContext||o.clearRect(t,e,n,r),null!=this._bgcolor&&(o.fillStyle=this._bgcolor,o.fillRect(t,e,n,r))}});const sb=(t,e)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,e.call(t._obj,n,r)};fe(ab,Tv,{initialize(t,e,n){let r=this._svg;return r&&(r.removeEventListener(Zv,this._hrefHandler),r.removeEventListener(Yv,this._tooltipHandler),r.removeEventListener(Jv,this._tooltipHandler)),this._svg=r=t&&Fv(t,"svg"),r&&(r.addEventListener(Zv,this._hrefHandler),r.addEventListener(Yv,this._tooltipHandler),r.addEventListener(Jv,this._tooltipHandler)),Tv.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){const n=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[n],t,e)<0){const i={type:t,handler:e,listener:sb(this,e)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(t,e){const n=this.eventName(t),r=this._handlers[n],i=this._handlerIndex(r,t,e);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const ub="aria-hidden",lb="aria-label",cb="role",fb="aria-roledescription",hb="graphics-object",db="graphics-symbol",pb=(t,e,n)=>({[cb]:t,[fb]:e,[lb]:n||void 0}),gb=Me(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),mb={axis:{desc:"axis",caption:function(t){const e=t.datum,n=t.orient,r=e.title?wb(t):null,i=t.context,o=i.scales[e.scale].value,a=i.dataflow.locale(),s=o.type;return("left"===n||"right"===n?"Y":"X")+"-axis"+(r?` titled '${r}'`:"")+` for a ${Hp(s)?"discrete":s} scale`+` with ${Eg(a,o,t)}`}},legend:{desc:"legend",caption:function(t){const e=t.datum,n=e.title?wb(t):null,r=`${e.type||""} legend`.trim(),i=e.scales,o=Object.keys(i),a=t.context,s=a.scales[i[o[0]]].value,u=a.dataflow.locale();return((l=r).length?l[0].toUpperCase()+l.slice(1):l)+(n?` titled '${n}'`:"")+` for ${function(t){return(t=t.map((t=>t+("fill"===t||"stroke"===t?" color":"")))).length<2?t[0]:t.slice(0,-1).join(", ")+" and "+Ct(t)}(o)}`+` with ${Eg(u,s,t)}`;var l}},"title-text":{desc:"title",caption:t=>`Title text '${xb(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${xb(t)}'`}},yb={ariaRole:cb,ariaRoleDescription:fb,description:lb};function vb(t,e){const n=!1===e.aria;if(t(ub,n||void 0),n||null==e.description)for(const e in yb)t(yb[e],void 0);else{const n=e.mark.marktype;t(lb,e.description),t(cb,e.ariaRole||("group"===n?hb:db)),t(fb,e.ariaRoleDescription||`${n} mark`)}}function bb(t){return!1===t.aria?{[ub]:!0}:gb[t.role]?null:mb[t.role]?function(t,e){try{const n=t.items[0],r=e.caption||(()=>"");return pb(e.role||db,e.desc,n.description||r(n))}catch(t){return null}}(t,mb[t.role]):function(t){const e=t.marktype,n="group"===e||"text"===e||t.items.some((t=>null!=t.description&&!1!==t.aria));return pb(n?hb:db,`${e} mark container`,t.description)}(t)}function xb(t){return Gt(t.text).join(" ")}function wb(t){try{return Gt(Ct(t.items).items[0].text).join(" ")}catch(t){return null}}const _b=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function kb(){let t="",e="",n="";const r=[],i=()=>e=n="",o=(t,n)=>{var r;return null!=n&&(e+=` ${t}="${r=n,_b(r).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")}"`),a},a={open(s,...u){(o=>{e&&(t+=`${e}>${n}`,i()),r.push(o)})(s),e="<"+s;for(const t of u)for(const e in t)o(e,t[e]);return a},close(){const o=r.pop();return t+=e?e+(n?`>${n}</${o}>`:"/>"):`</${o}>`,i(),a},attr:o,text:t=>(n+=_b(t),a),toString:()=>t};return a}const Ab=t=>Eb(kb(),t)+"";function Eb(t,e){if(t.open(e.tagName),e.hasAttributes()){const n=e.attributes,r=n.length;for(let e=0;e<r;++e)t.attr(n[e].name,n[e].value)}if(e.hasChildNodes()){const n=e.childNodes,r=n.length;for(let e=0;e<r;e++){const r=n[e];3===r.nodeType?t.text(r.nodeValue):Eb(t,r)}}return t.close()}const Db={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Sb={fill:"none","stroke-miterlimit":10},Cb="http://www.w3.org/2000/xmlns/",Ob=zy.xmlns;function Fb(t){Iv.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Mb=Iv.prototype;function $b(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function Nb(t,e,n){let r,i,o;if("radial"===e.gradient){let r=Mv(t,n++,"pattern",Ob);Lb(r,{id:Sg+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=Mv(r,0,"rect",Ob),Lb(r,{width:1,height:1,fill:`url(${Ub()}#${e.id})`}),Lb(t=Mv(t,n++,"radialGradient",Ob),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else Lb(t=Mv(t,n++,"linearGradient",Ob),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(r=0,i=e.stops.length;r<i;++r)o=Mv(t,r,"stop",Ob),o.setAttribute("offset",e.stops[r].offset),o.setAttribute("stop-color",e.stops[r].color);return $v(t,r),n}function Bb(t,e,n){let r;return(t=Mv(t,n,"clipPath",Ob)).setAttribute("id",e.id),e.path?(r=Mv(t,0,"path",Ob),r.setAttribute("d",e.path)):(r=Mv(t,0,"rect",Ob),Lb(r,{x:0,y:0,width:e.width,height:e.height})),$v(t,1),n+1}function Tb(t,e,n,r,i){let o,a=t._svg;if(!a&&(o=e.ownerDocument,a=Ov(o,r,Ob),t._svg=a,t.mark&&(a.__data__=t,a.__values__={fill:"default"},"g"===r))){const e=Ov(o,"path",Ob);a.appendChild(e),e.__data__=t;const n=Ov(o,"g",Ob);a.appendChild(n),n.__data__=t;const r=Ov(o,"path",Ob);a.appendChild(r),r.__data__=t,r.__values__={fill:"default"}}return(a.ownerSVGElement!==i||function(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}(a,n))&&e.insertBefore(a,n?n.nextSibling:e.firstChild),a}fe(Fb,Iv,{initialize(t,e,n,r,i){return this._defs={},this._clearDefs(),t&&(this._svg=Mv(t,0,"svg",Ob),this._svg.setAttributeNS(Cb,"xmlns",Ob),this._svg.setAttributeNS(Cb,"xmlns:xlink",zy["xmlns:xlink"]),this._svg.setAttribute("version",zy.version),this._svg.setAttribute("class","marks"),$v(t,1),this._root=Mv(this._svg,0,"g",Ob),Lb(this._root,Sb),$v(this._svg,1)),this.background(this._bgcolor),Mb.initialize.call(this,t,e,n,r,i)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),Mb.background.apply(this,arguments)},resize(t,e,n,r){return Mb.resize.call(this,t,e,n,r),this._svg&&(Lb(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;e&&(t.removeAttribute("style"),n=Mv(t,0,"rect",Ob),Lb(n,{width:this._width,height:this._height,fill:e}));const r=Ab(t);return e&&(t.removeChild(n),this._svg.style.setProperty("background-color",e)),r},_render(t){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t),$v(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const e=++this._dirtyID;let n,r,i,o,a,s,u;for(a=0,s=t.length;a<s;++a)n=t[a],r=n.mark,r.marktype!==i&&(i=r.marktype,o=bv[i]),r.zdirty&&r.dirty!==e&&(this._dirtyAll=!1,$b(n,e),r.items.forEach((t=>{t.dirty=e}))),r.zdirty||(n.exit?(o.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(o,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null):(n=o.nested?r.items[0]:n,n._update!==e&&(n._svg&&n._svg.ownerSVGElement?this._update(o,n._svg,n):(this._dirtyAll=!1,$b(n,e)),n._update=e)));return!this._dirtyAll},mark(t,e,n){if(!this.isDirty(e))return e._svg;const r=this._svg,i=bv[e.marktype],o=!1===e.interactive?"none":null,a="g"===i.tag;let s=null,u=0;const l=Tb(e,t,n,"g",r);l.setAttribute("class",Nv(e));const c=bb(e);for(const t in c)qb(l,t,c[t]);a||qb(l,"pointer-events",o),qb(l,"clip-path",e.clip?km(this,e,e.group):null);const f=t=>{const e=this.isDirty(t),n=Tb(t,l,s,i.tag,r);e&&(this._update(i,n,t),a&&function(t,e,n){e=e.lastChild.previousSibling;let r,i=0;gy(n,(n=>{r=t.mark(e,n,r),++i})),$v(e,1+i)}(this,n,t)),s=n,++u};return i.nested?e.items.length&&f(e.items[0]):gy(e,f),$v(l,u),l},_update(t,e,n){jb=e,Ib=e.__values__,vb(Rb,n),t.attr(Rb,n,this);const r=zb[t.type];r&&r.call(this,t,e,n),jb&&this.style(jb,n)},style(t,e){if(null!=e)for(const n in Db){let r="font"===n?hv(e):e[n];if(r===Ib[n])continue;const i=Db[n];null==r?t.removeAttribute(i):(Cg(r)&&(r=Og(r,this._defs.gradient,Ub())),t.setAttribute(i,r+"")),Ib[n]=r}},defs(){const t=this._svg,e=this._defs;let n=e.el,r=0;for(const i in e.gradient)n||(e.el=n=Mv(t,1,"defs",Ob)),r=Nb(n,e.gradient[i],r);for(const i in e.clipping)n||(e.el=n=Mv(t,1,"defs",Ob)),r=Bb(n,e.clipping[i],r);n&&(0===r?(t.removeChild(n),e.el=null):$v(n,r))},_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}});let jb=null,Ib=null;const zb={group(t,e,n){const r=jb=e.childNodes[2];Ib=r.__values__,t.foreground(Rb,n,this),Ib=e.__values__,jb=e.childNodes[1],t.content(Rb,n,this);const i=jb=e.childNodes[0];t.background(Rb,n,this);const o=!1===n.mark.interactive?"none":null;if(o!==Ib.events&&(qb(r,"pointer-events",o),qb(i,"pointer-events",o),Ib.events=o),n.strokeForeground&&n.stroke){const t=n.fill;qb(r,"display",null),this.style(i,n),qb(i,"stroke",null),t&&(n.fill=null),Ib=r.__values__,this.style(r,n),t&&(n.fill=t),jb=null}else qb(r,"display","none")},image(t,e,n){!1===n.smooth?(Pb(e,"image-rendering","optimizeSpeed"),Pb(e,"image-rendering","pixelated")):Pb(e,"image-rendering",null)},text(t,e,n){const r=lv(n);let i,o,a,s;_t(r)?(o=r.map((t=>fv(n,t))),i=o.join("\n"),i!==Ib.text&&($v(e,0),a=e.ownerDocument,s=uv(n),o.forEach(((t,r)=>{const i=Ov(a,"tspan",Ob);i.__data__=n,i.textContent=t,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),e.appendChild(i)})),Ib.text=i)):(o=fv(n,r),o!==Ib.text&&(e.textContent=o,Ib.text=o)),qb(e,"font-family",hv(n)),qb(e,"font-size",sv(n)+"px"),qb(e,"font-style",n.fontStyle),qb(e,"font-variant",n.fontVariant),qb(e,"font-weight",n.fontWeight)}};function Rb(t,e,n){e!==Ib[t]&&(n?function(t,e,n,r){null!=n?t.setAttributeNS(r,e,n):t.removeAttributeNS(r,e)}(jb,t,e,n):qb(jb,t,e),Ib[t]=e)}function Pb(t,e,n){n!==Ib[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),Ib[e]=n)}function Lb(t,e){for(const n in e)qb(t,n,e[n])}function qb(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function Ub(){let t;return"undefined"==typeof window?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function Wb(t){Iv.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}fe(Wb,Iv,{svg(){return this._text},_render(t){const e=kb();e.open("svg",re({},zy,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",Sb,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){const n=bv[e.marktype],r=n.tag,i=[vb,n.attr];t.open("g",{class:Nv(e),"clip-path":e.clip?km(this,e,e.group):null},bb(e),{"pointer-events":"g"!==r&&!1===e.interactive?"none":null});const o=o=>{const a=this.href(o);if(a&&t.open("a",a),t.open(r,this.attr(e,o,i,"g"!==r?r:null)),"text"===r){const e=lv(o);if(_t(e)){const n={x:0,dy:uv(o)};for(let r=0;r<e.length;++r)t.open("tspan",r?n:null).text(fv(o,e[r])).close()}else t.text(fv(o,e))}else if("g"===r){const r=o.strokeForeground,i=o.fill,a=o.stroke;r&&a&&(o.stroke=null),t.open("path",this.attr(e,o,n.background,"bgrect")).close(),t.open("g",this.attr(e,o,n.content)),gy(o,(e=>this.mark(t,e))),t.close(),r&&a?(i&&(o.fill=null),o.stroke=a,t.open("path",this.attr(e,o,n.foreground,"bgrect")).close(),i&&(o.fill=i)):t.open("path",this.attr(e,o,n.foreground,"bgfore")).close()}t.close(),a&&t.close()};return n.nested?e.items&&e.items.length&&o(e.items[0]):gy(e,o),t.close()},href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e])return n;this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[e]=t}))}return null},attr(t,e,n,r){const i={},o=(t,e,n,r)=>{i[r||t]=e};return Array.isArray(n)?n.forEach((t=>t(o,e,this))):n(o,e,this),r&&function(t,e,n,r,i){if(null==e)return t;if("bgrect"===r&&!1===n.interactive&&(t["pointer-events"]="none"),"bgfore"===r&&(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null!==e.fill))return t;"image"===r&&!1===e.smooth&&(t.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),"text"===r&&(t["font-family"]=hv(e),t["font-size"]=sv(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight);for(const n in Db){let r=e[n];const o=Db[n];("transparent"!==r||"fill"!==o&&"stroke"!==o)&&null!=r&&(Cg(r)&&(r=Og(r,i.gradient,"")),t[o]=r)}}(i,e,t,r,this._defs),i},defs(t){const e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){t.open("defs");for(const n in e){const r=e[n],i=r.stops;"radial"===r.gradient?(t.open("pattern",{id:Sg+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):t.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let e=0;e<i.length;++e)t.open("stop",{offset:i[e].offset,"stop-color":i[e].color}).close();t.close()}for(const e in n){const r=n[e];t.open("clipPath",{id:e}),r.path?t.open("path",{d:r.path}).close():t.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),t.close()}t.close()}}});const Vb={Canvas:"canvas",PNG:"png",SVG:"svg",None:"none"},Hb={};function Gb(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(Hb[t]=e,this):Hb[t]}function Xb(t,e,n){const r=[],i=(new Am).union(e),o=t.marktype;return o?Kb(t,i,n,r):"group"===o?Yb(t,i,n,r):at("Intersect scene must be mark node or group item.")}function Kb(t,e,n,r){if(function(t,e,n){return t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))}(t,e,n)){const i=t.items,o=t.marktype,a=i.length;let s=0;if("group"===o)for(;s<a;++s)Yb(i[s],e,n,r);else for(const t=bv[o].isect;s<a;++s){const n=i[s];Jb(n,e,t)&&r.push(n)}}return r}function Yb(t,e,n,r){n&&n(t.mark)&&Jb(t,e,bv.group.isect)&&r.push(t);const i=t.items,o=i&&i.length;if(o){const a=t.x||0,s=t.y||0;e.translate(-a,-s);for(let t=0;t<o;++t)Kb(i[t],e,n,r);e.translate(a,s)}return r}function Jb(t,e,n){const r=t.bounds;return e.encloses(r)||e.intersects(r)&&n(t,e)}Hb.canvas=Hb.png={renderer:ib,headless:ib,handler:Qv},Hb.svg={renderer:Fb,headless:Wb,handler:ab},Hb.none={};const Zb=new Am;function Qb(t){const e=t.clip;if(Kt(e))e(Xm(Zb.clear()));else{if(!e)return;Zb.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(Zb)}function tx(t,e,n){return t===e||("path"===n?ex(t,e):t instanceof Date&&e instanceof Date?+t==+e:me(t)&&me(e)?Math.abs(t-e)<=1e-9:t&&e&&(kt(t)||kt(e))?function(t,e){var n,r,i=Object.keys(t),o=Object.keys(e);if(i.length!==o.length)return!1;for(i.sort(),o.sort(),r=i.length-1;r>=0;r--)if(i[r]!=o[r])return!1;for(r=i.length-1;r>=0;r--)if(!tx(t[n=i[r]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function ex(t,e){return tx(jg(t),jg(e))}function nx(){_m(),Dg=0}const rx="top",ix="left",ox="right",ax="bottom",sx="start",ux="middle",lx="end",cx="group",fx="axis",hx="title",dx="legend",px="row-header",gx="row-footer",mx="row-title",yx="column-header",vx="column-footer",bx="column-title",xx="none",wx="all",_x="each",kx="flush",Ax="column",Ex="row";function Dx(t){ps.call(this,null,t)}function Sx(t,e,n){return e(t.bounds.clear(),t,n)}fe(Dx,ps,{transform(t,e){const n=e.dataflow,r=t.mark,i=r.marktype,o=bv[i],a=o.bound;let s,u=r.bounds;if(o.nested)r.items.length&&n.dirty(r.items[0]),u=Sx(r,a),r.items.forEach((t=>{t.bounds.clear().union(u)}));else if(i===cx||t.modified())switch(e.visit(e.MOD,(t=>n.dirty(t))),u.clear(),r.items.forEach((t=>u.union(Sx(t,a)))),r.role){case fx:case dx:case hx:e.reflow()}else s=e.changed(e.REM),e.visit(e.ADD,(t=>{u.union(Sx(t,a))})),e.visit(e.MOD,(t=>{s=s||u.alignsWith(t.bounds),n.dirty(t),u.union(Sx(t,a))})),s&&(u.clear(),r.items.forEach((t=>u.union(t.bounds))));return Qb(r),e.modifies("bounds")}});const Cx=":vega_identifier:";function Ox(t){ps.call(this,0,t)}function Fx(t){ps.call(this,null,t)}function Mx(t){ps.call(this,null,t)}Ox.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},fe(Ox,ps,{transform(t,e){const n=(i=e.dataflow)._signals[Cx]||(i._signals[Cx]=i.add(0)),r=t.as;var i;let o=n.value;return e.visit(e.ADD,(t=>t[r]=t[r]||++o)),n.set(this.value=o),e}}),fe(Fx,ps,{transform(t,e){let n=this.value;n||(n=e.dataflow.scenegraph().mark(t.markdef,function(t){const e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index),n.group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);const r=n.marktype===cx?Dm:Em;return e.visit(e.ADD,(t=>r.call(t,n))),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});const $x={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,r)=>r&&Nx(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1)))}},Nx=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),Bx=(t,e)=>{for(var n,r=1,i=t.length,o=t[0].bounds;r<i;o=n,++r)if(Nx(o,n=t[r].bounds,e))return!0},Tx=t=>{const e=t.bounds;return e.width()>1&&e.height()>1},jx=t=>(t.forEach((t=>t.opacity=1)),t),Ix=(t,e)=>t.reflow(e.modified()).modifies("opacity");function zx(t){ps.call(this,null,t)}fe(Mx,ps,{transform(t,e){const n=$x[t.method]||$x.parity,r=t.separation||0;let i,o,a=e.materialize(e.SOURCE).source;if(!a||!a.length)return;if(!t.method)return t.modified("method")&&(jx(a),e=Ix(e,t)),e;if(a=a.filter(Tx),!a.length)return;if(t.sort&&(a=a.slice().sort(t.sort)),i=jx(a),e=Ix(e,t),i.length>=3&&Bx(i,r)){do{i=n(i,r)}while(i.length>=3&&Bx(i,r));i.length<3&&!Ct(a).opacity&&(i.length>1&&(Ct(i).opacity=0),Ct(a).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(o=((t,e,n)=>{var r=t.range(),i=new Am;return e===rx||e===ax?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),t=>i.encloses(t.bounds)})(t.boundScale,t.boundOrient,+t.boundTolerance),a.forEach((t=>{o(t)||(t.opacity=0)})));const s=i[0].mark.bounds.clear();return a.forEach((t=>{t.opacity&&s.union(t.bounds)})),e}}),fe(zx,ps,{transform(t,e){const n=e.dataflow;if(e.visit(e.ALL,(t=>n.dirty(t))),e.fields&&e.fields.zindex){const t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});const Rx=new Am;function Px(t,e,n){return t[e]===n?0:(t[e]=n,1)}function Lx(t){var e=t.items[0].orient;return e===ix||e===ox}function qx(t,e,n,r){var i,o,a=e.items[0],s=a.datum,u=null!=a.translate?a.translate:.5,l=a.orient,c=function(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}(s),f=a.range,h=a.offset,d=a.position,p=a.minExtent,g=a.maxExtent,m=s.title&&a.items[c[2]].items[0],y=a.titlePadding,v=a.bounds,b=m&&cv(m),x=0,w=0;switch(Rx.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(a.items[i].bounds),(i=c[1])>-1&&v.union(a.items[i].bounds),l){case rx:x=d||0,w=-h,o=Math.max(p,Math.min(g,-v.y1)),v.add(0,-o).add(f,0),m&&Ux(t,m,o,y,b,0,-1,v);break;case ix:x=-h,w=d||0,o=Math.max(p,Math.min(g,-v.x1)),v.add(-o,0).add(0,f),m&&Ux(t,m,o,y,b,1,-1,v);break;case ox:x=n+h,w=d||0,o=Math.max(p,Math.min(g,v.x2)),v.add(0,0).add(o,f),m&&Ux(t,m,o,y,b,1,1,v);break;case ax:x=d||0,w=r+h,o=Math.max(p,Math.min(g,v.y2)),v.add(0,0).add(f,o),m&&Ux(t,m,o,y,0,0,1,v);break;default:x=a.x,w=a.y}return Fm(v.translate(x,w),a),Px(a,"x",x+u)|Px(a,"y",w+u)&&(a.bounds=Rx,t.dirty(a),a.bounds=v,t.dirty(a)),a.mark.bounds.clear().union(v)}function Ux(t,e,n,r,i,o,a,s){const u=e.bounds;if(e.auto){const s=a*(n+i+r);let l=0,c=0;t.dirty(e),o?l=(e.x||0)-(e.x=s):c=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(u.translate(-l,-c)),t.dirty(e)}s.union(u)}const Wx=(t,e)=>Math.floor(Math.min(t,e)),Vx=(t,e)=>Math.ceil(Math.max(t,e));function Hx(t){return(new Am).set(0,0,t.width||0,t.height||0)}function Gx(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function Xx(t,e,n){const r=kt(t)?t[e]:t;return null!=r?r:void 0!==n?n:0}function Kx(t){return t<0?Math.ceil(-t):0}function Yx(t,e,n){var r,i,o,a,s,u,l,c,f,h,d,p=!n.nodirty,g=n.bounds===kx?Hx:Gx,m=Rx.set(0,0,0,0),y=Xx(n.align,Ax),v=Xx(n.align,Ex),b=Xx(n.padding,Ax),x=Xx(n.padding,Ex),w=n.columns||e.length,_=w<=0?1:Math.ceil(e.length/w),k=e.length,A=Array(k),E=Array(w),D=0,S=Array(k),C=Array(_),O=0,F=Array(k),M=Array(k),$=Array(k);for(i=0;i<w;++i)E[i]=0;for(i=0;i<_;++i)C[i]=0;for(i=0;i<k;++i)u=e[i],s=$[i]=g(u),u.x=u.x||0,F[i]=0,u.y=u.y||0,M[i]=0,o=i%w,a=~~(i/w),D=Math.max(D,l=Math.ceil(s.x2)),O=Math.max(O,c=Math.ceil(s.y2)),E[o]=Math.max(E[o],l),C[a]=Math.max(C[a],c),A[i]=b+Kx(s.x1),S[i]=x+Kx(s.y1),p&&t.dirty(e[i]);for(i=0;i<k;++i)i%w==0&&(A[i]=0),i<w&&(S[i]=0);if(y===_x)for(o=1;o<w;++o){for(d=0,i=o;i<k;i+=w)d<A[i]&&(d=A[i]);for(i=o;i<k;i+=w)A[i]=d+E[o-1]}else if(y===wx){for(d=0,i=0;i<k;++i)i%w&&d<A[i]&&(d=A[i]);for(i=0;i<k;++i)i%w&&(A[i]=d+D)}else for(y=!1,o=1;o<w;++o)for(i=o;i<k;i+=w)A[i]+=E[o-1];if(v===_x)for(a=1;a<_;++a){for(d=0,r=(i=a*w)+w;i<r;++i)d<S[i]&&(d=S[i]);for(i=a*w;i<r;++i)S[i]=d+C[a-1]}else if(v===wx){for(d=0,i=w;i<k;++i)d<S[i]&&(d=S[i]);for(i=w;i<k;++i)S[i]=d+O}else for(v=!1,a=1;a<_;++a)for(r=(i=a*w)+w;i<r;++i)S[i]+=C[a-1];for(f=0,i=0;i<k;++i)f=A[i]+(i%w?f:0),F[i]+=f-e[i].x;for(o=0;o<w;++o)for(h=0,i=o;i<k;i+=w)h+=S[i],M[i]+=h-e[i].y;if(y&&Xx(n.center,Ax)&&_>1)for(i=0;i<k;++i)(f=(s=y===wx?D:E[i%w])-$[i].x2-e[i].x-F[i])>0&&(F[i]+=f/2);if(v&&Xx(n.center,Ex)&&1!==w)for(i=0;i<k;++i)(h=(s=v===wx?O:C[~~(i/w)])-$[i].y2-e[i].y-M[i])>0&&(M[i]+=h/2);for(i=0;i<k;++i)m.union($[i].translate(F[i],M[i]));switch(f=Xx(n.anchor,"x"),h=Xx(n.anchor,"y"),Xx(n.anchor,Ax)){case lx:f-=m.width();break;case ux:f-=m.width()/2}switch(Xx(n.anchor,Ex)){case lx:h-=m.height();break;case ux:h-=m.height()/2}for(f=Math.round(f),h=Math.round(h),m.clear(),i=0;i<k;++i)e[i].mark.bounds.clear();for(i=0;i<k;++i)(u=e[i]).x+=F[i]+=f,u.y+=M[i]+=h,m.union(u.mark.bounds.union(u.bounds.translate(F[i],M[i]))),p&&t.dirty(u);return m}function Jx(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function Zx(t,e){return t.bounds[e]}function Qx(t,e,n,r,i,o,a,s,u,l,c,f,h,d){var p,g,m,y,v,b,x,w,_,k=n.length,A=0,E=0;if(!k)return A;for(p=c;p<k;p+=f)n[p]&&(A=a(A,u(n[p],l)));if(!e.length)return A;for(e.length>i&&(t.warn("Grid headers exceed limit: "+i),e=e.slice(0,i)),A+=o,g=0,y=e.length;g<y;++g)t.dirty(e[g]),e[g].mark.bounds.clear();for(p=c,g=0,y=e.length;g<y;++g,p+=f){for(v=(b=e[g]).mark.bounds,m=p;m>=0&&null==(x=n[m]);m-=h);s?(w=null==d?x.x:Math.round(x.bounds.x1+d*x.bounds.width()),_=A):(w=A,_=null==d?x.y:Math.round(x.bounds.y1+d*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,t.dirty(b),E=a(E,v[l])}return E}function tw(t,e,n,r,i,o){if(e){t.dirty(e);var a=n,s=n;r?a=Math.round(i.x1+o*i.width()):s=Math.round(i.y1+o*i.height()),e.bounds.translate(a-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=a,e.y=s,t.dirty(e)}}function ew(t,e,n,r,i,o,a){const s=function(t,e){const n=t[e]||{};return(e,r)=>null!=n[e]?n[e]:null!=t[e]?t[e]:r}(n,e),u=function(t,e){let n=-1/0;return t.forEach((t=>{null!=t.offset&&(n=Math.max(n,t.offset))})),n>-1/0?n:e}(t,s("offset",0)),l=s("anchor",sx),c=l===lx?1:l===ux?.5:0,f={align:_x,bounds:s("bounds",kx),columns:"vertical"===s("direction")?1:t.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(e){case ix:f.anchor={x:Math.floor(r.x1)-u,column:lx,y:c*(a||r.height()+2*r.y1),row:l};break;case ox:f.anchor={x:Math.ceil(r.x2)+u,y:c*(a||r.height()+2*r.y1),row:l};break;case rx:f.anchor={y:Math.floor(i.y1)-u,row:lx,x:c*(o||i.width()+2*i.x1),column:l};break;case ax:f.anchor={y:Math.ceil(i.y2)+u,x:c*(o||i.width()+2*i.x1),column:l};break;case"top-left":f.anchor={x:u,y:u};break;case"top-right":f.anchor={x:o-u,y:u,column:lx};break;case"bottom-left":f.anchor={x:u,y:a-u,row:lx};break;case"bottom-right":f.anchor={x:o-u,y:a-u,column:lx,row:lx}}return f}function nw(t,e){var n,r,i=e.items[0],o=i.datum,a=i.orient,s=i.bounds,u=i.x,l=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(t,e,n){var r=e.padding,i=r-n.x,o=r-n.y;if(e.datum.title){var a=e.items[1].items[0],s=a.anchor,u=e.titlePadding||0,l=r-a.x,c=r-a.y;switch(a.orient){case ix:i+=Math.ceil(a.bounds.width())+u;break;case ox:case ax:break;default:o+=a.bounds.height()+u}switch((i||o)&&iw(t,n,i,o),a.orient){case ix:c+=rw(e,n,a,s,1,1);break;case ox:l+=rw(e,n,a,lx,0,0)+u,c+=rw(e,n,a,s,1,1);break;case ax:l+=rw(e,n,a,s,0,0),c+=rw(e,n,a,lx,-1,0,1)+u;break;default:l+=rw(e,n,a,s,0,0)}(l||c)&&iw(t,a,l,c),(l=Math.round(a.bounds.x1-r))<0&&(iw(t,n,-l,0),iw(t,a,-l,0))}else(i||o)&&iw(t,n,i,o)}(t,i,i.items[0].items[0]),s=function(t,e){return t.items.forEach((t=>e.union(t.bounds))),e.x1=t.padding,e.y1=t.padding,e}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===o.type&&function(t){const e=t.reduce(((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t)),{});t.forEach((t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y}))}(i.items[0].items[0].items[0].items),a!==xx&&(i.x=u=0,i.y=l=0),i.width=n,i.height=r,Fm(s.set(u,l,u+n,l+r),i),i.mark.bounds.clear().union(s),i}function rw(t,e,n,r,i,o,a){const s="symbol"!==t.datum.type,u=n.datum.vgrad,l=(!s||!o&&u||a?e:e.items[0]).bounds[i?"y2":"x2"]-t.padding,c=u&&o?l:0,f=u&&o?0:l,h=i<=0?0:cv(n);return Math.round(r===sx?c:r===lx?f-h:.5*(l-h))}function iw(t,e,n,r){e.x+=n,e.y+=r,e.bounds.translate(n,r),e.mark.bounds.translate(n,r),t.dirty(e)}function ow(t){ps.call(this,null,t)}function aw(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let r=-1;for(let i of t)(i=+e(i,++r,t))&&(n+=i)}return n}function sw(t){ps.call(this,null,t)}function uw(t){ps.call(this,null,t)}function lw(){return za({})}function cw(t){ps.call(this,null,t)}function fw(t){ps.call(this,[],t)}fe(ow,ps,{transform(t,e){const n=e.dataflow;return t.mark.items.forEach((e=>{t.layout&&function(t,e,n){var r,i,o,a,s,u,l,c=function(t){var e,n,r=t.items,i=r.length,o=0;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;o<i;++o)if(n=(e=r[o]).items,e.marktype===cx)switch(e.role){case fx:case dx:case hx:break;case px:a.rowheaders.push(...n);break;case gx:a.rowfooters.push(...n);break;case yx:a.colheaders.push(...n);break;case vx:a.colfooters.push(...n);break;case mx:a.rowtitle=n[0];break;case bx:a.coltitle=n[0];break;default:a.marks.push(...n)}return a}(e),f=c.marks,h=n.bounds===kx?Jx:Zx,d=n.offset,p=n.columns||f.length,g=p<=0?1:Math.ceil(f.length/p),m=g*p;const y=Yx(t,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(u=Xx(n.headerBand,Ex,null),r=Qx(t,c.rowheaders,f,0,g,-Xx(d,"rowHeader"),Wx,0,h,"x1",0,p,1,u)),c.colheaders&&(u=Xx(n.headerBand,Ax,null),i=Qx(t,c.colheaders,f,0,p,-Xx(d,"columnHeader"),Wx,1,h,"y1",0,1,p,u)),c.rowfooters&&(u=Xx(n.footerBand,Ex,null),o=Qx(t,c.rowfooters,f,0,g,Xx(d,"rowFooter"),Vx,0,h,"x2",p-1,p,1,u)),c.colfooters&&(u=Xx(n.footerBand,Ax,null),a=Qx(t,c.colfooters,f,0,p,Xx(d,"columnFooter"),Vx,1,h,"y2",m-p,1,p,u)),c.rowtitle&&(s=Xx(n.titleAnchor,Ex),l=Xx(d,"rowTitle"),l=s===lx?o+l:r-l,u=Xx(n.titleBand,Ex,.5),tw(t,c.rowtitle,l,0,y,u)),c.coltitle&&(s=Xx(n.titleAnchor,Ax),l=Xx(d,"columnTitle"),l=s===lx?a+l:i-l,u=Xx(n.titleBand,Ax,.5),tw(t,c.coltitle,l,1,y,u))}(n,e,t.layout),function(t,e,n){var r,i,o,a,s,u=e.items,l=Math.max(0,e.width||0),c=Math.max(0,e.height||0),f=(new Am).set(0,0,l,c),h=f.clone(),d=f.clone(),p=[];for(a=0,s=u.length;a<s;++a)switch((i=u[a]).role){case fx:(Lx(i)?h:d).union(qx(t,i,l,c));break;case hx:r=i;break;case dx:p.push(nw(t,i));break;case"frame":case"scope":case px:case gx:case mx:case yx:case vx:case bx:h.union(i.bounds),d.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const e={};p.forEach((t=>{(o=t.orient||ox)!==xx&&(e[o]||(e[o]=[])).push(t)}));for(const r in e){const i=e[r];Yx(t,i,ew(i,r,n.legends,h,d,l,c))}p.forEach((e=>{const r=e.bounds;if(r.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=r,t.dirty(e)),n.autosize&&"fit"===n.autosize.type)switch(e.orient){case ix:case ox:f.add(r.x1,0).add(r.x2,0);break;case rx:case ax:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(h).union(d),r&&f.union(function(t,e,n,r,i){var o,a=e.items[0],s=a.frame,u=a.orient,l=a.anchor,c=a.offset,f=a.padding,h=a.items[0].items[0],d=a.items[1]&&a.items[1].items[0],p=u===ix||u===ox?r:n,g=0,m=0,y=0,v=0,b=0;if(s!==cx?u===ix?(g=i.y2,p=i.y1):u===ox?(g=i.y1,p=i.y2):(g=i.x1,p=i.x2):u===ix&&(g=r,p=0),o=l===sx?g:l===lx?p:(g+p)/2,d&&d.text){switch(u){case rx:case ax:b=h.bounds.height()+f;break;case ix:v=h.bounds.width()+f;break;case ox:v=-h.bounds.width()-f}Rx.clear().union(d.bounds),Rx.translate(v-(d.x||0),b-(d.y||0)),Px(d,"x",v)|Px(d,"y",b)&&(t.dirty(d),d.bounds.clear().union(Rx),d.mark.bounds.clear().union(Rx),t.dirty(d)),Rx.clear().union(d.bounds)}else Rx.clear();switch(Rx.union(h.bounds),u){case rx:m=o,y=i.y1-Rx.height()-c;break;case ix:m=i.x1-Rx.width()-c,y=o;break;case ox:m=i.x2+Rx.width()+c,y=o;break;case ax:m=o,y=i.y2+c;break;default:m=a.x,y=a.y}return Px(a,"x",m)|Px(a,"y",y)&&(Rx.translate(m,y),t.dirty(a),a.bounds.clear().union(Rx),e.bounds.clear().union(Rx),t.dirty(a)),a.bounds}(t,r,l,c,f)),e.clip&&f.set(0,0,e.width||0,e.height||0),function(t,e,n,r){const i=r.autosize||{},o=i.type;if(t._autosize<1||!o)return;let a=t._width,s=t._height,u=Math.max(0,e.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if("padding"===i.contains){const e=t.padding();a-=e.left+e.right,s-=e.top+e.bottom}o===xx?(l=0,f=0,u=a,c=s):"fit"===o?(u=Math.max(0,a-l-h),c=Math.max(0,s-f-d)):"fit-x"===o?(u=Math.max(0,a-l-h),s=c+f+d):"fit-y"===o?(a=u+l+h,c=Math.max(0,s-f-d)):"pad"===o&&(a=u+l+h,s=c+f+d),t._resizeView(a,s,u,c,[l,f],i.resize)}(t,e,f,n)}(n,e,t)})),function(t){return t&&"legend-entry"!==t.mark.role}(t.mark.group)?e.reflow():e}}),fe(sw,ps,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=this.value,o=t.scale,a=fg(o,null==t.count?t.values?t.values.length:10:t.count,t.minstep),s=t.format||pg(n,o,a,t.formatSpecifier,t.formatType,!!t.values),u=t.values?hg(o,t.values,a):dg(o,a);return i&&(r.rem=i),i=u.map(((t,e)=>za({index:e/(u.length-1||1),value:t,label:s(t)}))),t.extra&&i.length&&i.push(za({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),fe(uw,ps,{transform(t,e){var n=e.dataflow,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.item||lw,o=t.key||ja,a=this.value;return _t(r.encode)&&(r.encode=null),a&&(t.modified("key")||e.modified(o))&&at("DataJoin does not support modified key function or fields."),a||(e=e.addAll(),this.value=a=function(t){const e=le().test((t=>t.exit));return e.lookup=n=>e.get(t(n)),e}(o)),e.visit(e.ADD,(t=>{const e=o(t);let n=a.get(e);n?n.exit?(a.empty--,r.add.push(n)):r.mod.push(n):(n=i(t),a.set(e,n),r.add.push(n)),n.datum=t,n.exit=!1})),e.visit(e.MOD,(t=>{const e=o(t),n=a.get(e);n&&(n.datum=t,r.mod.push(n))})),e.visit(e.REM,(t=>{const e=o(t),n=a.get(e);t!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++a.empty)})),e.changed(e.ADD_MOD)&&r.modifies("datum"),(e.clean()||t.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),r}}),fe(cw,ps,{transform(t,e){var n=e.fork(e.ADD_REM),r=t.mod||!1,i=t.encoders,o=e.encode;if(_t(o)){if(!n.changed()&&!o.every((t=>i[t])))return e.StopPropagation;o=o[0],n.encode=null}var a="enter"===o,s=i.update||pt,u=i.enter||pt,l=i.exit||pt,c=(o&&!a?i[o]:s)||pt;if(e.changed(e.ADD)&&(e.visit(e.ADD,(e=>{u(e,t),s(e,t)})),n.modifies(u.output),n.modifies(s.output),c!==pt&&c!==s&&(e.visit(e.ADD,(e=>{c(e,t)})),n.modifies(c.output))),e.changed(e.REM)&&l!==pt&&(e.visit(e.REM,(e=>{l(e,t)})),n.modifies(l.output)),a||c!==pt){const i=e.MOD|(t.modified()?e.REFLOW:0);a?(e.visit(i,(e=>{const i=u(e,t)||r;(c(e,t)||i)&&n.mod.push(e)})),n.mod.length&&n.modifies(u.output)):e.visit(i,(e=>{(c(e,t)||r)&&n.mod.push(e)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation}}),fe(fw,ps,{transform(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,r,i,o,a,s=e.dataflow.locale(),u=e.fork(e.NO_SOURCE|e.NO_FIELDS),l=this.value,c=t.type||sg,f=t.scale,h=+t.limit,d=fg(f,null==t.count?5:t.count,t.minstep),p=!!t.values||c===sg,g=t.format||bg(s,f,d,c,t.formatSpecifier,t.formatType,p),m=t.values||vg(f,d);return l&&(u.rem=l),c===sg?(h&&m.length>h?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),l=m.slice(0,h-1),a=!0):l=m,Kt(i=t.size)?(t.values||0!==f(l[0])||(l=l.slice(1)),o=l.reduce(((e,n)=>Math.max(e,i(n,t))),0)):i=ee(o=i||8),l=l.map(((e,n)=>za({index:n,label:g(e,n,l),value:e,offset:o,size:i(e,t)}))),a&&(a=m[l.length],l.push(za({index:l.length,label:"".concat(m.length-l.length," entries"),value:a,offset:o,size:i(a,t)})))):"gradient"===c?(n=f.domain(),r=eg(f,n[0],Ct(n)),m.length<3&&!t.values&&n[0]!==Ct(n)&&(m=[n[0],Ct(n)]),l=m.map(((t,e)=>za({index:e,label:g(t,e,m),value:t,perc:r(t)})))):(i=m.length-1,r=function(t){const e=t.domain(),n=e.length-1;let r=+e[0],i=+Ct(e),o=i-r;if(t.type===Ep){const t=n?o/n:.1;r-=t,i+=t,o=i-r}return t=>(t-r)/o}(f),l=m.map(((t,e)=>za({index:e,label:g(t,e,m),value:t,perc:e?r(t):0,perc2:e===i?1:r(m[e+1])})))),u.source=l,u.add=l,this.value=l,u}});const hw=t=>t.source.x,dw=t=>t.source.y,pw=t=>t.target.x,gw=t=>t.target.y;function mw(t){ps.call(this,{},t)}mw.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},fe(mw,ps,{transform(t,e){var n=t.sourceX||hw,r=t.sourceY||dw,i=t.targetX||pw,o=t.targetY||gw,a=t.as||"path",s=t.orient||"vertical",u=t.shape||"line",l=xw.get(u+"-"+s)||xw.get(u);return l||at("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,(t=>{t[a]=l(n(t),r(t),i(t),o(t))})),e.reflow(t.modified()).modifies(a)}});const yw=(t,e,n,r)=>"M"+t+","+e+"L"+n+","+r,vw=(t,e,n,r)=>{var i=n-t,o=r-e,a=Math.sqrt(i*i+o*o)/2;return"M"+t+","+e+"A"+a+","+a+" "+180*Math.atan2(o,i)/Math.PI+" 0 1 "+n+","+r},bw=(t,e,n,r)=>{const i=n-t,o=r-e,a=.2*(i+o),s=.2*(o-i);return"M"+t+","+e+"C"+(t+a)+","+(e+s)+" "+(n+s)+","+(r-a)+" "+n+","+r},xw=le({line:yw,"line-radial":(t,e,n,r)=>yw(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),arc:vw,"arc-radial":(t,e,n,r)=>vw(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),curve:bw,"curve-radial":(t,e,n,r)=>bw(e*Math.cos(t),e*Math.sin(t),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(t,e,n,r)=>"M"+t+","+e+"V"+r+"H"+n,"orthogonal-vertical":(t,e,n,r)=>"M"+t+","+e+"H"+n+"V"+r,"orthogonal-radial":(t,e,n,r)=>{const i=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n);return"M"+e*i+","+e*o+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*a+","+e*s+"L"+r*a+","+r*s},"diagonal-horizontal":(t,e,n,r)=>{const i=(t+n)/2;return"M"+t+","+e+"C"+i+","+e+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(t,e,n,r)=>{const i=(e+r)/2;return"M"+t+","+e+"C"+t+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(t,e,n,r)=>{const i=Math.cos(t),o=Math.sin(t),a=Math.cos(n),s=Math.sin(n),u=(e+r)/2;return"M"+e*i+","+e*o+"C"+u*i+","+u*o+" "+u*a+","+u*s+" "+r*a+","+r*s}});function ww(t){ps.call(this,null,t)}function _w(t){return Vp(t)&&t!==wp}ww.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},fe(ww,ps,{transform(t,e){var n,r,i,o=t.as||["startAngle","endAngle"],a=o[0],s=o[1],u=t.field||ht,l=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,f=e.source,h=f.map(u),d=h.length,p=l,g=(c-l)/aw(h),m=xu(d);for(t.sort&&m.sort(((t,e)=>h[t]-h[e])),n=0;n<d;++n)i=h[m[n]],(r=f[m[n]])[a]=p,r[s]=p+=i*g;return this.value=h,e.reflow(t.modified()).modifies(o)}});const kw=Me(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function Aw(t){ps.call(this,null,t),this.modified(!0)}function Ew(t,e,n){return Xp(t)&&Math.abs(e.reduce(((t,e)=>t+(e<0?-1:e>0?1:0)),0))!==e.length&&n.warn("Log scale domain includes zero: "+De(e)),e}function Dw(t,e,n){return Kt(t)&&(e||n)?Zp(t,Sw(e||[0,1],n)):t}function Sw(t,e){return e?t.slice().reverse():t}function Cw(t){ps.call(this,null,t)}fe(Aw,ps,{transform(t,e){var n=e.dataflow,r=this.value,i=function(t){var e,n=t.type,r="";return n===wp?"sequential-linear":(function(t){const e=t.type;return Vp(e)&&e!==bp&&e!==xp&&(t.scheme||t.range&&t.range.length&&t.range.every(ve))}(t)&&(r=2===(e=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?"sequential-":3===e?"diverging-":""),(r+n||pp).toLowerCase())}(t);for(i in r&&i===r.type||(this.value=r=qp(i)()),t)if(!kw[i]){if("padding"===i&&_w(r.type))continue;Kt(r[i])?r[i](t[i]):n.warn("Unsupported scale property: "+i)}return function(t,e,n){var r=t.type,i=e.round||!1,o=e.range;if(null!=e.rangeStep)o=function(t,e,n){t!==Cp&&t!==Sp&&at("Only band and point scales support rangeStep.");var r=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,i=t===Sp?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0;return[0,e.rangeStep*dp(n,i,r)]}(r,e,n);else if(e.scheme&&(o=function(t,e,n){var r,i=e.schemeExtent;return _t(e.scheme)?r=Qp(e.scheme,e.interpolate,e.interpolateGamma):(r=ag(e.scheme.toLowerCase()))||at("Unrecognized scheme name: ".concat(e.scheme)),n=t===Ep?n+1:t===Op?n-1:t===kp||t===Ap?+e.schemeCount||5:n,Kp(t)?Dw(r,i,e.reverse):Kt(r)?tg(Dw(r,i),n):t===Dp?r:r.slice(0,n)}(r,e,n),Kt(o))){if(t.interpolator)return t.interpolator(o);at("Scale type ".concat(r," does not support interpolating color schemes."))}if(o&&Kp(r))return t.interpolator(Qp(Sw(o,e.reverse),e.interpolate,e.interpolateGamma));o&&e.interpolate&&t.interpolate?t.interpolate(ng(e.interpolate,e.interpolateGamma)):Kt(t.round)?t.round(i):Kt(t.rangeRound)&&t.interpolate(i?$h:Mh),o&&t.range(Sw(o,e.reverse))}(r,t,function(t,e,n){let r=e.bins;if(r&&!_t(r)){const e=t.domain(),n=e[0],i=Ct(e),o=r.step;let a=null==r.start?n:r.start,s=null==r.stop?i:r.stop;o||at("Scale bins parameter missing step property."),a<n&&(a=o*Math.ceil(n/o)),s>i&&(s=o*Math.floor(i/o)),r=xu(a,s+o/2,o)}return r?t.bins=r:t.bins&&delete t.bins,t.type===Op&&(r?e.domain||e.domainRaw||(t.domain(r),n=r.length):t.bins=t.domain()),n}(r,t,function(t,e,n){const r=function(t,e,n){return e?(t.domain(Ew(t.type,e,n)),e.length):-1}(t,e.domainRaw,n);if(r>-1)return r;var i,o,a=e.domain,s=t.type,u=e.zero||void 0===e.zero&&function(t){const e=t.type;return!t.bins&&(e===pp||e===mp||e===yp)}(t);if(!a)return 0;if(_w(s)&&e.padding&&a[0]!==Ct(a)&&(a=function(t,e,n,r,i,o){var a=Math.abs(Ct(n)-n[0]),s=a/(a-2*r),u=t===gp?qt(e,null,s):t===yp?Ut(e,null,s,.5):t===mp?Ut(e,null,s,i||1):t===vp?Wt(e,null,s,o||1):Lt(e,null,s);return(e=e.slice())[0]=u[0],e[e.length-1]=u[1],e}(s,a,e.range,e.padding,e.exponent,e.constant)),(u||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(i=(a=a.slice()).length-1||1,u&&(a[0]>0&&(a[0]=0),a[i]<0&&(a[i]=0)),null!=e.domainMin&&(a[0]=e.domainMin),null!=e.domainMax&&(a[i]=e.domainMax),null!=e.domainMid)){const t=(o=e.domainMid)>a[i]?i+1:o<a[0]?0:i;t!==i&&n.warn("Scale domainMid exceeds domain min or max.",o),a.splice(t,0,o)}return t.domain(Ew(s,a,n)),s===Dp&&t.unknown(e.domainImplicit?gf:void 0),e.nice&&t.nice&&t.nice(!0!==e.nice&&fg(t,e.nice)||null),a.length}(r,t,n))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),fe(Cw,ps,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(qa(t.sort)),this.modified(n),e}});const Ow="zero",Fw="center",Mw="normalize",$w=["y0","y1"];function Nw(t){ps.call(this,null,t)}function Bw(t,e,n,r,i){for(var o,a=(e-t.sum)/2,s=t.length,u=0;u<s;++u)(o=t[u])[r]=a,o[i]=a+=Math.abs(n(o))}function Tw(t,e,n,r,i){for(var o,a=1/t.sum,s=0,u=t.length,l=0,c=0;l<u;++l)(o=t[l])[r]=s,o[i]=s=a*(c+=Math.abs(n(o)))}function jw(t,e,n,r,i){for(var o,a,s=0,u=0,l=t.length,c=0;c<l;++c)(o=+n(a=t[c]))<0?(a[r]=u,a[i]=u+=o):(a[r]=s,a[i]=s+=o)}Nw.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:Ow,values:[Ow,Fw,Mw]},{name:"as",type:"string",array:!0,length:2,default:$w}]},fe(Nw,ps,{transform(t,e){var n,r,i,o,a=t.as||$w,s=a[0],u=a[1],l=qa(t.sort),c=t.field||ht,f=t.offset===Fw?Bw:t.offset===Mw?Tw:jw;for(n=function(t,e,n,r){var i,o,a,s,u,l,c,f,h,d=[],p=t=>t(u);if(null==e)d.push(t.slice());else for(i={},o=0,a=t.length;o<a;++o)u=t[o],(c=i[l=e.map(p)])||(i[l]=c=[],d.push(c)),c.push(u);for(l=0,h=0,s=d.length;l<s;++l){for(o=0,f=0,a=(c=d[l]).length;o<a;++o)f+=Math.abs(r(c[o]));c.sum=f,f>h&&(h=f),n&&c.sort(n)}return d.max=h,d}(e.source,t.groupby,l,c),r=0,i=n.length,o=n.max;r<i;++r)f(n[r],o,c,s,u);return e.reflow(t.modified()).modifies(a)}});const Iw=t=>t;function zw(t,e){t&&Pw.hasOwnProperty(t.type)&&Pw[t.type](t,e)}var Rw={Feature:function(t,e){zw(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)zw(n[r].geometry,e)}},Pw={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Lw(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Lw(n[r],e,0)},Polygon:function(t,e){qw(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)qw(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)zw(n[r],e)}};function Lw(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function qw(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Lw(t[n],e,1);e.polygonEnd()}function Uw(t,e){t&&Rw.hasOwnProperty(t.type)?Rw[t.type](t,e):zw(t,e)}class Ww{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,a=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);a&&(e[n++]=a),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}var Vw=1e-6,Hw=1e-12,Gw=Math.PI,Xw=Gw/2,Kw=Gw/4,Yw=2*Gw,Jw=180/Gw,Zw=Gw/180,Qw=Math.abs,t_=Math.atan,e_=Math.atan2,n_=Math.cos,r_=Math.ceil,i_=Math.exp,o_=(Math.floor,Math.hypot),a_=Math.log,s_=Math.pow,u_=Math.sin,l_=Math.sign||function(t){return t>0?1:t<0?-1:0},c_=Math.sqrt,f_=Math.tan;function h_(t){return t>1?0:t<-1?Gw:Math.acos(t)}function d_(t){return t>1?Xw:t<-1?-Xw:Math.asin(t)}function p_(){}var g_,m_,y_,v_,b_=new Ww,x_=new Ww,w_={point:p_,lineStart:p_,lineEnd:p_,polygonStart:function(){w_.lineStart=__,w_.lineEnd=E_},polygonEnd:function(){w_.lineStart=w_.lineEnd=w_.point=p_,b_.add(Qw(x_)),x_=new Ww},result:function(){var t=b_/2;return b_=new Ww,t}};function __(){w_.point=k_}function k_(t,e){w_.point=A_,g_=y_=t,m_=v_=e}function A_(t,e){x_.add(v_*t-y_*e),y_=t,v_=e}function E_(){A_(g_,m_)}const D_=w_;var S_=1/0,C_=S_,O_=-S_,F_=O_;const M_={point:function(t,e){t<S_&&(S_=t),t>O_&&(O_=t),e<C_&&(C_=e),e>F_&&(F_=e)},lineStart:p_,lineEnd:p_,polygonStart:p_,polygonEnd:p_,result:function(){var t=[[S_,C_],[O_,F_]];return O_=F_=-(C_=S_=1/0),t}};var $_,N_,B_,T_,j_=0,I_=0,z_=0,R_=0,P_=0,L_=0,q_=0,U_=0,W_=0,V_={point:H_,lineStart:G_,lineEnd:Y_,polygonStart:function(){V_.lineStart=J_,V_.lineEnd=Z_},polygonEnd:function(){V_.point=H_,V_.lineStart=G_,V_.lineEnd=Y_},result:function(){var t=W_?[q_/W_,U_/W_]:L_?[R_/L_,P_/L_]:z_?[j_/z_,I_/z_]:[NaN,NaN];return j_=I_=z_=R_=P_=L_=q_=U_=W_=0,t}};function H_(t,e){j_+=t,I_+=e,++z_}function G_(){V_.point=X_}function X_(t,e){V_.point=K_,H_(B_=t,T_=e)}function K_(t,e){var n=t-B_,r=e-T_,i=c_(n*n+r*r);R_+=i*(B_+t)/2,P_+=i*(T_+e)/2,L_+=i,H_(B_=t,T_=e)}function Y_(){V_.point=H_}function J_(){V_.point=Q_}function Z_(){tk($_,N_)}function Q_(t,e){V_.point=tk,H_($_=B_=t,N_=T_=e)}function tk(t,e){var n=t-B_,r=e-T_,i=c_(n*n+r*r);R_+=i*(B_+t)/2,P_+=i*(T_+e)/2,L_+=i,q_+=(i=T_*t-B_*e)*(B_+t),U_+=i*(T_+e),W_+=3*i,H_(B_=t,T_=e)}const ek=V_;function nk(t){this._context=t}nk.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,Yw)}},result:p_};var rk,ik,ok,ak,sk,uk=new Ww,lk={point:p_,lineStart:function(){lk.point=ck},lineEnd:function(){rk&&fk(ik,ok),lk.point=p_},polygonStart:function(){rk=!0},polygonEnd:function(){rk=null},result:function(){var t=+uk;return uk=new Ww,t}};function ck(t,e){lk.point=fk,ik=ak=t,ok=sk=e}function fk(t,e){ak-=t,sk-=e,uk.add(c_(ak*ak+sk*sk)),ak=t,sk=e}const hk=lk;function dk(){this._string=[]}function pk(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function gk(t,e){var n,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Uw(t,n(r))),r.result()}return o.area=function(t){return Uw(t,n(D_)),D_.result()},o.measure=function(t){return Uw(t,n(hk)),hk.result()},o.bounds=function(t){return Uw(t,n(M_)),M_.result()},o.centroid=function(t){return Uw(t,n(ek)),ek.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,Iw):(t=e).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(e=null,new dk):new nk(e=t),"function"!=typeof i&&r.pointRadius(i),o):e},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(e)}function mk(){var t,e=[];return{point:function(e,n,r){t.push([e,n,r])},lineStart:function(){e.push(t=[])},lineEnd:p_,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function yk(t,e){return Qw(t[0]-e[0])<Vw&&Qw(t[1]-e[1])<Vw}function vk(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function bk(t,e,n,r,i){var o,a,s=[],u=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,r=t[0],a=t[e];if(yk(r,a)){if(!r[2]&&!a[2]){for(i.lineStart(),o=0;o<e;++o)i.point((r=t[o])[0],r[1]);return void i.lineEnd()}a[0]+=2e-6}s.push(n=new vk(r,t,null,!0)),u.push(n.o=new vk(r,null,n,!1)),s.push(n=new vk(a,t,null,!1)),u.push(n.o=new vk(a,null,n,!0))}})),s.length){for(u.sort(e),xk(s),xk(u),o=0,a=u.length;o<a;++o)u[o].e=n=!n;for(var l,c,f=s[0];;){for(var h=f,d=!0;h.v;)if((h=h.n)===f)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,a=l.length;o<a;++o)i.point((c=l[o])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(l=h.p.z,o=l.length-1;o>=0;--o)i.point((c=l[o])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,d=!d}while(!h.v);i.lineEnd()}}}function xk(t){if(e=t.length){for(var e,n,r=0,i=t[0];++r<e;)i.n=n=t[r],n.p=i,i=n;i.n=n=t[0],n.p=i}}function wk(t){return[e_(t[1],t[0]),d_(t[2])]}function _k(t){var e=t[0],n=t[1],r=n_(n);return[r*n_(e),r*u_(e),u_(n)]}function kk(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ak(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Ek(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Dk(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Sk(t){var e=c_(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Ck(t){return Qw(t[0])<=Gw?t[0]:l_(t[0])*((Qw(t[0])+Gw)%Yw-Gw)}function Ok(t){return Array.from(function*(t){for(const e of t)yield*e}(t))}function Fk(t,e,n,r){return function(i){var o,a,s,u=e(i),l=mk(),c=e(l),f=!1,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=v,h.lineEnd=b,a=[],o=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,a=Ok(a);var t=function(t,e){var n=Ck(e),r=e[1],i=u_(r),o=[u_(n),-n_(n),0],a=0,s=0,u=new Ww;1===i?r=Xw+Vw:-1===i&&(r=-Xw-Vw);for(var l=0,c=t.length;l<c;++l)if(h=(f=t[l]).length)for(var f,h,d=f[h-1],p=Ck(d),g=d[1]/2+Kw,m=u_(g),y=n_(g),v=0;v<h;++v,p=x,m=_,y=k,d=b){var b=f[v],x=Ck(b),w=b[1]/2+Kw,_=u_(w),k=n_(w),A=x-p,E=A>=0?1:-1,D=E*A,S=D>Gw,C=m*_;if(u.add(e_(C*E*u_(D),y*k+C*n_(D))),a+=S?A+E*Yw:A,S^p>=n^x>=n){var O=Ak(_k(d),_k(b));Sk(O);var F=Ak(o,O);Sk(F);var M=(S^A>=0?-1:1)*d_(F[2]);(r>M||r===M&&(O[0]||O[1]))&&(s+=S^A>=0?1:-1)}}return(a<-1e-6||a<Vw&&u<-1e-12)^1&s}(o,r);a.length?(f||(i.polygonStart(),f=!0),bk(a,$k,t,n,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),a=o=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(e,n){t(e,n)&&i.point(e,n)}function p(t,e){u.point(t,e)}function g(){h.point=p,u.lineStart()}function m(){h.point=d,u.lineEnd()}function y(t,e){s.push([t,e]),c.point(t,e)}function v(){c.lineStart(),s=[]}function b(){y(s[0][0],s[0][1]),c.lineEnd();var t,e,n,r,u=c.clean(),h=l.result(),d=h.length;if(s.pop(),o.push(s),s=null,d)if(1&u){if((e=(n=h[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<e;++t)i.point((r=n[t])[0],r[1]);i.lineEnd()}}else d>1&&2&u&&h.push(h.pop().concat(h.shift())),a.push(h.filter(Mk))}return h}}function Mk(t){return t.length>1}function $k(t,e){return((t=t.x)[0]<0?t[1]-Xw-Vw:Xw-t[1])-((e=e.x)[0]<0?e[1]-Xw-Vw:Xw-e[1])}dk.prototype={_radius:4.5,_circle:pk(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=pk(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};const Nk=Fk((function(){return!0}),(function(t){var e,n=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var s=o>0?Gw:-Gw,u=Qw(o-n);Qw(u-Gw)<Vw?(t.point(n,r=(r+a)/2>0?Xw:-Xw),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),t.point(o,r),e=0):i!==s&&u>=Gw&&(Qw(n-i)<Vw&&(n-=i*Vw),Qw(o-s)<Vw&&(o-=s*Vw),r=function(t,e,n,r){var i,o,a=u_(t-n);return Qw(a)>Vw?t_((u_(e)*(o=n_(r))*u_(n)-u_(r)*(i=n_(e))*u_(t))/(i*o*a)):(e+r)/2}(n,r,o,a),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(s,r),e=0),t.point(n=o,r=a),i=s},lineEnd:function(){t.lineEnd(),n=r=NaN},clean:function(){return 2-e}}}),(function(t,e,n,r){var i;if(null==t)i=n*Xw,r.point(-Gw,i),r.point(0,i),r.point(Gw,i),r.point(Gw,0),r.point(Gw,-i),r.point(0,-i),r.point(-Gw,-i),r.point(-Gw,0),r.point(-Gw,i);else if(Qw(t[0]-e[0])>Vw){var o=t[0]<e[0]?Gw:-Gw;i=n*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(e[0],e[1])}),[-Gw,-Xw]);function Bk(t,e){(e=_k(e))[0]-=t,Sk(e);var n=h_(-e[1]);return((-e[2]<0?-n:n)+Yw-Vw)%Yw}function Tk(t){var e=n_(t),n=6*Zw,r=e>0,i=Qw(e)>Vw;function o(t,n){return n_(t)*n_(n)>e}function a(t,n,r){var i=[1,0,0],o=Ak(_k(t),_k(n)),a=kk(o,o),s=o[0],u=a-s*s;if(!u)return!r&&t;var l=e*a/u,c=-e*s/u,f=Ak(i,o),h=Dk(i,l);Ek(h,Dk(o,c));var d=f,p=kk(h,d),g=kk(d,d),m=p*p-g*(kk(h,h)-1);if(!(m<0)){var y=c_(m),v=Dk(d,(-p-y)/g);if(Ek(v,h),v=wk(v),!r)return v;var b,x=t[0],w=n[0],_=t[1],k=n[1];w<x&&(b=x,x=w,w=b);var A=w-x,E=Qw(A-Gw)<Vw;if(!E&&k<_&&(b=_,_=k,k=b),E||A<Vw?E?_+k>0^v[1]<(Qw(v[0]-x)<Vw?_:k):_<=v[1]&&v[1]<=k:A>Gw^(x<=v[0]&&v[0]<=w)){var D=Dk(d,(-p+y)/g);return Ek(D,h),[v,wk(D)]}}}function s(e,n){var i=r?t:Gw-t,o=0;return e<-i?o|=1:e>i&&(o|=2),n<-i?o|=4:n>i&&(o|=8),o}return Fk(o,(function(t){var e,n,u,l,c;return{lineStart:function(){l=u=!1,c=1},point:function(f,h){var d,p=[f,h],g=o(f,h),m=r?g?0:s(f,h):g?s(f+(f<0?Gw:-Gw),h):0;if(!e&&(l=u=g)&&t.lineStart(),g!==u&&(!(d=a(e,p))||yk(e,d)||yk(p,d))&&(p[2]=1),g!==u)c=0,g?(t.lineStart(),d=a(p,e),t.point(d[0],d[1])):(d=a(e,p),t.point(d[0],d[1],2),t.lineEnd()),e=d;else if(i&&e&&r^g){var y;m&n||!(y=a(p,e,!0))||(c=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!g||e&&yk(e,p)||t.point(p[0],p[1]),e=p,u=g,n=m},lineEnd:function(){u&&t.lineEnd(),e=null},clean:function(){return c|(l&&u)<<1}}}),(function(e,r,i,o){!function(t,e,n,r,i,o){if(n){var a=n_(e),s=u_(e),u=r*n;null==i?(i=e+r*Yw,o=e-u/2):(i=Bk(a,i),o=Bk(a,o),(r>0?i<o:i>o)&&(i+=r*Yw));for(var l,c=i;r>0?c>o:c<o;c-=u)l=wk([a,-s*n_(c),-s*u_(c)]),t.point(l[0],l[1])}}(o,t,n,i,e,r)}),r?[0,-t]:[-Gw,t-Gw])}var jk=1e9,Ik=-jk;function zk(t,e,n,r){function i(i,o){return t<=i&&i<=n&&e<=o&&o<=r}function o(i,o,s,l){var c=0,f=0;if(null==i||(c=a(i,s))!==(f=a(o,s))||u(i,o)<0^s>0)do{l.point(0===c||3===c?t:n,c>1?r:e)}while((c=(c+s+4)%4)!==f);else l.point(o[0],o[1])}function a(r,i){return Qw(r[0]-t)<Vw?i>0?0:3:Qw(r[0]-n)<Vw?i>0?2:1:Qw(r[1]-e)<Vw?i>0?1:0:i>0?3:2}function s(t,e){return u(t.x,e.x)}function u(t,e){var n=a(t,1),r=a(e,1);return n!==r?n-r:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(a){var u,l,c,f,h,d,p,g,m,y,v,b=a,x=mk(),w={point:_,lineStart:function(){w.point=k,l&&l.push(c=[]),y=!0,m=!1,p=g=NaN},lineEnd:function(){u&&(k(f,h),d&&m&&x.rejoin(),u.push(x.result())),w.point=_,m&&b.lineEnd()},polygonStart:function(){b=x,u=[],l=[],v=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,i=l.length;n<i;++n)for(var o,a,s=l[n],u=1,c=s.length,f=s[0],h=f[0],d=f[1];u<c;++u)o=h,a=d,h=(f=s[u])[0],d=f[1],a<=r?d>r&&(h-o)*(r-a)>(d-a)*(t-o)&&++e:d<=r&&(h-o)*(r-a)<(d-a)*(t-o)&&--e;return e}(),n=v&&e,i=(u=Ok(u)).length;(n||i)&&(a.polygonStart(),n&&(a.lineStart(),o(null,null,1,a),a.lineEnd()),i&&bk(u,s,e,o,a),a.polygonEnd()),b=a,u=l=c=null}};function _(t,e){i(t,e)&&b.point(t,e)}function k(o,a){var s=i(o,a);if(l&&c.push([o,a]),y)f=o,h=a,d=s,y=!1,s&&(b.lineStart(),b.point(o,a));else if(s&&m)b.point(o,a);else{var u=[p=Math.max(Ik,Math.min(jk,p)),g=Math.max(Ik,Math.min(jk,g))],x=[o=Math.max(Ik,Math.min(jk,o)),a=Math.max(Ik,Math.min(jk,a))];!function(t,e,n,r,i,o){var a,s=t[0],u=t[1],l=0,c=1,f=e[0]-s,h=e[1]-u;if(a=n-s,f||!(a>0)){if(a/=f,f<0){if(a<l)return;a<c&&(c=a)}else if(f>0){if(a>c)return;a>l&&(l=a)}if(a=i-s,f||!(a<0)){if(a/=f,f<0){if(a>c)return;a>l&&(l=a)}else if(f>0){if(a<l)return;a<c&&(c=a)}if(a=r-u,h||!(a>0)){if(a/=h,h<0){if(a<l)return;a<c&&(c=a)}else if(h>0){if(a>c)return;a>l&&(l=a)}if(a=o-u,h||!(a<0)){if(a/=h,h<0){if(a>c)return;a>l&&(l=a)}else if(h>0){if(a<l)return;a<c&&(c=a)}return l>0&&(t[0]=s+l*f,t[1]=u+l*h),c<1&&(e[0]=s+c*f,e[1]=u+c*h),!0}}}}}(u,x,t,e,n,r)?s&&(b.lineStart(),b.point(o,a),v=!1):(m||(b.lineStart(),b.point(u[0],u[1])),b.point(x[0],x[1]),s||b.lineEnd(),v=!1)}p=o,g=a,m=s}return w}}function Rk(t,e){function n(n,r){return n=t(n,r),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,r){return(n=e.invert(n,r))&&t.invert(n[0],n[1])}),n}function Pk(t,e){return[Qw(t)>Gw?t+Math.round(-t/Yw)*Yw:t,e]}function Lk(t,e,n){return(t%=Yw)?e||n?Rk(Uk(t),Wk(e,n)):Uk(t):e||n?Wk(e,n):Pk}function qk(t){return function(e,n){return[(e+=t)>Gw?e-Yw:e<-Gw?e+Yw:e,n]}}function Uk(t){var e=qk(t);return e.invert=qk(-t),e}function Wk(t,e){var n=n_(t),r=u_(t),i=n_(e),o=u_(e);function a(t,e){var a=n_(e),s=n_(t)*a,u=u_(t)*a,l=u_(e),c=l*n+s*r;return[e_(u*i-c*o,s*n-l*r),d_(c*i+u*o)]}return a.invert=function(t,e){var a=n_(e),s=n_(t)*a,u=u_(t)*a,l=u_(e),c=l*i-u*o;return[e_(u*i+l*o,s*n+c*r),d_(c*n-s*r)]},a}function Vk(t){return function(e){var n=new Hk;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Hk(){}function Gk(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),Uw(n,t.stream(M_)),e(M_.result()),null!=r&&t.clipExtent(r),t}function Xk(t,e,n){return Gk(t,(function(n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],o=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),a=+e[0][0]+(r-o*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(i-o*(n[1][1]+n[0][1]))/2;t.scale(150*o).translate([a,s])}),n)}function Kk(t,e,n){return Xk(t,[[0,0],e],n)}function Yk(t,e,n){return Gk(t,(function(n){var r=+e,i=r/(n[1][0]-n[0][0]),o=(r-i*(n[1][0]+n[0][0]))/2,a=-i*n[0][1];t.scale(150*i).translate([o,a])}),n)}function Jk(t,e,n){return Gk(t,(function(n){var r=+e,i=r/(n[1][1]-n[0][1]),o=-i*n[0][0],a=(r-i*(n[1][1]+n[0][1]))/2;t.scale(150*i).translate([o,a])}),n)}Pk.invert=Pk,Hk.prototype={constructor:Hk,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Zk=n_(30*Zw);function Qk(t,e){return+e?function(t,e){function n(r,i,o,a,s,u,l,c,f,h,d,p,g,m){var y=l-r,v=c-i,b=y*y+v*v;if(b>4*e&&g--){var x=a+h,w=s+d,_=u+p,k=c_(x*x+w*w+_*_),A=d_(_/=k),E=Qw(Qw(_)-1)<Vw||Qw(o-f)<Vw?(o+f)/2:e_(w,x),D=t(E,A),S=D[0],C=D[1],O=S-r,F=C-i,M=v*O-y*F;(M*M/b>e||Qw((y*O+v*F)/b-.5)>.3||a*h+s*d+u*p<Zk)&&(n(r,i,o,a,s,u,S,C,E,x/=k,w/=k,_,g,m),m.point(S,C),n(S,C,E,x,w,_,l,c,f,h,d,p,g,m))}}return function(e){var r,i,o,a,s,u,l,c,f,h,d,p,g={point:m,lineStart:y,lineEnd:b,polygonStart:function(){e.polygonStart(),g.lineStart=x},polygonEnd:function(){e.polygonEnd(),g.lineStart=y}};function m(n,r){n=t(n,r),e.point(n[0],n[1])}function y(){c=NaN,g.point=v,e.lineStart()}function v(r,i){var o=_k([r,i]),a=t(r,i);n(c,f,l,h,d,p,c=a[0],f=a[1],l=r,h=o[0],d=o[1],p=o[2],16,e),e.point(c,f)}function b(){g.point=m,e.lineEnd()}function x(){y(),g.point=w,g.lineEnd=_}function w(t,e){v(r=t,e),i=c,o=f,a=h,s=d,u=p,g.point=v}function _(){n(c,f,l,h,d,p,i,o,r,a,s,u,16,e),g.lineEnd=b,b()}return g}}(t,e):function(t){return Vk({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}(t)}var tA=Vk({point:function(t,e){this.stream.point(t*Zw,e*Zw)}});function eA(t,e,n,r,i,o){if(!o)return function(t,e,n,r,i){function o(o,a){return[e+t*(o*=r),n-t*(a*=i)]}return o.invert=function(o,a){return[(o-e)/t*r,(n-a)/t*i]},o}(t,e,n,r,i);var a=n_(o),s=u_(o),u=a*t,l=s*t,c=a/t,f=s/t,h=(s*n-a*e)/t,d=(s*e+a*n)/t;function p(t,o){return[u*(t*=r)-l*(o*=i)+e,n-l*t-u*o]}return p.invert=function(t,e){return[r*(c*t-f*e+h),i*(d-f*t-c*e)]},p}function nA(t){return rA((function(){return t}))()}function rA(t){var e,n,r,i,o,a,s,u,l,c,f=150,h=480,d=250,p=0,g=0,m=0,y=0,v=0,b=0,x=1,w=1,_=null,k=Nk,A=null,E=Iw,D=.5;function S(t){return u(t[0]*Zw,t[1]*Zw)}function C(t){return(t=u.invert(t[0],t[1]))&&[t[0]*Jw,t[1]*Jw]}function O(){var t=eA(f,0,0,x,w,b).apply(null,e(p,g)),r=eA(f,h-t[0],d-t[1],x,w,b);return n=Lk(m,y,v),s=Rk(e,r),u=Rk(n,s),a=Qk(s,D),F()}function F(){return l=c=null,S}return S.stream=function(t){return l&&c===t?l:l=tA(function(t){return Vk({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}(n)(k(a(E(c=t)))))},S.preclip=function(t){return arguments.length?(k=t,_=void 0,F()):k},S.postclip=function(t){return arguments.length?(E=t,A=r=i=o=null,F()):E},S.clipAngle=function(t){return arguments.length?(k=+t?Tk(_=t*Zw):(_=null,Nk),F()):_*Jw},S.clipExtent=function(t){return arguments.length?(E=null==t?(A=r=i=o=null,Iw):zk(A=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),F()):null==A?null:[[A,r],[i,o]]},S.scale=function(t){return arguments.length?(f=+t,O()):f},S.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],O()):[h,d]},S.center=function(t){return arguments.length?(p=t[0]%360*Zw,g=t[1]%360*Zw,O()):[p*Jw,g*Jw]},S.rotate=function(t){return arguments.length?(m=t[0]%360*Zw,y=t[1]%360*Zw,v=t.length>2?t[2]%360*Zw:0,O()):[m*Jw,y*Jw,v*Jw]},S.angle=function(t){return arguments.length?(b=t%360*Zw,O()):b*Jw},S.reflectX=function(t){return arguments.length?(x=t?-1:1,O()):x<0},S.reflectY=function(t){return arguments.length?(w=t?-1:1,O()):w<0},S.precision=function(t){return arguments.length?(a=Qk(s,D=t*t),F()):c_(D)},S.fitExtent=function(t,e){return Xk(S,t,e)},S.fitSize=function(t,e){return Kk(S,t,e)},S.fitWidth=function(t,e){return Yk(S,t,e)},S.fitHeight=function(t,e){return Jk(S,t,e)},function(){return e=t.apply(this,arguments),S.invert=e.invert&&C,O()}}function iA(t){var e=0,n=Gw/3,r=rA(t),i=r(e,n);return i.parallels=function(t){return arguments.length?r(e=t[0]*Zw,n=t[1]*Zw):[e*Jw,n*Jw]},i}function oA(t,e){var n=u_(t),r=(n+u_(e))/2;if(Qw(r)<Vw)return function(t){var e=n_(t);function n(t,n){return[t*e,u_(n)/e]}return n.invert=function(t,n){return[t/e,d_(n*e)]},n}(t);var i=1+n*(2*r-n),o=c_(i)/r;function a(t,e){var n=c_(i-2*r*u_(e))/r;return[n*u_(t*=r),o-n*n_(t)]}return a.invert=function(t,e){var n=o-e,a=e_(t,Qw(n))*l_(n);return n*r<0&&(a-=Gw*l_(t)*l_(n)),[a/r,d_((i-(t*t+n*n)*r*r)/(2*r))]},a}function aA(){return iA(oA).scale(155.424).center([0,33.6442])}function sA(){return aA().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function uA(t){return function(e,n){var r=n_(e),i=n_(n),o=t(r*i);return o===1/0?[2,0]:[o*i*u_(e),o*u_(n)]}}function lA(t){return function(e,n){var r=c_(e*e+n*n),i=t(r),o=u_(i),a=n_(i);return[e_(e*o,r*a),d_(r&&n*o/r)]}}var cA=uA((function(t){return c_(2/(1+t))}));cA.invert=lA((function(t){return 2*d_(t/2)}));var fA=uA((function(t){return(t=h_(t))&&t/u_(t)}));function hA(t,e){return[t,a_(f_((Xw+e)/2))]}function dA(t){var e,n,r,i=nA(t),o=i.center,a=i.scale,s=i.translate,u=i.clipExtent,l=null;function c(){var o=Gw*a(),s=i(function(t){function e(e){return(e=t(e[0]*Zw,e[1]*Zw))[0]*=Jw,e[1]*=Jw,e}return t=Lk(t[0]*Zw,t[1]*Zw,t.length>2?t[2]*Zw:0),e.invert=function(e){return(e=t.invert(e[0]*Zw,e[1]*Zw))[0]*=Jw,e[1]*=Jw,e},e}(i.rotate()).invert([0,0]));return u(null==l?[[s[0]-o,s[1]-o],[s[0]+o,s[1]+o]]:t===hA?[[Math.max(s[0]-o,l),e],[Math.min(s[0]+o,n),r]]:[[l,Math.max(s[1]-o,e)],[n,Math.min(s[1]+o,r)]])}return i.scale=function(t){return arguments.length?(a(t),c()):a()},i.translate=function(t){return arguments.length?(s(t),c()):s()},i.center=function(t){return arguments.length?(o(t),c()):o()},i.clipExtent=function(t){return arguments.length?(null==t?l=e=n=r=null:(l=+t[0][0],e=+t[0][1],n=+t[1][0],r=+t[1][1]),c()):null==l?null:[[l,e],[n,r]]},c()}function pA(t){return f_((Xw+t)/2)}function gA(t,e){var n=n_(t),r=t===e?u_(t):a_(n/n_(e))/a_(pA(e)/pA(t)),i=n*s_(pA(t),r)/r;if(!r)return hA;function o(t,e){i>0?e<-Xw+Vw&&(e=-Xw+Vw):e>Xw-Vw&&(e=Xw-Vw);var n=i/s_(pA(e),r);return[n*u_(r*t),i-n*n_(r*t)]}return o.invert=function(t,e){var n=i-e,o=l_(r)*c_(t*t+n*n),a=e_(t,Qw(n))*l_(n);return n*r<0&&(a-=Gw*l_(t)*l_(n)),[a/r,2*t_(s_(i/o,1/r))-Xw]},o}function mA(t,e){return[t,e]}function yA(t,e){var n=n_(t),r=t===e?u_(t):(n-n_(e))/(e-t),i=n/r+t;if(Qw(r)<Vw)return mA;function o(t,e){var n=i-e,o=r*t;return[n*u_(o),i-n*n_(o)]}return o.invert=function(t,e){var n=i-e,o=e_(t,Qw(n))*l_(n);return n*r<0&&(o-=Gw*l_(t)*l_(n)),[o/r,i-l_(r)*c_(t*t+n*n)]},o}fA.invert=lA((function(t){return t})),hA.invert=function(t,e){return[t,2*t_(i_(e))-Xw]},mA.invert=mA;var vA=1.340264,bA=-.081106,xA=893e-6,wA=.003796,_A=c_(3)/2;function kA(t,e){var n=d_(_A*u_(e)),r=n*n,i=r*r*r;return[t*n_(n)/(_A*(vA+3*bA*r+i*(7*xA+9*wA*r))),n*(vA+bA*r+i*(xA+wA*r))]}function AA(t,e){var n=n_(e),r=n_(t)*n;return[n*u_(t)/r,u_(e)/r]}function EA(t,e){var n=e*e,r=n*n;return[t*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function DA(t,e){return[n_(e)*u_(t),u_(e)]}function SA(t,e){var n=n_(e),r=1+n_(t)*n;return[n*u_(t)/r,u_(e)/r]}function CA(t,e){return[a_(f_((Xw+e)/2)),-t]}kA.invert=function(t,e){for(var n,r=e,i=r*r,o=i*i*i,a=0;a<12&&(o=(i=(r-=n=(r*(vA+bA*i+o*(xA+wA*i))-e)/(vA+3*bA*i+o*(7*xA+9*wA*i)))*r)*i*i,!(Qw(n)<Hw));++a);return[_A*t*(vA+3*bA*i+o*(7*xA+9*wA*i))/n_(r),d_(u_(r)/_A)]},AA.invert=lA(t_),EA.invert=function(t,e){var n,r=e,i=25;do{var o=r*r,a=o*o;r-=n=(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))-e)/(1.007226+o*(.045255+a*(.259866*o-.311325-.005916*11*a)))}while(Qw(n)>Vw&&--i>0);return[t/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979)),r]},DA.invert=lA(d_),SA.invert=lA((function(t){return 2*t_(t)})),CA.invert=function(t,e){return[-e,2*t_(i_(t))-Xw]};var OA=Math.abs,FA=(Math.atan,Math.atan2,Math.ceil,Math.cos),MA=(Math.exp,Math.floor,Math.log,Math.max,Math.min,Math.pow,Math.round,Math.sign,Math.sin),$A=(Math.tan,Math.PI),NA=$A/2,BA=(Math.SQRT1_2,jA(2));function TA(t){return t>1?NA:t<-1?-NA:Math.asin(t)}function jA(t){return t>0?Math.sqrt(t):0}function IA(t,e){var n,r=t*MA(e),i=30;do{e-=n=(e+MA(e)-r)/(1+FA(e))}while(OA(n)>1e-6&&--i>0);return e/2}jA($A);var zA=function(t,e,n){function r(r,i){return[t*r*FA(i=IA(n,i)),e*MA(i)]}return r.invert=function(r,i){return i=TA(i/e),[r/(t*FA(i)),TA((2*i+MA(2*i))/n)]},r}(BA/NA,BA,$A);const RA=gk(),PA=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function LA(t,e){return function n(){const r=e();return r.type=t,r.path=gk().projection(r),r.copy=r.copy||function(){const t=n();return PA.forEach((e=>{r[e]&&t[e](r[e]())})),t.path.pointRadius(r.path.pointRadius()),t},r}}function qA(t,e){if(!t||"string"!=typeof t)throw new Error("Projection type must be a name string.");return t=t.toLowerCase(),arguments.length>1?(WA[t]=LA(t,e),this):WA[t]||null}function UA(t){return t&&t.path||RA}const WA={albers:sA,albersusa:function(){var t,e,n,r,i,o,a=sA(),s=aA().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=aA().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,e){o=[t,e]}};function c(t){var e=t[0],a=t[1];return o=null,n.point(e,a),o||(r.point(e,a),o)||(i.point(e,a),o)}function f(){return t=e=null,c}return c.invert=function(t){var e=a.scale(),n=a.translate(),r=(t[0]-n[0])/e,i=(t[1]-n[1])/e;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?u:a).invert(t)},c.stream=function(n){return t&&e===n?t:(r=[a.stream(e=n),s.stream(n),u.stream(n)],i=r.length,t={point:function(t,e){for(var n=-1;++n<i;)r[n].point(t,e)},sphere:function(){for(var t=-1;++t<i;)r[t].sphere()},lineStart:function(){for(var t=-1;++t<i;)r[t].lineStart()},lineEnd:function(){for(var t=-1;++t<i;)r[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<i;)r[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<i;)r[t].polygonEnd()}});var r,i},c.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),u.precision(t),f()):a.precision()},c.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),u.scale(t),c.translate(a.translate())):a.scale()},c.translate=function(t){if(!arguments.length)return a.translate();var e=a.scale(),o=+t[0],c=+t[1];return n=a.translate(t).clipExtent([[o-.455*e,c-.238*e],[o+.455*e,c+.238*e]]).stream(l),r=s.translate([o-.307*e,c+.201*e]).clipExtent([[o-.425*e+Vw,c+.12*e+Vw],[o-.214*e-Vw,c+.234*e-Vw]]).stream(l),i=u.translate([o-.205*e,c+.212*e]).clipExtent([[o-.214*e+Vw,c+.166*e+Vw],[o-.115*e-Vw,c+.234*e-Vw]]).stream(l),f()},c.fitExtent=function(t,e){return Xk(c,t,e)},c.fitSize=function(t,e){return Kk(c,t,e)},c.fitWidth=function(t,e){return Yk(c,t,e)},c.fitHeight=function(t,e){return Jk(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return nA(cA).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return nA(fA).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return iA(gA).scale(109.5).parallels([30,30])},conicequalarea:aA,conicequidistant:function(){return iA(yA).scale(131.154).center([0,13.9389])},equalEarth:function(){return nA(kA).scale(177.158)},equirectangular:function(){return nA(mA).scale(152.63)},gnomonic:function(){return nA(AA).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,r,i,o,a,s=1,u=0,l=0,c=1,f=1,h=0,d=null,p=1,g=1,m=Vk({point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}}),y=Iw;function v(){return p=s*c,g=s*f,o=a=null,b}function b(n){var r=n[0]*p,i=n[1]*g;if(h){var o=i*t-r*e;r=r*t+i*e,i=o}return[r+u,i+l]}return b.invert=function(n){var r=n[0]-u,i=n[1]-l;if(h){var o=i*t+r*e;r=r*t-i*e,i=o}return[r/p,i/g]},b.stream=function(t){return o&&a===t?o:o=m(y(a=t))},b.postclip=function(t){return arguments.length?(y=t,d=n=r=i=null,v()):y},b.clipExtent=function(t){return arguments.length?(y=null==t?(d=n=r=i=null,Iw):zk(d=+t[0][0],n=+t[0][1],r=+t[1][0],i=+t[1][1]),v()):null==d?null:[[d,n],[r,i]]},b.scale=function(t){return arguments.length?(s=+t,v()):s},b.translate=function(t){return arguments.length?(u=+t[0],l=+t[1],v()):[u,l]},b.angle=function(n){return arguments.length?(e=u_(h=n%360*Zw),t=n_(h),v()):h*Jw},b.reflectX=function(t){return arguments.length?(c=t?-1:1,v()):c<0},b.reflectY=function(t){return arguments.length?(f=t?-1:1,v()):f<0},b.fitExtent=function(t,e){return Xk(b,t,e)},b.fitSize=function(t,e){return Kk(b,t,e)},b.fitWidth=function(t,e){return Yk(b,t,e)},b.fitHeight=function(t,e){return Jk(b,t,e)},b},mercator:function(){return dA(hA).scale(961/Yw)},mollweide:function(){return nA(zA).scale(169.529)},naturalEarth1:function(){return nA(EA).scale(175.295)},orthographic:function(){return nA(DA).scale(249.5).clipAngle(90.000001)},stereographic:function(){return nA(SA).scale(250).clipAngle(142)},transversemercator:function(){var t=dA(CA),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(const t in WA)qA(t,WA[t]);function VA(t,e,n){var r=xu(t,e-Vw,n).concat(e);return function(t){return r.map((function(e){return[t,e]}))}}function HA(t,e,n){var r=xu(t,e-Vw,n).concat(e);return function(t){return r.map((function(e){return[e,t]}))}}function GA(){}const XA=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function KA(){var t=1,e=1,n=a;function r(t,e){return e.map((e=>i(t,e)))}function i(r,i){var a=[],s=[];return function(n,r,i){var a,s,u,l,c,f,h=new Array,d=new Array;for(a=s=-1,l=n[0]>=r,XA[l<<1].forEach(p);++a<t-1;)u=l,l=n[a+1]>=r,XA[u|l<<1].forEach(p);for(XA[l<<0].forEach(p);++s<e-1;){for(a=-1,l=n[s*t+t]>=r,c=n[s*t]>=r,XA[l<<1|c<<2].forEach(p);++a<t-1;)u=l,l=n[s*t+t+a+1]>=r,f=c,c=n[s*t+a+1]>=r,XA[u|l<<1|c<<2|f<<3].forEach(p);XA[l|c<<3].forEach(p)}for(a=-1,c=n[s*t]>=r,XA[c<<2].forEach(p);++a<t-1;)f=c,c=n[s*t+a+1]>=r,XA[c<<2|f<<3].forEach(p);function p(t){var e,n,r=[t[0][0]+a,t[0][1]+s],u=[t[1][0]+a,t[1][1]+s],l=o(r),c=o(u);(e=d[l])?(n=h[c])?(delete d[e.end],delete h[n.start],e===n?(e.ring.push(u),i(e.ring)):h[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(u),d[e.end=c]=e):(e=h[c])?(n=d[l])?(delete h[e.start],delete d[n.end],e===n?(e.ring.push(u),i(e.ring)):h[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete h[e.start],e.ring.unshift(r),h[e.start=l]=e):h[l]=d[c]={start:l,end:c,ring:[r,u]}}XA[c<<3].forEach(p)}(r,i,(t=>{n(t,r,i),function(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?a.push([t]):s.push(t)})),s.forEach((t=>{for(var e,n=0,r=a.length;n<r;++n)if(-1!==YA((e=a[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:a}}function o(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,r,i){n.forEach((n=>{var o,a=n[0],s=n[1],u=0|a,l=0|s,c=r[l*t+u];a>0&&a<t&&u===a&&(o=r[l*t+u-1],n[0]=a+(i-o)/(c-o)-.5),s>0&&s<e&&l===s&&(o=r[(l-1)*t+u],n[1]=s+(i-o)/(c-o)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[t,e];var i=Math.floor(n[0]),o=Math.floor(n[1]);return i>=0&&o>=0||at("invalid size"),t=i,e=o,r},r.smooth=function(t){return arguments.length?(n=t?a:GA,r):n===a},r}function YA(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=JA(t,e[r]))return n;return 0}function JA(t,e){for(var n=e[0],r=e[1],i=-1,o=0,a=t.length,s=a-1;o<a;s=o++){var u=t[o],l=u[0],c=u[1],f=t[s],h=f[0],d=f[1];if(ZA(u,f,e))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function ZA(t,e,n){var r,i,o,a;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[r=+(t[0]===e[0])],o=n[r],a=e[r],i<=o&&o<=a||a<=o&&o<=i)}function QA(t,e,n){return function(r){var i=ie(r),o=n?Math.min(i[0],0):i[0],a=i[1],s=a-o,u=e?An(o,a,t):s/(t+1);return xu(o+u,a,u)}}function tE(t){ps.call(this,null,t)}function eE(t,e,n,r,i){const o=t.x1||0,a=t.y1||0,s=e*n<0;function u(t){t.forEach(l)}function l(t){s&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-o)*e+r,t[1]=(t[1]-a)*n+i}return function(t){return t.coordinates.forEach(u),t}}function nE(t,e,n){const r=t>=0?t:Os(e,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function rE(t){return Kt(t)?t:ee(+t)}function iE(){var t=t=>t[0],e=t=>t[1],n=ht,r=[-1,-1],i=960,o=500,a=2;function s(s,u){const l=nE(r[0],s,t)>>a,c=nE(r[1],s,e)>>a,f=l?l+2:0,h=c?c+2:0,d=2*f+(i>>a),p=2*h+(o>>a),g=new Float32Array(d*p),m=new Float32Array(d*p);let y=g;s.forEach((r=>{const i=f+(+t(r)>>a),o=h+(+e(r)>>a);i>=0&&i<d&&o>=0&&o<p&&(g[i+o*d]+=+n(r))})),l>0&&c>0?(oE(d,p,g,m,l),aE(d,p,m,g,c),oE(d,p,g,m,l),aE(d,p,m,g,c),oE(d,p,g,m,l),aE(d,p,m,g,c)):l>0?(oE(d,p,g,m,l),oE(d,p,m,g,l),oE(d,p,g,m,l),y=m):c>0&&(aE(d,p,g,m,c),aE(d,p,m,g,c),aE(d,p,g,m,c),y=m);const v=u?Math.pow(2,-2*a):1/aw(y);for(let t=0,e=d*p;t<e;++t)y[t]*=v;return{values:y,scale:1<<a,width:d,height:p,x1:f,y1:h,x2:f+(i>>a),y2:h+(o>>a)}}return s.x=function(e){return arguments.length?(t=rE(e),s):t},s.y=function(t){return arguments.length?(e=rE(t),s):e},s.weight=function(t){return arguments.length?(n=rE(t),s):n},s.size=function(t){if(!arguments.length)return[i,o];var e=+t[0],n=+t[1];return e>=0&&n>=0||at("invalid size"),i=e,o=n,s},s.cellSize=function(t){return arguments.length?((t=+t)>=1||at("invalid cell size"),a=Math.floor(Math.log(t)/Math.LN2),s):1<<a},s.bandwidth=function(t){return arguments.length?(1===(t=Gt(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&at("invalid bandwidth"),r=t,s):r},s}function oE(t,e,n,r,i){const o=1+(i<<1);for(let a=0;a<e;++a)for(let e=0,s=0;e<t+i;++e)e<t&&(s+=n[e+a*t]),e>=i&&(e>=o&&(s-=n[e-o+a*t]),r[e-i+a*t]=s/Math.min(e+1,t-1+o-e,o))}function aE(t,e,n,r,i){const o=1+(i<<1);for(let a=0;a<t;++a)for(let s=0,u=0;s<e+i;++s)s<e&&(u+=n[a+s*t]),s>=i&&(s>=o&&(u-=n[a+(s-o)*t]),r[a+(s-i)*t]=u/Math.min(s+1,e-1+o-s,o))}function sE(t){ps.call(this,null,t)}tE.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},fe(tE,ps,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=e.materialize(e.SOURCE).source,i=t.field||ct,o=KA().smooth(!1!==t.smooth),a=t.thresholds||function(t,e,n){const r=QA(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(t.map((t=>vs(e(t).values))))}(r,i,t),s=null===t.as?null:t.as||"contour",u=[];return r.forEach((e=>{const n=i(e),r=o.size([n.width,n.height])(n.values,_t(a)?a:a(n.values));!function(t,e,n,r){let i=r.scale||e.scale,o=r.translate||e.translate;if(Kt(i)&&(i=i(n,r)),Kt(o)&&(o=o(n,r)),(1===i||null==i)&&!o)return;const a=(me(i)?i:i[0])||1,s=(me(i)?i:i[1])||1,u=o&&o[0]||0,l=o&&o[1]||0;t.forEach(eE(e,a,s,u,l))}(r,n,e,t),r.forEach((t=>{u.push(Pa(e,za(null!=s?{[s]:t}:t)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}}),sE.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const uE=["x","y","weight","size","cellSize","bandwidth"];function lE(t,e){return uE.forEach((n=>null!=e[n]?t[n](e[n]):0)),t}function cE(t){ps.call(this,null,t)}fe(sE,ps,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=function(t,e){var n,r,i,o,a,s,u=[],l=t=>t(o);if(null==e)u.push(t);else for(n={},r=0,i=t.length;r<i;++r)o=t[r],(s=n[a=e.map(l)])||(n[a]=s=[],s.dims=a,u.push(s)),s.push(o);return u}(e.materialize(e.SOURCE).source,t.groupby),o=(t.groupby||[]).map(et),a=lE(iE(),t),s=t.as||"grid";return n=i.map((e=>za(function(t,e){for(let n=0;n<o.length;++n)t[o[n]]=e[n];return t}({[s]:a(e,t.counts)},e.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),cE.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},fe(cE,ps,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,r,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),o=KA().smooth(!1!==t.smooth),a=t.values,s=t.thresholds||QA(t.count||10,t.nice,!!a),u=t.size;return a||(a=e.materialize(e.SOURCE).source,r=eE(n=lE(iE(),t)(a,!0),n.scale||1,n.scale||1,0,0),u=[n.width,n.height],a=n.values),s=_t(s)?s:s(a),a=o.size(u)(a,s),r&&a.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(a||[]).map(za),i}});const fE="Feature",hE="FeatureCollection";function dE(t){ps.call(this,null,t)}function pE(t){ps.call(this,null,t)}function gE(t){ps.call(this,null,t)}function mE(t){ps.call(this,null,t)}function yE(t){ps.call(this,[],t),this.generator=function(){var t,e,n,r,i,o,a,s,u,l,c,f,h=10,d=h,p=90,g=360,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return xu(r_(r/p)*p,n,p).map(c).concat(xu(r_(s/g)*g,a,g).map(f)).concat(xu(r_(e/h)*h,t,h).filter((function(t){return Qw(t%p)>Vw})).map(u)).concat(xu(r_(o/d)*d,i,d).filter((function(t){return Qw(t%g)>Vw})).map(l))}return y.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(a).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(t){return arguments.length?y.extentMajor(t).extentMinor(t):y.extentMinor()},y.extentMajor=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],r>n&&(t=r,r=n,n=t),s>a&&(t=s,s=a,a=t),y.precision(m)):[[r,s],[n,a]]},y.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],o=+n[0][1],i=+n[1][1],e>t&&(n=e,e=t,t=n),o>i&&(n=o,o=i,i=n),y.precision(m)):[[e,o],[t,i]]},y.step=function(t){return arguments.length?y.stepMajor(t).stepMinor(t):y.stepMinor()},y.stepMajor=function(t){return arguments.length?(p=+t[0],g=+t[1],y):[p,g]},y.stepMinor=function(t){return arguments.length?(h=+t[0],d=+t[1],y):[h,d]},y.precision=function(h){return arguments.length?(m=+h,u=VA(o,i,90),l=HA(e,t,m),c=VA(s,a,90),f=HA(r,n,m),y):m},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function vE(t){ps.call(this,null,t)}function bE(t){if(!Kt(t))return!1;const e=Me(nt(t));return e.$x||e.$y||e.$value||e.$max}function xE(t){ps.call(this,null,t),this.modified(!0)}function wE(t,e,n){Kt(t[e])&&t[e](n)}function _E(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o,a,s,u,l,c,f,h,d=t._root,p={data:r},g=t._x0,m=t._y0,y=t._x1,v=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((l=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a,i=d,!(d=d[f=c<<1|l]))return i[f]=p,t;if(s=+t._x.call(null,d.data),u=+t._y.call(null,d.data),e===s&&n===u)return p.next=d,i?i[f]=p:t._root=p,t;do{i=i?i[f]=new Array(4):t._root=new Array(4),(l=e>=(o=(g+y)/2))?g=o:y=o,(c=n>=(a=(m+v)/2))?m=a:v=a}while((f=c<<1|l)==(h=(u>=a)<<1|s>=o));return i[h]=d,i[f]=p,t}function kE(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function AE(t){return t[0]}function EE(t){return t[1]}function DE(t,e,n){var r=new SE(null==e?AE:e,null==n?EE:n,NaN,NaN,NaN,NaN);return null==t?r:r.addAll(t)}function SE(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function CE(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}dE.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},fe(dE,ps,{transform(t,e){var n,r=this._features,i=this._points,o=t.fields,a=o&&o[0],s=o&&o[1],u=t.geojson||!o&&ct,l=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(nt(u))||a&&e.modified(nt(a))||s&&e.modified(nt(s)),this.value&&!n||(l=e.SOURCE,this._features=r=[],this._points=i=[]),u&&e.visit(l,(t=>r.push(u(t)))),a&&s&&(e.visit(l,(t=>{var e=a(t),n=s(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&i.push([e,n])})),r=r.concat({type:fE,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:hE,features:r}}}),pE.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},fe(pE,ps,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.field||ct,o=t.as||"path",a=n.SOURCE;!r||t.modified()?(this.value=r=UA(t.projection),n.materialize().reflow()):a=i===ct||e.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(t,e){const n=t.pointRadius();return t.context(null),null!=e&&t.pointRadius(e),n}(r,t.pointRadius);return n.visit(a,(t=>t[o]=r(i(t)))),r.pointRadius(s),n.modifies(o)}}),gE.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},fe(gE,ps,{transform(t,e){var n,r=t.projection,i=t.fields[0],o=t.fields[1],a=t.as||["x","y"],s=a[0],u=a[1];function l(t){const e=r([i(t),o(t)]);e?(t[s]=e[0],t[u]=e[1]):(t[s]=void 0,t[u]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,l):(n=e.modified(i.fields)||e.modified(o.fields),e.visit(n?e.ADD_MOD:e.ADD,l)),e.modifies(a)}}),mE.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},fe(mE,ps,{transform(t,e){var n=e.fork(e.ALL),r=this.value,i=t.as||"shape",o=n.ADD;return r&&!t.modified()||(this.value=r=function(t,e,n){const r=null==n?n=>t(e(n)):r=>{var i=t.pointRadius(),o=t.pointRadius(n)(e(r));return t.pointRadius(i),o};return r.context=e=>(t.context(e),r),r}(UA(t.projection),t.field||ut("datum"),t.pointRadius),n.materialize().reflow(),o=n.SOURCE),n.visit(o,(t=>t[i]=r)),n.modifies(i)}}),yE.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},fe(yE,ps,{transform(t,e){var n,r=this.value,i=this.generator;if(!r.length||t.modified())for(const e in t)Kt(i[e])&&i[e](t[e]);return n=i(),r.length?e.mod.push(La(r[0],n)):e.add.push(za(n)),r[0]=n,e}}),vE.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},fe(vE,ps,{transform(t,e){if(!e.changed()&&!t.modified())return e.StopPropagation;var n=e.materialize(e.SOURCE).source,r="shared"===t.resolve,i=t.field||ct,o=function(t,e){let n;return Kt(t)?(n=n=>t(n,e),n.dep=bE(t)):t?n=ee(t):(n=t=>t.$value/t.$max||0,n.dep=!0),n}(t.opacity,t),a=function(t,e){let n;return Kt(t)?(n=n=>th(t(n,e)),n.dep=bE(t)):n=ee(th(t||"#888")),n}(t.color,t),s=t.as||"image",u={$x:0,$y:0,$value:0,$max:r?vs(n.map((t=>vs(i(t).values)))):0};return n.forEach((t=>{const e=i(t),n=re({},t,u);r||(n.$max=vs(e.values||[])),t[s]=function(t,e,n,r){const i=t.width,o=t.height,a=t.x1||0,s=t.y1||0,u=t.x2||i,l=t.y2||o,c=t.values,f=c?t=>c[t]:ft,h=sf(u-a,l-s),d=h.getContext("2d"),p=d.getImageData(0,0,u-a,l-s),g=p.data;for(let t=s,o=0;t<l;++t){e.$y=t-s;for(let s=a,l=t*i;s<u;++s,o+=4){e.$x=s-a,e.$value=f(s+l);const t=n(e);g[o+0]=t.r,g[o+1]=t.g,g[o+2]=t.b,g[o+3]=~~(255*r(e))}}return d.putImageData(p,0,0),h}(e,n,a.dep?a:ee(a(n)),o.dep?o:ee(o(n)))})),e.reflow(!0).modifies(s)}}),fe(xE,ps,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=function(t){const e=qA((t||"mercator").toLowerCase());return e||at("Unrecognized projection type: "+t),e()}(t.type),PA.forEach((e=>{null!=t[e]&&wE(n,e,t[e])}))):PA.forEach((e=>{t.modified(e)&&wE(n,e,t[e])})),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){const n=function(t){return 1===(t=Gt(t)).length?t[0]:{type:hE,features:t.reduce(((t,e)=>t.concat(function(t){return t.type===hE?t.features:Gt(t).filter((t=>null!=t)).map((t=>t.type===fE?t:{type:fE,geometry:t}))}(e))),[])}}(e.fit);e.extent?t.fitExtent(e.extent,n):e.size&&t.fitSize(e.size,n)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});var OE=DE.prototype=SE.prototype;function FE(t){return function(){return t}}function ME(t){return 1e-6*(t()-.5)}function $E(t){return t.x+t.vx}function NE(t){return t.y+t.vy}OE.copy=function(){var t,e,n=new SE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=CE(r),n;for(t=[{source:r,target:n._root=new Array(4)}];r=t.pop();)for(var i=0;i<4;++i)(e=r.source[i])&&(e.length?t.push({source:e,target:r.target[i]=new Array(4)}):r.target[i]=CE(e));return n},OE.add=function(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return _E(this.cover(e,n),e,n,t)},OE.addAll=function(t){var e,n,r,i,o=t.length,a=new Array(o),s=new Array(o),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,e=t[n]))||isNaN(i=+this._y.call(null,e))||(a[n]=r,s[n]=i,r<u&&(u=r),r>c&&(c=r),i<l&&(l=i),i>f&&(f=i));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<o;++n)_E(this,a[n],s[n],t[n]);return this},OE.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a,s,u=i-n||1,l=this._root;n>t||t>=i||r>e||e>=o;)switch(s=(e<r)<<1|t<n,(a=new Array(4))[s]=l,l=a,u*=2,s){case 0:i=n+u,o=r+u;break;case 1:n=i-u,o=r+u;break;case 2:i=n+u,r=o-u;break;case 3:n=i-u,r=o-u}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this},OE.data=function(){var t=[];return this.visit((function(e){if(!e.length)do{t.push(e.data)}while(e=e.next)})),t},OE.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},OE.find=function(t,e,n){var r,i,o,a,s,u,l,c=this._x0,f=this._y0,h=this._x1,d=this._y1,p=[],g=this._root;for(g&&p.push(new kE(g,c,f,h,d)),null==n?n=1/0:(c=t-n,f=e-n,h=t+n,d=e+n,n*=n);u=p.pop();)if(!(!(g=u.node)||(i=u.x0)>h||(o=u.y0)>d||(a=u.x1)<c||(s=u.y1)<f))if(g.length){var m=(i+a)/2,y=(o+s)/2;p.push(new kE(g[3],m,y,a,s),new kE(g[2],i,y,m,s),new kE(g[1],m,o,a,y),new kE(g[0],i,o,m,y)),(l=(e>=y)<<1|t>=m)&&(u=p[p.length-1],p[p.length-1]=p[p.length-1-l],p[p.length-1-l]=u)}else{var v=t-+this._x.call(null,g.data),b=e-+this._y.call(null,g.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=t-w,f=e-w,h=t+w,d=e+w,r=g.data}}return r},OE.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(a=+this._y.call(null,t)))return this;var e,n,r,i,o,a,s,u,l,c,f,h,d=this._root,p=this._x0,g=this._y0,m=this._x1,y=this._y1;if(!d)return this;if(d.length)for(;;){if((l=o>=(s=(p+m)/2))?p=s:m=s,(c=a>=(u=(g+y)/2))?g=u:y=u,e=d,!(d=d[f=c<<1|l]))return this;if(!d.length)break;(e[f+1&3]||e[f+2&3]||e[f+3&3])&&(n=e,h=f)}for(;d.data!==t;)if(r=d,!(d=d.next))return this;return(i=d.next)&&delete d.next,r?(i?r.next=i:delete r.next,this):e?(i?e[f]=i:delete e[f],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[h]=d:this._root=d),this):(this._root=i,this)},OE.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},OE.root=function(){return this._root},OE.size=function(){var t=0;return this.visit((function(e){if(!e.length)do{++t}while(e=e.next)})),t},OE.visit=function(t){var e,n,r,i,o,a,s=[],u=this._root;for(u&&s.push(new kE(u,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(u=e.node,r=e.x0,i=e.y0,o=e.x1,a=e.y1)&&u.length){var l=(r+o)/2,c=(i+a)/2;(n=u[3])&&s.push(new kE(n,l,c,o,a)),(n=u[2])&&s.push(new kE(n,r,c,l,a)),(n=u[1])&&s.push(new kE(n,l,i,o,c)),(n=u[0])&&s.push(new kE(n,r,i,l,c))}return this},OE.visitAfter=function(t){var e,n=[],r=[];for(this._root&&n.push(new kE(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var i=e.node;if(i.length){var o,a=e.x0,s=e.y0,u=e.x1,l=e.y1,c=(a+u)/2,f=(s+l)/2;(o=i[0])&&n.push(new kE(o,a,s,c,f)),(o=i[1])&&n.push(new kE(o,c,s,u,f)),(o=i[2])&&n.push(new kE(o,a,f,c,l)),(o=i[3])&&n.push(new kE(o,c,f,u,l))}r.push(e)}for(;e=r.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},OE.x=function(t){return arguments.length?(this._x=t,this):this._x},OE.y=function(t){return arguments.length?(this._y=t,this):this._y};var BE={value:()=>{}};function TE(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new jE(r)}function jE(t){this._=t}function IE(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function zE(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function RE(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=BE,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}jE.prototype=TE.prototype={constructor:jE,on:function(t,e){var n,r=this._,i=IE(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=RE(r[n],t.name,e);else if(null==e)for(n in r)r[n]=RE(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=zE(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new jE(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const PE=TE;var LE,qE,UE=0,WE=0,VE=0,HE=0,GE=0,XE=0,KE="object"==typeof performance&&performance.now?performance:Date,YE="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function JE(){return GE||(YE(ZE),GE=KE.now()+XE)}function ZE(){GE=0}function QE(){this._call=this._time=this._next=null}function tD(t,e,n){var r=new QE;return r.restart(t,e,n),r}function eD(){GE=(HE=KE.now())+XE,UE=WE=0;try{!function(){JE(),++UE;for(var t,e=LE;e;)(t=GE-e._time)>=0&&e._call.call(null,t),e=e._next;--UE}()}finally{UE=0,function(){for(var t,e,n=LE,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:LE=e);qE=t,rD(r)}(),GE=0}}function nD(){var t=KE.now(),e=t-HE;e>1e3&&(XE-=e,HE=t)}function rD(t){UE||(WE&&(WE=clearTimeout(WE)),t-GE>24?(t<1/0&&(WE=setTimeout(eD,t-KE.now()-XE)),VE&&(VE=clearInterval(VE))):(VE||(HE=KE.now(),VE=setInterval(nD,1e3)),UE=1,YE(eD)))}QE.prototype=tD.prototype={constructor:QE,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?JE():+n)+(null==e?0:+e),this._next||qE===this||(qE?qE._next=this:LE=this,qE=this),this._call=t,this._time=n,rD()},stop:function(){this._call&&(this._call=null,this._time=1/0,rD())}};const iD=4294967296;function oD(t){return t.x}function aD(t){return t.y}var sD=Math.PI*(3-Math.sqrt(5));function uD(t){return t.index}function lD(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}const cD={center:function(t,e){var n,r=1;function i(){var i,o,a=n.length,s=0,u=0;for(i=0;i<a;++i)s+=(o=n[i]).x,u+=o.y;for(s=(s/a-t)*r,u=(u/a-e)*r,i=0;i<a;++i)(o=n[i]).x-=s,o.y-=u}return null==t&&(t=0),null==e&&(e=0),i.initialize=function(t){n=t},i.x=function(e){return arguments.length?(t=+e,i):t},i.y=function(t){return arguments.length?(e=+t,i):e},i.strength=function(t){return arguments.length?(r=+t,i):r},i},collide:function(t){var e,n,r,i=1,o=1;function a(){for(var t,a,u,l,c,f,h,d=e.length,p=0;p<o;++p)for(a=DE(e,$E,NE).visitAfter(s),t=0;t<d;++t)u=e[t],f=n[u.index],h=f*f,l=u.x+u.vx,c=u.y+u.vy,a.visit(g);function g(t,e,n,o,a){var s=t.data,d=t.r,p=f+d;if(!s)return e>l+p||o<l-p||n>c+p||a<c-p;if(s.index>u.index){var g=l-s.x-s.vx,m=c-s.y-s.vy,y=g*g+m*m;y<p*p&&(0===g&&(y+=(g=ME(r))*g),0===m&&(y+=(m=ME(r))*m),y=(p-(y=Math.sqrt(y)))/y*i,u.vx+=(g*=y)*(p=(d*=d)/(h+d)),u.vy+=(m*=y)*p,s.vx-=g*(p=1-p),s.vy-=m*p)}}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function u(){if(e){var r,i,o=e.length;for(n=new Array(o),r=0;r<o;++r)i=e[r],n[i.index]=+t(i,r,e)}}return"function"!=typeof t&&(t=FE(null==t?1:+t)),a.initialize=function(t,n){e=t,r=n,u()},a.iterations=function(t){return arguments.length?(o=+t,a):o},a.strength=function(t){return arguments.length?(i=+t,a):i},a.radius=function(e){return arguments.length?(t="function"==typeof e?e:FE(+e),u(),a):t},a},nbody:function(){var t,e,n,r,i,o=FE(-30),a=1,s=1/0,u=.81;function l(n){var i,o=t.length,a=DE(t,oD,aD).visitAfter(f);for(r=n,i=0;i<o;++i)e=t[i],a.visit(h)}function c(){if(t){var e,n,r=t.length;for(i=new Array(r),e=0;e<r;++e)n=t[e],i[n.index]=+o(n,e,t)}}function f(t){var e,n,r,o,a,s=0,u=0;if(t.length){for(r=o=a=0;a<4;++a)(e=t[a])&&(n=Math.abs(e.value))&&(s+=e.value,u+=n,r+=n*e.x,o+=n*e.y);t.x=r/u,t.y=o/u}else{(e=t).x=e.data.x,e.y=e.data.y;do{s+=i[e.data.index]}while(e=e.next)}t.value=s}function h(t,o,l,c){if(!t.value)return!0;var f=t.x-e.x,h=t.y-e.y,d=c-o,p=f*f+h*h;if(d*d/u<p)return p<s&&(0===f&&(p+=(f=ME(n))*f),0===h&&(p+=(h=ME(n))*h),p<a&&(p=Math.sqrt(a*p)),e.vx+=f*t.value*r/p,e.vy+=h*t.value*r/p),!0;if(!(t.length||p>=s)){(t.data!==e||t.next)&&(0===f&&(p+=(f=ME(n))*f),0===h&&(p+=(h=ME(n))*h),p<a&&(p=Math.sqrt(a*p)));do{t.data!==e&&(d=i[t.data.index]*r/p,e.vx+=f*d,e.vy+=h*d)}while(t=t.next)}}return l.initialize=function(e,r){t=e,n=r,c()},l.strength=function(t){return arguments.length?(o="function"==typeof t?t:FE(+t),c(),l):o},l.distanceMin=function(t){return arguments.length?(a=t*t,l):Math.sqrt(a)},l.distanceMax=function(t){return arguments.length?(s=t*t,l):Math.sqrt(s)},l.theta=function(t){return arguments.length?(u=t*t,l):Math.sqrt(u)},l},link:function(t){var e,n,r,i,o,a,s=uD,u=function(t){return 1/Math.min(i[t.source.index],i[t.target.index])},l=FE(30),c=1;function f(r){for(var i=0,s=t.length;i<c;++i)for(var u,l,f,h,d,p,g,m=0;m<s;++m)l=(u=t[m]).source,h=(f=u.target).x+f.vx-l.x-l.vx||ME(a),d=f.y+f.vy-l.y-l.vy||ME(a),h*=p=((p=Math.sqrt(h*h+d*d))-n[m])/p*r*e[m],d*=p,f.vx-=h*(g=o[m]),f.vy-=d*g,l.vx+=h*(g=1-g),l.vy+=d*g}function h(){if(r){var a,u,l=r.length,c=t.length,f=new Map(r.map(((t,e)=>[s(t,e,r),t])));for(a=0,i=new Array(l);a<c;++a)(u=t[a]).index=a,"object"!=typeof u.source&&(u.source=lD(f,u.source)),"object"!=typeof u.target&&(u.target=lD(f,u.target)),i[u.source.index]=(i[u.source.index]||0)+1,i[u.target.index]=(i[u.target.index]||0)+1;for(a=0,o=new Array(c);a<c;++a)u=t[a],o[a]=i[u.source.index]/(i[u.source.index]+i[u.target.index]);e=new Array(c),d(),n=new Array(c),p()}}function d(){if(r)for(var n=0,i=t.length;n<i;++n)e[n]=+u(t[n],n,t)}function p(){if(r)for(var e=0,i=t.length;e<i;++e)n[e]=+l(t[e],e,t)}return null==t&&(t=[]),f.initialize=function(t,e){r=t,a=e,h()},f.links=function(e){return arguments.length?(t=e,h(),f):t},f.id=function(t){return arguments.length?(s=t,f):s},f.iterations=function(t){return arguments.length?(c=+t,f):c},f.strength=function(t){return arguments.length?(u="function"==typeof t?t:FE(+t),d(),f):u},f.distance=function(t){return arguments.length?(l="function"==typeof t?t:FE(+t),p(),f):l},f},x:function(t){var e,n,r,i=FE(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vx+=(r[o]-i.x)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=FE(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:FE(+t),a(),o):i},o.x=function(e){return arguments.length?(t="function"==typeof e?e:FE(+e),a(),o):t},o},y:function(t){var e,n,r,i=FE(.1);function o(t){for(var i,o=0,a=e.length;o<a;++o)(i=e[o]).vy+=(r[o]-i.y)*n[o]*t}function a(){if(e){var o,a=e.length;for(n=new Array(a),r=new Array(a),o=0;o<a;++o)n[o]=isNaN(r[o]=+t(e[o],o,e))?0:+i(e[o],o,e)}}return"function"!=typeof t&&(t=FE(null==t?0:+t)),o.initialize=function(t){e=t,a()},o.strength=function(t){return arguments.length?(i="function"==typeof t?t:FE(+t),a(),o):i},o.y=function(e){return arguments.length?(t="function"==typeof e?e:FE(+e),a(),o):t},o}},fD="forces",hD=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],dD=["static","iterations"],pD=["x","y","vx","vy"];function gD(t){ps.call(this,null,t)}function mD(t,e,n,r){var i,o,a,s,u=Gt(e.forces);for(i=0,o=hD.length;i<o;++i)(a=hD[i])!==fD&&e.modified(a)&&t[a](e[a]);for(i=0,o=u.length;i<o;++i)s=fD+i,(a=n||e.modified(fD,i)?vD(u[i]):r&&yD(u[i],r)?t.force(s):null)&&t.force(s,a);for(o=t.numForces||0;i<o;++i)t.force(fD+i,null);return t.numForces=u.length,t}function yD(t,e){var n,r;for(n in t)if(Kt(r=t[n])&&e.modified(nt(r)))return 1;return 0}function vD(t){var e,n;for(n in se(cD,t.force)||at("Unrecognized force: "+t.force),e=cD[t.force](),t)Kt(e[n])&&bD(e[n],t[n],t);return e}function bD(t,e,n){t(Kt(e)?t=>e(t,n):e)}function xD(t){var e=0,n=t.children,r=n&&n.length;if(r)for(;--r>=0;)e+=n[r].value;else e=1;t.value=e}function wD(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=kD)):void 0===e&&(e=_D);for(var n,r,i,o,a,s=new DD(t),u=[s];n=u.pop();)if((i=e(n.data))&&(a=(i=Array.from(i)).length))for(n.children=i,o=a-1;o>=0;--o)u.push(r=i[o]=new DD(i[o])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(ED)}function _D(t){return t.children}function kD(t){return Array.isArray(t)?t[1]:null}function AD(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function ED(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function DD(t){this.data=t,this.depth=this.height=0,this.parent=null}function SD(t,e){var n,r;if(FD(e,t))return[e];for(n=0;n<t.length;++n)if(CD(e,t[n])&&FD($D(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(r=n+1;r<t.length;++r)if(CD($D(t[n],t[r]),e)&&CD($D(t[n],e),t[r])&&CD($D(t[r],e),t[n])&&FD(ND(t[n],t[r],e),t))return[t[n],t[r],e];throw new Error}function CD(t,e){var n=t.r-e.r,r=e.x-t.x,i=e.y-t.y;return n<0||n*n<r*r+i*i}function OD(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function FD(t,e){for(var n=0;n<e.length;++n)if(!OD(t,e[n]))return!1;return!0}function MD(t){switch(t.length){case 1:return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return $D(t[0],t[1]);case 3:return ND(t[0],t[1],t[2])}var e}function $D(t,e){var n=t.x,r=t.y,i=t.r,o=e.x,a=e.y,s=e.r,u=o-n,l=a-r,c=s-i,f=Math.sqrt(u*u+l*l);return{x:(n+o+u/f*c)/2,y:(r+a+l/f*c)/2,r:(f+i+s)/2}}function ND(t,e,n){var r=t.x,i=t.y,o=t.r,a=e.x,s=e.y,u=e.r,l=n.x,c=n.y,f=n.r,h=r-a,d=r-l,p=i-s,g=i-c,m=u-o,y=f-o,v=r*r+i*i-o*o,b=v-a*a-s*s+u*u,x=v-l*l-c*c+f*f,w=d*p-h*g,_=(p*x-g*b)/(2*w)-r,k=(g*m-p*y)/w,A=(d*b-h*x)/(2*w)-i,E=(h*y-d*m)/w,D=k*k+E*E-1,S=2*(o+_*k+A*E),C=_*_+A*A-o*o,O=-(D?(S+Math.sqrt(S*S-4*D*C))/(2*D):C/S);return{x:r+_+k*O,y:i+A+E*O,r:O}}function BD(t,e,n){var r,i,o,a,s=t.x-e.x,u=t.y-e.y,l=s*s+u*u;l?(i=e.r+n.r,i*=i,a=t.r+n.r,i>(a*=a)?(r=(l+a-i)/(2*l),o=Math.sqrt(Math.max(0,a/l-r*r)),n.x=t.x-r*s-o*u,n.y=t.y-r*u+o*s):(r=(l+i-a)/(2*l),o=Math.sqrt(Math.max(0,i/l-r*r)),n.x=e.x+r*s-o*u,n.y=e.y+r*u+o*s)):(n.x=e.x+n.r,n.y=e.y)}function TD(t,e){var n=t.r+e.r-1e-6,r=e.x-t.x,i=e.y-t.y;return n>0&&n*n>r*r+i*i}function jD(t){var e=t._,n=t.next._,r=e.r+n.r,i=(e.x*n.r+n.x*e.r)/r,o=(e.y*n.r+n.y*e.r)/r;return i*i+o*o}function ID(t){this._=t,this.next=null,this.previous=null}function zD(t){if(!(i=(t=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(t)).length))return 0;var e,n,r,i,o,a,s,u,l,c,f;if((e=t[0]).x=0,e.y=0,!(i>1))return e.r;if(n=t[1],e.x=-n.r,n.x=e.r,n.y=0,!(i>2))return e.r+n.r;BD(n,e,r=t[2]),e=new ID(e),n=new ID(n),r=new ID(r),e.next=r.previous=n,n.next=e.previous=r,r.next=n.previous=e;t:for(s=3;s<i;++s){BD(e._,n._,r=t[s]),r=new ID(r),u=n.next,l=e.previous,c=n._.r,f=e._.r;do{if(c<=f){if(TD(u._,r._)){n=u,e.next=n,n.previous=e,--s;continue t}c+=u._.r,u=u.next}else{if(TD(l._,r._)){(e=l).next=n,n.previous=e,--s;continue t}f+=l._.r,l=l.previous}}while(u!==l.next);for(r.previous=e,r.next=n,e.next=n.previous=n=r,o=jD(e);(r=r.next)!==n;)(a=jD(r))<o&&(e=r,o=a);n=e.next}for(e=[n._],r=n;(r=r.next)!==n;)e.push(r._);for(r=function(t){for(var e,n,r=0,i=(t=function(t){for(var e,n,r=t.length;r;)n=Math.random()*r--|0,e=t[r],t[r]=t[n],t[n]=e;return t}(Array.from(t))).length,o=[];r<i;)e=t[r],n&&OD(n,e)?++r:(n=MD(o=SD(o,e)),r=0);return n}(e),s=0;s<i;++s)(e=t[s]).x-=r.x,e.y-=r.y;return r.r}function RD(t){return null==t?null:PD(t)}function PD(t){if("function"!=typeof t)throw new Error;return t}function LD(){return 0}function qD(t){return function(){return t}}function UD(t){return Math.sqrt(t.value)}function WD(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function VD(t,e){return function(n){if(r=n.children){var r,i,o,a=r.length,s=t(n)*e||0;if(s)for(i=0;i<a;++i)r[i].r+=s;if(o=zD(r),s)for(i=0;i<a;++i)r[i].r-=s;n.r=o+s}}}function HD(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function GD(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function XD(t,e,n,r,i){for(var o,a=t.children,s=-1,u=a.length,l=t.value&&(r-e)/t.value;++s<u;)(o=a[s]).y0=n,o.y1=i,o.x0=e,o.x1=e+=o.value*l}gD.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:pD}]},fe(gD,ps,{transform(t,e){var n,r,i=this.value,o=e.changed(e.ADD_REM),a=t.modified(hD),s=t.iterations||300;if(i?(o&&(e.modifies("index"),i.nodes(e.source)),(a||e.changed(e.MOD))&&mD(i,t,0,e)):(this.value=i=function(t,e){const n=function(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,u=tD(f),l=PE("tick","end"),c=function(){let t=1;return()=>(t=(1664525*t+1013904223)%iD)/iD}();function f(){h(),l.call("tick",e),n<r&&(u.stop(),l.call("end",e))}function h(r){var u,l,c=t.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(o-n)*i,s.forEach((function(t){t(n)})),u=0;u<c;++u)null==(l=t[u]).fx?l.x+=l.vx*=a:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=a:(l.y=l.fy,l.vy=0);return e}function d(){for(var e,n=0,r=t.length;n<r;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var i=10*Math.sqrt(.5+n),o=n*sD;e.x=i*Math.cos(o),e.y=i*Math.sin(o)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function p(e){return e.initialize&&e.initialize(t,c),e}return null==t&&(t=[]),d(),e={tick:h,restart:function(){return u.restart(f),e},stop:function(){return u.stop(),e},nodes:function(n){return arguments.length?(t=n,d(),s.forEach(p),e):t},alpha:function(t){return arguments.length?(n=+t,e):n},alphaMin:function(t){return arguments.length?(r=+t,e):r},alphaDecay:function(t){return arguments.length?(i=+t,e):+i},alphaTarget:function(t){return arguments.length?(o=+t,e):o},velocityDecay:function(t){return arguments.length?(a=1-t,e):1-a},randomSource:function(t){return arguments.length?(c=t,s.forEach(p),e):c},force:function(t,n){return arguments.length>1?(null==n?s.delete(t):s.set(t,p(n)),e):s.get(t)},find:function(e,n,r){var i,o,a,s,u,l=0,c=t.length;for(null==r?r=1/0:r*=r,l=0;l<c;++l)(a=(i=e-(s=t[l]).x)*i+(o=n-s.y)*o)<r&&(u=s,r=a);return u},on:function(t,n){return arguments.length>1?(l.on(t,n),e):l.on(t)}}}(t),r=n.stop,i=n.restart;let o=!1;return n.stopped=()=>o,n.restart=()=>(o=!1,i()),n.stop=()=>(o=!0,r()),mD(n,e,!0).on("end",(()=>o=!0))}(e.source,t),i.on("tick",(n=e.dataflow,r=this,()=>n.touch(r).run())),t.static||(o=!0,i.tick()),e.modifies("index")),a||o||t.modified(dD)||e.changed()&&t.restart)if(i.alpha(Math.max(i.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),t.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!o)return e.StopPropagation;return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let t,e=this._argops,s=0,u=e.length;s<u;++s)if(t=e[s],t.name===fD&&"link"===t.op._argval.force)for(var r,i=t.op._argops,o=0,a=i.length;o<a;++o)if("links"===i[o].name&&(r=i[o].op.source)){n.pulse(r,n.changeset().reflow());break}return e.reflow(t.modified()).modifies(pD)}}),DD.prototype=wD.prototype={constructor:DD,count:function(){return this.eachAfter(xD)},each:function(t,e){let n=-1;for(const r of this)t.call(e,r,++n,this);return this},eachAfter:function(t,e){for(var n,r,i,o=this,a=[o],s=[],u=-1;o=a.pop();)if(s.push(o),n=o.children)for(r=0,i=n.length;r<i;++r)a.push(n[r]);for(;o=s.pop();)t.call(e,o,++u,this);return this},eachBefore:function(t,e){for(var n,r,i=this,o=[i],a=-1;i=o.pop();)if(t.call(e,i,++a,this),n=i.children)for(r=n.length-1;r>=0;--r)o.push(n[r]);return this},find:function(t,e){let n=-1;for(const r of this)if(t.call(e,r,++n,this))return r},sum:function(t){return this.eachAfter((function(e){for(var n=+t(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)n+=r[i].value;e.value=n}))},sort:function(t){return this.eachBefore((function(e){e.children&&e.children.sort(t)}))},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),r=e.ancestors(),i=null;for(t=n.pop(),e=r.pop();t===e;)i=t,t=n.pop(),e=r.pop();return i}(e,t),r=[e];e!==n;)e=e.parent,r.push(e);for(var i=r.length;t!==n;)r.splice(i,0,t),t=t.parent;return r},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore((function(e){e.children||t.push(e)})),t},links:function(){var t=this,e=[];return t.each((function(n){n!==t&&e.push({source:n.parent,target:n})})),e},copy:function(){return wD(this).eachBefore(AD)},[Symbol.iterator]:function*(){var t,e,n,r,i=this,o=[i];do{for(t=o.reverse(),o=[];i=t.pop();)if(yield i,e=i.children)for(n=0,r=e.length;n<r;++n)o.push(e[n])}while(o.length)}};var KD={depth:-1},YD={};function JD(t){return t.id}function ZD(t){return t.parentId}function QD(){var t=JD,e=ZD;function n(n){var r,i,o,a,s,u,l,c=Array.from(n),f=c.length,h=new Map;for(i=0;i<f;++i)r=c[i],s=c[i]=new DD(r),null!=(u=t(r,i,n))&&(u+="")&&(l=s.id=u,h.set(l,h.has(l)?YD:s)),null!=(u=e(r,i,n))&&(u+="")&&(s.parent=u);for(i=0;i<f;++i)if(u=(s=c[i]).parent){if(!(a=h.get(u)))throw new Error("missing: "+u);if(a===YD)throw new Error("ambiguous: "+u);a.children?a.children.push(s):a.children=[s],s.parent=a}else{if(o)throw new Error("multiple roots");o=s}if(!o)throw new Error("no root");if(o.parent=KD,o.eachBefore((function(t){t.depth=t.parent.depth+1,--f})).eachBefore(ED),o.parent=null,f>0)throw new Error("cycle");return o}return n.id=function(e){return arguments.length?(t=PD(e),n):t},n.parentId=function(t){return arguments.length?(e=PD(t),n):e},n}function tS(t,e){return t.parent===e.parent?1:2}function eS(t){var e=t.children;return e?e[0]:t.t}function nS(t){var e=t.children;return e?e[e.length-1]:t.t}function rS(t,e,n){var r=n/(e.i-t.i);e.c-=r,e.s+=n,t.c+=r,e.z+=n,e.m+=n}function iS(t,e,n){return t.a.parent===e.parent?t.a:n}function oS(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function aS(t,e){return t.parent===e.parent?1:2}function sS(t,e){return t+e.x}function uS(t,e){return Math.max(t,e.y)}function lS(t,e,n,r,i){for(var o,a=t.children,s=-1,u=a.length,l=t.value&&(i-n)/t.value;++s<u;)(o=a[s]).x0=e,o.x1=r,o.y0=n,o.y1=n+=o.value*l}oS.prototype=Object.create(DD.prototype);var cS=(1+Math.sqrt(5))/2;function fS(t,e,n,r,i,o){for(var a,s,u,l,c,f,h,d,p,g,m,y=[],v=e.children,b=0,x=0,w=v.length,_=e.value;b<w;){u=i-n,l=o-r;do{c=v[x++].value}while(!c&&x<w);for(f=h=c,m=c*c*(g=Math.max(l/u,u/l)/(_*t)),p=Math.max(h/m,m/f);x<w;++x){if(c+=s=v[x].value,s<f&&(f=s),s>h&&(h=s),m=c*c*g,(d=Math.max(h/m,m/f))>p){c-=s;break}p=d}y.push(a={value:c,dice:u<l,children:v.slice(b,x)}),a.dice?XD(a,n,r,i,_?r+=l*c/_:o):lS(a,n,r,_?n+=u*c/_:i,o),_-=c,b=x}return y}const hS=function t(e){function n(t,n,r,i,o){fS(e,t,n,r,i,o)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(cS),dS=function t(e){function n(t,n,r,i,o){if((a=t._squarify)&&a.ratio===e)for(var a,s,u,l,c,f=-1,h=a.length,d=t.value;++f<h;){for(u=(s=a[f]).children,l=s.value=0,c=u.length;l<c;++l)s.value+=u[l].value;s.dice?XD(s,n,r,i,d?r+=(o-r)*s.value/d:o):lS(s,n,r,d?n+=(i-n)*s.value/d:i,o),d-=s.value}else t._squarify=a=fS(e,t,n,r,i,o),a.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(cS);function pS(t,e,n){const r={};return t.each((t=>{const i=t.data;n(i)&&(r[e(i)]=t)})),t.lookup=r,t}function gS(t){ps.call(this,null,t)}gS.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const mS=t=>t.values;function yS(){const t=[],e={entries:t=>r(n(t,0),0),key:n=>(t.push(n),e)};function n(e,r){if(r>=t.length)return e;const i=e.length,o=t[r++],a={},s={};let u,l,c,f=-1;for(;++f<i;)u=o(l=e[f])+"",(c=a[u])?c.push(l):a[u]=[l];for(u in a)s[u]=n(a[u],r);return s}function r(e,n){if(++n>t.length)return e;const i=[];for(const t in e)i.push({key:t,values:r(e[t],n)});return i}return e}function vS(t){ps.call(this,null,t)}fe(gS,ps,{transform(t,e){e.source||at("Nest transform requires an upstream data source.");var n=t.generate,r=t.modified(),i=e.clone(),o=this.value;return(!o||r||e.changed())&&(o&&o.each((t=>{t.children&&Ta(t.data)&&i.rem.push(t.data)})),this.value=o=wD({values:Gt(t.keys).reduce(((t,e)=>(t.key(e),t)),yS()).entries(i.source)},mS),n&&o.each((t=>{t.children&&(t=za(t.data),i.add.push(t),i.source.push(t))})),pS(o,ja,ja)),i.source.root=o,i}});const bS=(t,e)=>t.parent===e.parent?1:2;fe(vS,ps,{transform(t,e){e.source&&e.source.root||at(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(t.method),r=this.fields,i=e.source.root,o=t.as||r;t.field?i.sum(t.field):i.count(),t.sort&&i.sort(qa(t.sort,(t=>t.data))),function(t,e,n){for(let r,i=0,o=e.length;i<o;++i)r=e[i],r in n&&t[r](n[r])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?bS:ht);try{this.value=n(i)}catch(t){at(t)}return i.each((t=>function(t,e,n){const r=t.data,i=e.length-1;for(let o=0;o<i;++o)r[n[o]]=t[e[o]];r[n[i]]=t.children?t.children.length:0}(t,r,o))),e.reflow(t.modified()).modifies(o).modifies("leaf")}});const xS=["x","y","r","depth","children"];function wS(t){vS.call(this,t)}wS.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:xS.length,default:xS}]},fe(wS,vS,{layout:function(){var t=null,e=1,n=1,r=LD;function i(i){return i.x=e/2,i.y=n/2,t?i.eachBefore(WD(t)).eachAfter(VD(r,.5)).eachBefore(HD(1)):i.eachBefore(WD(UD)).eachAfter(VD(LD,1)).eachAfter(VD(r,i.r/Math.min(e,n))).eachBefore(HD(Math.min(e,n)/(2*i.r))),i}return i.radius=function(e){return arguments.length?(t=RD(e),i):t},i.size=function(t){return arguments.length?(e=+t[0],n=+t[1],i):[e,n]},i.padding=function(t){return arguments.length?(r="function"==typeof t?t:qD(+t),i):r},i},params:["radius","size","padding"],fields:xS});const _S=["x0","y0","x1","y1","depth","children"];function kS(t){vS.call(this,t)}function AS(t){ps.call(this,null,t)}kS.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:_S.length,default:_S}]},fe(kS,vS,{layout:function(){var t=1,e=1,n=0,r=!1;function i(i){var o=i.height+1;return i.x0=i.y0=n,i.x1=t,i.y1=e/o,i.eachBefore(function(t,e){return function(r){r.children&&XD(r,r.x0,t*(r.depth+1)/e,r.x1,t*(r.depth+2)/e);var i=r.x0,o=r.y0,a=r.x1-n,s=r.y1-n;a<i&&(i=a=(i+a)/2),s<o&&(o=s=(o+s)/2),r.x0=i,r.y0=o,r.x1=a,r.y1=s}}(e,o)),r&&i.eachBefore(GD),i}return i.round=function(t){return arguments.length?(r=!!t,i):r},i.size=function(n){return arguments.length?(t=+n[0],e=+n[1],i):[t,e]},i.padding=function(t){return arguments.length?(n=+t,i):n},i},params:["size","round","padding"],fields:_S}),AS.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},fe(AS,ps,{transform(t,e){e.source||at("Stratify transform requires an upstream data source.");let n=this.value;const r=t.modified(),i=e.fork(e.ALL).materialize(e.SOURCE),o=!n||r||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return i.source=i.source.slice(),o&&(n=i.source.length?pS(QD().id(t.key).parentId(t.parentKey)(i.source),t.key,dt):pS(QD()([{}]),t.key,t.key)),i.source.root=this.value=n,i}});const ES={tidy:function(){var t=tS,e=1,n=1,r=null;function i(i){var u=function(t){for(var e,n,r,i,o,a=new oS(t,0),s=[a];e=s.pop();)if(r=e._.children)for(e.children=new Array(o=r.length),i=o-1;i>=0;--i)s.push(n=e.children[i]=new oS(r[i],i)),n.parent=e;return(a.parent=new oS(null,0)).children=[a],a}(i);if(u.eachAfter(o),u.parent.m=-u.z,u.eachBefore(a),r)i.eachBefore(s);else{var l=i,c=i,f=i;i.eachBefore((function(t){t.x<l.x&&(l=t),t.x>c.x&&(c=t),t.depth>f.depth&&(f=t)}));var h=l===c?1:t(l,c)/2,d=h-l.x,p=e/(c.x+h+d),g=n/(f.depth||1);i.eachBefore((function(t){t.x=(t.x+d)*p,t.y=t.depth*g}))}return i}function o(e){var n=e.children,r=e.parent.children,i=e.i?r[e.i-1]:null;if(n){!function(t){for(var e,n=0,r=0,i=t.children,o=i.length;--o>=0;)(e=i[o]).z+=n,e.m+=n,n+=e.s+(r+=e.c)}(e);var o=(n[0].z+n[n.length-1].z)/2;i?(e.z=i.z+t(e._,i._),e.m=e.z-o):e.z=o}else i&&(e.z=i.z+t(e._,i._));e.parent.A=function(e,n,r){if(n){for(var i,o=e,a=e,s=n,u=o.parent.children[0],l=o.m,c=a.m,f=s.m,h=u.m;s=nS(s),o=eS(o),s&&o;)u=eS(u),(a=nS(a)).a=e,(i=s.z+f-o.z-l+t(s._,o._))>0&&(rS(iS(s,e,r),e,i),l+=i,c+=i),f+=s.m,l+=o.m,h+=u.m,c+=a.m;s&&!nS(a)&&(a.t=s,a.m+=f-c),o&&!eS(u)&&(u.t=o,u.m+=l-h,r=e)}return r}(e,i,e.parent.A||r[0])}function a(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i},cluster:function(){var t=aS,e=1,n=1,r=!1;function i(i){var o,a=0;i.eachAfter((function(e){var n=e.children;n?(e.x=function(t){return t.reduce(sS,0)/t.length}(n),e.y=function(t){return 1+t.reduce(uS,0)}(n)):(e.x=o?a+=t(e,o):0,e.y=0,o=e)}));var s=function(t){for(var e;e=t.children;)t=e[0];return t}(i),u=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(i),l=s.x-t(s,u)/2,c=u.x+t(u,s)/2;return i.eachAfter(r?function(t){t.x=(t.x-i.x)*e,t.y=(i.y-t.y)*n}:function(t){t.x=(t.x-l)/(c-l)*e,t.y=(1-(i.y?t.y/i.y:1))*n})}return i.separation=function(e){return arguments.length?(t=e,i):t},i.size=function(t){return arguments.length?(r=!1,e=+t[0],n=+t[1],i):r?null:[e,n]},i.nodeSize=function(t){return arguments.length?(r=!0,e=+t[0],n=+t[1],i):r?[e,n]:null},i}},DS=["x","y","depth","children"];function SS(t){vS.call(this,t)}function CS(t){ps.call(this,[],t)}SS.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:DS.length,default:DS}]},fe(SS,vS,{layout(t){const e=t||"tidy";if(se(ES,e))return ES[e]();at("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:DS}),CS.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},fe(CS,ps,{transform(t,e){const n=this.value,r=e.source&&e.source.root,i=e.fork(e.NO_SOURCE),o={};return r||at("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(i.rem=n,e.visit(e.SOURCE,(t=>o[ja(t)]=1)),r.each((t=>{const e=t.data,n=t.parent&&t.parent.data;n&&o[ja(e)]&&o[ja(n)]&&i.add.push(za({source:n,target:e}))})),this.value=i.add):e.changed(e.MOD)&&(e.visit(e.MOD,(t=>o[ja(t)]=1)),n.forEach((t=>{(o[ja(t.source)]||o[ja(t.target)])&&i.mod.push(t)}))),i}});const OS={binary:function(t,e,n,r,i){var o,a,s=t.children,u=s.length,l=new Array(u+1);for(l[0]=a=o=0;o<u;++o)l[o+1]=a+=s[o].value;!function t(e,n,r,i,o,a,u){if(e>=n-1){var c=s[e];return c.x0=i,c.y0=o,c.x1=a,void(c.y1=u)}for(var f=l[e],h=r/2+f,d=e+1,p=n-1;d<p;){var g=d+p>>>1;l[g]<h?d=g+1:p=g}h-l[d-1]<l[d]-h&&e+1<d&&--d;var m=l[d]-f,y=r-m;if(a-i>u-o){var v=r?(i*y+a*m)/r:a;t(e,d,m,i,o,v,u),t(d,n,y,v,o,a,u)}else{var b=r?(o*y+u*m)/r:u;t(e,d,m,i,o,a,b),t(d,n,y,i,b,a,u)}}(0,u,t.value,e,n,r,i)},dice:XD,slice:lS,slicedice:function(t,e,n,r,i){(1&t.depth?lS:XD)(t,e,n,r,i)},squarify:hS,resquarify:dS},FS=["x0","y0","x1","y1","depth","children"];function MS(t){vS.call(this,t)}function $S(t,e,n,r){const i=t.width,o=t.height,a=n||r,s=sf(i,o).getContext("2d");e.forEach((t=>NS(s,t,a)));const u=new Uint32Array(s.getImageData(0,0,i,o).data.buffer),l=t.bitmap(),c=a&&t.bitmap();let f,h,d,p,g;for(h=0;h<o;++h)for(f=0;f<i;++f)g=4278190080&u[h*i+f],g&&(d=t(f),p=t(h),r||l.set(d,p),a&&268435456^g&&c.set(d,p));return[l,c]}function NS(t,e,n){if(!e.length)return;const r=e[0].mark.marktype;"group"===r?e.forEach((e=>{e.items.forEach((e=>NS(t,e.items,n)))})):bv[r].draw(t,{items:n?e.map(BS):e})}function BS(t){const e=Pa(t,{});return e.stroke&&(e.strokeOpacity=1),e.fill&&(e.fillOpacity=.0625,e.stroke="#000",e.strokeOpacity=1,e.strokeWidth=2),e}MS.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:FS.length,default:FS}]},fe(MS,vS,{layout(){const t=function(){var t=hS,e=!1,n=1,r=1,i=[0],o=LD,a=LD,s=LD,u=LD,l=LD;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=r,t.eachBefore(f),i=[0],e&&t.eachBefore(GD),t}function f(e){var n=i[e.depth],r=e.x0+n,c=e.y0+n,f=e.x1-n,h=e.y1-n;f<r&&(r=f=(r+f)/2),h<c&&(c=h=(c+h)/2),e.x0=r,e.y0=c,e.x1=f,e.y1=h,e.children&&(n=i[e.depth+1]=o(e)/2,r+=l(e)-n,c+=a(e)-n,(f-=s(e)-n)<r&&(r=f=(r+f)/2),(h-=u(e)-n)<c&&(c=h=(c+h)/2),t(e,r,c,f,h))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],r=+t[1],c):[n,r]},c.tile=function(e){return arguments.length?(t=PD(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(o="function"==typeof t?t:qD(+t),c):o},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(a="function"==typeof t?t:qD(+t),c):a},c.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:qD(+t),c):s},c.paddingBottom=function(t){return arguments.length?(u="function"==typeof t?t:qD(+t),c):u},c.paddingLeft=function(t){return arguments.length?(l="function"==typeof t?t:qD(+t),c):l},c}();return t.ratio=e=>{const n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{se(OS,e)?t.tile(OS[e]):at("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:FS});const TS=31,jS=new Uint32Array(33),IS=new Uint32Array(33);IS[0]=0,jS[0]=~IS[0];for(let t=1;t<=32;++t)IS[t]=IS[t-1]<<1|1,jS[t]=~IS[t];function zS(t,e,n,r,i,o){let a=n/2;return t-a<0||t+a>i||e-(a=r/2)<0||e+a>o}function RS(t,e,n,r,i,o,a,s){const u=i*o/(2*r),l=t(e-u),c=t(e+u),f=t(n-(o/=2)),h=t(n+o);return a.outOfBounds(l,f,c,h)||a.getRange(l,f,c,h)||s&&s.getRange(l,f,c,h)}const PS=[-1,-1,1,1],LS=[-1,1,-1,1],qS=["right","center","left"],US=["bottom","middle","top"];function WS(t,e,n,r,i,o,a,s,u,l,c,f){return!(i.outOfBounds(t,n,e,r)||(f&&o?o.getRange(t,n,e,r)||!function(t,e,n,r,i){return i[0]<=t&&n<=i[2]&&i[3]<=e&&r<=i[5]}(a,u,s,l,c):i.getRange(t,n,e,r)))}const VS={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},HS={naive:function(t,e,n,r){const i=t.width,o=t.height;return function(t){const e=t.datum.datum.items[r].items,n=e.length,a=t.datum.fontSize,s=ev.width(t.datum,t.datum.text);let u,l,c,f,h,d,p,g=0;for(let r=0;r<n;++r)u=e[r].x,c=e[r].y,l=void 0===e[r].x2?u:e[r].x2,f=void 0===e[r].y2?c:e[r].y2,h=(u+l)/2,d=(c+f)/2,p=Math.abs(l-u+f-c),p>=g&&(g=p,t.x=h,t.y=d);return h=s/2,d=a/2,u=t.x-h,l=t.x+h,c=t.y-d,f=t.y+d,t.align="center",u<0&&l<=i?t.align="left":0<=u&&i<l&&(t.align="right"),t.baseline="middle",c<0&&f<=o?t.baseline="top":0<=c&&o<f&&(t.baseline="bottom"),!0}},"reduced-search":function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1];function u(e,n,r,u,l){const c=t.invert(e),f=t.invert(n);let h,d=r,p=o;if(!zS(c,f,u,l,i,o)&&!RS(t,c,f,l,u,d,a,s)&&!RS(t,c,f,l,u,l,a,null)){for(;p-d>=1;)h=(d+p)/2,RS(t,c,f,l,u,h,a,s)?p=h:d=h;if(d>r)return[c,f,d,!0]}}return function(e){const s=e.datum.datum.items[r].items,l=s.length,c=e.datum.fontSize,f=ev.width(e.datum,e.datum.text);let h,d,p,g,m,y,v,b,x,w,_,k,A,E,D,S,C,O=n?c:0,F=!1,M=!1,$=0;for(let r=0;r<l;++r){for(h=s[r].x,p=s[r].y,d=void 0===s[r].x2?h:s[r].x2,g=void 0===s[r].y2?p:s[r].y2,h>d&&(C=h,h=d,d=C),p>g&&(C=p,p=g,g=C),x=t(h),_=t(d),w=~~((x+_)/2),k=t(p),E=t(g),A=~~((k+E)/2),v=w;v>=x;--v)for(b=A;b>=k;--b)S=u(v,b,O,f,c),S&&([e.x,e.y,O,F]=S);for(v=w;v<=_;++v)for(b=A;b<=E;++b)S=u(v,b,O,f,c),S&&([e.x,e.y,O,F]=S);F||n||(D=Math.abs(d-h+g-p),m=(h+d)/2,y=(p+g)/2,D>=$&&!zS(m,y,f,c,i,o)&&!RS(t,m,y,c,f,c,a,null)&&($=D,e.x=m,e.y=y,M=!0))}return!(!F&&!M||(m=f/2,y=c/2,a.setRange(t(e.x-m),t(e.y-y),t(e.x+m),t(e.y+y)),e.align="center",e.baseline="middle",0))}},floodfill:function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1],u=t.bitmap();return function(e){const l=e.datum.datum.items[r].items,c=l.length,f=e.datum.fontSize,h=ev.width(e.datum,e.datum.text),d=[];let p,g,m,y,v,b,x,w,_,k,A,E,D=n?f:0,S=!1,C=!1,O=0;for(let r=0;r<c;++r){for(p=l[r].x,m=l[r].y,g=void 0===l[r].x2?p:l[r].x2,y=void 0===l[r].y2?m:l[r].y2,d.push([t((p+g)/2),t((m+y)/2)]);d.length;)if([x,w]=d.pop(),!(a.get(x,w)||s.get(x,w)||u.get(x,w))){u.set(x,w);for(let t=0;t<4;++t)v=x+PS[t],b=w+LS[t],u.outOfBounds(v,b,v,b)||d.push([v,b]);if(v=t.invert(x),b=t.invert(w),_=D,k=o,!zS(v,b,h,f,i,o)&&!RS(t,v,b,f,h,_,a,s)&&!RS(t,v,b,f,h,f,a,null)){for(;k-_>=1;)A=(_+k)/2,RS(t,v,b,f,h,A,a,s)?k=A:_=A;_>D&&(e.x=v,e.y=b,D=_,S=!0)}}S||n||(E=Math.abs(g-p+y-m),v=(p+g)/2,b=(m+y)/2,E>=O&&!zS(v,b,h,f,i,o)&&!RS(t,v,b,f,h,f,a,null)&&(O=E,e.x=v,e.y=b,C=!0))}return!(!S&&!C||(v=h/2,b=f/2,a.setRange(t(e.x-v),t(e.y-b),t(e.x+v),t(e.y+b)),e.align="center",e.baseline="middle",0))}}};function GS(t,e,n,r,i,o,a,s,u,l,c){if(!t.length)return t;const f=Math.max(r.length,i.length),h=function(t,e){const n=new Float64Array(e),r=t.length;for(let e=0;e<r;++e)n[e]=t[e]||0;for(let t=r;t<e;++t)n[t]=n[r-1];return n}(r,f),d=function(t,e){const n=new Int8Array(e),r=t.length;for(let e=0;e<r;++e)n[e]|=VS[t[e]];for(let t=r;t<e;++t)n[t]=n[r-1];return n}(i,f),p=(x=t[0].datum)&&x.mark&&x.mark.marktype,g="group"===p&&t[0].datum.items[u].marktype,m="area"===g,y=function(t,e,n,r){const i=t=>[t.x,t.x,t.x,t.y,t.y,t.y];return t?"line"===t||"area"===t?t=>i(t.datum):"line"===e?t=>{const e=t.datum.items[r].items;return i(e.length?e["start"===n?0:e.length-1]:{x:NaN,y:NaN})}:t=>{const e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}:i}(p,g,s,u),v=function(t,e,n){const r=Math.max(1,Math.sqrt(t*e/1e6)),i=~~((t+2*n+r)/r),o=~~((e+2*n+r)/r),a=t=>~~((t+n)/r);return a.invert=t=>t*r-n,a.bitmap=()=>function(t,e){const n=new Uint32Array(~~((t*e+32)/32));function r(t,e){n[t]|=e}function i(t,e){n[t]&=e}return{array:n,get:(e,r)=>{const i=r*t+e;return n[i>>>5]&1<<(i&TS)},set:(e,n)=>{const i=n*t+e;r(i>>>5,1<<(i&TS))},clear:(e,n)=>{const r=n*t+e;i(r>>>5,~(1<<(r&TS)))},getRange:(e,r,i,o)=>{let a,s,u,l,c=o;for(;c>=r;--c)if(a=c*t+e,s=c*t+i,u=a>>>5,l=s>>>5,u===l){if(n[u]&jS[a&TS]&IS[1+(s&TS)])return!0}else{if(n[u]&jS[a&TS])return!0;if(n[l]&IS[1+(s&TS)])return!0;for(let t=u+1;t<l;++t)if(n[t])return!0}return!1},setRange:(e,n,i,o)=>{let a,s,u,l,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+i,u=a>>>5,l=s>>>5,u===l)r(u,jS[a&TS]&IS[1+(s&TS)]);else for(r(u,jS[a&TS]),r(l,IS[1+(s&TS)]),c=u+1;c<l;++c)r(c,4294967295)},clearRange:(e,n,r,o)=>{let a,s,u,l,c;for(;n<=o;++n)if(a=n*t+e,s=n*t+r,u=a>>>5,l=s>>>5,u===l)i(u,IS[a&TS]|jS[1+(s&TS)]);else for(i(u,IS[a&TS]),i(l,jS[1+(s&TS)]),c=u+1;c<l;++c)i(c,0)},outOfBounds:(n,r,i,o)=>n<0||r<0||o>=e||i>=t}}(i,o),a.ratio=r,a.padding=n,a.width=t,a.height=e,a}(e[0],e[1],l),b=m&&"naive"===c;var x;const w=t.map((t=>({datum:t,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(t)})));let _;if(!b){n&&w.sort(((t,e)=>n(t.datum,e.datum)));let e=!1;for(let t=0;t<d.length&&!e;++t)e=5===d[t]||h[t]<0;p&&(a||m)&&(o=[t.map((t=>t.datum))].concat(o)),_=o.length?$S(v,o,e,m):function(t,e){const n=t.bitmap();return(e||[]).forEach((e=>n.set(t(e.boundary[0]),t(e.boundary[3])))),[n,void 0]}(v,a&&w)}const k=m?HS[c](v,_,a,u):function(t,e,n,r){const i=t.width,o=t.height,a=e[0],s=e[1],u=r.length;return function(e){const l=e.boundary,c=e.datum.fontSize;if(l[2]<0||l[5]<0||l[0]>i||l[3]>o)return!1;let f,h,d,p,g,m,y,v,b,x,w,_,k,A,E,D=0;for(let i=0;i<u;++i){if(f=(3&n[i])-1,h=(n[i]>>>2&3)-1,d=0===f&&0===h||r[i]<0,p=f&&h?Math.SQRT1_2:1,g=r[i]<0?-1:1,m=l[1+f]+r[i]*f*p,w=l[4+h]+g*c*h/2+r[i]*h*p,v=w-c/2,b=w+c/2,_=t(m),A=t(v),E=t(b),!D){if(!WS(_,_,A,E,a,s,m,m,v,b,l,d))continue;D=ev.width(e.datum,e.datum.text)}if(x=m+g*D*f/2,m=x-D/2,y=x+D/2,_=t(m),k=t(y),WS(_,k,A,E,a,s,m,y,v,b,l,d))return e.x=f?f*g<0?y:m:x,e.y=h?h*g<0?b:v:w,e.align=qS[f*g+1],e.baseline=US[h*g+1],a.setRange(_,A,k,E),!0}return!1}}(v,_,d,h);return w.forEach((t=>t.opacity=+k(t))),w}const XS=["x","y","opacity","align","baseline"],KS=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function YS(t){ps.call(this,null,t)}function JS(t,e){var n,r,i,o,a,s,u=[],l=function(t){return t(o)};if(null==e)u.push(t);else for(n={},r=0,i=t.length;r<i;++r)o=t[r],(s=n[a=e.map(l)])||(n[a]=s=[],s.dims=a,u.push(s)),s.push(o);return u}function ZS(t){ps.call(this,null,t)}YS.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:KS},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:XS.length,default:XS}]},fe(YS,ps,{transform(t,e){const n=t.modified();if(!(n||e.changed(e.ADD_REM)||function(n){const r=t.sort;return Kt(r)&&e.modified(r.fields)}()))return;t.size&&2===t.size.length||at("Size parameter should be specified as a [width, height] array.");const r=t.as||XS;return GS(e.materialize(e.SOURCE).source,t.size,t.sort,Gt(t.offset||1),Gt(t.anchor||KS),t.avoidMarks||[],!1!==t.avoidBaseMark,t.lineAnchor||"end",t.markIndex||0,t.padding||0,t.method||"naive").forEach((t=>{const e=t.datum;e[r[0]]=t.x,e[r[1]]=t.y,e[r[2]]=t.opacity,e[r[3]]=t.align,e[r[4]]=t.baseline})),e.reflow(n).modifies(r)}}),ZS.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},fe(ZS,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=JS(e.materialize(e.SOURCE).source,t.groupby),i=(t.groupby||[]).map(et),o=i.length,a=t.as||[et(t.x),et(t.y)],s=[];r.forEach((e=>{pu(e,t.x,t.y,t.bandwidth||.3).forEach((t=>{const n={};for(let t=0;t<o;++t)n[i[t]]=e.dims[t];n[a[0]]=t[0],n[a[1]]=t[1],s.push(za(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const QS={linear:su,log:uu,exp:lu,pow:cu,quad:fu,poly:hu};function tC(t){ps.call(this,null,t)}tC.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(QS)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},fe(tC,ps,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const r=JS(e.materialize(e.SOURCE).source,t.groupby),i=(t.groupby||[]).map(et),o=t.method||"linear",a=t.order||3,s=((t,e)=>"poly"===t?e:"quad"===t?2:1)(o,a),u=t.as||[et(t.x),et(t.y)],l=QS[o],c=[];let f=t.extent;se(QS,o)||at("Invalid regression method: "+o),null!=f&&"log"===o&&f[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void e.dataflow.warn("Skipping regression with more parameters than data points.");const r=l(n,t.x,t.y,a);if(t.params)return void c.push(za({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const h=f||ie(n,t.x),d=t=>{const e={};for(let t=0;t<i.length;++t)e[i[t]]=n.dims[t];e[u[0]]=t[0],e[u[1]]=t[1],c.push(za(e))};"linear"===o?h.forEach((t=>d([t,r.predict(t)]))):vu(r.predict,h,25,200).forEach(d)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});const eC=Math.pow(2,-52),nC=new Uint32Array(512);class rC{static from(t,e=fC,n=hC){const r=t.length,i=new Float64Array(2*r);for(let o=0;o<r;o++){const r=t[o];i[2*o]=e(r),i[2*o+1]=n(r)}return new rC(i)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:r,_hullHash:i}=this,o=t.length>>1;let a=1/0,s=1/0,u=-1/0,l=-1/0;for(let e=0;e<o;e++){const n=t[2*e],r=t[2*e+1];n<a&&(a=n),r<s&&(s=r),n>u&&(u=n),r>l&&(l=r),this._ids[e]=e}const c=(a+u)/2,f=(s+l)/2;let h,d,p,g=1/0;for(let e=0;e<o;e++){const n=iC(c,f,t[2*e],t[2*e+1]);n<g&&(h=e,g=n)}const m=t[2*h],y=t[2*h+1];g=1/0;for(let e=0;e<o;e++){if(e===h)continue;const n=iC(m,y,t[2*e],t[2*e+1]);n<g&&n>0&&(d=e,g=n)}let v=t[2*d],b=t[2*d+1],x=1/0;for(let e=0;e<o;e++){if(e===h||e===d)continue;const n=uC(m,y,v,b,t[2*e],t[2*e+1]);n<x&&(p=e,x=n)}let w=t[2*p],_=t[2*p+1];if(x===1/0){for(let e=0;e<o;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];lC(this._ids,this._dists,0,o-1);const e=new Uint32Array(o);let n=0;for(let t=0,r=-1/0;t<o;t++){const i=this._ids[t];this._dists[i]>r&&(e[n++]=i,r=this._dists[i])}return this.hull=e.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(aC(m,y,v,b,w,_)){const t=d,e=v,n=b;d=p,v=w,b=_,p=t,w=e,_=n}const k=function(t,e,n,r,i,o){const a=n-t,s=r-e,u=i-t,l=o-e,c=a*a+s*s,f=u*u+l*l,h=.5/(a*l-s*u);return{x:t+(l*c-s*f)*h,y:e+(a*f-u*c)*h}}(m,y,v,b,w,_);this._cx=k.x,this._cy=k.y;for(let e=0;e<o;e++)this._dists[e]=iC(t[2*e],t[2*e+1],k.x,k.y);lC(this._ids,this._dists,0,o-1),this._hullStart=h;let A=3;n[h]=e[p]=d,n[d]=e[h]=p,n[p]=e[d]=h,r[h]=0,r[d]=1,r[p]=2,i.fill(-1),i[this._hashKey(m,y)]=h,i[this._hashKey(v,b)]=d,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(h,d,p,-1,-1,-1);for(let o,a,s=0;s<this._ids.length;s++){const u=this._ids[s],l=t[2*u],c=t[2*u+1];if(s>0&&Math.abs(l-o)<=eC&&Math.abs(c-a)<=eC)continue;if(o=l,a=c,u===h||u===d||u===p)continue;let f=0;for(let t=0,e=this._hashKey(l,c);t<this._hashSize&&(f=i[(e+t)%this._hashSize],-1===f||f===n[f]);t++);f=e[f];let g,m=f;for(;g=n[m],!aC(l,c,t[2*m],t[2*m+1],t[2*g],t[2*g+1]);)if(m=g,m===f){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,n[m],-1,-1,r[m]);r[u]=this._legalize(y+2),r[m]=y,A++;let v=n[m];for(;g=n[v],aC(l,c,t[2*v],t[2*v+1],t[2*g],t[2*g+1]);)y=this._addTriangle(v,u,g,r[u],-1,r[v]),r[u]=this._legalize(y+2),n[v]=v,A--,v=g;if(m===f)for(;g=e[m],aC(l,c,t[2*g],t[2*g+1],t[2*m],t[2*m+1]);)y=this._addTriangle(g,u,m,-1,r[m],r[g]),this._legalize(y+2),r[g]=y,n[m]=m,A--,m=g;this._hullStart=e[u]=m,n[m]=e[v]=u,n[u]=v,i[this._hashKey(l,c)]=u,i[this._hashKey(t[2*m],t[2*m+1])]=m}this.hull=new Uint32Array(A);for(let t=0,e=this._hullStart;t<A;t++)this.hull[t]=e,e=n[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:r}=this;let i=0,o=0;for(;;){const a=n[t],s=t-t%3;if(o=s+(t+2)%3,-1===a){if(0===i)break;t=nC[--i];continue}const u=a-a%3,l=s+(t+1)%3,c=u+(a+2)%3,f=e[o],h=e[t],d=e[l],p=e[c];if(sC(r[2*f],r[2*f+1],r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1])){e[t]=p,e[a]=f;const r=n[c];if(-1===r){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,r),this._link(a,n[o]),this._link(o,c);const s=u+(a+1)%3;i<nC.length&&(nC[i++]=s)}else{if(0===i)break;t=nC[--i]}}return o}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,r,i,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=e,this._triangles[a+2]=n,this._link(a,r),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function iC(t,e,n,r){const i=t-n,o=e-r;return i*i+o*o}function oC(t,e,n,r,i,o){const a=(r-e)*(i-t),s=(n-t)*(o-e);return Math.abs(a-s)>=33306690738754716e-32*Math.abs(a+s)?a-s:0}function aC(t,e,n,r,i,o){return(oC(i,o,t,e,n,r)||oC(t,e,n,r,i,o)||oC(n,r,i,o,t,e))<0}function sC(t,e,n,r,i,o,a,s){const u=t-a,l=e-s,c=n-a,f=r-s,h=i-a,d=o-s,p=c*c+f*f,g=h*h+d*d;return u*(f*g-p*d)-l*(c*g-p*h)+(u*u+l*l)*(c*d-f*h)<0}function uC(t,e,n,r,i,o){const a=n-t,s=r-e,u=i-t,l=o-e,c=a*a+s*s,f=u*u+l*l,h=.5/(a*l-s*u),d=(l*c-s*f)*h,p=(a*f-u*c)*h;return d*d+p*p}function lC(t,e,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=t[i],o=e[r];let a=i-1;for(;a>=n&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let i=n+1,o=r;cC(t,n+r>>1,i),e[t[n]]>e[t[r]]&&cC(t,n,r),e[t[i]]>e[t[r]]&&cC(t,i,r),e[t[n]]>e[t[i]]&&cC(t,n,i);const a=t[i],s=e[a];for(;;){do{i++}while(e[t[i]]<s);do{o--}while(e[t[o]]>s);if(o<i)break;cC(t,i,o)}t[n+1]=t[o],t[o]=a,r-i+1>=o-n?(lC(t,e,i,r),lC(t,e,n,o-1)):(lC(t,e,n,o-1),lC(t,e,i,r))}}function cC(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function fC(t){return t[0]}function hC(t){return t[1]}const dC=1e-6;class pC{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){const r=(t=+t)+(n=+n),i=e=+e;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>dC||Math.abs(this._y1-i)>dC)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(t,e,n,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class gC{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class mC{constructor(t,[e,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(e=+e)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=r,this.xmin=e,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let e,r,o=0,a=0,s=n.length;o<s;o+=3,a+=2){const s=2*n[o],u=2*n[o+1],l=2*n[o+2],c=t[s],f=t[s+1],h=t[u],d=t[u+1],p=t[l],g=t[l+1],m=h-c,y=d-f,v=p-c,b=g-f,x=m*m+y*y,w=v*v+b*b,_=2*(m*b-y*v);if(_)if(Math.abs(_)<1e-8)e=(c+p)/2,r=(f+g)/2;else{const t=1/_;e=c+(b*x-y*w)*t,r=f+(m*w-v*x)*t}else e=(c+p)/2-1e8*b,r=(f+g)/2+1e8*v;i[a]=e,i[a+1]=r}let o,a,s,u=e[e.length-1],l=4*u,c=t[2*u],f=t[2*u+1];r.fill(0);for(let n=0;n<e.length;++n)u=e[n],o=l,a=c,s=f,l=4*u,c=t[2*u],f=t[2*u+1],r[o+2]=r[l]=s-f,r[o+3]=r[l+1]=c-a}render(t){const e=null==t?t=new pC:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:o,vectors:a}=this;if(i.length<=1)return null;for(let e=0,r=n.length;e<r;++e){const r=n[e];if(r<e)continue;const i=2*Math.floor(e/3),a=2*Math.floor(r/3),s=o[i],u=o[i+1],l=o[a],c=o[a+1];this._renderSegment(s,u,l,c,t)}let s,u=i[i.length-1];for(let e=0;e<i.length;++e){s=u,u=i[e];const n=2*Math.floor(r[u]/3),l=o[n],c=o[n+1],f=4*s,h=this._project(l,c,a[f+2],a[f+3]);h&&this._renderSegment(l,c,h[0],h[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new pC:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const n=null==e?e=new pC:void 0,r=this._clip(t);if(null===r||!r.length)return;e.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let t=2;t<i;t+=2)r[t]===r[t-2]&&r[t+1]===r[t-1]||e.lineTo(r[t],r[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new gC;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,r,i){let o;const a=this._regioncode(t,e),s=this._regioncode(n,r);0===a&&0===s?(i.moveTo(t,e),i.lineTo(n,r)):(o=this._clipSegment(t,e,n,r,a,s))&&(i.moveTo(o[0],o[1]),i.lineTo(o[2],o[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let r=0,i=e.length;r<i;r+=2)for(let o=0,a=t.length;o<a;o+=2)if(e[r]==t[o]&&e[r+1]==t[o+1]&&e[(r+2)%i]==t[(o+a-2)%a]&&e[(r+3)%i]==t[(o+a-1)%a]){yield n;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,o=n[t];if(-1===o)return null;const a=[];let s=o;do{const n=Math.floor(s/3);if(a.push(e[2*n],e[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==t)break;s=r[s]}while(s!==o&&-1!==s);return a}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:n}=this,r=4*t;return n[r]||n[r+1]?this._clipInfinite(t,e,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let r,i,o,a,s,u=null,l=e[n-2],c=e[n-1],f=this._regioncode(l,c);for(let h=0;h<n;h+=2)if(r=l,i=c,l=e[h],c=e[h+1],o=f,f=this._regioncode(l,c),0===o&&0===f)a=s,s=0,u?u.push(l,c):u=[l,c];else{let e,n,h,d,p;if(0===o){if(null===(e=this._clipSegment(r,i,l,c,o,f)))continue;[n,h,d,p]=e}else{if(null===(e=this._clipSegment(l,c,r,i,f,o)))continue;[d,p,n,h]=e,a=s,s=this._edgecode(n,h),a&&s&&this._edge(t,a,s,u,u.length),u?u.push(n,h):u=[n,h]}a=s,s=this._edgecode(d,p),a&&s&&this._edge(t,a,s,u,u.length),u?u.push(d,p):u=[d,p]}if(u)a=s,s=this._edgecode(u[0],u[1]),a&&s&&this._edge(t,a,s,u,u.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return u}_clipSegment(t,e,n,r,i,o){for(;;){if(0===i&&0===o)return[t,e,n,r];if(i&o)return null;let a,s,u=i||o;8&u?(a=t+(n-t)*(this.ymax-e)/(r-e),s=this.ymax):4&u?(a=t+(n-t)*(this.ymin-e)/(r-e),s=this.ymin):2&u?(s=e+(r-e)*(this.xmax-t)/(n-t),a=this.xmax):(s=e+(r-e)*(this.xmin-t)/(n-t),a=this.xmin),i?(t=a,e=s,i=this._regioncode(t,e)):(n=a,r=s,o=this._regioncode(n,r))}}_clipInfinite(t,e,n,r,i,o){let a,s=Array.from(e);if((a=this._project(s[0],s[1],n,r))&&s.unshift(a[0],a[1]),(a=this._project(s[s.length-2],s[s.length-1],i,o))&&s.push(a[0],a[1]),s=this._clipFinite(t,s))for(let e,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)e=i,i=this._edgecode(s[n],s[n+1]),e&&i&&(n=this._edge(t,e,i,s,n),r=s.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(t,e,n,r,i){for(;e!==n;){let n,o;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,o=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,o=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,o=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,o=this.ymin}r[i]===n&&r[i+1]===o||!this.contains(t,n,o)||(r.splice(i,0,n,o),i+=2)}if(r.length>4)for(let t=0;t<r.length;t+=2){const e=(t+2)%r.length,n=(t+4)%r.length;(r[t]===r[e]&&r[e]===r[n]||r[t+1]===r[e+1]&&r[e+1]===r[n+1])&&(r.splice(e,2),t-=2)}return i}_project(t,e,n,r){let i,o,a,s=1/0;if(r<0){if(e<=this.ymin)return null;(i=(this.ymin-e)/r)<s&&(a=this.ymin,o=t+(s=i)*n)}else if(r>0){if(e>=this.ymax)return null;(i=(this.ymax-e)/r)<s&&(a=this.ymax,o=t+(s=i)*n)}if(n>0){if(t>=this.xmax)return null;(i=(this.xmax-t)/n)<s&&(o=this.xmax,a=e+(s=i)*r)}else if(n<0){if(t<=this.xmin)return null;(i=(this.xmin-t)/n)<s&&(o=this.xmin,a=e+(s=i)*r)}return[o,a]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const yC=2*Math.PI,vC=Math.pow;function bC(t){return t[0]}function xC(t){return t[1]}function wC(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class _C{static from(t,e=bC,n=xC,r){return new _C("length"in t?function(t,e,n,r){const i=t.length,o=new Float64Array(2*i);for(let a=0;a<i;++a){const i=t[a];o[2*a]=e.call(r,i,a,t),o[2*a+1]=n.call(r,i,a,t)}return o}(t,e,n,r):Float64Array.from(function*(t,e,n,r){let i=0;for(const o of t)yield e.call(r,o,i,t),yield n.call(r,o,i,t),++i}(t,e,n,r)))}constructor(t){this._delaunator=new rC(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const r=2*e[t],i=2*e[t+1],o=2*e[t+2];if((n[o]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let t=0,n=e.length/2;t<n;++t){const n=wC(e[2*t],e[2*t+1],i);e[2*t]=n[0],e[2*t+1]=n[1]}this._delaunator=new rC(e)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let t=0,e=n.length;t<e;++t){const e=i[t%3==2?t-2:t+1];-1!==n[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=r.length;t<e;++t)a[r[t]]=t;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],o[r[0]]=1,2===r.length&&(o[r[1]]=0))}voronoi(t){return new mC(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:r,halfedges:i,triangles:o,collinear:a}=this;if(a){const e=a.indexOf(t);return e>0&&(yield a[e-1]),void(e<a.length-1&&(yield a[e+1]))}const s=e[t];if(-1===s)return;let u=s,l=-1;do{if(yield l=o[u],u=u%3==2?u-2:u+1,o[u]!==t)return;if(u=i[u],-1===u){const e=n[(r[t]+1)%n.length];return void(e!==l&&(yield e))}}while(u!==s)}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const r=n;let i;for(;(i=this._step(n,t,e))>=0&&i!==n&&i!==r;)n=i;return i}_step(t,e,n){const{inedges:r,hull:i,_hullIndex:o,halfedges:a,triangles:s,points:u}=this;if(-1===r[t]||!u.length)return(t+1)%(u.length>>1);let l=t,c=vC(e-u[2*t],2)+vC(n-u[2*t+1],2);const f=r[t];let h=f;do{let r=s[h];const f=vC(e-u[2*r],2)+vC(n-u[2*r+1],2);if(f<c&&(c=f,l=r),h=h%3==2?h-2:h+1,s[h]!==t)break;if(h=a[h],-1===h){if(h=i[(o[t]+1)%i.length],h!==r&&vC(e-u[2*h],2)+vC(n-u[2*h+1],2)<c)return h;break}}while(h!==f);return l}render(t){const e=null==t?t=new pC:void 0,{points:n,halfedges:r,triangles:i}=this;for(let e=0,o=r.length;e<o;++e){const o=r[e];if(o<e)continue;const a=2*i[e],s=2*i[o];t.moveTo(n[a],n[a+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e=2){const n=null==t?t=new pC:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],o=r[n+1];t.moveTo(i+e,o),t.arc(i,o,e,0,yC)}return n&&n.value()}renderHull(t){const e=null==t?t=new pC:void 0,{hull:n,points:r}=this,i=2*n[0],o=n.length;t.moveTo(r[i],r[i+1]);for(let e=1;e<o;++e){const i=2*n[e];t.lineTo(r[i],r[i+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new gC;return this.renderHull(t),t.value()}renderTriangle(t,e){const n=null==e?e=new pC:void 0,{points:r,triangles:i}=this,o=2*i[t*=3],a=2*i[t+1],s=2*i[t+2];return e.moveTo(r[o],r[o+1]),e.lineTo(r[a],r[a+1]),e.lineTo(r[s],r[s+1]),e.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new gC;return this.renderTriangle(t,e),e.value()}}function kC(t){ps.call(this,null,t)}kC.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const AC=[-1e5,-1e5,1e5,1e5];function EC(t){const e=t[0][0],n=t[0][1];let r=t.length-1;for(;t[r][0]===e&&t[r][1]===n;--r);return"M"+t.slice(0,r+1).join("L")+"Z"}fe(kC,ps,{transform(t,e){const n=t.as||"path",r=e.source;if(!r||!r.length)return e;let i=t.size;i=i?[0,0,i[0],i[1]]:(i=t.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:AC;const o=this.value=_C.from(r,t.x,t.y).voronoi(i);for(let t=0,e=r.length;t<e;++t){const e=o.cellPolygon(t);r[t][n]=e?EC(e):null}return e.reflow(t.modified()).modifies(n)}});var DC=Math.PI/180,SC=2048;function CC(t,e,n,r){if(!e.sprite){var i=t.context,o=t.ratio;i.clearRect(0,0,2048/o,SC/o);var a,s,u,l,c,f=0,h=0,d=0,p=n.length;for(--r;++r<p;){if(e=n[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/o)+"px "+e.font,a=i.measureText(e.text+"m").width*o,u=e.size<<1,e.rotate){var g=Math.sin(e.rotate*DC),m=Math.cos(e.rotate*DC),y=a*m,v=a*g,b=u*m,x=u*g;a=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,u=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else a=a+31>>5<<5;if(u>d&&(d=u),f+a>=2048&&(f=0,h+=d,d=0),h+u>=SC)break;i.translate((f+(a>>1))/o,(h+(u>>1))/o),e.rotate&&i.rotate(e.rotate*DC),i.fillText(e.text,0,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,0,0)),i.restore(),e.width=a,e.height=u,e.xoff=f,e.yoff=h,e.x1=a>>1,e.y1=u>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,f+=a}for(var w=i.getImageData(0,0,2048/o,SC/o).data,_=[];--r>=0;)if((e=n[r]).hasText){for(s=(a=e.width)>>5,u=e.y1-e.y0,l=0;l<u*s;l++)_[l]=0;if(null==(f=e.xoff))return;h=e.yoff;var k=0,A=-1;for(c=0;c<u;c++){for(l=0;l<a;l++){var E=s*c+(l>>5),D=w[2048*(h+c)+(f+l)<<2]?1<<31-l%32:0;_[E]|=D,k|=D}k?A=c:(e.y0++,u--,c--,h++)}e.y1=e.y0+A,e.sprite=_.slice(0,(e.y1-e.y0)*s)}}}function OC(t,e,n){n>>=5;for(var r,i=t.sprite,o=t.width>>5,a=t.x-(o<<4),s=127&a,u=32-s,l=t.y1-t.y0,c=(t.y+t.y0)*n+(a>>5),f=0;f<l;f++){r=0;for(var h=0;h<=o;h++)if((r<<u|(h<o?(r=i[f*o+h])>>>s:0))&e[c+h])return!0;c+=n}return!1}function FC(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function MC(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function $C(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function NC(t){return"function"==typeof t?t:function(){return t}}var BC={archimedean:$C,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var i=t<0?-1:1;switch(Math.sqrt(1+4*i*t)-i&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}};const TC=["x","y","font","fontSize","fontStyle","fontWeight","angle"],jC=["text","font","rotate","fontSize","fontStyle","fontWeight"];function IC(t){ps.call(this,function(){var t,e,n,r,i,o,a,s=[256,256],u=$C,l=[],c=Math.random,f={};function h(t,e,n){for(var r,i,o,a=e.x,l=e.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),h=u(s),d=c()<.5?1:-1,p=-d;(r=h(p+=d))&&(i=~~r[0],o=~~r[1],!(Math.min(Math.abs(i),Math.abs(o))>=f));)if(e.x=a+i,e.y=l+o,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>s[0]||e.y+e.y1>s[1])&&(!n||!OC(e,t,s[0]))&&(!n||MC(e,n))){for(var g,m=e.sprite,y=e.width>>5,v=s[0]>>5,b=e.x-(y<<4),x=127&b,w=32-x,_=e.y1-e.y0,k=(e.y+e.y0)*v+(b>>5),A=0;A<_;A++){g=0;for(var E=0;E<=y;E++)t[k+E]|=g<<w|(E<y?(g=m[A*y+E])>>>x:0);k+=v}return e.sprite=null,!0}return!1}return f.layout=function(){for(var u=function(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=2048/e,t.height=SC/e;var n=t.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:e}}(sf()),f=function(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}((s[0]>>5)*s[1]),d=null,p=l.length,g=-1,m=[],y=l.map((s=>({text:t(s),font:e(s),style:r(s),weight:i(s),rotate:o(s),size:~~(n(s)+1e-14),padding:a(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((t,e)=>e.size-t.size));++g<p;){var v=y[g];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,CC(u,v,y,g),v.hasText&&h(f,v,d)&&(m.push(v),d?FC(d,v):d=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return m},f.words=function(t){return arguments.length?(l=t,f):l},f.size=function(t){return arguments.length?(s=[+t[0],+t[1]],f):s},f.font=function(t){return arguments.length?(e=NC(t),f):e},f.fontStyle=function(t){return arguments.length?(r=NC(t),f):r},f.fontWeight=function(t){return arguments.length?(i=NC(t),f):i},f.rotate=function(t){return arguments.length?(o=NC(t),f):o},f.text=function(e){return arguments.length?(t=NC(e),f):t},f.spiral=function(t){return arguments.length?(u=BC[t]||t,f):u},f.fontSize=function(t){return arguments.length?(n=NC(t),f):n},f.padding=function(t){return arguments.length?(a=NC(t),f):a},f.random=function(t){return arguments.length?(c=t,f):c},f}(),t)}IC.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:TC}]},fe(IC,ps,{transform(t,e){!t.size||t.size[0]&&t.size[1]||at("Wordcloud size dimensions must be non-zero.");const n=t.modified();if(!(n||e.changed(e.ADD_REM)||jC.some((function(n){const r=t[n];return Kt(r)&&e.modified(r.fields)}))))return;const r=e.materialize(e.SOURCE).source,i=this.value,o=t.as||TC;let a,s=t.fontSize||14;if(Kt(s)?a=t.fontSizeRange:s=ee(s),a){const t=s,e=qp("sqrt")().domain(ie(r,t)).range(a);s=n=>e(t(n))}r.forEach((t=>{t[o[0]]=NaN,t[o[1]]=NaN,t[o[3]]=0}));const u=i.words(r).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(s).random(Ms).layout(),l=i.size(),c=l[0]>>1,f=l[1]>>1,h=u.length;for(let t,e,n=0;n<h;++n)t=u[n],e=t.datum,e[o[0]]=t.x+c,e[o[1]]=t.y+f,e[o[2]]=t.font,e[o[3]]=t.size,e[o[4]]=t.style,e[o[5]]=t.weight,e[o[6]]=t.rotate;return e.reflow(n).modifies(o)}});const zC=t=>new Uint8Array(t),RC=t=>new Uint16Array(t),PC=t=>new Uint32Array(t);function LC(t,e,n){const r=(e<257?zC:e<65537?RC:PC)(t);return n&&r.set(n),r}function qC(t,e,n){const r=1<<e;return{one:r,zero:~r,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){const n=this,i=n.bisect(n.range,t.value),o=t.index,a=i[0],s=i[1],u=o.length;let l;for(l=0;l<a;++l)e[o[l]]|=r;for(l=s;l<u;++l)e[o[l]]|=r;return n}}}function UC(){let t=PC(0),e=[],n=0;return{insert:function(r,i,o){if(!i.length)return[];const a=n,s=i.length,u=PC(s);let l,c,f,h=Array(s);for(f=0;f<s;++f)h[f]=r(i[f]),u[f]=f;if(h=function(t,e){return t.sort.call(e,((e,n)=>{const r=t[e],i=t[n];return r<i?-1:r>i?1:0})),function(t,e){return Array.from(e,(e=>t[e]))}(t,e)}(h,u),a)l=e,c=t,e=Array(a+s),t=PC(a+s),function(t,e,n,r,i,o,a,s,u){let l,c=0,f=0;for(l=0;c<r&&f<a;++l)e[c]<i[f]?(s[l]=e[c],u[l]=n[c++]):(s[l]=i[f],u[l]=o[f++]+t);for(;c<r;++c,++l)s[l]=e[c],u[l]=n[c];for(;f<a;++f,++l)s[l]=i[f],u[l]=o[f]+t}(o,l,c,a,h,u,s,e,t);else{if(o>0)for(f=0;f<s;++f)u[f]+=o;e=h,t=u}return n=a+s,{index:u,value:h}},remove:function(r,i){const o=n;let a,s,u;for(s=0;!i[t[s]]&&s<o;++s);for(u=s;s<o;++s)i[a=t[s]]||(t[u]=a,e[u]=e[s],++u);n=o-r},bisect:function(t,r){let i;return r?i=r.length:(r=e,i=n),[ff(r,t[0],0,i),cf(r,t[1],0,i)]},reindex:function(e){for(let r=0,i=n;r<i;++r)t[r]=e[t[r]]},index:()=>t,size:()=>n}}function WC(t){ps.call(this,function(){let t=8,e=[],n=PC(0),r=LC(0,t),i=LC(0,t);return{data:()=>e,seen:()=>n=function(t,e,n){return t.length>=e?t:((n=n||new t.constructor(e)).set(t),n)}(n,e.length),add(t){for(let n,r=0,i=e.length,o=t.length;r<o;++r)n=t[r],n._index=i++,e.push(n)},remove(t,n){const o=e.length,a=Array(o-t),s=e;let u,l,c;for(l=0;!n[l]&&l<o;++l)a[l]=e[l],s[l]=l;for(c=l;l<o;++l)u=e[l],n[l]?s[l]=-1:(s[l]=c,r[c]=r[l],i[c]=i[l],a[c]=u,u._index=c++),r[l]=0;return e=a,s},size:()=>e.length,curr:()=>r,prev:()=>i,reset:t=>i[t]=r[t],all:()=>t<257?255:t<65537?65535:4294967295,set(t,e){r[t]|=e},clear(t,e){r[t]&=~e},resize(e,n){(e>r.length||n>t)&&(t=Math.max(n,t),r=LC(e,t,r),i=LC(e,t))}}}(),t),this._indices=null,this._dims=null}function VC(t){ps.call(this,null,t)}WC.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},fe(WC,ps,{transform(t,e){return this._dims?t.modified("fields")||t.fields.some((t=>e.modified(t.fields)))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},init(t,e){const n=t.fields,r=t.query,i=this._indices={},o=this._dims=[],a=r.length;let s,u,l=0;for(;l<a;++l)s=n[l].fname,u=i[s]||(i[s]=UC()),o.push(qC(u,l,r[l]));return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),r=t.fields,i=t.query,o=this._indices,a=this._dims,s=this.value,u=s.curr(),l=s.prev(),c=s.all(),f=n.rem=n.add,h=n.mod,d=i.length,p={};let g,m,y,v,b,x,w,_,k;if(l.set(u),e.rem.length&&(b=this.remove(t,e,n)),e.add.length&&s.add(e.add),e.mod.length)for(x={},v=e.mod,w=0,_=v.length;w<_;++w)x[v[w]._index]=1;for(w=0;w<d;++w)k=r[w],(!a[w]||t.modified("fields",w)||e.modified(k.fields))&&(y=k.fname,(g=p[y])||(o[y]=m=UC(),p[y]=g=m.insert(k,e.source,0)),a[w]=qC(m,w,i[w]).onAdd(g,u));for(w=0,_=s.data().length;w<_;++w)b[w]||(l[w]!==u[w]?f.push(w):x[w]&&u[w]!==c&&h.push(w));return s.mask=(1<<d)-1,n},eval(t,e){const n=e.materialize().fork(),r=this._dims.length;let i=0;return e.rem.length&&(this.remove(t,e,n),i|=(1<<r)-1),t.modified("query")&&!t.modified("fields")&&(i|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),i|=(1<<r)-1),e.mod.length&&(this.modify(e,n),i|=(1<<r)-1),this.value.mask=i,n},insert(t,e,n){const r=e.add,i=this.value,o=this._dims,a=this._indices,s=t.fields,u={},l=n.add,c=i.size()+r.length,f=o.length;let h,d,p,g=i.size();i.resize(c,f),i.add(r);const m=i.curr(),y=i.prev(),v=i.all();for(h=0;h<f;++h)d=s[h].fname,p=u[d]||(u[d]=a[d].insert(s[h],r,g)),o[h].onAdd(p,m);for(;g<c;++g)y[g]=v,m[g]!==v&&l.push(g)},modify(t,e){const n=e.mod,r=this.value,i=r.curr(),o=r.all(),a=t.mod;let s,u,l;for(s=0,u=a.length;s<u;++s)l=a[s]._index,i[l]!==o&&n.push(l)},remove(t,e,n){const r=this._indices,i=this.value,o=i.curr(),a=i.prev(),s=i.all(),u={},l=n.rem,c=e.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,a[d]=p=o[d],o[d]=s,p!==s&&l.push(d);for(d in r)r[d].remove(h,u);return this.reindex(e,h,u),u},reindex(t,e,n){const r=this._indices,i=this.value;t.runAfter((()=>{const t=i.remove(e,n);for(const e in r)r[e].reindex(t)}))},update(t,e,n){const r=this._dims,i=t.query,o=e.stamp,a=r.length;let s,u,l=0;for(n.filters=0,u=0;u<a;++u)t.modified("query",u)&&(s=u,++l);if(1===l)l=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(u=0,l=0;u<a;++u)t.modified("query",u)&&(l|=r[u].one,this.incrementAll(r[u],i[u],o,n.add),n.rem=n.add);return l},incrementAll(t,e,n,r){const i=this.value,o=i.seen(),a=i.curr(),s=i.prev(),u=t.index(),l=t.bisect(t.range),c=t.bisect(e),f=c[0],h=c[1],d=l[0],p=l[1],g=t.one;let m,y,v;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;else if(f>d)for(m=d,y=Math.min(f,p);m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;if(h>p)for(m=Math.max(f,p),y=h;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;else if(h<p)for(m=Math.max(d,h),y=p;m<y;++m)v=u[m],o[v]!==n&&(s[v]=a[v],o[v]=n,r.push(v)),a[v]^=g;t.range=e.slice()},incrementOne(t,e,n,r){const i=this.value.curr(),o=t.index(),a=t.bisect(t.range),s=t.bisect(e),u=s[0],l=s[1],c=a[0],f=a[1],h=t.one;let d,p,g;if(u<c)for(d=u,p=Math.min(c,l);d<p;++d)g=o[d],i[g]^=h,n.push(g);else if(u>c)for(d=c,p=Math.min(u,f);d<p;++d)g=o[d],i[g]^=h,r.push(g);if(l>f)for(d=Math.max(u,f),p=l;d<p;++d)g=o[d],i[g]^=h,n.push(g);else if(l<f)for(d=Math.max(c,l),p=f;d<p;++d)g=o[d],i[g]^=h,r.push(g);t.range=e.slice()}}),VC.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},fe(VC,ps,{transform(t,e){const n=~(t.ignore||0),r=t.filter,i=r.mask;if(0==(i&n))return e.StopPropagation;const o=e.fork(e.ALL),a=r.data(),s=r.curr(),u=r.prev(),l=t=>s[t]&n?null:a[t];return o.filter(o.MOD,l),i&i-1?(o.filter(o.ADD,(t=>{const e=s[t]&n;return!e&&e^u[t]&n?a[t]:null})),o.filter(o.REM,(t=>{const e=s[t]&n;return!e||e^e^u[t]&n?null:a[t]}))):(o.filter(o.ADD,l),o.filter(o.REM,(t=>(s[t]&n)===i?a[t]:null))),o.filter(o.SOURCE,(t=>l(t._index)))}});const HC="Literal",GC="CallExpression";function XC(t){this.type=t}var KC,YC,JC,ZC,QC;XC.prototype.visit=function(t){let e,n,r;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case GC:return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case HC:case"RawCode":default:return[]}}(this),n=0,r=e.length;n<r;++n)if(e[n].visit(t))return 1},(KC={})[1]="Boolean",KC[2]="<end>",KC[3]="Identifier",KC[4]="Keyword",KC[5]="Null",KC[6]="Numeric",KC[7]="Punctuator",KC[8]="String",KC[9]="RegularExpression";var tO="Identifier",eO="Unexpected token %0",nO="Invalid regular expression",rO="Invalid regular expression: missing /",iO="Octal literals are not allowed in strict mode.",oO="ILLEGAL",aO="Disabled.",sO=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),uO=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function lO(t,e){if(!t)throw new Error("ASSERT: "+e)}function cO(t){return t>=48&&t<=57}function fO(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function hO(t){return"01234567".indexOf(t)>=0}function dO(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function pO(t){return 10===t||13===t||8232===t||8233===t}function gO(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&sO.test(String.fromCharCode(t))}function mO(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&uO.test(String.fromCharCode(t))}const yO={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function vO(){for(;JC<ZC;){const t=YC.charCodeAt(JC);if(!dO(t)&&!pO(t))break;++JC}}function bO(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)JC<ZC&&fO(YC[JC])?(r=YC[JC++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):NO({},eO,oO);return String.fromCharCode(i)}function xO(){var t,e,n,r;for(e=0,"}"===(t=YC[JC])&&NO({},eO,oO);JC<ZC&&fO(t=YC[JC++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&NO({},eO,oO),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),r=56320+(e-65536&1023),String.fromCharCode(n,r))}function wO(){var t,e;for(t=YC.charCodeAt(JC++),e=String.fromCharCode(t),92===t&&(117!==YC.charCodeAt(JC)&&NO({},eO,oO),++JC,(t=bO("u"))&&"\\"!==t&&gO(t.charCodeAt(0))||NO({},eO,oO),e=t);JC<ZC&&mO(t=YC.charCodeAt(JC));)++JC,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==YC.charCodeAt(JC)&&NO({},eO,oO),++JC,(t=bO("u"))&&"\\"!==t&&mO(t.charCodeAt(0))||NO({},eO,oO),e+=t);return e}function _O(){var t,e,n,r,i=JC,o=YC.charCodeAt(JC),a=YC[JC];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++JC,{type:7,value:String.fromCharCode(o),start:i,end:JC};default:if(61===(t=YC.charCodeAt(JC+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return JC+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(t),start:i,end:JC};case 33:case 61:return JC+=2,61===YC.charCodeAt(JC)&&++JC,{type:7,value:YC.slice(i,JC),start:i,end:JC}}}return">>>="===(r=YC.substr(JC,4))?{type:7,value:r,start:i,end:JC+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:JC+=3}:a===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===e?{type:7,value:e,start:i,end:JC+=2}:("//"===e&&NO({},eO,oO),"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:i,end:++JC}:void NO({},eO,oO))}function kO(){var t,e,n;if(lO(cO((n=YC[JC]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=JC,t="","."!==n){if(t=YC[JC++],n=YC[JC],"0"===t){if("x"===n||"X"===n)return++JC,function(t){let e="";for(;JC<ZC&&fO(YC[JC]);)e+=YC[JC++];return 0===e.length&&NO({},eO,oO),gO(YC.charCodeAt(JC))&&NO({},eO,oO),{type:6,value:parseInt("0x"+e,16),start:t,end:JC}}(e);if(hO(n))return function(t){let e="0"+YC[JC++];for(;JC<ZC&&hO(YC[JC]);)e+=YC[JC++];return(gO(YC.charCodeAt(JC))||cO(YC.charCodeAt(JC)))&&NO({},eO,oO),{type:6,value:parseInt(e,8),octal:!0,start:t,end:JC}}(e);n&&cO(n.charCodeAt(0))&&NO({},eO,oO)}for(;cO(YC.charCodeAt(JC));)t+=YC[JC++];n=YC[JC]}if("."===n){for(t+=YC[JC++];cO(YC.charCodeAt(JC));)t+=YC[JC++];n=YC[JC]}if("e"===n||"E"===n)if(t+=YC[JC++],"+"!==(n=YC[JC])&&"-"!==n||(t+=YC[JC++]),cO(YC.charCodeAt(JC)))for(;cO(YC.charCodeAt(JC));)t+=YC[JC++];else NO({},eO,oO);return gO(YC.charCodeAt(JC))&&NO({},eO,oO),{type:6,value:parseFloat(t),start:e,end:JC}}function AO(){if(vO(),JC>=ZC)return{type:2,start:JC,end:JC};const t=YC.charCodeAt(JC);return gO(t)?function(){var t,e;return t=JC,{type:1===(e=92===YC.charCodeAt(JC)?wO():function(){var t,e;for(t=JC++;JC<ZC;){if(92===(e=YC.charCodeAt(JC)))return JC=t,wO();if(!mO(e))break;++JC}return YC.slice(t,JC)}()).length?3:yO.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:JC}}():40===t||41===t||59===t?_O():39===t||34===t?function(){var t,e,n,r,i="",o=!1;for(lO("'"===(t=YC[JC])||'"'===t,"String literal must starts with a quote"),e=JC,++JC;JC<ZC;){if((n=YC[JC++])===t){t="";break}if("\\"===n)if((n=YC[JC++])&&pO(n.charCodeAt(0)))"\r"===n&&"\n"===YC[JC]&&++JC;else switch(n){case"u":case"x":"{"===YC[JC]?(++JC,i+=xO()):i+=bO(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:hO(n)?(0!==(r="01234567".indexOf(n))&&(o=!0),JC<ZC&&hO(YC[JC])&&(o=!0,r=8*r+"01234567".indexOf(YC[JC++]),"0123".indexOf(n)>=0&&JC<ZC&&hO(YC[JC])&&(r=8*r+"01234567".indexOf(YC[JC++]))),i+=String.fromCharCode(r)):i+=n}else{if(pO(n.charCodeAt(0)))break;i+=n}}return""!==t&&NO({},eO,oO),{type:8,value:i,octal:o,start:e,end:JC}}():46===t?cO(YC.charCodeAt(JC+1))?kO():_O():cO(t)?kO():_O()}function EO(){const t=QC;return JC=t.end,QC=AO(),JC=t.end,t}function DO(){const t=JC;QC=AO(),JC=t}function SO(t,e,n){const r=new XC("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return r.operator=t,r.left=e,r.right=n,r}function CO(t,e){const n=new XC("CallExpression");return n.callee=t,n.arguments=e,n}function OO(t){const e=new XC(tO);return e.name=t,e}function FO(t){const e=new XC("Literal");return e.value=t.value,e.raw=YC.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function MO(t,e,n){const r=new XC("MemberExpression");return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function $O(t,e,n){const r=new XC("Property");return r.key=e,r.value=n,r.kind=t,r}function NO(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,((t,e)=>(lO(e<r.length,"Message reference must be in range"),r[e])));throw(n=new Error(i)).index=JC,n.description=i,n}function BO(t){2===t.type&&NO(t,"Unexpected end of input"),6===t.type&&NO(t,"Unexpected number"),8===t.type&&NO(t,"Unexpected string"),3===t.type&&NO(t,"Unexpected identifier"),4===t.type&&NO(t,"Unexpected reserved word"),NO(t,eO,t.value)}function TO(t){const e=EO();7===e.type&&e.value===t||BO(e)}function jO(t){return 7===QC.type&&QC.value===t}function IO(t){return 4===QC.type&&QC.value===t}function zO(){JC=QC.start;const t=EO();return 8===t.type||6===t.type?(t.octal&&NO(t,iO),FO(t)):OO(t.value)}function RO(){var t,e,n;return JC=QC.start,3===(t=QC).type?(n=zO(),TO(":"),$O("init",n,GO())):2!==t.type&&7!==t.type?(e=zO(),TO(":"),$O("init",e,GO())):void BO(t)}const PO={if:1};function LO(){var t,e,n;if(jO("("))return function(){TO("(");const t=XO();return TO(")"),t}();if(jO("["))return function(){const t=[];for(JC=QC.start,TO("[");!jO("]");)jO(",")?(EO(),t.push(null)):(t.push(GO()),jO("]")||TO(","));return EO(),function(t){const e=new XC("ArrayExpression");return e.elements=t,e}(t)}();if(jO("{"))return function(){var t,e,n=[],r={},i=String;for(JC=QC.start,TO("{");!jO("}");)e="$"+((t=RO()).key.type===tO?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?NO({},"Duplicate data property in object literal not allowed in strict mode"):r[e]=!0,n.push(t),jO("}")||TO(",");return TO("}"),function(t){const e=new XC("ObjectExpression");return e.properties=t,e}(n)}();if(t=QC.type,JC=QC.start,3===t||PO[QC.value])n=OO(EO().value);else if(8===t||6===t)QC.octal&&NO(QC,iO),n=FO(EO());else{if(4===t)throw new Error(aO);1===t?((e=EO()).value="true"===e.value,n=FO(e)):5===t?((e=EO()).value=null,n=FO(e)):jO("/")||jO("/=")?(n=FO(function(){var t,e,n,r;return QC=null,vO(),t=JC,e=function(){var t,e,n,r;for(lO("/"===(t=YC[JC]),"Regular expression literal must start with a slash"),e=YC[JC++],n=!1,r=!1;JC<ZC;)if(e+=t=YC[JC++],"\\"===t)pO((t=YC[JC++]).charCodeAt(0))&&NO({},rO),e+=t;else if(pO(t.charCodeAt(0)))NO({},rO);else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||NO({},rO),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";JC<ZC&&mO((t=YC[JC]).charCodeAt(0));)++JC,"\\"===t&&JC<ZC?NO({},eO,oO):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&NO({},nO,n),{value:n,literal:e}}(),r=function(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111)return"x";NO({},nO)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){NO({},nO)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:JC}}()),DO()):BO(EO())}return n}function qO(){const t=[];if(TO("("),!jO(")"))for(;JC<ZC&&(t.push(GO()),!jO(")"));)TO(",");return TO(")"),t}function UO(){TO("[");const t=XO();return TO("]"),t}function WO(){const t=function(){var t;for(t=LO();;)if(jO("."))t=MO(".",t,(TO("."),function(){JC=QC.start;const t=EO();return function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(t)||BO(t),OO(t.value)}()));else if(jO("("))t=CO(t,qO());else{if(!jO("["))break;t=MO("[",t,UO())}return t}();if(7===QC.type&&(jO("++")||jO("--")))throw new Error(aO);return t}function VO(){var t,e;if(7!==QC.type&&4!==QC.type)e=WO();else{if(jO("++")||jO("--"))throw new Error(aO);if(jO("+")||jO("-")||jO("~")||jO("!"))t=EO(),e=VO(),e=function(t,e){const n=new XC("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(IO("delete")||IO("void")||IO("typeof"))throw new Error(aO);e=WO()}}return e}function HO(t){let e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function GO(){var t,e;return t=function(){var t,e,n,r,i,o,a,s,u,l;if(t=QC,u=VO(),0===(i=HO(r=QC)))return u;for(r.prec=i,EO(),e=[t,QC],o=[u,r,a=VO()];(i=HO(QC))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),e.pop(),n=SO(s,u,a),o.push(n);(r=EO()).prec=i,o.push(r),e.push(QC),n=VO(),o.push(n)}for(n=o[l=o.length-1],e.pop();l>1;)e.pop(),n=SO(o[l-1].value,o[l-2],n),l-=2;return n}(),jO("?")&&(EO(),e=GO(),TO(":"),t=function(t,e,n){const r=new XC("ConditionalExpression");return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,GO())),t}function XO(){const t=GO();if(jO(","))throw new Error(aO);return t}function KO(t){JC=0,ZC=(YC=t).length,QC=null,DO();const e=XO();if(2!==QC.type)throw new Error("Unexpect token after expression.");return e}var YO={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function JO(t){function e(e,n,r){return i=>function(e,n,r,i){let o=t(n[0]);return r&&(o=r+"("+o+")",0===r.lastIndexOf("new ",0)&&(o="("+o+")")),o+"."+e+(i<0?"":0===i?"()":"("+n.slice(1).map(t).join(",")+")")}(e,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&at("Missing arguments to clamp function."),e.length>3&&at("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",r,0),lower:e("toLowerCase",r,0),substring:e("substring",r),split:e("split",r),trim:e("trim",r,0),regexp:i,test:e("test",i),if:function(e){e.length<3&&at("Missing arguments to if function."),e.length>3&&at("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function ZO(t){const e=(t=t||{}).allowed?Me(t.allowed):{},n=t.forbidden?Me(t.forbidden):{},r=t.constants||YO,i=(t.functions||JO)(f),o=t.globalvar,a=t.fieldvar,s=Kt(o)?o:t=>"".concat(o,'["').concat(t,'"]');let u={},l={},c=0;function f(t){if(ve(t))return t;const e=h[t.type];return null==e&&at("Unsupported type: "+t.type),e(t)}const h={Literal:t=>t.raw,Identifier:t=>{const i=t.name;return c>0?i:se(n,i)?at("Illegal identifier: "+i):se(r,i)?r[i]:se(e,i)?i:(u[i]=1,s(i))},MemberExpression:t=>{const e=!t.computed,n=f(t.object);e&&(c+=1);const r=f(t.property);return n===a&&(l[function(t){const e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(r)]=1),e&&(c-=1),n+(e?"."+r:"["+r+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&at("Illegal callee type: "+t.callee.type);const e=t.callee.name,n=t.arguments,r=se(i,e)&&i[e];return r||at("Unrecognized function: "+e),Kt(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(f).join(",")+"]",BinaryExpression:t=>"("+f(t.left)+" "+t.operator+" "+f(t.right)+")",UnaryExpression:t=>"("+t.operator+f(t.argument)+")",ConditionalExpression:t=>"("+f(t.test)+"?"+f(t.consequent)+":"+f(t.alternate)+")",LogicalExpression:t=>"("+f(t.left)+t.operator+f(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(f).join(",")+"}",Property:t=>{c+=1;const e=f(t.key);return c-=1,e+":"+f(t.value)}};function d(t){const e={code:f(t),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},e}return d.functions=i,d.constants=r,d}var QO,tF,eF,nF,rF,iF,oF,aF,sF,uF,lF,cF,fF,hF,dF,pF,gF=new Ww,mF=new Ww,yF={point:p_,lineStart:p_,lineEnd:p_,polygonStart:function(){gF=new Ww,yF.lineStart=vF,yF.lineEnd=bF},polygonEnd:function(){var t=+gF;mF.add(t<0?Yw+t:t),this.lineStart=this.lineEnd=this.point=p_},sphere:function(){mF.add(Yw)}};function vF(){yF.point=xF}function bF(){wF(QO,tF)}function xF(t,e){yF.point=wF,QO=t,tF=e,eF=t*=Zw,nF=n_(e=(e*=Zw)/2+Kw),rF=u_(e)}function wF(t,e){var n=(t*=Zw)-eF,r=n>=0?1:-1,i=r*n,o=n_(e=(e*=Zw)/2+Kw),a=u_(e),s=rF*a,u=nF*o+s*n_(i),l=s*r*u_(i);gF.add(e_(l,u)),eF=t,nF=o,rF=a}var _F,kF,AF,EF,DF,SF,CF,OF,FF,MF,$F,NF,BF,TF,jF,IF,zF={point:RF,lineStart:LF,lineEnd:qF,polygonStart:function(){zF.point=UF,zF.lineStart=WF,zF.lineEnd=VF,hF=new Ww,yF.polygonStart()},polygonEnd:function(){yF.polygonEnd(),zF.point=RF,zF.lineStart=LF,zF.lineEnd=qF,gF<0?(iF=-(aF=180),oF=-(sF=90)):hF>Vw?sF=90:hF<-1e-6&&(oF=-90),pF[0]=iF,pF[1]=aF},sphere:function(){iF=-(aF=180),oF=-(sF=90)}};function RF(t,e){dF.push(pF=[iF=t,aF=t]),e<oF&&(oF=e),e>sF&&(sF=e)}function PF(t,e){var n=_k([t*Zw,e*Zw]);if(fF){var r=Ak(fF,n),i=Ak([r[1],-r[0],0],r);Sk(i),i=wk(i);var o,a=t-uF,s=a>0?1:-1,u=i[0]*Jw*s,l=Qw(a)>180;l^(s*uF<u&&u<s*t)?(o=i[1]*Jw)>sF&&(sF=o):l^(s*uF<(u=(u+360)%360-180)&&u<s*t)?(o=-i[1]*Jw)<oF&&(oF=o):(e<oF&&(oF=e),e>sF&&(sF=e)),l?t<uF?HF(iF,t)>HF(iF,aF)&&(aF=t):HF(t,aF)>HF(iF,aF)&&(iF=t):aF>=iF?(t<iF&&(iF=t),t>aF&&(aF=t)):t>uF?HF(iF,t)>HF(iF,aF)&&(aF=t):HF(t,aF)>HF(iF,aF)&&(iF=t)}else dF.push(pF=[iF=t,aF=t]);e<oF&&(oF=e),e>sF&&(sF=e),fF=n,uF=t}function LF(){zF.point=PF}function qF(){pF[0]=iF,pF[1]=aF,zF.point=RF,fF=null}function UF(t,e){if(fF){var n=t-uF;hF.add(Qw(n)>180?n+(n>0?360:-360):n)}else lF=t,cF=e;yF.point(t,e),PF(t,e)}function WF(){yF.lineStart()}function VF(){UF(lF,cF),yF.lineEnd(),Qw(hF)>Vw&&(iF=-(aF=180)),pF[0]=iF,pF[1]=aF,fF=null}function HF(t,e){return(e-=t)<0?e+360:e}function GF(t,e){return t[0]-e[0]}function XF(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var KF={sphere:p_,point:YF,lineStart:ZF,lineEnd:eM,polygonStart:function(){KF.lineStart=nM,KF.lineEnd=rM},polygonEnd:function(){KF.lineStart=ZF,KF.lineEnd=eM}};function YF(t,e){t*=Zw;var n=n_(e*=Zw);JF(n*n_(t),n*u_(t),u_(e))}function JF(t,e,n){++_F,AF+=(t-AF)/_F,EF+=(e-EF)/_F,DF+=(n-DF)/_F}function ZF(){KF.point=QF}function QF(t,e){t*=Zw;var n=n_(e*=Zw);TF=n*n_(t),jF=n*u_(t),IF=u_(e),KF.point=tM,JF(TF,jF,IF)}function tM(t,e){t*=Zw;var n=n_(e*=Zw),r=n*n_(t),i=n*u_(t),o=u_(e),a=e_(c_((a=jF*o-IF*i)*a+(a=IF*r-TF*o)*a+(a=TF*i-jF*r)*a),TF*r+jF*i+IF*o);kF+=a,SF+=a*(TF+(TF=r)),CF+=a*(jF+(jF=i)),OF+=a*(IF+(IF=o)),JF(TF,jF,IF)}function eM(){KF.point=YF}function nM(){KF.point=iM}function rM(){oM(NF,BF),KF.point=YF}function iM(t,e){NF=t,BF=e,t*=Zw,e*=Zw,KF.point=oM;var n=n_(e);TF=n*n_(t),jF=n*u_(t),IF=u_(e),JF(TF,jF,IF)}function oM(t,e){t*=Zw;var n=n_(e*=Zw),r=n*n_(t),i=n*u_(t),o=u_(e),a=jF*o-IF*i,s=IF*r-TF*o,u=TF*i-jF*r,l=o_(a,s,u),c=d_(l),f=l&&-c/l;FF.add(f*a),MF.add(f*s),$F.add(f*u),kF+=c,SF+=c*(TF+(TF=r)),CF+=c*(jF+(jF=i)),OF+=c*(IF+(IF=o)),JF(TF,jF,IF)}const aM="intersect",sM="union",uM="index:unit";function lM(t,e){for(var n,r,i=e.fields,o=e.values,a=i.length,s=0;s<a;++s)if((r=i[s]).getter=ut.getter||ut(r.field),pe(n=r.getter(t))&&(n=Ot(n)),pe(o[s])&&(o[s]=Ot(o[s])),pe(o[s][0])&&(o[s]=o[s].map(Ot)),"E"===r.type){if(_t(o[s])?o[s].indexOf(n)<0:n!==o[s])return!1}else if("R"===r.type){if(!he(n,o[s]))return!1}else if("R-RE"===r.type){if(!he(n,o[s],!0,!1))return!1}else if("R-E"===r.type){if(!he(n,o[s],!1,!1))return!1}else if("R-LE"===r.type&&!he(n,o[s],!1,!0))return!1;return!0}const cM=ut("_vgsid_"),fM=function(t){let e=t,n=t;function r(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)<0?r=o+1:i=o}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>function(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}(t(e),n)}(t)),{left:r,center:function(t,n,i,o){null==i&&(i=0),null==o&&(o=t.length);const a=r(t,n,i,o-1);return a>i&&e(t[a-1],n)>-e(t[a],n)?a-1:a},right:function(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const o=r+i>>>1;n(t[o],e)>0?i=o:r=o+1}return r}}}(cM),hM=fM.left,dM=fM.right;var pM={E_union:function(t,e){if(!t.length)return e;for(var n=0,r=e.length;n<r;++n)t.indexOf(e[n])<0&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter((t=>e.indexOf(t)>=0)):e},R_union:function(t,e){var n=Ot(e[0]),r=Ot(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?(t[0]>n&&(t[0]=n),t[1]<r&&(t[1]=r),t):[n,r]},R_intersect:function(t,e){var n=Ot(e[0]),r=Ot(e[1]);return n>r&&(n=e[1],r=e[0]),t.length?r<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>r&&(t[1]=r),t):[n,r]}};function gM(t,e,n,r){e[0].type!==HC&&at("First argument to selection functions must be a string literal.");const i=e[0].value,o=":"+i;(e.length>=2&&Ct(e).value)!==aM||se(r,"@unit")||(r["@unit"]=n.getData(i).indataRef(n,"unit")),se(r,o)||(r[o]=n.getData(i).tuplesRef())}function mM(t){const e=this.context.data[t];return e?e.values.value:[]}const yM=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},vM=yM("format"),bM=yM("timeFormat"),xM=yM("utcFormat"),wM=yM("timeParse"),_M=yM("utcParse"),kM=new Date(2e3,0,1);function AM(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(kM.setYear(2e3),kM.setMonth(t),kM.setDate(e),bM.call(this,kM,n)):""}function EM(t,e,n,r){e[0].type!==HC&&at("First argument to data functions must be a string literal.");const i=e[0].value,o=":"+i;if(!se(o,r))try{r[o]=n.getData(i).tuplesRef()}catch(t){}}function DM(t,e,n,r){if(e[0].type===HC)SM(n,r,e[0].value);else for(t in n.scales)SM(n,r,t)}function SM(t,e,n){const r="%"+n;if(!se(e,r))try{e[r]=t.scaleRef(n)}catch(t){}}function CM(t,e){let n;return Kt(t)?t:ve(t)?(n=e.scales[t])&&n.value:void 0}function OM(t,e){return function(n,r,i){if(n){const e=CM(n,(i||this).context);return e&&e.path[t](r)}return e(r)}}const FM=OM("area",(function(t){return mF=new Ww,Uw(t,yF),2*mF})),MM=OM("bounds",(function(t){var e,n,r,i,o,a,s;if(sF=aF=-(iF=oF=1/0),dF=[],Uw(t,zF),n=dF.length){for(dF.sort(GF),e=1,o=[r=dF[0]];e<n;++e)XF(r,(i=dF[e])[0])||XF(r,i[1])?(HF(r[0],i[1])>HF(r[0],r[1])&&(r[1]=i[1]),HF(i[0],r[1])>HF(r[0],r[1])&&(r[0]=i[0])):o.push(r=i);for(a=-1/0,e=0,r=o[n=o.length-1];e<=n;r=i,++e)i=o[e],(s=HF(r[1],i[0]))>a&&(a=s,iF=i[0],aF=r[1])}return dF=pF=null,iF===1/0||oF===1/0?[[NaN,NaN],[NaN,NaN]]:[[iF,oF],[aF,sF]]})),$M=OM("centroid",(function(t){_F=kF=AF=EF=DF=SF=CF=OF=0,FF=new Ww,MF=new Ww,$F=new Ww,Uw(t,KF);var e=+FF,n=+MF,r=+$F,i=o_(e,n,r);return i<Hw&&(e=SF,n=CF,r=OF,kF<Vw&&(e=AF,n=EF,r=DF),(i=o_(e,n,r))<Hw)?[NaN,NaN]:[e_(n,e)*Jw,d_(r/i)*Jw]}));function NM(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function BM(t){const e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function TM(t){const e=th(t);return.2126*BM(e.r)+.7152*BM(e.g)+.0722*BM(e.b)}function jM(t,e){return t===e||t!=t&&e!=e||(_t(t)?!(!_t(e)||t.length!==e.length)&&function(t,e){for(let n=0,r=t.length;n<r;++n)if(!jM(t[n],e[n]))return!1;return!0}(t,e):!(!kt(t)||!kt(e))&&IM(t,e))}function IM(t,e){for(const n in t)if(!jM(t[n],e[n]))return!1;return!0}function zM(t){return e=>IM(t,e)}const RM={};function PM(t){return _t(t)||ArrayBuffer.isView(t)?t:null}function LM(t){return PM(t)||(ve(t)?t:null)}const qM=t=>t.data;function UM(t,e){const n=mM.call(e,t);return n.root&&n.root.lookup||{}}const WM=()=>"undefined"!=typeof window&&window||null,VM={random:()=>Ms(),cumulativeNormal:qs,cumulativeLogNormal:Xs,cumulativeUniform:tu,densityNormal:Ls,densityLogNormal:Gs,densityUniform:Qs,quantileNormal:Us,quantileLogNormal:Ks,quantileUniform:eu,sampleNormal:Ps,sampleLogNormal:Hs,sampleUniform:Zs,isArray:_t,isBoolean:de,isDate:pe,isDefined:t=>void 0!==t,isNumber:me,isObject:kt,isRegExp:ye,isString:ve,isTuple:Ta,isValid:t=>null!=t&&t==t,toBoolean:Se,toDate:Oe,toNumber:Ot,toString:Fe,indexof:function(t,...e){return LM(t).indexOf(...e)},join:function(t,...e){return PM(t).join(...e)},lastindexof:function(t,...e){return LM(t).lastIndexOf(...e)},replace:function(t,e,n){return Kt(n)&&at("Function argument passed to replace."),String(t).replace(e,n)},reverse:function(t){return PM(t).slice().reverse()},slice:function(t,...e){return LM(t).slice(...e)},flush:ce,lerp:xe,merge:function(){const t=[].slice.call(arguments);return t.unshift({}),re(...t)},pad:Ae,peek:Ct,pluck:function(t,e){const n=RM[e]||(RM[e]=ut(e));return _t(t)?t.map(n):n(t)},span:Ee,inrange:he,truncate:$e,rgb:th,lab:zd,hcl:Vd,hsl:sh,luminance:TM,contrast:function(t,e){const n=TM(t),r=TM(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:xu,format:vM,utcFormat:xM,utcParse:_M,utcOffset:Di,utcSequence:Oi,timeFormat:bM,timeParse:wM,timeOffset:Ei,timeSequence:Ci,timeUnitSpecifier:Jr,monthFormat:function(t){return AM.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return AM.call(this,t,1,"%b")},dayFormat:function(t){return AM.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return AM.call(this,0,2+t,"%a")},quarter:Vt,utcquarter:Ht,week:ei,utcweek:si,dayofyear:ti,utcdayofyear:ai,warn:function(){return NM(this.context.dataflow,"warn",arguments)},info:function(){return NM(this.context.dataflow,"info",arguments)},debug:function(){return NM(this.context.dataflow,"debug",arguments)},extent:ie,inScope:function(t){const e=this.context.group;let n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:function(t,e,n){if(!t)return[];const[r,i]=t,o=(new Am).set(r[0],r[1],i[0],i[1]);return Xb(n||this.context.dataflow.scenegraph().root,o,function(t){let e=null;if(t){const n=Gt(t.marktype),r=Gt(t.markname);e=t=>(!n.length||n.some((e=>t.marktype===e)))&&(!r.length||r.some((e=>t.name===e)))}return e}(e))},clampRange:Xt,pinchDistance:function(t){const e=t.touches,n=e[0].clientX-e[1].clientX,r=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){const t=WM();return t?t.screen:{}},containerSize:function(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){const t=WM();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return dp(t||0,e||0,n||0)},setdata:function(t,e){const n=this.context.dataflow,r=this.context.data[t].input;return n.pulse(r,n.changeset().remove(dt).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?Gg(n,e=e||jg(t)):t}},panLinear:jt,panLog:It,panPow:zt,panSymlog:Rt,zoomLinear:Lt,zoomLog:qt,zoomPow:Ut,zoomSymlog:Wt,encode:function(t,e,n){if(t){const n=this.context.dataflow,r=t.mark.source;n.pulse(r,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,r,i,o){const a=this.context.dataflow,s=this.context.data[t],u=s.input,l=a.stamp();let c,f,h=s.changes;if(!1===a._trigger||!(u.value.length||e||r))return 0;if((!h||h.stamp<l)&&(s.changes=h=a.changeset(),h.stamp=l,a.runAfter((()=>{s.modified=!0,a.pulse(u,h).run()}),!0,1)),n&&(c=!0===n?dt:_t(n)||Ta(n)?n:zM(n),h.remove(c)),e&&h.insert(e),r&&(c=zM(r),u.value.some(c)?h.remove(c):h.insert(r)),i)for(f in o)h.modify(i,f,o[f]);return 1}},HM=["view","item","group","xy","x","y"],GM="this.",XM={},KM={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>"_[".concat(De("$"+t),"]"),functions:function(t){const e=JO(t);HM.forEach((t=>e[t]="event.vega."+t));for(const t in VM)e[t]=GM+t;return re(e,function(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=DM,n._range=DM,n._scale=DM;const r=e=>"_["+(e.type===HC?De("%"+e.value):De("%")+"+"+t(e))+"]";return{_bandwidth:t=>"this.__bandwidth(".concat(r(t[0]),")"),_range:t=>"".concat(r(t[0]),".range()"),_scale:e=>"".concat(r(e[0]),"(").concat(t(e[1]),")")}}(t,VM,XM)),e},constants:YO,visitors:XM},YM=ZO(KM);function JM(t,e,n){return 1===arguments.length?VM[t]:(VM[t]=e,n&&(XM[t]=n),YM&&(YM.functions[t]=GM+t),this)}function ZM(t,e){const n={};let r;try{r=KO(t=ve(t)?t:De(t)+"")}catch(e){at("Expression parse error: "+t)}r.visit((t=>{if(t.type!==GC)return;const r=t.callee.name,i=KM.visitors[r];i&&i(r,t.arguments,e,n)}));const i=YM(r);return i.globals.forEach((t=>{const r="$"+t;!se(n,r)&&e.getSignal(t)&&(n[r]=e.signalRef(t))})),{$expr:re({code:i.code},e.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}JM("bandwidth",(function(t,e){const n=CM(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}),DM),JM("copy",(function(t,e){const n=CM(t,(e||this).context);return n?n.copy():void 0}),DM),JM("domain",(function(t,e){const n=CM(t,(e||this).context);return n?n.domain():[]}),DM),JM("range",(function(t,e){const n=CM(t,(e||this).context);return n&&n.range?n.range():[]}),DM),JM("invert",(function(t,e,n){const r=CM(t,(n||this).context);return r?_t(e)?(r.invertRange||r.invert)(e):(r.invert||r.invertExtent)(e):void 0}),DM),JM("scale",(function(t,e,n){const r=CM(t,(n||this).context);return r?r(e):void 0}),DM),JM("gradient",(function(t,e,n,r,i){t=CM(t,(i||this).context);const o=Mg(e,n);let a=t.domain(),s=a[0],u=Ct(a),l=ct;return u-s?l=eg(t,s,u):t=(t.interpolator?qp("sequential")().interpolator(t.interpolator()):qp("linear")().interpolate(t.interpolate()).range(t.range())).domain([s=0,u=1]),t.ticks&&(a=t.ticks(+r||15),s!==a[0]&&a.unshift(s),u!==Ct(a)&&a.push(u)),a.forEach((e=>o.stop(l(e),t(e)))),o}),DM),JM("geoArea",FM,DM),JM("geoBounds",MM,DM),JM("geoCentroid",$M,DM),JM("geoShape",(function(t,e,n){const r=CM(t,(n||this).context);return function(t){return r?r.path.context(t)(e):""}}),DM),JM("indata",(function(t,e,n){const r=this.context.data[t]["index:"+e],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(t,e,n,r){e[0].type!==HC&&at("First argument to indata must be a string literal."),e[1].type!==HC&&at("Second argument to indata must be a string literal.");const i=e[0].value,o=e[1].value,a="@"+o;se(a,r)||(r[a]=n.getData(i).indataRef(n,o))})),JM("data",mM,EM),JM("treePath",(function(t,e,n){const r=UM(t,this),i=r[e],o=r[n];return i&&o?i.path(o).map(qM):void 0}),EM),JM("treeAncestors",(function(t,e){const n=UM(t,this)[e];return n?n.ancestors().map(qM):void 0}),EM),JM("vlSelectionTest",(function(t,e,n){for(var r,i,o,a,s,u=this.context.data[t],l=u?u.values.value:[],c=u?u[uM]&&u[uM].value:void 0,f=n===aM,h=l.length,d=0;d<h;++d)if(r=l[d],c&&f){if(-1===(o=(i=i||{})[a=r.unit]||0))continue;if(s=lM(e,r),i[a]=s?-1:++o,s&&1===c.size)return!0;if(!s&&o===c.get(a).count)return!1}else if(f^(s=lM(e,r)))return s;return h&&f}),gM),JM("vlSelectionIdTest",(function(t,e,n){const r=this.context.data[t],i=r?r.values.value:[],o=r?r[uM]&&r[uM].value:void 0,a=n===aM,s=cM(e),u=hM(i,s);if(u===i.length)return!1;if(cM(i[u])!==s)return!1;if(o&&a){if(1===o.size)return!0;if(dM(i,s)-u<o.size)return!1}return!0}),gM),JM("vlSelectionResolve",(function(t,e,n,r){for(var i,o,a,s,u,l,c,f,h,d,p,g=this.context.data[t],m=g?g.values.value:[],y={},v={},b={},x=m.length,w=0;w<x;++w){for(s=(i=m[w]).unit,o=i.fields,a=i.values,d=0,p=o.length;d<p;++d)u=o[d],c=(l=y[u.field]||(y[u.field]={}))[s]||(l[s]=[]),b[u.field]=f=u.type.charAt(0),h=pM[f+"_union"],l[s]=h(c,Gt(a[d]));n&&(c=v[s]||(v[s]=[])).push(Gt(a).reduce(((t,e,n)=>(t[o[n].field]=e,t)),{}))}return e=e||sM,Object.keys(y).forEach((t=>{y[t]=Object.keys(y[t]).map((e=>y[t][e])).reduce(((n,r)=>void 0===n?r:pM[b[t]+"_"+e](n,r)))})),m=Object.keys(v),n&&m.length&&(y[r?"vlPoint":"vlMulti"]=e===sM?{or:m.reduce(((t,e)=>(t.push(...v[e]),t)),[])}:{and:m.map((t=>({or:v[t]})))}),y}),gM),JM("vlSelectionTuples",(function(t,e){return t.map((t=>re({values:e.fields.map((e=>(e.getter||(e.getter=ut(e.field)))(t.datum)))},e)))}));const QM=Me(["rule"]),t$=Me(["group","image","rect"]);function e$(t){return(t+"").toLowerCase()}function n$(t,e,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...e.concat(n));return t&&t.functions?r.bind(t.functions):r}var r$={operator:(t,e)=>n$(t,["_"],e.code),parameter:(t,e)=>n$(t,["datum","_"],e.code),event:(t,e)=>n$(t,["event"],e.code),handler:(t,e)=>n$(t,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(e.code,";")),encode:(t,e)=>{const{marktype:n,channels:r}=e;let i="var o=item,datum=o.datum,m=0,$;";for(const t in r){const e="o["+De(t)+"]";i+="$=".concat(r[t].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return i+=function(t,e){let n="";return QM[e]||(t.x2&&(t.x?(t$[e]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),t.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),t.y2&&(t.y?(t$[e]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),t.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",n$(t,["item","_"],i)},codegen:{get(t){const e="[".concat(t.map(De).join("]["),"]"),n=Function("_","return _".concat(e,";"));return n.path=e,n},comparator(t,e){let n;const r=Function("a","b","var u, v; return "+t.map(((t,r)=>{const i=e[r];let o,a;return t.path?(o="a".concat(t.path),a="b".concat(t.path)):((n=n||{})["f"+r]=t,o="this.f".concat(r,"(a)"),a="this.f".concat(r,"(b)")),function(t,e,n,r){return"((u = ".concat(t,") < (v = ").concat(e,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(o,a,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function i$(t,e,n){if(!t||!kt(t))return t;for(let r,i=0,o=o$.length;i<o;++i)if(r=o$[i],se(t,r.key))return r.parse(t,e,n);return t}var o$=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||at("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=be(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,e,n){t.$params&&e.parseParameters(t.$params,n);const r="e:"+t.$expr.code+"_"+t.$name;return e.fn[r]||(e.fn[r]=tt(e.parameterExpression(t.$expr),t.$fields,t.$name))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=ut(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,e){const n=t.$encode,r={};for(const t in n){const i=n[t];r[t]=tt(e.encodeExpression(i.$expr),i.$fields),r[t].output=i.$output}return r}},{key:"$compare",parse:function(t,e){const n="c:"+t.$compare+"_"+t.$order,r=Gt(t.$compare).map((t=>t&&t.$tupleid?ja:t));return e.fn[n]||(e.fn[n]=Yt(r,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){const n=t.$subflow;return function(t,r,i){const o=e.fork().parse(n),a=o.get(n.operators[0].id),s=o.signals.parent;return s&&s.set(i),a.detachSubflow=()=>e.detach(o),a}}},{key:"$tupleid",parse:function(){return ja}}];const a$={skip:!0};function s$(t,e,n,r){return new u$(t,e,n,r)}function u$(t,e,n,r){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=r||r$,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function l$(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function c$(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}u$.prototype=l$.prototype={fork(){const t=new l$(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter((e=>e!==t));const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,r=n.dataflow,i=t.value;if(n.set(t.id,e),"collect"===e$(t.type)&&i&&(i.$ingest?r.ingest(e,i.$ingest,i.$format):i.$request?r.preload(e,i.$request,i.$format):r.pulse(e,r.changeset().insert(i))),t.root&&(n.root=e),t.parent){let i=n.get(t.parent.$ref);i?(r.connect(i,[e]),e.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(t.parent.$ref),r.connect(i,[e]),e.targets().add(i)}))}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(const r in t.data){const i=n.data[r]||(n.data[r]={});t.data[r].forEach((t=>i[t]=e))}},resolve(){return(this.unresolved||[]).forEach((t=>t())),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[e$(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,r,i){this.dataflow.on(e,n,r,i,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){const e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach((t=>e.parseOperator(t))),n.forEach((t=>e.parseOperatorParameters(t))),(t.streams||[]).forEach((t=>e.parseStream(t))),(t.updates||[]).forEach((t=>e.parseUpdate(t))),e.resolve()},parseOperator:function(t){const e=this;"operator"!==e$(t.type)&&t.type?e.transform(t,t.type):e.operator(t,t.update?e.operatorExpression(t.update):null)},parseOperatorParameters:function(t){const e=this;if(t.params){const n=e.get(t.id);n||at("Invalid operator id: "+t.id),e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};const n=this;for(const r in t){const i=t[r];e[r]=_t(i)?i.map((t=>i$(t,n,e))):i$(i,n,e)}return e},parseStream:function(t){var e,n=this,r=null!=t.filter?n.eventExpression(t.filter):void 0,i=null!=t.stream?n.get(t.stream):void 0;t.source?i=n.events(t.source,t.type,r):t.merge&&(i=(e=t.merge.map((t=>n.get(t))))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map((t=>n.get(t))),i=i.between(e[0],e[1])),t.filter&&(i=i.filter(r)),null!=t.throttle&&(i=i.throttle(+t.throttle)),null!=t.debounce&&(i=i.debounce(+t.debounce)),null==i&&at("Invalid stream definition: "+JSON.stringify(t)),t.consume&&i.consume(!0),n.stream(t,i)},parseUpdate:function(t){var e,n=this,r=kt(r=t.source)?r.$ref:r,i=n.get(r),o=t.update,a=void 0;i||at("Source not defined: "+t.source),e=t.target&&t.target.$expr?n.eventExpression(t.target.$expr):n.get(t.target),o&&o.$expr&&(o.$params&&(a=n.parseParameters(o.$params)),o=n.handlerExpression(o.$expr)),n.update(t,i,e,o,a)},getState:function(t){var e=this,n={};if(t.signals){var r=n.signals={};Object.keys(e.signals).forEach((n=>{const i=e.signals[n];t.signals(n,i)&&(r[n]=i.value)}))}if(t.data){var i=n.data={};Object.keys(e.data).forEach((n=>{const r=e.data[n];t.data(n,r)&&(i[n]=r.input.value)}))}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map((e=>e.getState(t)))),n},setState:function(t){var e=this,n=e.dataflow,r=t.data,i=t.signals;Object.keys(i||{}).forEach((t=>{n.update(e.signals[t],i[t],a$)})),Object.keys(r||{}).forEach((t=>{n.pulse(e.data[t].input,n.changeset().remove(dt).insert(r[t]))})),(t.subcontext||[]).forEach(((t,n)=>{const r=e.subcontext[n];r&&r.setState(t)}))}};const f$="default";function h$(t,e){const n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function d$(t,e){var n=t._runtime.data;return se(n,e)||at("Unrecognized data set: "+e),n[e]}function p$(t,e){Ua(e)||at("Second argument to changes must be a changeset.");const n=d$(this,t);return n.modified=!0,this.pulse(n.input,e)}function g$(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function m$(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function y$(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}const v$="view",b$={trap:!1};function x$(t,e,n,r){t._eventListeners.push({type:n,sources:Gt(e),handler:r})}function w$(t,e,n){const r=t._eventConfig&&t._eventConfig[e];return!(!1===r||kt(r)&&!r[n])||(t.warn(`Blocked ${e} ${n} event listener.`),!1)}function _$(t){return t.item}function k$(t){return t.item.mark.source}function A$(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function E$(t,e,n){const r=document.createElement(t);for(const t in e)r.setAttribute(t,e[t]);return null!=n&&(r.textContent=n),r}function D$(t,e,n,r){const i=n.event||"input",o=()=>t.update(e.value);r.signal(n.signal,e.value),e.addEventListener(i,o),x$(r,e,i,o),t.set=t=>{e.value=t,e.dispatchEvent(function(t){return"undefined"!=typeof Event?new Event(t):{type:t}}(i))}}function S$(t,e,n,r){const i=r.signal(n.signal),o=E$("div",{class:"vega-bind"}),a="radio"===n.input?o:o.appendChild(E$("label"));a.appendChild(E$("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(o);let s=C$;switch(n.input){case"checkbox":s=O$;break;case"select":s=F$;break;case"radio":s=M$;break;case"range":s=$$}s(t,a,n,i)}function C$(t,e,n,r){const i=E$("input");for(const t in n)"signal"!==t&&"element"!==t&&i.setAttribute("input"===t?"type":t,n[t]);i.setAttribute("name",n.signal),i.value=r,e.appendChild(i),i.addEventListener("input",(()=>t.update(i.value))),t.elements=[i],t.set=t=>i.value=t}function O$(t,e,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const o=E$("input",i);e.appendChild(o),o.addEventListener("change",(()=>t.update(o.checked))),t.elements=[o],t.set=t=>o.checked=!!t||null}function F$(t,e,n,r){const i=E$("select",{name:n.signal}),o=n.labels||[];n.options.forEach(((t,e)=>{const n={value:t};N$(t,r)&&(n.selected=!0),i.appendChild(E$("option",n,(o[e]||t)+""))})),e.appendChild(i),i.addEventListener("change",(()=>{t.update(n.options[i.selectedIndex])})),t.elements=[i],t.set=t=>{for(let e=0,r=n.options.length;e<r;++e)if(N$(n.options[e],t))return void(i.selectedIndex=e)}}function M$(t,e,n,r){const i=E$("span",{class:"vega-bind-radio"}),o=n.labels||[];e.appendChild(i),t.elements=n.options.map(((e,a)=>{const s={type:"radio",name:n.signal,value:e};N$(e,r)&&(s.checked=!0);const u=E$("input",s);u.addEventListener("change",(()=>t.update(e)));const l=E$("label",{},(o[a]||e)+"");return l.prepend(u),i.appendChild(l),u})),t.set=e=>{const n=t.elements,r=n.length;for(let t=0;t<r;++t)N$(n[t].value,e)&&(n[t].checked=!0)}}function $$(t,e,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,o=n.min||Math.min(0,i,+r)||0,a=n.step||An(o,i,100),s=E$("input",{type:"range",name:n.signal,min:o,max:i,step:a});s.value=r;const u=E$("span",{},+r);e.appendChild(s),e.appendChild(u);const l=()=>{u.textContent=s.value,t.update(+s.value)};s.addEventListener("input",l),s.addEventListener("change",l),t.elements=[s],t.set=t=>{s.value=t,u.textContent=t}}function N$(t,e){return t===e||t+""==e+""}function B$(t,e,n,r,i,o){return(e=e||new r(t.loader())).initialize(n,g$(t),m$(t),y$(t),i,o).background(t.background())}function T$(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function j$(t,e,n){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e&&n)try{e.innerHTML=""}catch(n){e=null,t.error(n)}return e}const I$=t=>+t||0;function z$(t){return kt(t)?{top:I$(t.top),bottom:I$(t.bottom),left:I$(t.left),right:I$(t.right)}:(t=>({top:t,bottom:t,left:t,right:t}))(I$(t))}async function R$(t,e,n,r){const i=Gb(e),o=i&&i.headless;return o||at("Unrecognized renderer type: "+e),await t.runAsync(),B$(t,null,null,o,n,r).renderAsync(t._scenegraph.root)}var P$="padding",L$={skip:!0};function q$(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===P$?r.left+r.right:0)}function U$(t,e){var n=t.autosize(),r=t.padding();return e-(n&&n.contains===P$?r.top+r.bottom:0)}function W$(t,e){return e.modified&&_t(e.input.value)&&t.indexOf("_:vega:_")}function V$(t,e){return!("parent"===t||e instanceof gs.proxy)}function H$(t,e,n,r){const i=t.element();i&&i.setAttribute("title",function(t){return null==t?"":_t(t)?G$(t):kt(t)&&!pe(t)?(e=t,Object.keys(e).map((t=>{const n=e[t];return t+": "+(_t(n)?G$(n):X$(n))})).join("\n")):t+"";var e}(r))}function G$(t){return"["+t.map(X$).join(", ")+"]"}function X$(t){return _t(t)?"[]":kt(t)&&!pe(t)?"{}":t}function K$(t,e){const n=this;if(e=e||{},hs.call(n),e.loader&&n.loader(e.loader),e.logger&&n.logger(e.logger),null!=e.logLevel&&n.logLevel(e.logLevel),e.locale||t.locale){const r=re({},t.locale,e.locale);n.locale(Da(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=e.renderer||Vb.Canvas,n._scenegraph=new Sv;const r=n._scenegraph.root;n._renderer=null,n._tooltip=e.tooltip||H$,n._redraw=!0,n._handler=(new Qv).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(t){const e=re({defaults:{}},t),n=(t,e)=>{e.forEach((e=>{_t(t[e])&&(t[e]=Me(t[e]))}))};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(t,e,n){return s$(t,gs,VM,n).parse(e)}(n,t,e.expr);n._runtime=i,n._signals=i.signals,n._bind=(t.bindings||[]).map((t=>({state:null,param:re({},t)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=q$(n,n._width),n._viewHeight=U$(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(t){var e=t._signals,n=e.width,r=e.height,i=e.padding;function o(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(e=>{t._width=e.size,t._viewWidth=q$(t,e.size),o()}),{size:n}),t._resizeHeight=t.add(null,(e=>{t._height=e.size,t._viewHeight=U$(t,e.size),o()}),{size:r});const a=t.add(null,o,{pad:i});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=r.rank+1,a.rank=i.rank+1}(n),function(t){t.add(null,(e=>(t._background=e.bg,t._resize=1,e.bg)),{bg:t._signals.background})}(n),function(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:f$,item:null}));t.on(t.events("view","mousemove"),e,((t,n)=>{const r=e.value,i=r?ve(r)?r:r.user:f$,o=n.item&&n.item.cursor||null;return r&&i===r.user&&o==r.item?r:{user:i,item:o}})),t.add(null,(function(e){let n=e.cursor,r=this.value;return ve(n)||(r=n.item,n=n.user),h$(t,n&&n!==f$?n:r||n),r}),{cursor:e})}(n),n.description(t.description),e.hover&&n.hover(),e.container&&n.initialize(e.container,e.bind)}function Y$(t,e){return se(t._signals,e)?t._signals[e]:at("Unrecognized signal name: "+De(e))}function J$(t,e){const n=(t._targets||[]).filter((t=>t._update&&t._update.handler===e));return n.length?n[0]:null}function Z$(t,e,n,r){let i=J$(n,r);return i||(i=T$(t,(()=>r(e,n.value))),i.handler=r,t.on(n,null,i)),t}function Q$(t,e,n){const r=J$(e,n);return r&&e._targets.remove(r),t}fe(K$,hs,{async evaluate(t,e,n){if(await hs.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,i=y$(r=this),o=g$(r),a=m$(r),r._renderer.background(r.background()),r._renderer.resize(o,a,i),r._handler.origin(i),r._resizeListeners.forEach((t=>{try{t(o,a)}catch(t){r.error(t)}}))),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(t){this.error(t)}var r,i,o,a;return n&&$a(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=null!=t?t+"":null;return e!==this._desc&&c$(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const r=Y$(this,t);return 1===arguments.length?r.value:this.update(r,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",z$(t)):z$(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(Gb(t)||at("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(hs.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Y$(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(t,e,n,r,i,o){this.runAfter((a=>{let s=0;a._autosize=0,a.width()!==n&&(s=1,a.signal("width",n,L$),a._resizeWidth.skip(!0)),a.height()!==r&&(s=1,a.signal("height",r,L$),a._resizeHeight.skip(!0)),a._viewWidth!==t&&(a._resize=1,a._viewWidth=t),a._viewHeight!==e&&(a._resize=1,a._viewHeight=e),a._origin[0]===i[0]&&a._origin[1]===i[1]||(a._resize=1,a._origin=i),s&&a.run("enter"),o&&a.runAfter((t=>t.resize()))}),!1,1)},addEventListener(t,e,n){let r=e;return n&&!1===n.trap||(r=T$(this,e),r.raw=e),this._handler.on(t,r),this},removeEventListener(t,e){for(var n,r,i=this._handler.handlers(t),o=i.length;--o>=0;)if(r=i[o].type,n=i[o].handler,t===r&&(e===n||e===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(t){const e=this._resizeListeners;return e.indexOf(t)<0&&e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return Z$(this,t,Y$(this,t),e)},removeSignalListener(t,e){return Q$(this,Y$(this,t),e)},addDataListener(t,e){return Z$(this,t,d$(this,t).values,e)},removeDataListener(t,e){return Q$(this,d$(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=h$(this,null);this._globalCursor=!!t,e&&h$(this,e)}return this}return this._globalCursor},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:function(t,e){this._timers.push(function(t,e,n){var r=new QE,i=e;return null==e?(r.restart(t,e,n),r):(r._restart=r.restart,r.restart=function(t,e,n){e=+e,n=null==n?JE():+n,r._restart((function o(a){a+=i,r._restart(o,i+=e,n),t(a)}),e,n)},r.restart(t,e,n),r)}((function(e){t({timestamp:Date.now(),elapsed:e})}),e))},events:function(t,e,n){var r,i=this,o=new Za(n),a=function(n,r){i.runAsync(null,(()=>{t===v$&&function(t,e){var n=t._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[e]:i?!i[e]:t.preventDefault()))}(i,e)&&n.preventDefault(),o.receive(function(t,e,n){var r,i,o=t._renderer,a=o&&o.canvas();return a&&(i=y$(t),(r=Bv(e.changedTouches?e.changedTouches[0]:e,a))[0]-=i[0],r[1]-=i[1]),e.dataflow=t,e.item=n,e.vega=function(t,e,n){const r=e?"group"===e.mark.marktype?e:e.mark.group:null;function i(t){var n,i=r;if(t)for(n=e;n;n=n.mark.group)if(n.mark.name===t){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function o(t){if(!t)return n;ve(t)&&(t=i(t));const e=n.slice();for(;t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:ee(t),item:ee(e||{}),group:i,xy:o,x:t=>o(t)[0],y:t=>o(t)[1]}}(t,n,r),e}(i,n,r))}))};if("timer"===t)w$(i,"timer",e)&&i.timer(a,e);else if(t===v$)w$(i,"view",e)&&i.addEventListener(e,a,b$);else if("window"===t?w$(i,"window",e)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&w$(i,"selector",e)&&(r=document.querySelectorAll(t)),r){for(var s=0,u=r.length;s<u;++s)r[s].addEventListener(e,a);x$(i,r,e,a)}else i.warn("Can not resolve event source: "+t);return o},finalize:function(){var t,e,n,r=this._tooltip,i=this._timers,o=this._eventListeners;for(t=i.length;--t>=0;)i[t].stop();for(t=o.length;--t>=0;)for(e=(n=o[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","mouseover",_$),k$,A$(t)),this.on(this.events("view","mouseout",_$),k$,A$(e)),this},data:function(t,e){return arguments.length<2?d$(this,t).values.value:p$.call(this,t,Wa().remove(dt).insert(e))},change:p$,insert:function(t,e){return p$.call(this,t,Wa().insert(e))},remove:function(t,e){return p$.call(this,t,Wa().remove(e))},scale:function(t){var e=this._runtime.scales;return se(e,t)||at("Unrecognized scale or projection: "+t),e[t].value},initialize:function(t,e){const n=this,r=n._renderType,i=n._eventConfig.bind,o=Gb(r);t=n._el=t?j$(n,t,!0):null,function(t){const e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),c$(e,t.description()))}(n),o||n.error("Unrecognized renderer type: "+r);const a=o.handler||Qv,s=t?o.renderer:o.headless;return n._renderer=s?B$(n,n._renderer,t,s):null,n._handler=function(t,e,n,r){const i=new r(t.loader(),T$(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,y$(t),t);return e&&e.handlers().forEach((t=>{i.on(t.type,t.handler)})),i}(n,n._handler,t,a),n._redraw=!0,t&&"none"!==i&&(e=e?n._elBind=j$(n,e,!0):t.appendChild(E$("form",{class:"vega-bindings"})),n._bind.forEach((t=>{t.param.element&&"container"!==i&&(t.element=j$(n,t.param.element,!!t.param.input))})),n._bind.forEach((t=>{!function(t,e,n){if(!e)return;const r=n.param;let i=n.state;i||(i=n.state={elements:null,active:!1,set:null,update:e=>{e!=t.signal(r.signal)&&t.runAsync(null,(()=>{i.source=!0,t.signal(r.signal,e)}))}},r.debounce&&(i.update=ne(r.debounce,i.update))),(null==r.input&&r.element?D$:S$)(i,e,r,t),i.active||(t.on(t._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(t.signal(r.signal))})),i.active=!0)}(n,t.element||e,t)}))),n},toImageURL:async function(t,e){t!==Vb.Canvas&&t!==Vb.SVG&&t!==Vb.PNG&&at("Unrecognized image type: "+t);const n=await R$(this,t,e);return t===Vb.SVG?function(t,e){const n=new Blob([t],{type:"image/svg+xml"});return window.URL.createObjectURL(n)}(n.svg()):n.canvas().toDataURL("image/png")},toCanvas:async function(t,e){return(await R$(this,Vb.Canvas,t,e)).canvas()},toSVG:async function(t){return(await R$(this,Vb.SVG,t)).svg()},getState:function(t){return this._runtime.getState(t||{data:W$,signals:V$,recurse:!0})},setState:function(t){return this.runAsync(null,(e=>{e._trigger=!1,e._runtime.setState(t)}),(t=>{t._trigger=!0})),this}});const tN=/[[\]{}]/,eN={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let nN,rN;function iN(t,e,n){return nN=e||"view",rN=n||eN,aN(t.trim()).map(sN)}function oN(t,e,n,r,i){const o=t.length;let a,s=0;for(;e<o;++e){if(a=t[e],!s&&a===n)return e;i&&i.indexOf(a)>=0?--s:r&&r.indexOf(a)>=0&&++s}return e}function aN(t){const e=[],n=t.length;let r=0,i=0;for(;i<n;)i=oN(t,i,",","[{","]}"),e.push(t.substring(r,i).trim()),r=++i;if(0===e.length)throw"Empty event selector: "+t;return e}function sN(t){return"["===t[0]?function(t){const e=t.length;let n,r=1;if(r=oN(t,r,"]","[","]"),r===e)throw"Empty between selector: "+t;if(n=aN(t.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+t;if(">"!==(t=t.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+t;n=n.map(sN);const i=sN(t.slice(1).trim());return i.between?{between:n,stream:i}:(i.between=n,i)}(t):function(t){const e={source:nN},n=[];let r,i,o=[0,0],a=0,s=0,u=t.length,l=0;if("}"===t[u-1]){if(l=t.lastIndexOf("{"),!(l>=0))throw"Unmatched right brace: "+t;try{o=function(t){const e=t.split(",");if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!=n)throw t;return n}))}(t.substring(l+1,u-1))}catch(e){throw"Invalid throttle specification: "+t}u=(t=t.slice(0,l).trim()).length,l=0}if(!u)throw t;if("@"===t[0]&&(a=++l),r=oN(t,l,":"),r<u&&(n.push(t.substring(s,r).trim()),s=l=++r),l=oN(t,l,"["),l===u)n.push(t.substring(s,u).trim());else if(n.push(t.substring(s,l).trim()),i=[],s=++l,s===u)throw"Unmatched left bracket: "+t;for(;l<u;){if(l=oN(t,l,"]"),l===u)throw"Unmatched left bracket: "+t;if(i.push(t.substring(s,l).trim()),l<u-1&&"["!==t[++l])throw"Expected left bracket: "+t;s=++l}if(!(u=n.length)||tN.test(n[u-1]))throw"Invalid event selector: "+t;var c;return u>1?(e.type=n[1],a?e.markname=n[0].slice(1):(c=n[0],rN[c]?e.marktype=n[0]:e.source=n[0])):e.type=n[0],"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1)),null!=i&&(e.filter=i),o[0]&&(e.throttle=o[0]),o[1]&&(e.debounce=o[1]),e}(t)}function uN(t){return kt(t)?t:{type:t||"pad"}}const lN=t=>+t||0;function cN(t){return kt(t)?t.signal?t:{top:lN(t.top),bottom:lN(t.bottom),left:lN(t.left),right:lN(t.right)}:{top:e=lN(t),bottom:e,left:e,right:e};var e}const fN=t=>kt(t)&&!_t(t)?re({},t):{value:t};function hN(t,e,n,r){return null!=n?(kt(n)&&!_t(n)||_t(n)&&n.length&&kt(n[0])?t.update[e]=n:t[r||"enter"][e]={value:n},1):0}function dN(t,e,n){for(const n in e)hN(t,n,e[n]);for(const e in n)hN(t,e,n[e],"update")}function pN(t,e,n){for(const r in e)n&&se(n,r)||(t[r]=re(t[r]||{},e[r]));return t}function gN(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const mN="mark",yN="frame",vN="scope",bN="legend-label";function xN(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const wN=t=>ve(t)?De(t):t.signal?"(".concat(t.signal,")"):EN(t);function _N(t){if(null!=t.gradient)return function(t){const e=[t.start,t.stop,t.count].map((t=>null==t?null:De(t)));for(;e.length&&null==Ct(e);)e.pop();return e.unshift(wN(t.gradient)),"gradient(".concat(e.join(","),")")}(t);let e=t.signal?"(".concat(t.signal,")"):t.color?function(t){return t.c?kN("hcl",t.h,t.c,t.l):t.h||t.s?kN("hsl",t.h,t.s,t.l):t.l||t.a?kN("lab",t.l,t.a,t.b):t.r||t.g||t.b?kN("rgb",t.r,t.g,t.b):null}(t.color):null!=t.field?EN(t.field):void 0!==t.value?De(t.value):void 0;return null!=t.scale&&(e=function(t,e){const n=wN(t.scale);return null!=t.range?e="lerp(_range(".concat(n,"), ").concat(+t.range,")"):(void 0!==e&&(e="_scale(".concat(n,", ").concat(e,")")),t.band&&(e=(e?e+"+":"")+"_bandwidth(".concat(n,")")+(1==+t.band?"":"*"+AN(t.band)),t.extra&&(e="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(e,")"))),null==e&&(e="0")),e}(t,e)),void 0===e&&(e=null),null!=t.exponent&&(e="pow(".concat(e,",").concat(AN(t.exponent),")")),null!=t.mult&&(e+="*".concat(AN(t.mult))),null!=t.offset&&(e+="+".concat(AN(t.offset))),t.round&&(e="round(".concat(e,")")),e}const kN=(t,e,n,r)=>"(".concat(t,"(").concat([e,n,r].map(_N).join(","),")+'')");function AN(t){return kt(t)?"("+_N(t)+")":t}function EN(t){return DN(kt(t)?t:{datum:t})}function DN(t){let e,n,r;if(t.signal)e="datum",r=t.signal;else if(t.group||t.parent){for(n=Math.max(1,t.level||1),e="item";n-- >0;)e+=".mark.group";t.parent?(r=t.parent,e+=".datum"):r=t.group}else t.datum?(e="datum",r=t.datum):at("Invalid field reference: "+De(t));return t.signal||(r=ve(r)?st(r).map(De).join("]["):DN(r)),e+"["+r+"]"}function SN(t,e,n,r,i,o){const a={};(o=o||{}).encoders={$encode:a},t=function(t,e,n,r,i){const o={},a={};let s,u,l,c;for(u in u="lineBreak","text"!==e||null==i[u]||gN(u,t)||xN(o,u,i[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===yN?i.group:n===mN?re({},i.mark,i[e]):null,c)l=gN(u,t)||("fill"===u||"stroke"===u)&&(gN("fill",t)||gN("stroke",t)),l||xN(o,u,c[u]);for(u in Gt(r).forEach((e=>{const n=i.style&&i.style[e];for(const e in n)gN(e,t)||xN(o,e,n[e])})),t=re({},t),o)c=o[u],c.signal?(s=s||{})[u]=c:a[u]=c;return t.enter=re(a,t.enter),s&&(t.update=re(s,t.update)),t}(t,e,n,r,i.config);for(const n in t)a[n]=CN(t[n],e,o,i);return o}function CN(t,e,n,r){const i={},o={};for(const e in t)null!=t[e]&&(i[e]=ON((a=t[e],_t(a)?function(t){let e="";return t.forEach((t=>{const n=_N(t);e+=t.test?"(".concat(t.test,")?").concat(n,":"):n})),":"===Ct(e)&&(e+="null"),e}(a):_N(a)),r,n,o));var a;return{$expr:{marktype:e,channels:i},$fields:Object.keys(o),$output:Object.keys(t)}}function ON(t,e,n,r){const i=ZM(t,e);return i.$fields.forEach((t=>r[t]=1)),re(n,i.$params),i.$expr}const FN=["value","update","init","react","bind"];function MN(t,e){at(t+' for "outer" push: '+De(e))}function $N(t,e){const n=t.name;if("outer"===t.push)e.signals[n]||MN("No prior signal definition",n),FN.forEach((e=>{void 0!==t[e]&&MN("Invalid property ",e)}));else{const r=e.addSignal(n,t.value);!1===t.react&&(r.react=!1),t.bind&&e.addBinding(n,t.bind)}}function NN(t,e,n,r){this.id=-1,this.type=t,this.value=e,this.params=n,r&&(this.parent=r)}function BN(t,e,n,r){return new NN(t,e,n,r)}function TN(t,e){return BN("operator",t,e)}function jN(t){const e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function IN(t,e){return e?{$field:t,$name:e}:{$field:t}}const zN=IN("key");function RN(t,e){return{$compare:t,$order:e}}function PN(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const LN="scope",qN="view";function UN(t){return t&&t.signal}function WN(t){if(UN(t))return!0;if(kt(t))for(const e in t)if(WN(t[e]))return!0;return!1}function VN(t,e){return null!=t?t:e}function HN(t){return t&&t.signal||t}const GN="timer";function XN(t,e){return(t.merge?KN:t.stream?YN:t.type?JN:at("Invalid stream specification: "+De(t)))(t,e)}function KN(t,e){const n=ZN({merge:t.merge.map((t=>XN(t,e)))},t,e);return e.addStream(n).id}function YN(t,e){const n=ZN({stream:XN(t.stream,e)},t,e);return e.addStream(n).id}function JN(t,e){let n;var r;t.type===GN?(n=e.event(GN,t.throttle),t={between:t.between,filter:t.filter}):n=e.event((r=t.source)===LN?qN:r||qN,t.type);const i=ZN({stream:n},t,e);return 1===Object.keys(i).length?n:e.addStream(i).id}function ZN(t,e,n){let r=e.between;return r&&(2!==r.length&&at('Stream "between" parameter must have 2 entries: '+De(e)),t.between=[XN(r[0],n),XN(r[1],n)]),r=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&r.push(function(t,e,n){const r="event.item";return r+(t&&"*"!==t?"&&"+r+".mark.marktype==='"+t+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(e?"&&"+r+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),e.source===LN&&r.push("inScope(event.item)"),r.length&&(t.filter=ZM("("+r.join(")&&(")+")",n).$expr),null!=(r=e.throttle)&&(t.throttle=+r),null!=(r=e.debounce)&&(t.debounce=+r),e.consume&&(t.consume=!0),t}const QN={code:"_.$value",ast:{type:"Identifier",value:"value"}};function tB(t){return{signal:"["+t.map((t=>t.scale?'scale("'+t.scale+'")':t.signal))+"]"}}const eB=t=>(e,n,r)=>BN(t,n,e||void 0,r),nB=eB("aggregate"),rB=eB("axisticks"),iB=eB("bound"),oB=eB("collect"),aB=eB("compare"),sB=eB("datajoin"),uB=eB("encode"),lB=eB("expression"),cB=eB("facet"),fB=eB("field"),hB=eB("key"),dB=eB("legendentries"),pB=eB("load"),gB=eB("mark"),mB=eB("multiextent"),yB=eB("multivalues"),vB=eB("overlap"),bB=eB("params"),xB=eB("prefacet"),wB=eB("projection"),_B=eB("proxy"),kB=eB("relay"),AB=eB("render"),EB=eB("scale"),DB=eB("sieve"),SB=eB("sortitems"),CB=eB("viewlayout"),OB=eB("values");let FB=0;const MB={min:"min",max:"max",count:"sum"};function $B(t,e){const n=e.getScale(t.name).params;let r;for(r in n.domain=jB(t.domain,t,e),null!=t.range&&(n.range=WB(t,e,n)),null!=t.interpolate&&function(t,e){e.interpolate=NB(t.type||t),null!=t.gamma&&(e.interpolateGamma=NB(t.gamma))}(t.interpolate,n),null!=t.nice&&(n.nice=function(t){return kt(t)?{interval:NB(t.interval),step:NB(t.step)}:NB(t)}(t.nice)),null!=t.bins&&(n.bins=function(t,e){return t.signal||_t(t)?BB(t,e):e.objectProperty(t)}(t.bins,e)),t)se(n,r)||"name"===r||(n[r]=NB(t[r],e))}function NB(t,e){return kt(t)?t.signal?e.signalRef(t.signal):at("Unsupported object: "+De(t)):t}function BB(t,e){return t.signal?e.signalRef(t.signal):t.map((t=>NB(t,e)))}function TB(t){at("Can not find data set: "+De(t))}function jB(t,e,n){if(t)return t.signal?n.signalRef(t.signal):(_t(t)?IB:t.fields?RB:zB)(t,e,n);null==e.domainMin&&null==e.domainMax||at("No scale domain defined for domainMin/domainMax to override.")}function IB(t,e,n){return t.map((t=>NB(t,n)))}function zB(t,e,n){const r=n.getData(t.data);return r||TB(t.data),Hp(e.type)?r.valuesRef(n,t.field,LB(t.sort,!1)):Yp(e.type)?r.domainRef(n,t.field):r.extentRef(n,t.field)}function RB(t,e,n){const r=t.data,i=t.fields.reduce(((t,e)=>(e=ve(e)?{data:r,field:e}:_t(e)||e.signal?function(t,e){const n="_:vega:_"+FB++,r=oB({});if(_t(t))r.value={$ingest:t};else if(t.signal){const i="setdata("+De(n)+","+t.signal+")";r.params.input=e.signalRef(i)}return e.addDataPipeline(n,[r,DB({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t)),[]);return(Hp(e.type)?PB:Yp(e.type)?qB:UB)(t,n,i)}function PB(t,e,n){const r=LB(t.sort,!0);let i,o;const a=n.map((t=>{const n=e.getData(t.data);return n||TB(t.data),n.countsRef(e,t.field,r)})),s={groupby:zN,pulse:a};r&&(i=r.op||"count",o=r.field?PN(i,r.field):"count",s.ops=[MB[i]],s.fields=[e.fieldRef(o)],s.as=[o]),i=e.add(nB(s));const u=e.add(oB({pulse:jN(i)}));return o=e.add(OB({field:zN,sort:e.sortRef(r),pulse:jN(u)})),jN(o)}function LB(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!MB[t.op]&&at("Multiple domain scales can not be sorted using "+t.op):at("No field provided for sort aggregate op: "+t.op):kt(t)?t.field="key":t={field:"key"}),t}function qB(t,e,n){const r=n.map((t=>{const n=e.getData(t.data);return n||TB(t.data),n.domainRef(e,t.field)}));return jN(e.add(yB({values:r})))}function UB(t,e,n){const r=n.map((t=>{const n=e.getData(t.data);return n||TB(t.data),n.extentRef(e,t.field)}));return jN(e.add(mB({extents:r})))}function WB(t,e,n){const r=e.config.range;let i=t.range;if(i.signal)return e.signalRef(i.signal);if(ve(i)){if(r&&se(r,i))return WB(t=re({},t,{range:r[i]}),e,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=Hp(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]:at("Unrecognized scale range value: "+De(i))}else{if(i.scheme)return n.scheme=_t(i.scheme)?BB(i.scheme,e):NB(i.scheme,e),i.extent&&(n.schemeExtent=BB(i.extent,e)),void(i.count&&(n.schemeCount=NB(i.count,e)));if(i.step)return void(n.rangeStep=NB(i.step,e));if(Hp(t.type)&&!_t(i))return jB(i,t,e);_t(i)||at("Unsupported range type: "+De(i))}return i.map((t=>(_t(t)?BB:NB)(t,e)))}function VB(t,e,n){return _t(t)?t.map((t=>VB(t,e,n))):kt(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:at("Unsupported parameter object: "+De(t)):t}const HB="top",GB="left",XB="right",KB="bottom",YB="center",JB="index",ZB="label",QB="perc",tT="value",eT="guide-label",nT="guide-title",rT="symbol",iT="gradient",oT="discrete",aT="size",sT=[aT,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],uT={name:1,style:1,interactive:1},lT={value:0},cT={value:1},fT="group",hT="rect",dT="rule",pT="text";function gT(t){return t.type=fT,t.interactive=t.interactive||!1,t}function mT(t,e){const n=(n,r)=>VN(t[n],VN(e[n],r));return n.isVertical=n=>"vertical"===VN(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>VN(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>VN(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>VN(t.columns,VN(e.columns,+n.isVertical(!0))),n}function yT(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function vT(t,e,n){return"item.anchor === '".concat("start","' ? ").concat(t," : item.anchor === '").concat("end","' ? ").concat(e," : ").concat(n)}const bT=vT(De(GB),De(XB),De(YB));function xT(t,e){return e?t?kt(t)?Object.assign({},t,{offset:xT(t.offset,e)}):{value:t,offset:e}:e:t}function wT(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=pN(t.encode,e,uT)):t.interactive=!1,t}function _T(t,e,n,r){const i=mT(t,n),o=i.isVertical(),a=i.gradientThickness(),s=i.gradientLength();let u,l,c,f,h;o?(l=[0,1],c=[0,0],f=a,h=s):(l=[0,0],c=[1,0],f=s,h=a);const d={enter:u={opacity:lT,x:lT,y:lT,width:fN(f),height:fN(h)},update:re({},u,{opacity:cT,fill:{gradient:e,start:l,stop:c}}),exit:{opacity:lT}};return dN(d,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),wT({type:hT,role:"legend-gradient",encode:d},r)}function kT(t,e,n,r,i){const o=mT(t,n),a=o.isVertical(),s=o.gradientThickness(),u=o.gradientLength();let l,c,f,h,d="";a?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:lT,fill:{scale:e,field:tT}};p[l]={signal:d+"datum."+QB,mult:u},p[c]=lT,p[f]={signal:d+"datum.perc2",mult:u},p[h]=fN(s);const g={enter:p,update:re({},p,{opacity:cT}),exit:{opacity:lT}};return dN(g,{stroke:o("gradientStrokeColor"),strokeWidth:o("gradientStrokeWidth")},{opacity:o("gradientOpacity")}),wT({type:hT,role:"legend-band",key:tT,from:i,encode:g},r)}const AT="datum.".concat(QB,'<=0?"').concat(GB,'":datum.').concat(QB,'>=1?"').concat(XB,'":"').concat(YB,'"'),ET="datum.".concat(QB,'<=0?"').concat(KB,'":datum.').concat(QB,'>=1?"').concat(HB,'":"').concat("middle",'"');function DT(t,e,n,r){const i=mT(t,e),o=i.isVertical(),a=fN(i.gradientThickness()),s=i.gradientLength();let u,l,c,f,h=i("labelOverlap"),d="";const p={enter:u={opacity:lT},update:l={opacity:cT,text:{field:ZB}},exit:{opacity:lT}};return dN(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:VN(t.labelLimit,e.gradientLabelLimit)}),o?(u.align={value:"left"},u.baseline=l.baseline={signal:ET},c="y",f="x",d="1-"):(u.align=l.align={signal:AT},u.baseline={value:"top"},c="x",f="y"),u[c]=l[c]={signal:d+"datum."+QB,mult:s},u[f]=l[f]=a,a.offset=VN(t.labelOffset,e.gradientLabelOffset)||0,h=h?{separation:i("labelSeparation"),method:h,order:"datum.index"}:void 0,wT({type:pT,role:bN,style:eT,key:tT,from:r,encode:p,overlap:h},n)}function ST(t,e,n,r,i){const o=mT(t,e),a=n.entries,s=!(!a||!a.interactive),u=a?a.name:void 0,l=o("clipHeight"),c=o("symbolOffset"),f={data:"value"},h="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(aT),d=l?fN(l):{field:aT},p="datum.".concat(JB),g="max(1, ".concat(i,")");let m,y,v,b,x;d.mult=.5,m={enter:y={opacity:lT,x:{signal:h,mult:.5,offset:c},y:d},update:v={opacity:cT,x:y.x,y:y.y},exit:{opacity:lT}};let w=null,_=null;t.fill||(w=e.symbolBaseFillColor,_=e.symbolBaseStrokeColor),dN(m,{fill:o("symbolFillColor",w),shape:o("symbolType"),size:o("symbolSize"),stroke:o("symbolStrokeColor",_),strokeDash:o("symbolDash"),strokeDashOffset:o("symbolDashOffset"),strokeWidth:o("symbolStrokeWidth")},{opacity:o("symbolOpacity")}),sT.forEach((e=>{t[e]&&(v[e]=y[e]={scale:t[e],field:tT})}));const k=wT({type:"symbol",role:"legend-symbol",key:tT,from:f,clip:!!l||void 0,encode:m},n.symbols),A=fN(c);A.offset=o("labelOffset"),m={enter:y={opacity:lT,x:{signal:h,offset:A},y:d},update:v={opacity:cT,text:{field:ZB},x:y.x,y:y.y},exit:{opacity:lT}},dN(m,{align:o("labelAlign"),baseline:o("labelBaseline"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontStyle:o("labelFontStyle"),fontWeight:o("labelFontWeight"),limit:o("labelLimit")});const E=wT({type:pT,role:bN,style:eT,key:tT,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:lT,height:l?fN(l):lT,opacity:lT},exit:{opacity:lT},update:v={opacity:cT,row:{signal:null},column:{signal:null}}},o.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(g,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(g,")"),v.column.signal="".concat(p," % ").concat(g),x={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),gT({role:vN,from:r={facet:{data:r,name:"value",groupby:JB}},encode:pN(m,a,uT),marks:[k,E],name:u,interactive:s,sort:x})}const CT='item.orient === "left"',OT='item.orient === "right"',FT="(".concat(CT," || ").concat(OT,")"),MT="datum.vgrad && ".concat(FT),$T=vT('"top"','"bottom"','"middle"'),NT=vT('"right"','"left"','"center"'),BT="datum.vgrad && ".concat(OT," ? (").concat(NT,") : (").concat(FT," && !(datum.vgrad && ").concat(CT,')) ? "left" : ').concat(bT),TT="item._anchor || (".concat(FT,' ? "middle" : "start")'),jT="".concat(MT," ? (").concat(CT," ? -90 : 90) : 0"),IT="".concat(FT," ? (datum.vgrad ? (").concat(OT,' ? "bottom" : "top") : ').concat($T,') : "top"');function zT(t,e){let n;return kt(t)&&(t.signal?n=t.signal:t.path?n="pathShape("+RT(t.path)+")":t.sphere&&(n="geoShape("+RT(t.sphere)+', {type: "Sphere"})')),n?e.signalRef(n):!!t}function RT(t){return kt(t)&&t.signal?t.signal:De(t)}function PT(t){const e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?t.type===fT?vN:e||mN:e}function LT(t){return{marktype:t.type,name:t.name||void 0,role:t.role||PT(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description}}function qT(t,e){return t&&t.signal?e.signalRef(t.signal):!1!==t}function UT(t,e){const n=ms(t.type);n||at("Unrecognized transform type: "+De(t.type));const r=BN(n.type.toLowerCase(),null,WT(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(r)),r.metadata=n.metadata||{},r}function WT(t,e,n){const r={},i=t.params.length;for(let o=0;o<i;++o){const i=t.params[o];r[i.name]=VT(i,e,n)}return r}function VT(t,e,n){const r=t.type,i=e[t.name];return"index"===r?function(t,e,n){return ve(e.from)||at('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key)}(0,e,n):void 0!==i?"param"===r?function(t,e,n){const r=e[t.name];return t.array?(_t(r)||at("Expected an array of sub-parameters. Instead: "+De(r)),r.map((e=>GT(t,e,n)))):GT(t,r,n)}(t,e,n):"projection"===r?n.projectionRef(e[t.name]):t.array&&!UN(i)?i.map((e=>HT(t,e,n))):HT(t,i,n):void(t.required&&at("Missing required "+De(e.type)+" parameter: "+De(t.name)))}function HT(t,e,n){const r=t.type;if(UN(e))return JT(r)?at("Expression references can not be signals."):ZT(r)?n.fieldRef(e):QT(r)?n.compareRef(e):n.signalRef(e.signal);{const i=t.expr||ZT(r);return i&&XT(e)?n.exprRef(e.expr,e.as):i&&KT(e)?IN(e.field,e.as):JT(r)?ZM(e,n):YT(r)?jN(n.getData(e).values):ZT(r)?IN(e):QT(r)?n.compareRef(e):e}}function GT(t,e,n){const r=t.params.length;let i;for(let n=0;n<r;++n){i=t.params[n];for(const t in i.key)if(i.key[t]!==e[t]){i=null;break}if(i)break}i||at("Unsupported parameter: "+De(e));const o=re(WT(i,e,n),i.key);return jN(n.add(bB(o)))}const XT=t=>t&&t.expr,KT=t=>t&&t.field,YT=t=>"data"===t,JT=t=>"expr"===t,ZT=t=>"field"===t,QT=t=>"compare"===t;function tj(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:jN(e.getData(t.data).output)}function ej(t,e,n,r,i){this.scope=t,this.input=e,this.output=n,this.values=r,this.aggregate=i,this.index={}}function nj(t){return ve(t)?t:null}function rj(t,e,n){const r=PN(n.op,n.field);let i;if(e.ops){for(let t=0,n=e.as.length;t<n;++t)if(e.as[t]===r)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((i=n.op.signal)?t.signalRef(i):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(r))}function ij(t,e,n,r,i,o,a){const s=e[n]||(e[n]={}),u=function(t){return kt(t)?("descending"===t.order?"-":"+")+PN(t.op,t.field):""}(o);let l,c,f=nj(i);if(null!=f&&(t=e.scope,f+=u?"|"+u:"",l=s[f]),!l){const n=o?{field:zN,pulse:e.countsRef(t,i,o)}:{field:t.fieldRef(i),pulse:jN(e.output)};u&&(n.sort=t.sortRef(o)),c=t.add(BN(r,void 0,n)),a&&(e.index[i]=c),l=jN(c),null!=f&&(s[f]=l)}return l}function oj(t,e,n){const r=t.remove,i=t.insert,o=t.toggle,a=t.modify,s=t.values,u=e.add(TN()),l=ZM("if("+t.trigger+',modify("'+n+'",'+[i,r,o,a,s].map((t=>null==t?"null":t)).join(",")+"),0)",e);u.update=l.$expr,u.params=l.$params}function aj(t,e){const n=PT(t),r=t.type===fT,i=t.from&&t.from.facet,o=t.overlap;let a,s,u,l,c,f,h,d=t.layout||n===vN||n===yN;const p=n===mN||d||i,g=function(t,e,n){let r,i,o,a,s;return t?(r=t.facet)&&(e||at("Only group marks can be faceted."),null!=r.field?a=s=tj(r,n):(t.data?s=jN(n.getData(t.data).aggregate):(o=UT(re({type:"aggregate",groupby:Gt(r.groupby)},r.aggregate),n),o.params.key=n.keyRef(r.groupby),o.params.pulse=tj(r,n),a=s=jN(n.add(o))),i=n.keyRef(r.groupby,!0))):a=jN(n.add(oB(null,[{}]))),a||(a=tj(t,n)),{key:i,pulse:a,parent:s}}(t.from,r,e);s=e.add(sB({key:g.key||(t.key?IN(t.key):void 0),pulse:g.pulse,clean:!r}));const m=jN(s);s=u=e.add(oB({pulse:m})),s=e.add(gB({markdef:LT(t),interactive:qT(t.interactive,e),clip:zT(t.clip,e),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:jN(s)}));const y=jN(s);s=l=e.add(uB(SN(t.encode,t.type,n,t.style,e,{mod:!1,pulse:y}))),s.params.parent=e.encode(),t.transform&&t.transform.forEach((t=>{const n=UT(t,e),r=n.metadata;(r.generates||r.changes)&&at("Mark transforms should not generate new data."),r.nomod||(l.params.mod=!0),n.params.pulse=jN(s),e.add(s=n)})),t.sort&&(s=e.add(SB({sort:e.compareRef(t.sort),pulse:jN(s)})));const v=jN(s);(i||d)&&(d=e.add(CB({layout:e.objectProperty(t.layout),legends:e.legends,mark:y,pulse:v})),f=jN(d));const b=e.add(iB({mark:y,pulse:f||v}));h=jN(b),r&&(p&&(a=e.operators,a.pop(),d&&a.pop()),e.pushState(v,f||h,m),i?function(t,e,n){const r=t.from.facet,i=r.name,o=tj(r,e);let a;r.name||at("Facet must have a name: "+De(r)),r.data||at("Facet must reference a data set: "+De(r)),r.field?a=e.add(xB({field:e.fieldRef(r.field),pulse:o})):r.groupby?a=e.add(cB({key:e.keyRef(r.groupby),group:jN(e.proxy(n.parent)),pulse:o})):at("Facet must specify groupby or field: "+De(r));const s=e.fork(),u=s.add(oB()),l=s.add(DB({pulse:jN(u)}));s.addData(i,new ej(s,u,u,l)),s.addSignal("parent",null),a.params.subflow={$subflow:s.parse(t).toRuntime()}}(t,e,g):p?function(t,e,n){const r=e.add(xB({pulse:n.pulse})),i=e.fork();i.add(DB()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(t).toRuntime()}}(t,e,g):e.parse(t),e.popState(),p&&(d&&a.push(d),a.push(b))),o&&(h=function(t,e,n){const r=t.method,i=t.bound,o=t.separation,a={separation:UN(o)?n.signalRef(o.signal):o,method:UN(r)?n.signalRef(r.signal):r,pulse:e};if(t.order&&(a.sort=n.compareRef({field:t.order})),i){const t=i.tolerance;a.boundTolerance=UN(t)?n.signalRef(t.signal):+t,a.boundScale=n.scaleRef(i.scale),a.boundOrient=i.orient}return jN(n.add(vB(a)))}(o,h,e));const x=e.add(AB({pulse:h})),w=e.add(DB({pulse:jN(x)},void 0,e.parent()));null!=t.name&&(c=t.name,e.addData(c,new ej(e,u,x,w)),t.on&&t.on.forEach((t=>{(t.insert||t.remove||t.toggle)&&at("Marks only support modify triggers."),oj(t,e,c)})))}function sj(t,e,n){const r={enter:{},update:{}};return dN(r,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),r}function uj(t,e,n){return e[t]?'scale("'.concat(e[t],'",datum)'):yT(t,n[0].encode)}ej.fromEntries=function(t,e){const n=e.length,r=e[n-1],i=e[n-2];let o=e[0],a=null,s=1;for(o&&"load"===o.type&&(o=e[1]),t.add(e[0]);s<n;++s)e[s].params.pulse=jN(e[s-1]),t.add(e[s]),"aggregate"===e[s].type&&(a=e[s]);return new ej(t,o,i,r,a)},ej.prototype={countsRef(t,e,n){const r=this,i=r.counts||(r.counts={}),o=nj(e);let a,s,u;return null!=o&&(t=r.scope,a=i[o]),a?n&&n.field&&rj(t,a.agg.params,n):(u={groupby:t.fieldRef(e,"key"),pulse:jN(r.output)},n&&n.field&&rj(t,u,n),s=t.add(nB(u)),a=t.add(oB({pulse:jN(s)})),a={agg:s,ref:jN(a)},null!=o&&(i[o]=a)),a.ref},tuplesRef(){return jN(this.values)},extentRef(t,e){return ij(t,this,"extent","extent",e,!1)},domainRef(t,e){return ij(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return ij(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return ij(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return ij(t,this,"indata","tupleindex",e,!0,!0)}};const lj='item.orient==="'.concat(GB,'"?-90:item.orient==="').concat(XB,'"?90:0');function cj(t,e){const n={enter:{},update:{}};return dN(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:bT},angle:{signal:lj},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),pN(n,e,uT)}function fj(t){const e=oB({},t);return e.metadata={source:!0},e}function hj(t,e){return pB({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}const dj=t=>t===KB||t===HB,pj=(t,e,n)=>UN(t)?xj(t.signal,e,n):t===GB||t===HB?e:n,gj=(t,e,n)=>UN(t)?vj(t.signal,e,n):dj(t)?e:n,mj=(t,e,n)=>UN(t)?bj(t.signal,e,n):dj(t)?n:e,yj=(t,e,n)=>UN(t)?wj(t.signal,e,n):t===HB?{value:e}:{value:n},vj=(t,e,n)=>_j("".concat(t," === '").concat(HB,"' || ").concat(t," === '").concat(KB,"'"),e,n),bj=(t,e,n)=>_j("".concat(t," !== '").concat(HB,"' && ").concat(t," !== '").concat(KB,"'"),e,n),xj=(t,e,n)=>Aj("".concat(t," === '").concat(GB,"' || ").concat(t," === '").concat(HB,"'"),e,n),wj=(t,e,n)=>Aj("".concat(t," === '").concat(HB,"'"),e,n),_j=(t,e,n)=>(e=null!=e?fN(e):e,n=null!=n?fN(n):n,kj(e)&&kj(n)?(e=e?e.signal||De(e.value):null,n=n?n.signal||De(n.value):null,{signal:"".concat(t," ? (").concat(e,") : (").concat(n,")")}):[re({test:t},e)].concat(n||[])),kj=t=>null==t||1===Object.keys(t).length,Aj=(t,e,n)=>({signal:"".concat(t," ? (").concat(Dj(e),") : (").concat(Dj(n),")")}),Ej=(t,e,n,r,i)=>({signal:(null!=r?"".concat(t," === '").concat(GB,"' ? (").concat(Dj(r),") : "):"")+(null!=n?"".concat(t," === '").concat(KB,"' ? (").concat(Dj(n),") : "):"")+(null!=i?"".concat(t," === '").concat(XB,"' ? (").concat(Dj(i),") : "):"")+(null!=e?"".concat(t," === '").concat(HB,"' ? (").concat(Dj(e),") : "):"")+"(null)"}),Dj=t=>UN(t)?t.signal:null==t?null:De(t),Sj=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function Cj(t,e,n,r){let i;if(e&&se(e,t))return e[t];if(se(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=t[5].toLowerCase()+t.slice(6)}return r["guide-title"][i]}if(t.startsWith("label")){switch(t){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=t[5].toLowerCase()+t.slice(6)}return r["guide-label"][i]}return null}function Oj(t){const e={};for(const n of t)if(n)for(const t in n)e[t]=1;return Object.keys(e)}function Fj(t,e){return{scale:t.scale,range:e}}function Mj(t,e,n,r,i){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+r+","+i+")"}}function $j(t,e,n,r,i,o){const a=mT(t,e),s=t.orient,u=t.scale,l=pj(s,-1,1),c=HN(a("labelFlush")),f=HN(a("labelFlushOffset")),h=a("labelAlign"),d=a("labelBaseline");let p,g=0===c||!!c;const m=fN(i);m.mult=l,m.offset=fN(a("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:tT,band:.5,offset:xT(o.offset,a("labelOffset"))},v=gj(s,g?Mj(u,c,'"left"','"right"','"center"'):{value:"center"},((t,e,n)=>UN(t)?((t,e,n)=>Aj("".concat(t," === '").concat(XB,"'"),e,n))(t.signal,e,n):t===XB?{value:e}:{value:n})(s,"left","right")),b=gj(s,yj(s,"bottom","top"),g?Mj(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=Mj(u,c,"-(".concat(f,")"),f,0);g=g&&f;const w={opacity:lT,x:gj(s,y,m),y:mj(s,y,m)},_={enter:w,update:p={opacity:cT,text:{field:ZB},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:lT,x:w.x,y:w.y}};dN(_,{dx:!h&&g?gj(s,x):null,dy:!d&&g?mj(s,x):null}),dN(_,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:h,baseline:d});const k=a("labelBound");let A=a("labelOverlap");return A=A||k?{separation:a("labelSeparation"),method:A,order:"datum.index",bound:k?{scale:u,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=Sj(p.align,v)),p.baseline!==b&&(p.baseline=Sj(p.baseline,b)),wT({type:pT,role:"axis-label",style:eT,key:tT,from:r,encode:_,overlap:A},n)}function Nj(t,e){const n=function(t,e){var n,r,i,o=e.config,a=o.style,s=o.axis,u="band"===e.scaleType(t.scale)&&o.axisBand,l=t.orient;if(UN(l)){const t=Oj([o.axisX,o.axisY]),e=Oj([o.axisTop,o.axisBottom,o.axisLeft,o.axisRight]);for(i of(n={},t))n[i]=gj(l,Cj(i,o.axisX,s,a),Cj(i,o.axisY,s,a));for(i of(r={},e))r[i]=Ej(l.signal,Cj(i,o.axisTop,s,a),Cj(i,o.axisBottom,s,a),Cj(i,o.axisLeft,s,a),Cj(i,o.axisRight,s,a))}else n=l===HB||l===KB?o.axisX:o.axisY,r=o["axis"+l[0].toUpperCase()+l.slice(1)];return n||r||u?re({},s,n,r,u):s}(t,e),r=t.encode||{},i=r.axis||{},o=i.name||void 0,a=i.interactive,s=i.style,u=mT(t,n),l=function(t){const e=t("tickBand");let n,r,i=t("tickOffset");return e?e.signal?(n={signal:"(".concat(e.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(e.signal,") === 'extent'")},kt(i)||(i={signal:"(".concat(e.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===e?(n=1,r=!0,i=0):(n=.5,r=!1):(n=t("bandPosition"),r=t("tickExtra")),{extra:r,band:n,offset:i}}(u),c={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=t.title},f=jN(e.add(oB({},[c]))),h=jN(e.add(rB({scale:e.scaleRef(t.scale),extra:e.property(l.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),d=[];let p;return c.grid&&d.push(function(t,e,n,r,i){const o=mT(t,e),a=t.orient,s=t.gridScale,u=pj(a,1,-1),l=function(t,e){if(1===e);else if(kt(t)){let n=t=re({},t);for(;null!=n.mult;){if(!kt(n.mult))return n.mult=UN(e)?{signal:"(".concat(n.mult,") * (").concat(e.signal,")")}:n.mult*e,t;n=n.mult=re({},n.mult)}n.mult=e}else t=UN(e)?{signal:"(".concat(e.signal,") * (").concat(t||0,")")}:e*(t||0);return t}(t.offset,u);let c,f,h;const d={enter:c={opacity:lT},update:h={opacity:cT},exit:f={opacity:lT}};dN(d,{stroke:o("gridColor"),strokeCap:o("gridCap"),strokeDash:o("gridDash"),strokeDashOffset:o("gridDashOffset"),strokeOpacity:o("gridOpacity"),strokeWidth:o("gridWidth")});const p={scale:t.scale,field:tT,band:i.band,extra:i.extra,offset:i.offset,round:o("tickRound")},g=gj(a,{signal:"height"},{signal:"width"}),m=s?{scale:s,range:0,mult:u,offset:l}:{value:0,offset:l},y=s?{scale:s,range:1,mult:u,offset:l}:re(g,{mult:u,offset:l});return c.x=h.x=gj(a,p,m),c.y=h.y=mj(a,p,m),c.x2=h.x2=mj(a,y),c.y2=h.y2=gj(a,y),f.x=gj(a,p),f.y=mj(a,p),wT({type:dT,role:"axis-grid",key:tT,from:r,encode:d},n)}(t,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(function(t,e,n,r,i,o){const a=mT(t,e),s=t.orient,u=pj(s,-1,1);let l,c,f;const h={enter:l={opacity:lT},update:f={opacity:cT},exit:c={opacity:lT}};dN(h,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const d=fN(i);d.mult=u;const p={scale:t.scale,field:tT,band:o.band,extra:o.extra,offset:o.offset,round:a("tickRound")};return f.y=l.y=gj(s,lT,p),f.y2=l.y2=gj(s,d),c.x=gj(s,p),f.x=l.x=mj(s,lT,p),f.x2=l.x2=mj(s,d),c.y=mj(s,p),wT({type:dT,role:"axis-tick",key:tT,from:r,encode:h},n)}(t,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push($j(t,n,r.labels,h,p,l))),c.domain&&d.push(function(t,e,n,r){const i=mT(t,e),o=t.orient;let a,s;const u={enter:a={opacity:lT},update:s={opacity:cT},exit:{opacity:lT}};dN(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=Fj(t,0),c=Fj(t,1);return a.x=s.x=gj(o,l,lT),a.x2=s.x2=gj(o,c),a.y=s.y=mj(o,l,lT),a.y2=s.y2=mj(o,c),wT({type:dT,role:"axis-domain",from:r,encode:u},n)}(t,n,r.domain,f)),c.title&&d.push(function(t,e,n,r){const i=mT(t,e),o=t.orient,a=pj(o,-1,1);let s,u;const l={enter:s={opacity:lT,anchor:fN(i("titleAnchor",null)),align:{signal:bT}},update:u=re({},s,{opacity:cT,text:fN(t.title)}),exit:{opacity:lT}},c={signal:'lerp(range("'.concat(t.scale,'"), ').concat(vT(0,1,.5),")")};return u.x=gj(o,c),u.y=mj(o,c),s.angle=gj(o,lT,((t,e)=>UN(t)?{signal:"(".concat(t.signal,") * ").concat(90)}:{value:90*t})(a)),s.baseline=gj(o,yj(o,KB,HB),{value:KB}),u.angle=s.angle,u.baseline=s.baseline,dN(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(t,e,n,r){const i=(t,e)=>null!=t?(n.update[e]=Sj(fN(t),n.update[e]),!1):!gN(e,r),o=i(t("titleX"),"x"),a=i(t("titleY"),"y");n.enter.auto=a===o?fN(a):gj(e,fN(a),fN(o))}(i,o,l,n),l.update.align=Sj(l.update.align,s.align),l.update.angle=Sj(l.update.angle,s.angle),l.update.baseline=Sj(l.update.baseline,s.baseline),wT({type:pT,role:"axis-title",style:nT,from:r,encode:l},n)}(t,n,r.title,f)),aj(gT({role:"axis",from:f,encode:pN(Bj(u,t),i,uT),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:a,style:s}),e)}function Bj(t,e){const n={enter:{},update:{}};return dN(n,{orient:t("orient"),offset:t("offset")||0,position:VN(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:'abs(span(range("'.concat(e.scale,'")))')},translate:t("translate"),format:e.format,formatType:e.formatType}),n}function Tj(t,e,n){const r=Gt(t.signals),i=Gt(t.scales);return n||r.forEach((t=>$N(t,e))),Gt(t.projections).forEach((t=>function(t,e){const n=e.config.projection||{},r={};for(const n in t)"name"!==n&&(r[n]=VB(t[n],n,e));for(const t in n)null==r[t]&&(r[t]=VB(n[t],t,e));e.addProjection(t.name,r)}(t,e))),i.forEach((t=>function(t,e){const n=t.type||"linear";Up(n)||at("Unrecognized scale type: "+De(n)),e.addScale(t.name,{type:n,domain:void 0})}(t,e))),Gt(t.data).forEach((t=>function(t,e){const n=[];t.transform&&t.transform.forEach((t=>{n.push(UT(t,e))})),t.on&&t.on.forEach((n=>{oj(n,e,t.name)})),e.addDataPipeline(t.name,function(t,e,n){const r=[];let i,o,a,s,u,l=null,c=!1,f=!1;for(t.values?UN(t.values)||WN(t.format)?(r.push(hj(e,t)),r.push(l=fj())):r.push(l=fj({$ingest:t.values,$format:t.format})):t.url?WN(t.url)||WN(t.format)?(r.push(hj(e,t)),r.push(l=fj())):r.push(l=fj({$request:t.url,$format:t.format})):t.source&&(l=i=Gt(t.source).map((t=>jN(e.getData(t).output))),r.push(null)),o=0,a=n.length;o<a;++o)s=n[o],u=s.metadata,l||u.source||r.push(l=fj()),r.push(s),u.generates&&(f=!0),u.modifies&&!f&&(c=!0),u.source?l=s:u.changes&&(l=null);return i&&(a=i.length-1,r[0]=kB({derive:c,pulse:a?i:i[0]}),(c||a)&&r.splice(1,0,fj())),l||r.push(fj()),r.push(DB({})),r}(t,e,n))}(t,e))),i.forEach((t=>$B(t,e))),(n||r).forEach((t=>function(t,e){const n=e.getSignal(t.name);let r=t.update;t.init&&(r?at("Signals can not include both init and update expressions."):(r=t.init,n.initonly=!0)),r&&(r=ZM(r,e),n.update=r.$expr,n.params=r.$params),t.on&&t.on.forEach((t=>function(t,e,n){const r=t.encode,i={target:n};let o=t.events,a=t.update,s=[];o||at("Signal update missing events specification."),ve(o)&&(o=iN(o,e.isSubscope()?LN:qN)),o=Gt(o).filter((t=>t.signal||t.scale?(s.push(t),0):1)),s.length>1&&(s=[tB(s)]),o.length&&s.push(o.length>1?{merge:o}:o[0]),null!=r&&(a&&at("Signal encode and update are mutually exclusive."),a="encode(item(),"+De(r)+")"),i.update=ve(a)?ZM(a,e):null!=a.expr?ZM(a.expr,e):null!=a.value?a.value:null!=a.signal?{$expr:QN,$params:{$value:e.signalRef(a.signal)}}:at("Invalid signal update specification."),t.force&&(i.options={force:!0}),s.forEach((t=>e.addUpdate(re(function(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):XN(t,e)}}(t,e),i))))}(t,e,n.id)))}(t,e))),Gt(t.axes).forEach((t=>Nj(t,e))),Gt(t.marks).forEach((t=>aj(t,e))),Gt(t.legends).forEach((t=>function(t,e){const n=e.config.legend,r=t.encode||{},i=mT(t,n),o=r.legend||{},a=o.name||void 0,s=o.interactive,u=o.style,l={};let c,f,h,d=0;sT.forEach((e=>t[e]?(l[e]=t[e],d=d||t[e]):0)),d||at("Missing valid scale for legend.");const p=function(t,e){let n=t.type||rT;return t.type||1!==function(t){return sT.reduce(((e,n)=>e+(t[n]?1:0)),0)}(t)||!t.fill&&!t.stroke||(n=Vp(e)?iT:Gp(e)?oT:rT),n!==iT?n:Gp(e)?oT:iT}(t,e.scaleType(d)),g={title:null!=t.title,scales:l,type:p,vgrad:"symbol"!==p&&i.isVertical()},m=jN(e.add(oB(null,[g]))),y=jN(e.add(dB(f={type:p,scale:e.scaleRef(d),count:e.objectProperty(i("tickCount")),limit:e.property(i("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return p===iT?(h=[_T(t,d,n,r.gradient),DT(t,n,r.labels,y)],f.count=f.count||e.signalRef("max(2,2*floor((".concat(HN(i.gradientLength()),")/100))"))):p===oT?h=[kT(t,d,n,r.gradient,y),DT(t,n,r.labels,y)]:(c=function(t,e){const n=mT(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,n),h=[ST(t,n,r,y,HN(c.columns))],f.size=function(t,e,n){const r=HN(uj("size",t,n)),i=HN(uj("strokeWidth",t,n)),o=HN(function(t,e,n){return yT("fontSize",t)||function(t,e,n){const r=e.config.style["guide-label"];return r&&r.fontSize}(0,e)}(n[1].encode,e));return ZM("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(o,")"),e)}(t,e,h[0].marks)),h=[gT({role:"legend-entry",from:m,encode:{enter:{x:{value:0},y:{value:0}}},marks:h,layout:c,interactive:s})],g.title&&h.push(function(t,e,n,r){const i=mT(t,e),o={enter:{opacity:lT},update:{opacity:cT,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:lT}};return dN(o,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:TT},angle:{signal:jT},align:{signal:BT},baseline:{signal:IT},text:t.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),wT({type:pT,role:"legend-title",style:nT,from:r,encode:o},n)}(t,n,r.title,m)),aj(gT({role:"legend",from:m,encode:pN(sj(i,t,n),o,uT),marks:h,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:a,interactive:s,style:u}),e)}(t,e))),t.title&&function(t,e){const n=mT(t=ve(t)?{text:t}:t,e.config.title),r=t.encode||{},i=r.group||{},o=i.name||void 0,a=i.interactive,s=i.style,u=[],l=jN(e.add(oB(null,[{}])));u.push(function(t,e,n,r){const i={value:0},o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return dN(o,{text:t.text,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),wT({type:pT,role:"title-text",style:"group-title",from:r,encode:o},n)}(t,n,function(t){const e=t.encode;return e&&e.title||re({name:t.name,interactive:t.interactive,style:t.style},e)}(t),l)),t.subtitle&&u.push(function(t,e,n,r){const i={value:0},o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return dN(o,{text:t.subtitle,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),wT({type:pT,role:"title-subtitle",style:"group-subtitle",from:r,encode:o},n)}(t,n,r.subtitle,l)),aj(gT({role:"title",from:l,encode:cj(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:o,interactive:a,style:s}),e)}(t.title,e),e.parseLambdas(),e}function jj(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function Ij(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function zj(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}function Rj(t){return(_t(t)?Pj:Lj)(t)}function Pj(t){const e=t.length;let n="[";for(let r=0;r<e;++r){const e=t[r];n+=(r>0?",":"")+(kt(e)?e.signal||Rj(e):De(e))}return n+"]"}function Lj(t){let e,n,r="{",i=0;for(e in t)n=t[e],r+=(++i>1?",":"")+De(e)+":"+(kt(n)?n.signal||Rj(n):De(n));return r+"}"}function qj(t,e,n){return kt(t)||at("Input Vega specification must be an object."),function(t,e){const n=e.config,r=jN(e.root=e.add(TN())),i=function(t,e){const n=n=>VN(t[n],e[n]),r=[jj("background",n("background")),jj("autosize",uN(n("autosize"))),jj("padding",cN(n("padding"))),jj("width",n("width")||0),jj("height",n("height")||0)],i=r.reduce(((t,e)=>(t[e.name]=e,t)),{}),o={};return Gt(t.signals).forEach((t=>{se(i,t.name)?t=re(i[t.name],t):r.push(t),o[t.name]=t})),Gt(e.signals).forEach((t=>{se(o,t.name)||se(i,t.name)||r.push(t)})),r}(t,n);i.forEach((t=>$N(t,e))),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;const o=e.add(oB()),a=e.add(uB(SN((t=>pN({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t))(t.encode),fT,yN,t.style,e,{pulse:jN(o)}))),s=e.add(CB({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:r,pulse:jN(a)}));e.operators.pop(),e.pushState(jN(a),jN(s),null),Tj(t,e,i),e.operators.push(s);let u=e.add(iB({mark:r,pulse:jN(s)}));return u=e.add(AB({pulse:jN(u)})),u=e.add(DB({pulse:jN(u)})),e.addData("root",new ej(e,o,o,u)),e}(t,new Ij(e=Et(function(){const t="sans-serif",e="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:e},area:{fill:e},image:null,line:{stroke:e,strokeWidth:2},path:{stroke:e},rect:{fill:e},rule:{stroke:n},shape:{stroke:e},symbol:{fill:e,size:64},text:{fill:n,font:t,fontSize:11},trail:{fill:e,size:2},style:{"guide-label":{fill:n,font:t,fontSize:10},"guide-title":{fill:n,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),e,t.config),n)).toRuntime()}Ij.prototype=zj.prototype={parse(t){return Tj(t,this)},fork(){return new zj(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach((e=>{e.$ref=t.id})),t.refs=null),t},proxy(t){const e=t instanceof NN?jN(t):t;return this.add(_B({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){let r,i;t&&(r=t.data||(t.data={}),i=r[e]||(r[e]=[]),i.push(n))}for(t in this.data){e=this.data[t],n(e.input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values");for(const r in e.index)n(e.index[r],t,"index:"+r)}return this},pushState(t,e,n){this._encode.push(jN(this.add(DB({pulse:t})))),this._parent.push(e),this._lookup.push(n?jN(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Ct(this._parent)},encode(){return Ct(this._encode)},lookup(){return Ct(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(ve(t))return IN(t,e);t.signal||at("Unsupported field reference: "+De(t));const n=t.signal;let r=this.field[n];if(!r){const t={name:this.signalRef(n)};e&&(t.as=e),this.field[n]=r=jN(this.add(fB(t)))}return r},compareRef(t){let e=!1;const n=t=>UN(t)?(e=!0,this.signalRef(t.signal)):function(t){return t&&t.expr}(t)?(e=!0,this.exprRef(t.expr)):t,r=Gt(t.field).map(n),i=Gt(t.order).map(n);return e?jN(this.add(aB({fields:r,orders:i}))):RN(r,i)},keyRef(t,e){let n=!1;const r=this.signals;return t=Gt(t).map((t=>UN(t)?(n=!0,jN(r[t.signal])):t)),n?jN(this.add(hB({fields:t,flat:e}))):function(t,e){const n={$key:t};return e&&(n.$flat=!0),n}(t,e)},sortRef(t){if(!t)return t;const e=PN(t.op,t.field),n=t.order||"ascending";return n.signal?jN(this.add(aB({fields:e,orders:this.signalRef(n.signal)}))):RN(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:t,type:e}),this.events[n]=r}return this.events[n]},hasOwnSignal(t){return se(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&at("Duplicate signal name: "+De(t));const n=e instanceof NN?e:this.add(TN(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||at("Unrecognized signal name: "+De(t)),this.signals[t]},signalRef(t){return this.signals[t]?jN(this.signals[t]):(se(this.lambdas,t)||(this.lambdas[t]=this.add(TN(null))),jN(this.lambdas[t]))},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const n=t[e],r=ZM(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return t&&kt(t)?this.signalRef(t.signal||Rj(t)):t},exprRef(t,e){const n={expr:ZM(t,this)};return e&&(n.expr.$name=e),jN(this.add(lB(n)))},addBinding(t,e){this.bindings||at("Nested signals do not support binding: "+De(t)),this.bindings.push(re({signal:t},e))},addScaleProj(t,e){se(this.scales,t)&&at("Duplicate scale or projection name: "+De(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,EB(e))},addProjection(t,e){this.addScaleProj(t,wB(e))},getScale(t){return this.scales[t]||at("Unrecognized scale name: "+De(t)),this.scales[t]},scaleRef(t){return jN(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return se(this.data,t)&&at("Duplicate data set name: "+De(t)),this.data[t]=e},getData(t){return this.data[t]||at("Undefined data set name: "+De(t)),this.data[t]},addDataPipeline(t,e){return se(this.data,t)&&at("Duplicate data set name: "+De(t)),this.addData(t,ej.fromEntries(this,e))}};re(gs,o,s,u,l,c,h,f,d,p,g,m);const Uj="5.20.0";function Wj(t,e,n){return t.fields=e||[],t.fname=n,t}function Vj(t){return 1===t.length?Hj(t[0]):Gj(t)}const Hj=t=>function(e){return e[t]},Gj=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function Xj(t){throw Error(t)}function Kj(t){var e,n,r,i=[],o=null,a=0,s=t.length,u="";function l(){i.push(u+t.substring(e,n)),u="",e=n+1}for(t+="",e=n=0;n<s;++n)if("\\"===(r=t[n]))u+=t.substring(e,n),u+=t.substring(++n,++n),e=n;else if(r===o)l(),o=null,a=-1;else{if(o)continue;e===a&&'"'===r||e===a&&"'"===r?(e=n+1,o=r):"."!==r||a?"["===r?(n>e&&l(),a=e=n+1):"]"===r&&(a||Xj("Access path missing open bracket: "+t),a>0&&l(),a=0,e=n+1):n>e?l():e=n+1}return a&&Xj("Access path missing closing bracket: "+t),o&&Xj("Access path missing closing quote: "+t),n>e&&(n++,l()),i}var Yj=[],Jj=(function(t,e,n){const r=Kj(t);t=1===r.length?r[0]:t,Wj(Vj(r),[t],t)}("id"),Wj((function(t){return t}),Yj,"identity"));function Zj(t,e,n){var r=[e].concat([].slice.call(n));console[t].apply(console,r)}Wj((function(){return 0}),Yj,"zero"),Wj((function(){return 1}),Yj,"one"),Wj((function(){return!0}),Yj,"true"),Wj((function(){return!1}),Yj,"false");const Qj=Array.isArray;function tI(t){return t===Object(t)}const eI=t=>"__proto__"!==t;function nI(...t){return t.reduce(((t,e)=>{for(var n in e)if("signals"===n)t.signals=iI(t.signals,e.signals);else{var r="legend"===n?{layout:1}:"style"===n||null;rI(t,n,e[n],r)}return t}),{})}function rI(t,e,n,r){var i,o;if(eI(e))if(tI(n)&&!Qj(n))for(i in o=tI(t[e])?t[e]:t[e]={},n)r&&(!0===r||r[i])?rI(o,i,n[i]):eI(i)&&(o[i]=n[i]);else t[e]=n}function iI(t,e){if(null==t)return e;const n={},r=[];function i(t){n[t.name]||(n[t.name]=1,r.push(t))}return e.forEach(i),t.forEach(i),r}function oI(t){return null!=t?Qj(t)?t:[t]:[]}const aI=Object.prototype.hasOwnProperty;function sI(t,e){return aI.call(t,e)}function uI(t){return"boolean"==typeof t}function lI(t){return"number"==typeof t}function cI(t){return"string"==typeof t}function fI(t){return Qj(t)?"["+t.map(fI)+"]":tI(t)||cI(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function hI(t){for(var e={},n=0,r=t.length;n<r;++n)e[t[n]]=!0;return e}function dI(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}Object.create,Object.create,Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,t.call(r,e-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var pI=n(6313),gI=n.n(pI),mI=n(4063),yI=n.n(mI),vI=n(5035),bI=n.n(vI);function xI(t){return!!t.or}function wI(t){return!!t.and}function _I(t){return!!t.not}function kI(t,e){if(_I(t))kI(t.not,e);else if(wI(t))for(const n of t.and)kI(n,e);else if(xI(t))for(const n of t.or)kI(n,e);else e(t)}function AI(t,e){return _I(t)?{not:AI(t.not,e)}:wI(t)?{and:t.and.map((t=>AI(t,e)))}:xI(t)?{or:t.or.map((t=>AI(t,e)))}:e(t)}const EI=yI(),DI=gI();function SI(t,e){const n={};for(const r of e)sI(t,r)&&(n[r]=t[r]);return n}function CI(t,e){const n=Object.assign({},t);for(const t of e)delete n[t];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((t=>bI()(t))).join(",")})`};const OI=bI();function FI(t){if(lI(t))return t;const e=cI(t)?t:bI()(t);if(e.length<250)return e;let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n}function MI(t){return!1===t||null===t}function $I(t,e){return t.indexOf(e)>-1}function NI(t,e){let n=0;for(const[r,i]of t.entries())if(e(i,r,n++))return!0;return!1}function BI(t,e){let n=0;for(const[r,i]of t.entries())if(!e(i,r,n++))return!1;return!0}function TI(t,e){for(const n of LI(e))rI(t,n,e[n],!0)}function jI(t,e){const n=[],r={};let i;for(const o of t)i=e(o),i in r||(r[i]=1,n.push(o));return n}function II(t,e){for(const n of t)if(e.has(n))return!0;return!1}function zI(t){const e=new Set;for(const n of t){const t=Kj(n).map(((t,e)=>0===e?t:`[${t}]`)),r=t.map(((e,n)=>t.slice(0,n+1).join("")));for(const t of r)e.add(t)}return e}function RI(t,e){return void 0===t||void 0===e||II(zI(t),zI(e))}function PI(t){return 0===LI(t).length}const LI=Object.keys,qI=Object.values;function UI(t){const e=[];for(const n in t)sI(t,n)&&e.push({key:n,value:t[n]});return e}function WI(t){return!0===t||!1===t}function VI(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function HI(t,e){return _I(t)?"!("+HI(t.not,e)+")":wI(t)?"("+t.and.map((t=>HI(t,e))).join(") && (")+")":xI(t)?"("+t.or.map((t=>HI(t,e))).join(") || (")+")":e(t)}function GI(t,e){if(0===e.length)return!0;const n=e.shift();return n in t&&GI(t[n],e)&&delete t[n],PI(t)}function XI(t){return t.charAt(0).toUpperCase()+t.substr(1)}function KI(t,e="datum"){const n=Kj(t),r=[];for(let t=1;t<=n.length;t++){const i=`[${n.slice(0,t).map(fI).join("][")}]`;r.push(`${e}${i}`)}return r.join(" && ")}function YI(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function JI(t){return`${Kj(t).map(YI).join("\\.")}`}function ZI(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function QI(t){return`${Kj(t).join(".")}`}function tz(t){return t?Kj(t).length:0}function ez(...t){for(const e of t)if(void 0!==e)return e}let nz=42;function rz(t){if(void 0!==t)return(t%360+360)%360}function iz(t){return!!lI(t)||!isNaN(t)&&!isNaN(parseFloat(t))}const oz={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function az(t){return t&&t.condition}const sz=["domain","grid","labels","ticks","title"],uz={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},lz={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},cz=Object.assign(Object.assign({},lz),{style:1,labelExpr:1,encoding:1});function fz(t){return!!cz[t]}LI(cz);const hz={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},dz=hz.arc,pz=hz.area,gz=hz.bar,mz=hz.image,yz=hz.line,vz=hz.point,bz=hz.rect,xz=hz.rule,wz=hz.text,_z=hz.tick,kz=hz.trail,Az=hz.circle,Ez=hz.square,Dz=hz.geoshape;function Sz(t){return $I(["line","area","trail"],t)}function Cz(t){return $I(["rect","bar","image","arc"],t)}const Oz=LI(hz);function Fz(t){return t.type}hI(Oz);const Mz=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],$z=LI({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),Nz={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function Bz(t){return"mark"in t}class Tz{constructor(t,e){this.name=t,this.run=e}hasMatchingType(t){return!!Bz(t)&&function(t){return Fz(t)?t.type:t}(t.mark)===this.name}}const jz={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Iz={count:1,min:1,max:1};function zz(t){return!!t&&!!t.argmin}function Rz(t){return!!t&&!!t.argmax}function Pz(t){return cI(t)&&!!jz[t]}LI(jz);const Lz=["count","valid","missing","distinct"];function qz(t){return cI(t)&&$I(Lz,t)}const Uz=["count","sum","distinct","valid","missing"],Wz=hI(["mean","average","median","q1","q3","min","max"]),Vz="row",Hz="column",Gz="facet",Xz="x",Kz="y",Yz="x2",Jz="y2",Zz="radius",Qz="radius2",tR="theta",eR="theta2",nR="latitude",rR="longitude",iR="latitude2",oR="longitude2",aR="color",sR="fill",uR="stroke",lR="shape",cR="size",fR="angle",hR="opacity",dR="fillOpacity",pR="strokeOpacity",gR="strokeWidth",mR="strokeDash",yR="text",vR="order",bR="detail",xR="key",wR="tooltip",_R="href",kR="url",AR="description",ER={theta:1,theta2:1,radius:1,radius2:1};function DR(t){return t in ER}const SR={longitude:1,longitude2:1,latitude:1,latitude2:1},CR=LI(SR),OR=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),ER),SR),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function FR(t){return t===aR||t===sR||t===uR}const MR={row:1,column:1,facet:1},$R=LI(MR),NR=Object.assign(Object.assign({},OR),MR),BR=LI(NR),{order:TR,detail:jR,tooltip:IR}=NR,zR=dI(NR,["order","detail","tooltip"]),{row:RR,column:PR,facet:LR}=zR,qR=dI(zR,["row","column","facet"]);function UR(t){return!!NR[t]}LI(zR),LI(qR);const WR=[Yz,Jz,iR,oR,eR,Qz];function VR(t){return HR(t)!==t}function HR(t){switch(t){case Yz:return Xz;case Jz:return Kz;case iR:return nR;case oR:return rR;case eR:return tR;case Qz:return Zz}return t}function GR(t){if(DR(t))switch(t){case tR:return"startAngle";case eR:return"endAngle";case Zz:return"outerRadius";case Qz:return"innerRadius"}return t}function XR(t){switch(t){case Xz:return Yz;case Kz:return Jz;case nR:return iR;case rR:return oR;case tR:return eR;case Zz:return Qz}}function KR(t){switch(t){case Xz:case Yz:return"width";case Kz:case Jz:return"height"}}LI(OR);const{x:YR,y:JR,x2:ZR,y2:QR,latitude:tP,longitude:eP,latitude2:nP,longitude2:rP,theta:iP,theta2:oP,radius:aP,radius2:sP}=OR,uP=dI(OR,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),lP=LI(uP),cP={x:1,y:1},fP=LI(cP);function hP(t){return t in cP}const dP={theta:1,radius:1},pP=LI(dP);function gP(t){return"width"===t?Xz:Kz}const{text:mP,tooltip:yP,href:vP,url:bP,description:xP,detail:wP,key:_P,order:kP}=uP,AP=dI(uP,["text","tooltip","href","url","description","detail","key","order"]),EP=LI(AP),DP=Object.assign(Object.assign(Object.assign({},cP),dP),AP),SP=LI(DP);function CP(t){return!!DP[t]}const OP={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:FP}=OP,MP=dI(OP,["geoshape"]);function $P(t){switch(t){case Xz:case Kz:case tR:case Zz:case cR:case fR:case gR:case hR:case dR:case pR:case Yz:case Jz:case eR:case Qz:return;case Gz:case Vz:case Hz:case lR:case mR:case yR:case wR:case _R:case kR:case AR:return"discrete";case aR:case sR:case uR:return"flexible";case nR:case rR:case iR:case oR:case bR:case xR:case vR:return}}function NP(t){return uI(t)&&(t=PU(t,void 0)),"bin"+LI(t).map((e=>IP(t[e])?VI(`_${e}_${Object.entries(t[e])}`):VI(`_${e}_${t[e]}`))).join("")}function BP(t){return!0===t||jP(t)&&!t.binned}function TP(t){return"binned"===t||jP(t)&&!0===t.binned}function jP(t){return tI(t)}function IP(t){return null==t?void 0:t.selection}function zP(t){switch(t){case Vz:case Hz:case cR:case aR:case sR:case uR:case gR:case hR:case dR:case pR:case lR:return 6;case mR:return 4;default:return 10}}function RP(t){return`Invalid specification ${JSON.stringify(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}function PP(t){return("width"==t?"Width":"Height")+' "container" only works for single views and layered views.'}function LP(t){return`${"width"==t?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==t?"x":"y"}".`}function qP(t){return t?`Dropping "fit-${t}" because spec has discrete ${KR(t)}.`:'Dropping "fit" because spec has discrete size.'}function UP(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function WP(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function VP(t){return`Selection not supported for ${t} yet.`}function HP(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}function GP(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}function XP(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function KP(t){return`Invalid field type "${t}".`}function YP(t,e){const{fill:n,stroke:r}=e;return`Dropping color ${t} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function JP(t,e){return`Dropping ${OI(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}function ZP(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?` when ${n}`:""}.`}function QP(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function tL(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${"ordinal"===e?"order":"magnitude"}.`}function eL(t){return`Using unaggregated domain with raw field has no effect (${OI(t)}).`}function nL(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function rL(t){return`Unaggregated domain is currently unsupported for log scale (${OI(t)}).`}function iL(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function oL(t){return`The step for "${t}" is dropped because the ${"width"===t?"x":"y"} is continuous.`}const aL="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function sL(t,e){return`Invalid ${t}: ${OI(e)}.`}function uL(t){return`1D error band does not support ${t}.`}function lL(t){return`Channel ${t} is required for "binned" bin.`}const cL=(fL=2,{level:function(t){return arguments.length?(fL=+t,this):fL},error:function(){return fL>=1&&Zj("error","ERROR",arguments),this},warn:function(){return fL>=2&&Zj("warn","WARN",arguments),this},info:function(){return fL>=3&&Zj("log","INFO",arguments),this},debug:function(){return fL>=4&&Zj("log","DEBUG",arguments),this}});var fL;let hL=cL;function dL(...t){hL.warn(...t)}function pL(t){if(t&&tI(t))for(const e of _L)if(e in t)return!0;return!1}const gL=["january","february","march","april","may","june","july","august","september","october","november","december"],mL=gL.map((t=>t.substr(0,3))),yL=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],vL=yL.map((t=>t.substr(0,3)));function bL(t,e){const n=[];if(e&&void 0!==t.day&&LI(t).length>1&&(dL(function(t){return`Dropping day from datetime ${OI(t)} as day cannot be combined with other units.`}(t)),delete(t=DI(t)).day),void 0!==t.year?n.push(t.year):n.push(2012),void 0!==t.month){const r=e?function(t){if(iz(t)&&(t=+t),lI(t))return t-1;{const e=t.toLowerCase(),n=gL.indexOf(e);if(-1!==n)return n;const r=e.substr(0,3),i=mL.indexOf(r);if(-1!==i)return i;throw new Error(sL("month",t))}}(t.month):t.month;n.push(r)}else if(void 0!==t.quarter){const r=e?function(t){if(iz(t)&&(t=+t),lI(t))return t>4&&dL(sL("quarter",t)),t-1;throw new Error(sL("quarter",t))}(t.quarter):t.quarter;n.push(lI(r)?3*r:r+"*3")}else n.push(0);if(void 0!==t.date)n.push(t.date);else if(void 0!==t.day){const r=e?function(t){if(iz(t)&&(t=+t),lI(t))return t%7;{const e=t.toLowerCase(),n=yL.indexOf(e);if(-1!==n)return n;const r=e.substr(0,3),i=vL.indexOf(r);if(-1!==i)return i;throw new Error(sL("day",t))}}(t.day):t.day;n.push(lI(r)?r+1:r+"+1")}else n.push(1);for(const e of["hours","minutes","seconds","milliseconds"]){const r=t[e];n.push(void 0===r?0:r)}return n}function xL(t){const e=bL(t,!0).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}const wL={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},_L=LI(wL);function kL(t){return t.startsWith("utc")}const AL={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function EL(t){const e=[];for(const n of _L)DL(t,n)&&e.push(n);return e}function DL(t,e){const n=t.indexOf(e);return!(n<0||n>0&&"seconds"===e&&"i"===t.charAt(n-1)||t.length>n+3&&"day"===e&&"o"===t.charAt(n+3)||n>0&&"year"===e&&"f"===t.charAt(n-1))}function SL(t){if(!t)return;const e=EL(t);return`timeUnitSpecifier(${bI()(e)}, ${bI()(AL)})`}function CL(t){if(!t)return;let e;return cI(t)?e={unit:t}:tI(t)&&(e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})),kL(e.unit)&&(e.utc=!0,e.unit=e.unit.substr(3)),e}function OL(t){return t&&!!t.signal}function FL(t){return!!t.step}function ML(t){return!Qj(t)&&"field"in t&&"data"in t}const $L=LI({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1}),NL={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},BL=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function TL(t){return t&&!!t.field&&void 0!==t.equal}function jL(t){return t&&!!t.field&&void 0!==t.lt}function IL(t){return t&&!!t.field&&void 0!==t.lte}function zL(t){return t&&!!t.field&&void 0!==t.gt}function RL(t){return t&&!!t.field&&void 0!==t.gte}function PL(t){if(t&&t.field){if(Qj(t.range)&&2===t.range.length)return!0;if(OL(t.range))return!0}return!1}function LL(t){return t&&!!t.field&&(Qj(t.oneOf)||Qj(t.in))}function qL(t){return LL(t)||TL(t)||PL(t)||jL(t)||zL(t)||IL(t)||RL(t)}function UL(t,e){return UU(t,{timeUnit:e,wrapTime:!0})}function WL(t,e=!0){var n;const{field:r}=t,i=null===(n=CL(t.timeUnit))||void 0===n?void 0:n.unit,o=i?"time("+function(t,e,{end:n}={end:!1}){const r=KI(e),i=kL(t)?"utc":"";let o;const a={};for(const e of _L)DL(t,e)&&(a[e]="quarter"===(s=e)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,o=e);var s;return n&&(a[o]+="+1"),function(t){const e=bL(t,!1).join(", ");return t.utc?`utc(${e})`:`datetime(${e})`}(a)}(i,r)+")":EU(t,{expr:"datum"});if(TL(t))return o+"==="+UL(t.equal,i);if(jL(t))return`${o}<${UL(t.lt,i)}`;if(zL(t))return`${o}>${UL(t.gt,i)}`;if(IL(t))return`${o}<=${UL(t.lte,i)}`;if(RL(t))return`${o}>=${UL(t.gte,i)}`;if(LL(t))return`indexof([${function(t,e){return t.map((t=>UL(t,e)))}(t.oneOf,i).join(",")}], ${o}) !== -1`;if(function(t){return t&&!!t.field&&void 0!==t.valid}(t))return VL(o,t.valid);if(PL(t)){const{range:n}=t,r=OL(n)?{signal:`${n.signal}[0]`}:n[0],a=OL(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==a&&e)return"inrange("+o+", ["+UL(r,i)+", "+UL(a,i)+"])";const s=[];return null!==r&&s.push(`${o} >= ${UL(r,i)}`),null!==a&&s.push(`${o} <= ${UL(a,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(t)}`)}function VL(t,e=!0){return e?`isValid(${t}) && isFinite(+${t})`:`!isValid(${t}) || !isFinite(+${t})`}function HL(t){var e;return qL(t)&&t.timeUnit?Object.assign(Object.assign({},t),{timeUnit:null===(e=CL(t.timeUnit))||void 0===e?void 0:e.unit}):t}const GL={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},XL=GL.quantitative,KL=GL.ordinal,YL=GL.temporal,JL=GL.nominal,ZL=GL.geojson,QL=LI(GL),tq="linear",eq="time",nq="utc",rq="point",iq={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},oq=LI(iq);function aq(t,e){const n=iq[t],r=iq[e];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const sq={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function uq(t){return sq[t]}const lq=["linear","log","pow","sqrt","symlog","time","utc"],cq=hI(lq),fq=hI(["linear","log","pow","sqrt","symlog"]),hq=hI(["quantile","quantize","threshold"]),dq=hI(lq.concat(["quantile","quantize","threshold","sequential","identity"])),pq=hI(["ordinal","bin-ordinal","point","band"]);function gq(t){return t in pq}function mq(t){return t in dq}function yq(t){return t in cq}function vq(t){return t in hq}function bq(t){return null==t?void 0:t.selection}const xq={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:wq,domain:_q,range:kq,scheme:Aq}=(LI(xq),xq),Eq=dI(xq,["type","domain","range","scheme"]),Dq=LI(Eq);function Sq(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!$I(["point","band","identity"],t);case"bins":return!$I(["point","band","identity","ordinal"],t);case"round":return yq(t)||"band"===t||"point"===t;case"padding":return yq(t)||$I(["point","band"],t);case"paddingOuter":case"align":return $I(["point","band"],t);case"paddingInner":return"band"===t;case"domainMid":case"clamp":return yq(t);case"nice":return yq(t)||"quantize"===t||"threshold"===t;case"exponent":return"pow"===t;case"base":return"log"===t;case"constant":return"symlog"===t;case"zero":return mq(t)&&!$I(["log","time","utc","threshold","quantile"],t)}}function Cq(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":return FR(t)?void 0:`Cannot use the scale property "${t}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function Oq(t,e){return $I([KL,JL],e)?void 0===t||gq(t):e===YL?$I([eq,nq,void 0],t):e!==XL||$I(["log","pow","sqrt","symlog","quantile","quantize","threshold",tq,void 0],t)}function Fq(t,e){if(!CP(t))return!1;switch(t){case Xz:case Kz:case tR:case Zz:return yq(e)||$I(["band","point"],e);case cR:case gR:case hR:case dR:case pR:case fR:return yq(e)||vq(e)||$I(["band","point","ordinal"],e);case aR:case sR:case uR:return"band"!==e;case mR:return"ordinal"===e||vq(e);case lR:return"ordinal"===e}}function Mq(t,e){return t+"_"+e}function $q(t){const{channel:e,channelDef:n,markDef:r,scale:i,config:o}=t,a=zq(t);return dU(n)&&!qz(n.aggregate)&&i&&yq(i.get("type"))&&!1===i.get("zero")?Nq({fieldDef:n,channel:e,markDef:r,ref:a,config:o}):a}function Nq({fieldDef:t,channel:e,markDef:n,ref:r,config:i}){return Sz(n.type)||null===ZU("invalid",n,i)?r:[Bq(t,e),r]}function Bq(t,e){const n=Tq(t,!0),r="y"===HR(e)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function Tq(t,e=!0){return VL(cI(t)?t:EU(t,{expr:"datum"}),!e)}function jq(t,e,n,r){const i={};if(e&&(i.scale=e),gU(t)){const{datum:e}=t;pL(e)?i.signal=xL(e):OL(e)?i.signal=e.signal:i.value=e}else i.field=EU(t,n);if(r){const{offset:t,band:e}=r;t&&(i.offset=t),e&&(i.band=e)}return i}function Iq({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:o=.5}){const a=0<o&&o<1?"datum":void 0,s=EU(e,{expr:a,suffix:i}),u=void 0!==n?EU(n,{expr:a}):EU(e,{suffix:"end",expr:a}),l={};if(0===o||1===o){l.scale=t;const e=0===o?s:u;l.field=e}else{const e=`${o} * ${s} + ${1-o} * ${u}`;l.signal=`scale("${t}", ${e})`}return r&&(l.offset=r),l}function zq({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:o,scale:a,stack:s,offset:u,defaultRef:l,band:c}){var f;if(e){if(vU(e)){if(bU(e)){c=null!=c?c:uU({channel:t,fieldDef:e,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:a,timeUnit:l,type:f}=e;if(BP(a)||c&&l&&f===YL)return s&&s.impute?jq(e,o,{binSuffix:"mid"},{offset:u}):c?Iq({scaleName:o,fieldOrDatumDef:e,band:c,offset:u}):jq(e,o,VU(e,t)?{binSuffix:"range"}:{},{offset:u});if(TP(a)){if(dU(n))return Iq({scaleName:o,fieldOrDatumDef:e,fieldOrDatumDef2:n,band:c,offset:u});dL(lL(t===Xz?Yz:Jz))}}const l=null==a?void 0:a.get("type");return jq(e,o,gq(l)?{binSuffix:"range"}:{},{offset:u,band:"band"===l?null!==(f=null!=c?c:e.band)&&void 0!==f?f:.5:void 0})}if(xU(e)){const n=e.value,r=u?{offset:u}:{};return Object.assign(Object.assign({},Rq(t,n)),r)}}return"function"==typeof l&&(l=l()),l?Object.assign(Object.assign({},l),u?{offset:u}:{}):l}function Rq(t,e){return $I(["x","x2"],t)&&"width"===e?{field:{group:"width"}}:$I(["y","y2"],t)&&"height"===e?{field:{group:"height"}}:XU(e)}function Pq(t){return t&&"number"!==t&&"time"!==t}function Lq(t,e,n){return`${t}(${e}${n?`, ${JSON.stringify(n)}`:""})`}function qq({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:o}){var a,s;if(Pq(n))return Wq({fieldOrDatumDef:t,format:e,formatType:n,expr:r,config:o});const u=Uq(t,r,i);if(qU(t)){const n=function(t,e,n,r,i){return!e||n?`${i?"utc":"time"}Format(${t}, '${n=cI(n)?n:r}')`:function(t,e,n){if(!t)return;const r=SL(t);return`${n||kL(t)?"utc":"time"}Format(${e}, ${r})`}(e,t,i)}(u,dU(t)?null===(a=CL(t.timeUnit))||void 0===a?void 0:a.unit:void 0,e,o.timeFormat,wU(t)&&(null===(s=t.scale)||void 0===s?void 0:s.type)===nq);return n?{signal:n}:void 0}return e=Gq(pU(t),e,o),dU(t)&&BP(t.bin)?{signal:Yq(u,EU(t,{expr:r,binSuffix:"end"}),e,n,o)}:e||"quantitative"===pU(t)?{signal:`${Xq(u,e)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function Uq(t,e,n){return dU(t)?n?`${EU(t,{expr:e,suffix:"end"})}-${EU(t,{expr:e,suffix:"start"})}`:EU(t,{expr:e}):function(t){const{datum:e}=t;return pL(e)?xL(e):`${JSON.stringify(e)}`}(t)}function Wq({fieldOrDatumDef:t,format:e,formatType:n,expr:r,normalizeStack:i,config:o,field:a}){return a=null!=a?a:Uq(t,r,i),dU(t)&&BP(t.bin)?{signal:Yq(a,EU(t,{expr:r,binSuffix:"end"}),e,n,o)}:{signal:Lq(n,a,e)}}function Vq(t,e,n,r,i,o){var a;if(!Pq(r))return qU(t)?function(t,e,n,r){return t||(e?{signal:SL(e)}:r?void 0:n.timeFormat)}(n,dU(t)?null===(a=CL(t.timeUnit))||void 0===a?void 0:a.unit:void 0,i,o):Gq(e,n,i)}function Hq(t,e,n){return t&&(OL(t)||"number"===t||"time"===t)?t:qU(e)&&"time"!==n&&"utc"!==n?"time":void 0}function Gq(t,e,n){return cI(e)?e:t===XL?n.numberFormat:void 0}function Xq(t,e){return`format(${t}, "${e||""}")`}function Kq(t,e,n,r){var i;return Pq(n)?Lq(n,t,e):Xq(t,null!==(i=cI(e)?e:void 0)&&void 0!==i?i:r.numberFormat)}function Yq(t,e,n,r,i){const o=Kq(t,n,r,i),a=Kq(e,n,r,i);return`${VL(t,!1)} ? "null" : ${o} + "  " + ${a}`}!function(){var t;const e={};for(const n of BR)for(const r of QL)for(const i of oq){const o=Mq(n,r);Fq(n,i)&&Oq(i,r)&&(e[o]=null!==(t=e[o])&&void 0!==t?t:[],e[o].push(i))}}();const Jq="min",Zq={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Qq(t){return t in Zq}function tU(t){return!!t&&!!t.encoding}function eU(t){return!(!t||"count"!==t.op&&!t.field)}function nU(t){return!!t&&Qj(t)}function rU(t){return"row"in t||"column"in t}function iU(t){return!!t&&"header"in t}function oU(t){return"facet"in t}function aU(t){const{field:e,timeUnit:n,bin:r,aggregate:i}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:e})}function sU(t){return bU(t)&&"sort"in t}function uU({channel:t,fieldDef:e,fieldDef2:n,markDef:r,stack:i,config:o,isMidPoint:a}){if(vU(e)&&void 0!==e.band)return e.band;if(dU(e)){const{timeUnit:t,bin:i}=e;if(t&&!n)return a?QU("timeUnitBandPosition",r,o):Cz(r.type)?QU("timeUnitBand",r,o):0;if(BP(i))return Cz(r.type)&&!a?1:.5}return(null==i?void 0:i.fieldChannel)===t&&a?.5:void 0}function lU(t,e,n,r,i,o){return!!(BP(e.bin)||e.timeUnit&&bU(e)&&"temporal"===e.type)&&!!uU({channel:t,fieldDef:e,fieldDef2:n,stack:r,markDef:i,config:o})}function cU(t){return!!t&&"condition"in t}function fU(t){const e=t&&t.condition;return!!e&&!Qj(e)&&dU(e)}function hU(t){const e=t&&t.condition;return!!e&&!Qj(e)&&vU(e)}function dU(t){return!(!t||!t.field&&"count"!==t.aggregate)}function pU(t){return t&&t.type}function gU(t){return!!t&&"datum"in t}function mU(t){return bU(t)&&SU(t)||yU(t)}function yU(t){return gU(t)&&lI(t.datum)}function vU(t){return dU(t)||gU(t)}function bU(t){return!!t&&("field"in t&&"type"in t||"count"===t.aggregate)}function xU(t){return t&&"value"in t&&"value"in t}function wU(t){return!!t&&("scale"in t||"sort"in t)}function _U(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function kU(t){return!!t&&"legend"in t}function AU(t){return!!t&&("format"in t||"formatType"in t)}function EU(t,e={}){var n,r,i;let o=t.field;const a=e.prefix;let s=e.suffix,u="";if(function(t){return"count"===t.aggregate}(t))o=function(t){return 0===t.indexOf("__")}(l="count")?l:"__count";else{let a;if(!e.nofn)if(function(t){return"op"in t}(t))a=t.op;else{const{bin:l,aggregate:c,timeUnit:f}=t;BP(l)?(a=NP(l),s=(null!==(n=e.binSuffix)&&void 0!==n?n:"")+(null!==(r=e.suffix)&&void 0!==r?r:"")):c?Rz(c)?(u=`["${o}"]`,o=`argmax_${c.argmax}`):zz(c)?(u=`["${o}"]`,o=`argmin_${c.argmin}`):a=String(c):f&&(a=function(t){const e=CL(t),{utc:n}=e,r=dI(e,["utc"]);return r.unit?(n?"utc":"")+LI(r).map((t=>VI(`${"unit"===t?"":`_${t}_`}${r[t]}`))).join(""):(n?"utc":"")+"timeunit"+LI(r).map((t=>VI(`_${t}_${r[t]}`))).join("")}(f),s=(!$I(["range","mid"],e.binSuffix)&&e.binSuffix||"")+(null!==(i=e.suffix)&&void 0!==i?i:""))}a&&(o=o?`${a}_${o}`:a)}var l;return s&&(o=`${o}_${s}`),a&&(o=`${a}_${o}`),e.forAs?QI(o):e.expr?function(t,e="datum"){return`${e}[${fI(Kj(t).join("."))}]`}(o,e.expr)+u:JI(o)+u}function DU(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return dU(t)&&!!t.bin;case"temporal":return!1}throw new Error(KP(t.type))}function SU(t){return!DU(t)}const CU=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return function(t){const{aggregate:e,bin:n,timeUnit:r,field:i}=t;if(Rz(e))return`${i} for argmax(${e.argmax})`;if(zz(e))return`${i} for argmin(${e.argmin})`;const o=CL(r),a=e||(null==o?void 0:o.unit)||(null==o?void 0:o.maxbins)&&"timeunit"||BP(n)&&"bin";return a?a.toUpperCase()+"("+i+")":i}(t);default:return function(t,e){var n;const{field:r,bin:i,timeUnit:o,aggregate:a}=t;if("count"===a)return e.countTitle;if(BP(i))return`${r} (binned)`;if(o){const t=null===(n=CL(o))||void 0===n?void 0:n.unit;if(t)return`${r} (${EL(t).join("-")})`}else if(a)return Rz(a)?`${r} for max ${a.argmax}`:zz(a)?`${r} for min ${a.argmin}`:`${XI(a)} of ${r}`;return r}(t,e)}};let OU=CU;function FU(t){OU=t}function MU(t,e,{allowDisabling:n,includeDefault:r=!0}){var i,o;const a=(null!==(i=$U(t))&&void 0!==i?i:{}).title;if(!dU(t))return a;const s=t,u=r?NU(s,e):void 0;return n?ez(a,s.title,u):null!==(o=null!=a?a:s.title)&&void 0!==o?o:u}function $U(t){return _U(t)&&t.axis?t.axis:kU(t)&&t.legend?t.legend:iU(t)&&t.header?t.header:void 0}function NU(t,e){return OU(t,e)}function BU(t){var e;if(AU(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}{const n=null!==(e=$U(t))&&void 0!==e?e:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function TU(t){return dU(t)?t:fU(t)?t.condition:void 0}function jU(t){return vU(t)?t:hU(t)?t.condition:void 0}function IU(t,e,n){return cI(t)||lI(t)||uI(t)?(dL(function(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${OI(n)}}.`}(e,cI(t)?"string":lI(t)?"number":"boolean",t)),{value:t}):vU(t)?zU(t,e,n):hU(t)?Object.assign(Object.assign({},t),{condition:zU(t.condition,e,n)}):t}function zU(t,e,n){if(AU(t)){const{format:r,formatType:i}=t,o=dI(t,["format","formatType"]);if(Pq(i)&&!n.customFormatTypes)return dL(XP(e)),zU(o,e,n)}else{const r=_U(t)?"axis":kU(t)?"legend":iU(t)?"header":null;if(r&&t[r]){const i=t[r],{format:o,formatType:a}=i,s=dI(i,["format","formatType"]);if(Pq(a)&&!n.customFormatTypes)return dL(XP(e)),zU(Object.assign(Object.assign({},t),{[r]:s}),e,n)}}return dU(t)?RU(t,e):function(t){let e=t.type;if(e)return t;const{datum:n}=t;return e=lI(n)?"quantitative":cI(n)?"nominal":pL(n)?"temporal":void 0,Object.assign(Object.assign({},t),{type:e})}(t)}function RU(t,e){const{aggregate:n,timeUnit:r,bin:i,field:o}=t,a=Object.assign({},t);if(!n||Pz(n)||Rz(n)||zz(n)||(dL(function(t){return`Invalid aggregation operator "${t}".`}(n)),delete a.aggregate),r&&(a.timeUnit=CL(r)),o&&(a.field=`${o}`),BP(i)&&(a.bin=PU(i,e)),TP(i)&&!hP(e)&&dL(`Channel ${e} should not be used with "binned" bin.`),bU(a)){const{type:t}=a,e=function(t){if(t)switch(t=t.toLowerCase()){case"q":case XL:return"quantitative";case"t":case YL:return"temporal";case"o":case KL:return"ordinal";case"n":case JL:return"nominal";case ZL:return"geojson"}}(t);t!==e&&(a.type=e),"quantitative"!==t&&qz(n)&&(dL(function(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}(t,n)),a.type="quantitative")}else if(!VR(e)){const t=function(t,e){if(t.timeUnit)return"temporal";if(BP(t.bin))return"quantitative";switch($P(e)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative"}}(a,e);dL(function(t,e){return`Missing type for channel "${t}", using "${e}" instead.`}(e,t)),a.type=t}if(bU(a)){const{compatible:t,warning:n}=function(t,e){const n=t.type;if("geojson"===n&&"shape"!==e)return{compatible:!1,warning:`Channel ${e} should not be used with a geojson data.`};switch(e){case Vz:case Hz:case Gz:return SU(t)?{compatible:!1,warning:QP(e)}:LU;case Xz:case Kz:case aR:case sR:case uR:case yR:case bR:case xR:case wR:case _R:case kR:case fR:case tR:case Zz:case AR:return LU;case rR:case oR:case nR:case iR:return n!==XL?{compatible:!1,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}:LU;case hR:case dR:case pR:case gR:case cR:case eR:case Qz:case Yz:case Jz:return"nominal"!==n||t.sort?LU:{compatible:!1,warning:`Channel ${e} should not be used with an unsorted discrete field.`};case mR:return $I(["ordinal","nominal"],t.type)?LU:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case lR:return $I(["ordinal","nominal","geojson"],t.type)?LU:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case vR:return"nominal"!==t.type||"sort"in t?LU:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(a,e);t||dL(n)}if(sU(a)&&cI(a.sort)){const{sort:t}=a;if(Qq(t))return Object.assign(Object.assign({},a),{sort:{encoding:t}});const e=t.substr(1);if("-"===t.charAt(0)&&Qq(e))return Object.assign(Object.assign({},a),{sort:{encoding:e,order:"descending"}})}if(iU(a)){const{header:t}=a,{orient:e}=t,n=dI(t,["orient"]);if(e)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},n),{labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e})})}return a}function PU(t,e){return uI(t)?{maxbins:zP(e)}:"binned"===t?{binned:!0}:t.maxbins||t.step?t:Object.assign(Object.assign({},t),{maxbins:zP(e)})}const LU={compatible:!0};function qU(t){const{formatType:e}=BU(t);return"time"===e||!e&&function(t){return t&&("temporal"===t.type||dU(t)&&!!t.timeUnit)}(t)}function UU(t,{timeUnit:e,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var o;const a=e&&(null===(o=CL(e))||void 0===o?void 0:o.unit);let s,u=a||"temporal"===n;return OL(t)?s=t.signal:pL(t)?(u=!0,s=xL(t)):(cI(t)||lI(t))&&u&&(s=`datetime(${JSON.stringify(t)})`,function(t){return!!wL[t]}(a)&&(lI(t)&&t<1e4||cI(t)&&isNaN(Date.parse(t)))&&(s=xL({[a]:t}))),s?r&&u?`time(${s})`:s:i?void 0:JSON.stringify(t)}function WU(t,e){const{type:n}=t;return e.map((e=>{const r=UU(e,{timeUnit:dU(t)?t.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:e}))}function VU(t,e){return BP(t.bin)?CP(e)&&$I(["ordinal","nominal"],t.type):(console.warn("Only call this method for binned field defs."),!1)}function HU(t){const{anchor:e,frame:n,offset:r,orient:i,color:o,subtitleColor:a,subtitleFont:s,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:h}=t,d=dI(t,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},d),o?{fill:o}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a?{subtitleColor:a}:{}),s?{subtitleFont:s}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),h?{subtitlePadding:h}:{});return{titleMarkConfig:p,subtitleMarkConfig:SI(p,["align","baseline","dx","dy","limit"]),nonMark:g,subtitle:m}}function GU(t){return cI(t)||Qj(t)&&cI(t[0])}function XU(t){return OL(t)?t:void 0!==t?{value:t}:void 0}function KU(t){return OL(t)?t.signal:fI(t.value)}function YU(t){return OL(t)?t.signal:null==t?null:fI(t)}function JU(t){var e;return[].concat(t.type,null!==(e=t.style)&&void 0!==e?e:[])}function ZU(t,e,n,r={}){const{vgChannel:i,ignoreVgConfig:o}=r;return i&&void 0!==e[i]?e[i]:void 0!==e[t]?e[t]:!o||i&&i!==t?QU(t,e,n,r):void 0}function QU(t,e,n,{vgChannel:r}={}){return ez(r?tW(t,e,n.style):void 0,tW(t,e,n.style),r?n[e.type][r]:void 0,n[e.type][t],r?n.mark[r]:n.mark[t])}function tW(t,e,n){return eW(t,JU(e),n)}function eW(t,e,n){let r;e=oI(e);for(const i of e){const e=n[i];e&&void 0!==e[t]&&(r=e[t])}return r}function nW(t,e){return oI(t).reduce(((t,n)=>{var r;return t.field.push(EU(n,e)),t.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),t}),{field:[],order:[]})}function rW(t,e){const n=[...t];return e.forEach((t=>{for(const e of n)if(EI(e,t))return;n.push(t)})),n}function iW(t,e){return EI(t,e)||!e?t:t?[...oI(t),...oI(e)].join(", "):e}function oW(t,e){const n=t.value,r=e.value;if(null==n||null===r)return{explicit:t.explicit,value:null};if((GU(n)||OL(n))&&(GU(r)||OL(r)))return{explicit:t.explicit,value:iW(n,r)};if(GU(n)||OL(n))return{explicit:t.explicit,value:n};if(GU(r)||OL(r))return{explicit:t.explicit,value:r};if(!(GU(n)||OL(n)||GU(r)||OL(r)))return{explicit:t.explicit,value:rW(n,r)};throw new Error("It should never reach here")}function aW(t,e){const n=t&&t[e];return!!n&&(Qj(n)?NI(n,(t=>!!t.field)):dU(n)||fU(n))}function sW(t){return NI(BR,(e=>{if(aW(t,e)){const n=t[e];if(Qj(n))return NI(n,(t=>!!t.aggregate));{const t=TU(n);return t&&!!t.aggregate}}return!1}))}function uW(t,e){const n=[],r=[],i=[],o=[],a={};return fW(t,((s,u)=>{if(dU(s)){const{field:l,aggregate:c,bin:f,timeUnit:h}=s,d=dI(s,["field","aggregate","bin","timeUnit"]);if(c||h||f){const t=$U(s),p=t&&t.title;let g=EU(s,{forAs:!0});const m=Object.assign(Object.assign(Object.assign({},p?[]:{title:MU(s,e,{allowDisabling:!0})}),d),{field:g});if(c){let t;if(Rz(c)?(t="argmax",g=EU({op:"argmax",field:c.argmax},{forAs:!0}),m.field=`${g}.${l}`):zz(c)?(t="argmin",g=EU({op:"argmin",field:c.argmin},{forAs:!0}),m.field=`${g}.${l}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(t=c),t){const e={op:t,as:g};l&&(e.field=l),o.push(e)}}else if(n.push(g),bU(s)&&BP(f)){if(r.push({bin:f,field:l,as:g}),n.push(EU(s,{binSuffix:"end"})),VU(s,u)&&n.push(EU(s,{binSuffix:"range"})),hP(u)){const t={field:g+"_end"};a[u+"2"]=t}m.bin="binned",VR(u)||(m.type=XL)}else if(h){i.push({timeUnit:h,field:l,as:g});const t=bU(s)&&s.type!==YL&&"time";t&&(u===yR||u===wR?m.formatType=t:function(t){return!!uP[t]}(u)?m.legend=Object.assign({formatType:t},m.legend):hP(u)&&(m.axis=Object.assign({formatType:t},m.axis)))}a[u]=m}else n.push(l),a[u]=t[u]}else a[u]=t[u]})),{bins:r,timeUnits:i,aggregate:o,groupby:n,encoding:a}}function lW(t,e,n){const r=e.type;return LI(t).reduce(((i,o)=>{if(!UR(o))return dL(function(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}(o)),i;const a=t[o];if("angle"!==o||"arc"!==r||t.theta||(dL("Arc marks uses theta channel rather than angle, replacing angle with theta."),o=tR),!function(t,e,n){const r=function(t,e){return function(t){switch(t){case aR:case sR:case uR:case AR:case bR:case xR:case wR:case _R:case vR:case hR:case dR:case pR:case gR:case Gz:case Vz:case Hz:return OP;case Xz:case Kz:case nR:case rR:return MP;case Yz:case Jz:case iR:case oR:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case cR:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case mR:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case lR:return{point:"always",geoshape:"always"};case yR:return{text:"always"};case fR:return{point:"always",square:"always",text:"always"};case kR:return{image:"always"};case tR:case Zz:return{text:"always",arc:"always"};case eR:case Qz:return{arc:"always"}}}(t)[e]}(e,n);if(!r)return!1;if("binned"===r){const n=t[e===Yz?Xz:Kz];return!!(dU(n)&&dU(t[e])&&TP(n.bin))}return!0}(t,o,r))return dL(ZP(o,r)),i;if(o===cR&&"line"===r){const e=TU(t[o]);if(null==e?void 0:e.aggregate)return dL("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(o===aR&&(e.filled?"fill"in t:"stroke"in t))return dL(YP("encoding",{fill:"fill"in t,stroke:"stroke"in t})),i;if(o===bR||o===vR&&!Qj(a)&&!xU(a)||o===wR&&Qj(a))a&&(i[o]=oI(a).reduce(((t,e)=>(dU(e)?t.push(RU(e,o)):dL(JP(e,o)),t)),[]));else{if(o===wR&&null===a)i[o]=null;else if(!(dU(a)||gU(a)||xU(a)||cU(a)||OL(a)))return dL(JP(a,o)),i;i[o]=IU(a,o,n)}return i}),{})}function cW(t){const e=[];for(const n of LI(t))if(aW(t,n)){const r=oI(t[n]);for(const t of r)dU(t)?e.push(t):fU(t)&&e.push(t.condition)}return e}function fW(t,e,n){if(t)for(const r of LI(t)){const i=t[r];if(Qj(i))for(const t of i)e.call(n,t,r);else e.call(n,i,r)}}function hW(t,e,n,r){return t?LI(t).reduce(((n,i)=>{const o=t[i];return Qj(o)?o.reduce(((t,n)=>e.call(r,t,n,i)),n):e.call(r,n,o,i)}),n):n}function dW(t,e){return LI(e).reduce(((n,r)=>{switch(r){case Xz:case Kz:case _R:case AR:case kR:case Yz:case Jz:case tR:case eR:case Zz:case Qz:case nR:case rR:case iR:case oR:case yR:case lR:case fR:case wR:return n;case vR:if("line"===t||"trail"===t)return n;case bR:case xR:{const t=e[r];if(Qj(t)||dU(t))for(const e of oI(t))e.aggregate||n.push(EU(e,{}));return n}case cR:if("trail"===t)return n;case aR:case sR:case uR:case hR:case dR:case pR:case mR:case gR:{const t=TU(e[r]);return t&&!t.aggregate&&n.push(EU(t,{})),n}}}),[])}function pW(t,e,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...t.map((({fieldPrefix:t,titlePrefix:n})=>{const i=r?` of ${e.field}`:"";return{field:t+e.field,type:e.type,title:OL(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...cW(n)]}}function gW(t){const{axis:e,title:n,field:r}=t;return e&&void 0!==e.title?void 0:ez(n,r)}function mW(t,e,n,r,i){const{scale:o,axis:a}=n;return({partName:s,mark:u,positionPrefix:l,endPositionPrefix:c,aria:f,extraEncoding:h={}})=>{const d=gW(n);return yW(t,s,i,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==o?{scale:o}:{}),void 0!==a?{axis:a}:{})},cI(c)?{[e+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function yW(t,e,n,r,i){const{clip:o,color:a,opacity:s}=t,u=t.type;return t[e]||void 0===t[e]&&n[e]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[e]),o?{clip:o}:{}),a?{color:a}:{}),s?{opacity:s}:{}),Fz(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${e}`}),uI(t[e])?{}:t[e]),!1===r?{aria:r}:{})})]:[]}function vW(t,e,n){const{encoding:r}=t,i="vertical"===e?"y":"x",o=r[i],a=r[i+"2"],s=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:bW(o,n),continuousAxisChannelDef2:bW(a,n),continuousAxisChannelDefError:bW(s,n),continuousAxisChannelDefError2:bW(u,n),continuousAxis:i}}function bW(t,e){if(t&&t.aggregate){const{aggregate:n}=t,r=dI(t,["aggregate"]);return n!==e&&dL(function(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}(n,e)),r}return t}function xW(t,e){const{mark:n,encoding:r}=t,{x:i,y:o}=r;if(mU(i)){if(mU(o)){const t=dU(i)&&i.aggregate,r=dU(o)&&o.aggregate;if(t||r!==e){if(r||t!==e){if(t===e&&r===e)throw new Error("Both x and y cannot have aggregate");return Fz(n)&&n.orient?n.orient:"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(mU(o))return"vertical";throw new Error("Need a valid continuous axis for "+e+"s")}const wW="boxplot",_W=new Tz(wW,AW);function kW(t){return lI(t)?"tukey":t}function AW(t,{config:e}){var n,r;const{mark:i,encoding:o,selection:a,projection:s}=t,u=dI(t,["mark","encoding","selection","projection"]),l=Fz(i)?i:{type:i};a&&dL(VP("boxplot"));const c=null!==(n=l.extent)&&void 0!==n?n:e.boxplot.extent,f=ZU("size",l,e),h=kW(c),{transform:d,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:x,customTooltipWithoutAggregatedField:w}=function(t,e,n){const r=xW(t,wW),{continuousAxisChannelDef:i,continuousAxis:o}=vW(t,r,wW),a=i.field,s=kW(e),u=[...EW(a),{op:"median",field:a,as:"mid_box_"+a},{op:"min",field:a,as:("min-max"===s?"lower_whisker_":"min_")+a},{op:"max",field:a,as:("min-max"===s?"upper_whisker_":"max_")+a}],l="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${a}"] - datum["lower_box_${a}"]`,as:"iqr_"+a},{calculate:`min(datum["upper_box_${a}"] + datum["iqr_${a}"] * ${e}, datum["max_${a}"])`,as:"upper_whisker_"+a},{calculate:`max(datum["lower_box_${a}"] - datum["iqr_${a}"] * ${e}, datum["min_${a}"])`,as:"lower_whisker_"+a}],c=t.encoding,f=o,h=(c[f],dI(c,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=function(t){const{tooltip:e}=t,n=dI(t,["tooltip"]);if(!e)return{filteredEncoding:t};let r,i;if(Qj(e)){for(const t of e)t.aggregate?(r||(r=[]),r.push(t)):(i||(i=[]),i.push(t));r&&(n.tooltip=r)}else e.aggregate?n.tooltip=e:i=e;return Qj(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(h),{bins:g,timeUnits:m,aggregate:y,groupby:v,encoding:b}=uW(p,n),x="vertical"===r?"horizontal":"vertical",w=r;return{transform:[...g,...m,{aggregate:[...y,...u],groupby:v},...l],groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:o,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:d}}(t,c,e),{color:_,size:k}=v,A=dI(v,["color","size"]),E=t=>mW(l,g,p,t,e.boxplot),D=E(A),S=E(v),C=E(Object.assign(Object.assign({},A),k?{size:k}:{})),O=pW([{fieldPrefix:"min-max"===h?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===h?"lower_whisker_":"min_",titlePrefix:"Min"}],p,v),F={type:"tick",color:"black",opacity:1,orient:b,invalid:null},M="min-max"===h?O:pW([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,v),$=[...D({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:M}),...D({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:M}),...D({partName:"ticks",mark:F,positionPrefix:"lower_whisker",aria:!1,extraEncoding:M}),...D({partName:"ticks",mark:F,positionPrefix:"upper_whisker",aria:!1,extraEncoding:M})],N=[..."tukey"!==h?$:[],...S({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:O}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},tI(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),f?{size:f}:{}),{orient:b,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:O})];let B;if("min-max"!==h){const t=`datum["lower_box_${p.field}"]`,n=`datum["upper_box_${p.field}"]`,r=`(${n} - ${t})`,i=`${t} - ${c} * ${r}`,o=`${n} + ${c} * ${r}`,a=`datum["${p.field}"]`,s={joinaggregate:EW(p.field),groupby:m};let u;"tukey"===h&&(u={transform:[{filter:`(${i} <= ${a}) && (${a} <= ${o})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:m}],layer:$});const{tooltip:f}=A,d=dI(A,["tooltip"]),{scale:v,axis:b}=p,x=gW(p),_=yW(l,"outliers",e.boxplot,!0,{transform:[{filter:`(${a} < ${i}) || (${a} > ${o})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},void 0!==x?{title:x}:{}),void 0!==v?{scale:v}:{}),void 0!==b?{axis:b}:{})},d),w?{tooltip:w}:{})})[0];_&&u?B={transform:[s],layer:[_,u]}:_?(B=_,B.transform.unshift(s)):u&&(B=u,B.transform.unshift(s))}return B?Object.assign(Object.assign({},u),{layer:[B,{transform:d,layer:N}]}):Object.assign(Object.assign({},u),{transform:(null!==(r=u.transform)&&void 0!==r?r:[]).concat(d),layer:N})}function EW(t){return[{op:"q1",field:t,as:"lower_box_"+t},{op:"q3",field:t,as:"upper_box_"+t}]}const DW="errorbar",SW=new Tz(DW,CW);function CW(t,{config:e}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:o,ticksOrient:a,markDef:s,outerSpec:u,tooltipEncoding:l}=OW(t,DW,e),c=mW(s,i,r,o,e.errorbar),f={type:"tick",orient:a},h=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function OW(t,e,n){var r;const{mark:i,encoding:o,selection:a,projection:s}=t,u=dI(t,["mark","encoding","selection","projection"]),l=Fz(i)?i:{type:i};a&&dL(VP(e));const{orient:c,inputType:f}=function(t,e){const{encoding:n}=t;if(function(t){return(vU(t.x)||vU(t.y))&&!vU(t.x2)&&!vU(t.y2)&&!vU(t.xError)&&!vU(t.xError2)&&!vU(t.yError)&&!vU(t.yError2)}(n))return{orient:xW(t,e),inputType:"raw"};const r=function(t){return vU(t.x2)||vU(t.y2)}(n),i=function(t){return vU(t.xError)||vU(t.xError2)||vU(t.yError)||vU(t.yError2)}(n),o=n.x,a=n.y;if(r){if(i)throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`);const t=n.x2,r=n.y2;if(vU(t)&&vU(r))throw new Error(`${e} cannot have both x2 and y2`);if(vU(t)){if(mU(o))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${e}`)}if(vU(r)){if(mU(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${e}`)}throw new Error("No ranged axis")}{const t=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(vU(r)&&!vU(t))throw new Error(`${e} cannot have xError2 without xError`);if(vU(s)&&!vU(i))throw new Error(`${e} cannot have yError2 without yError`);if(vU(t)&&vU(i))throw new Error(`${e} cannot have both xError and yError with both are quantiative`);if(vU(t)){if(mU(o))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(vU(i)){if(mU(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}(t,e),{continuousAxisChannelDef:h,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=vW(t,c,e),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(t,e,n,r,i,o,a,s){let u=[],l=[];const c=e.field;let f,h=!1;if("raw"===o){const e=t.center?t.center:t.extent?"iqr"===t.extent?"median":"mean":s.errorbar.center,n=t.extent?t.extent:"mean"===e?"stderr":"iqr";if("median"===e!=("iqr"===n)&&dL(function(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}(e,n,a)),"stderr"===n||"stdev"===n)u=[{op:n,field:c,as:"extent_"+c},{op:e,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:XI(e)},{fieldPrefix:"upper_",titlePrefix:FW(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:FW(e,n,"-")}],h=!0;else{let e,r,i;t.center&&t.extent&&dL(function(t,e){return`Center is not needed to be specified in ${e} when extent is ${t}.`}(t.extent,a)),"ci"===n?(e="mean",r="ci0",i="ci1"):(e="median",r="q1",i="q3"),u=[{op:r,field:c,as:"lower_"+c},{op:i,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:MU({field:c,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:MU({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:MU({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(t.center||t.extent)&&dL(function(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}(t.center,t.extent)),"aggregated-upper-lower"===o?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===o&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?l.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const t of l)f.push({fieldPrefix:t.as.substring(0,6),titlePrefix:ZI(ZI(t.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:h}}(l,h,d,p,g,f,e,n),w=o,_=m,k=(w[_],"x"===m?"x2":"y2"),A=(w[k],"x"===m?"xError":"yError"),E=(w[A],"x"===m?"xError2":"yError2"),D=(w[E],dI(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof A?A:A+"","symbol"==typeof E?E:E+""])),{bins:S,timeUnits:C,aggregate:O,groupby:F,encoding:M}=uW(D,n),$=[...O,...y],N="raw"!==f?[]:F,B=pW(b,h,M,x);return{transform:[...null!==(r=u.transform)&&void 0!==r?r:[],...S,...C,...0===$.length?[]:[{aggregate:$,groupby:N}],...v],groupby:N,continuousAxisChannelDef:h,continuousAxis:m,encodingWithoutContinuousAxis:M,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:B}}function FW(t,e,n){return XI(t)+" "+n+" "+e}const MW="errorband",$W=new Tz(MW,NW);function NW(t,{config:e}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:o,markDef:a,outerSpec:s,tooltipEncoding:u}=OW(t,MW,e),l=a,c=mW(l,i,r,o,e.errorband),f=void 0!==t.encoding.x&&void 0!==t.encoding.y;let h={type:f?"area":"rect"},d={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),d=Object.assign(Object.assign({},d),p)):l.interpolate?dL(uL("interpolate")):l.tension&&dL(uL("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const BW={};function TW(t,e,n){const r=new Tz(t,e);BW[t]={normalizer:r,parts:n}}TW(wW,AW,["box","median","outliers","rule","ticks"]),TW(DW,CW,["ticks","rule"]),TW(MW,NW,["band","borders"]);const jW=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],IW=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],zW={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},RW={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},PW=(LI(RW),"_vgsid_"),LW={single:{on:"click",fields:[PW],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[PW],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function qW(t){return!(!t||"legend"!==t&&!t.legend)}function UW(t){return qW(t)&&tI(t)}function WW(t){return"concat"in t}function VW(t){return"vconcat"in t}function HW(t){return"hconcat"in t}function GW(t){return tI(t)&&void 0!==t.step}function XW(t){return t.view||t.width||t.height}const KW=LI({align:1,bounds:1,center:1,columns:1,spacing:1});function YW(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:t["width"===e?"continuousWidth":"continuousHeight"]}function JW(t,e){const n=ZW(t,e);return GW(n)?n.step:QW}function ZW(t,e){var n;return ez(null!==(n=t[e])&&void 0!==n?n:t["width"===e?"discreteWidth":"discreteHeight"],{step:t.step})}const QW=20,tV={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:QW},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:LW,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},eV=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],nV={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},rV={blue:eV[0],orange:eV[1],red:eV[2],teal:eV[3],green:eV[4],yellow:eV[5],purple:eV[6],pink:eV[7],brown:eV[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function iV(t={}){const{color:e,font:n,fontSize:r}=t,i=dI(t,["color","font","fontSize"]);return nI({},tV,n?function(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}(n):{},e?function(t={}){return{signals:[{name:"color",value:tI(t)?Object.assign(Object.assign({},rV),t):rV}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(e):{},r?function(t){return{signals:[{name:"fontSize",value:tI(t)?Object.assign(Object.assign({},nV),t):nV}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{})}const oV=["view",...Oz],aV=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],sV=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function uV(t,e,n,r){const i=r?t[e][r]:t[e];"view"===e&&(n="cell");const o=Object.assign(Object.assign({},i),t.style[null!=n?n:e]);PI(o)||(t.style[null!=n?n:e]=o),r||delete t[e]}function lV(t){return"layer"in t}class cV{map(t,e){return oU(t)?this.mapFacet(t,e):function(t){return"repeat"in t}(t)?this.mapRepeat(t,e):HW(t)?this.mapHConcat(t,e):VW(t)?this.mapVConcat(t,e):WW(t)?this.mapConcat(t,e):this.mapLayerOrUnit(t,e)}mapLayerOrUnit(t,e){if(lV(t))return this.mapLayer(t,e);if(Bz(t))return this.mapUnit(t,e);throw new Error(RP(t))}mapLayer(t,e){return Object.assign(Object.assign({},t),{layer:t.layer.map((t=>this.mapLayerOrUnit(t,e)))})}mapHConcat(t,e){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map((t=>this.map(t,e)))})}mapVConcat(t,e){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map((t=>this.map(t,e)))})}mapConcat(t,e){const{concat:n}=t,r=dI(t,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((t=>this.map(t,e)))})}mapFacet(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}mapRepeat(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}}const fV={zero:1,center:1,normalize:1},hV=new Set([dz,gz,pz,xz,vz,Az,Ez,yz,wz,_z]),dV=new Set([gz,pz,dz]);function pV(t,e){var n,r;const i="x"===e?"y":"radius",o=t[e],a=t[i];if(dU(o)&&dU(a))if("quantitative"===pU(o)&&"quantitative"===pU(a)){if(o.stack)return e;if(a.stack)return i;const t=dU(o)&&!!o.aggregate;if(t!==(dU(a)&&!!a.aggregate))return t?e:i;{const t=null===(n=o.scale)||void 0===n?void 0:n.type,s=null===(r=a.scale)||void 0===r?void 0:r.type;if(t&&"linear"!==t)return i;if(s&&"linear"!==s)return e}}else{if("quantitative"===pU(o))return e;if("quantitative"===pU(a))return i}else{if("quantitative"===pU(o))return e;if("quantitative"===pU(a))return i}}function gV(t,e,n={}){const r=Fz(t)?t.type:t;if(!hV.has(r))return null;const i=pV(e,"x")||pV(e,"theta");if(!i)return null;const o=e[i],a=dU(o)?EU(o,{}):void 0;let s=function(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),u=e[s],l=dU(u)?EU(u,{}):void 0;l===a&&(l=void 0,u=void 0,s=void 0);const c=lP.reduce(((t,n)=>{if("tooltip"!==n&&aW(e,n)){const r=e[n];for(const e of oI(r)){const r=TU(e);if(r.aggregate)continue;const i=EU(r,{});i&&i===l||t.push({channel:n,fieldDef:r})}}return t}),[]);let f;if(void 0!==o.stack?f=uI(o.stack)?o.stack?"zero":null:o.stack:c.length>0&&dV.has(r)&&(f="zero"),!f||!(f in fV))return null;var h;if(sW(e)&&0===c.length)return null;if(o.scale&&o.scale.type&&o.scale.type!==tq){if(n.disallowNonLinearStack)return null;dL(function(t){return`Cannot stack non-linear scale (${t}).`}(o.scale.type))}return vU(e[XR(i)])?(void 0!==o.stack&&dL(`Cannot stack "${h=i}" if there is already "${h}2".`),null):(dU(o)&&o.aggregate&&!$I(Uz,o.aggregate)&&dL(`Stacking is applied even though the aggregate function is non-summative ("${o.aggregate}").`),{groupbyChannel:u?s:void 0,groupbyField:l,fieldChannel:i,impute:null!==o.impute&&Sz(r),stackBy:c,offset:f})}function mV(t){const{point:e,line:n}=t,r=dI(t,["point","line"]);return LI(r).length>1?r:r.type}function yV(t){for(const e of["line","area","rule","trail"])t[e]&&(t=Object.assign(Object.assign({},t),{[e]:CI(t[e],["point","line"])}));return t}function vV(t,e={},n){return"transparent"===t.point?{opacity:0}:t.point?tI(t.point)?t.point:{}:void 0!==t.point?null:e.point||n.shape?tI(e.point)?e.point:{}:void 0}function bV(t,e={}){return t.line?!0===t.line?{}:t.line:void 0!==t.line?null:e.line?!0===e.line?{}:e.line:void 0}class xV{constructor(){this.name="path-overlay"}hasMatchingType(t,e){if(Bz(t)){const{mark:n,encoding:r}=t,i=Fz(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!vV(i,e[i.type],r);case"area":return!!vV(i,e[i.type],r)||!!bV(i,e[i.type])}}return!1}run(t,e,n){const{config:r}=e,{selection:i,projection:o,encoding:a,mark:s}=t,u=dI(t,["selection","projection","encoding","mark"]),l=Fz(s)?s:{type:s},c=vV(l,r[l.type],a),f="area"===l.type&&bV(l,r[l.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:mV(Object.assign(Object.assign({},"area"===l.type&&void 0===l.opacity&&void 0===l.fillOpacity?{opacity:.7}:{}),l)),encoding:CI(a,["shape"])})],d=gV(l,a);let p=a;if(d){const{fieldChannel:t,offset:e}=d;p=Object.assign(Object.assign({},a),{[t]:Object.assign(Object.assign({},a[t]),e?{stack:e}:{})})}return f&&h.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},SI(l,["clip","interpolate","tension","tooltip"])),f),encoding:p})),c&&h.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},SI(l,["clip","tooltip"])),c),encoding:p})),n(Object.assign(Object.assign({},u),{layer:h}),Object.assign(Object.assign({},e),{config:yV(r)}))}}class wV{constructor(){this.name="RangeStep"}hasMatchingType(t){var e;if(Bz(t)&&t.encoding)for(const n of fP){const r=t.encoding[n];if(r&&vU(r)&&(null===(e=null==r?void 0:r.scale)||void 0===e?void 0:e.rangeStep))return!0}return!1}run(t){var e;const n={};let r=Object.assign({},t.encoding);for(const t of fP){const i=KR(t),o=r[t];if(o&&vU(o)&&(null===(e=null==o?void 0:o.scale)||void 0===e?void 0:e.rangeStep)){const{scale:e}=o,a=dI(o,["scale"]),s=e,{rangeStep:u}=s,l=dI(s,["rangeStep"]);n[i]={step:e.rangeStep},dL('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[t]:Object.assign(Object.assign({},a),PI(l)?{}:{scale:l})})}}return Object.assign(Object.assign(Object.assign({},n),t),{encoding:r})}}function _V(t,e){return e?rU(t)?CV(t,e):EV(t,e):t}function kV(t,e){return e?CV(t,e):t}function AV(t,e,n){const r=e[t];return(i=r)&&!cI(i)&&"repeat"in i?r.repeat in n?Object.assign(Object.assign({},e),{[t]:n[r.repeat]}):void dL(function(t){return`Unknown repeated value "${t}".`}(r.repeat)):e;var i}function EV(t,e){if(void 0!==(t=AV("field",t,e))){if(null===t)return null;if(sU(t)&&eU(t.sort)){const n=AV("field",t.sort,e);t=Object.assign(Object.assign({},t),n?{sort:n}:{})}return t}}function DV(t,e){if(dU(t))return EV(t,e);{const n=AV("datum",t,e);return n===t||n.type||(n.type="nominal"),n}}function SV(t,e){if(!vU(t)){if(hU(t)){const n=DV(t.condition,e);if(n)return Object.assign(Object.assign({},t),{condition:n});{const{condition:e}=t;return dI(t,["condition"])}}return t}{const n=DV(t,e);if(n)return n;if(cU(t))return{condition:t.condition}}}function CV(t,e){const n={};for(const r in t)if(sI(t,r)){const i=t[r];if(Qj(i))n[r]=i.map((t=>SV(t,e))).filter((t=>t));else{const t=SV(i,e);void 0!==t&&(n[r]=t)}}return n}class OV{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Bz(t)){const{encoding:e,mark:n}=t;if("line"===n)for(const t of WR){const n=e[HR(t)];if(e[t]&&(dU(n)&&!TP(n.bin)||gU(n)))return!0}}return!1}run(t,e,n){const{encoding:r}=t;var i,o;return dL((i=!!r.x2,o=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&o?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},t),{mark:"rule"}),e)}}function FV(t){const{parentEncoding:e,encoding:n}=t;if(e&&n){const t=LI(e).reduce(((t,e)=>(n[e]&&t.push(e),t)),[]);t.length>0&&dL(`Layer's shared ${(r=t).join(",")} channel ${1===r.length?"is":"are"} overriden.`)}var r;const i=Object.assign(Object.assign({},null!=e?e:{}),null!=n?n:{});return PI(i)?void 0:i}function MV(t){const{parentProjection:e,projection:n}=t;return e&&n&&dL(function(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${OI(e)} is overridden by a child projection ${OI(n)}.`}({parentProjection:e,projection:n})),null!=n?n:e}function $V(t,e){void 0===e&&(e=iV(t.config));const n=function(t,e={}){return NV.map(t,{config:e})}(t,e),{width:r,height:i}=t,o=function(t,e,n){let{width:r,height:i}=e;const o=Bz(t)||lV(t),a={};o?"container"==r&&"container"==i?(a.type="fit",a.contains="padding"):"container"==r?(a.type="fit-x",a.contains="padding"):"container"==i&&(a.type="fit-y",a.contains="padding"):("container"==r&&(dL(PP("width")),r=void 0),"container"==i&&(dL(PP("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},a),n?BV(n.autosize):{}),BV(t.autosize));if("fit"!==s.type||o||(dL('Autosize "fit" only works for single views and layered views.'),s.type="pad"),"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&dL(LP("width")),"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&dL(LP("height")),!EI(s,{type:"pad"}))return s}(n,{width:r,height:i,autosize:t.autosize},e);return Object.assign(Object.assign({},n),o?{autosize:o}:{})}const NV=new class extends cV{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[_W,SW,$W,new xV,new OV,new wV]}map(t,e){if(Bz(t)){const n=aW(t.encoding,Vz),r=aW(t.encoding,Hz),i=aW(t.encoding,Gz);if(n||r||i)return this.mapFacetedUnit(t,e)}return super.map(t,e)}mapUnit(t,e){const{parentEncoding:n,parentProjection:r}=e,i=Object.assign(Object.assign({},t),{encoding:kV(t.encoding,e.repeater)});if(n||r)return this.mapUnitWithParentEncodingOrProjection(i,e);const o=this.mapLayerOrUnit.bind(this);for(const t of this.nonFacetUnitNormalizers)if(t.hasMatchingType(i,e.config))return t.run(i,e,o);return i}mapRepeat(t,e){return function(t){return!Qj(t.repeat)&&t.repeat.layer}(t)?this.mapLayerRepeat(t,e):this.mapNonLayerRepeat(t,e)}mapLayerRepeat(t,e){const{repeat:n,spec:r}=t,i=dI(t,["repeat","spec"]),{row:o,column:a,layer:s}=n,{repeater:u={},repeaterPrefix:l=""}=e;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:s},spec:r}}),e):Object.assign(Object.assign({},i),{layer:s.map((t=>{const n=Object.assign(Object.assign({},u),{layer:t}),i=(r.name||"")+l+`child__layer_${VI(t)}`,o=this.mapLayerOrUnit(r,Object.assign(Object.assign({},e),{repeater:n,repeaterPrefix:i}));return o.name=i,o}))})}mapNonLayerRepeat(t,e){var n;const{repeat:r,spec:i,data:o}=t,a=dI(t,["repeat","spec","data"]);!Qj(r)&&t.columns&&(t=CI(t,["columns"]),dL(HP("repeat")));const s=[],{repeater:u={},repeaterPrefix:l=""}=e,c=!Qj(r)&&r.row||[u?u.row:null],f=!Qj(r)&&r.column||[u?u.column:null],h=Qj(r)&&r||[u?u.repeat:null];for(const t of h)for(const n of c)for(const o of f){const a={repeat:t,row:n,column:o,layer:u.layer},c=(i.name||"")+l+"child__"+(Qj(r)?`${VI(t)}`:(r.row?`row_${VI(n)}`:"")+(r.column?`column_${VI(o)}`:"")),f=this.map(i,Object.assign(Object.assign({},e),{repeater:a,repeaterPrefix:c}));f.name=c,s.push(CI(f,["data"]))}const d=Qj(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:o,align:"all"},a),{columns:d,concat:s})}mapFacet(t,e){const{facet:n}=t;return rU(n)&&t.columns&&(t=CI(t,["columns"]),dL(HP("facet"))),super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){const{encoding:n,projection:r}=t,{parentEncoding:i,parentProjection:o,config:a}=e,s=MV({parentProjection:o,projection:r}),u=FV({parentEncoding:i,encoding:kV(n,e.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),s?{projection:s}:{}),u?{encoding:u}:{}),{config:a})}mapFacetedUnit(t,e){const n=t.encoding,{row:r,column:i,facet:o}=n,a=dI(n,["row","column","facet"]),{mark:s,width:u,projection:l,height:c,view:f,selection:h,encoding:d}=t,p=dI(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:r,column:i,facet:o},e),y=kV(a,e.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),m),{facet:g,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{width:u}:{}),c?{height:c}:{}),f?{view:f}:{}),l?{projection:l}:{}),{mark:s,encoding:y}),h?{selection:h}:{})}),e)}getFacetMappingAndLayout(t,e){var n;const{row:r,column:i,facet:o}=t;if(r||i){o&&dL(`Facet encoding dropped as ${(a=[...r?[Vz]:[],...i?[Hz]:[]]).join(" and ")} ${a.length>1?"are":"is"} also specified.`);const e={},s={};for(const r of[Vz,Hz]){const i=t[r];if(i){const{align:t,center:o,spacing:a,columns:u}=i,l=dI(i,["align","center","spacing","columns"]);e[r]=l;for(const t of["align","center","spacing"])void 0!==i[t]&&(s[t]=null!==(n=s[t])&&void 0!==n?n:{},s[t][r]=i[t])}}return{facetMapping:e,layout:s}}{const{align:t,center:n,spacing:r,columns:i}=o;return{facetMapping:_V(dI(o,["align","center","spacing","columns"]),e.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},t?{align:t}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var a}mapLayer(t,e){var{parentEncoding:n,parentProjection:r}=e,i=dI(e,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,s=dI(t,["encoding","projection"]),u=Object.assign(Object.assign({},i),{parentEncoding:FV({parentEncoding:n,encoding:o}),parentProjection:MV({parentProjection:r,projection:a})});return super.mapLayer(s,u)}};function BV(t){return cI(t)?{type:t}:null!=t?t:{}}const TV=["background","padding"];function jV(t){return TV.reduce(((e,n)=>(t&&void 0!==t[n]&&(e[n]=t[n]),e)),{})}class IV{constructor(t={},e={}){this.explicit=t,this.implicit=e}clone(){return new IV(DI(this.explicit),DI(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return ez(this.explicit[t],this.implicit[t])}getWithExplicit(t){return void 0!==this.explicit[t]?{explicit:!0,value:this.explicit[t]}:void 0!==this.implicit[t]?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,e){void 0!==e.value&&this.set(t,e.value,e.explicit)}set(t,e,n){return delete this[n?"implicit":"explicit"][t],this[n?"explicit":"implicit"][t]=e,this}copyKeyFromSplit(t,e){void 0!==e.explicit[t]?this.set(t,e.explicit[t],!0):void 0!==e.implicit[t]&&this.set(t,e.implicit[t],!1)}copyKeyFromObject(t,e){void 0!==e[t]&&this.set(t,e[t],!0)}copyAll(t){for(const e of LI(t.combine())){const n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}}function zV(t){return{explicit:!0,value:t}}function RV(t){return{explicit:!1,value:t}}function PV(t){return(e,n,r,i)=>{const o=t(e.value,n.value);return o>0?e:o<0?n:LV(e,n,r,i)}}function LV(t,e,n,r){return t.explicit&&e.explicit&&dL(function(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${OI(n)} and ${OI(r)}). Using ${OI(n)}.`}(n,r,t.value,e.value)),t}function qV(t,e,n,r,i=LV){return void 0===t||void 0===t.value?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:EI(t.value,e.value)?t:i(t,e,n,r)}class UV extends IV{constructor(t={},e={},n=!1){super(t,e),this.explicit=t,this.implicit=e,this.parseNothing=n}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function WV(t){return"url"in t}function VV(t){return"values"in t}function HV(t){return"name"in t&&!WV(t)&&!VV(t)&&!GV(t)}function GV(t){return t&&(XV(t)||KV(t)||YV(t))}function XV(t){return"sequence"in t}function KV(t){return"sphere"in t}function YV(t){return"graticule"in t}const JV="main",ZV="raw";function QV(t){return"filter"in t}function tH(t){return"lookup"in t}function eH(t){return"pivot"in t}function nH(t){return"density"in t}function rH(t){return"quantile"in t}function iH(t){return"regression"in t}function oH(t){return"loess"in t}function aH(t){return"sample"in t}function sH(t){return"window"in t}function uH(t){return"joinaggregate"in t}function lH(t){return"flatten"in t}function cH(t){return"calculate"in t}function fH(t){return"bin"in t}function hH(t){return"impute"in t}function dH(t){return"timeUnit"in t}function pH(t){return"aggregate"in t}function gH(t){return"stack"in t}function mH(t){return"fold"in t}function yH(t,e,n,r){const i=cU(e)&&e.condition,o=r(e);return i?{[n]:[...oI(i).map((e=>{const n=r(e),i=function(t){return t.selection}(e)?RX(t,e.selection):LX(t,e.test);return Object.assign({test:i},n)})),...void 0!==o?[o]:[]]}:void 0!==o?{[n]:o}:{}}function vH(t,e="text"){const n=t.encoding[e];return yH(t,n,e,(e=>bH(e,t.config)))}function bH(t,e,n="datum"){if(t){if(xU(t))return XU(t.value);if(vU(t)){const{format:r,formatType:i}=BU(t);return qq({fieldOrDatumDef:t,format:r,formatType:i,expr:n,config:e})}}}function xH(t,e={}){const{encoding:n,markDef:r,config:i,stack:o}=t,a=n.tooltip;if(Qj(a))return{tooltip:_H({tooltip:a},o,i,e)};{const s=e.reactiveGeom?"datum.datum":"datum";return yH(t,a,"tooltip",(t=>{const a=bH(t,i,s);if(a)return a;if(null===t)return;let u=ZU("tooltip",r,i);return!0===u&&(u={content:"encoding"}),cI(u)?{value:u}:tI(u)?"encoding"===u.content?_H(n,o,i,e):{signal:s}:void 0}))}}function wH(t,e,n,{reactiveGeom:r}={}){const i={},o=r?"datum.datum":"datum",a=[];function s(r,s){const u=HR(s),l=bU(r)?r:Object.assign(Object.assign({},r),{type:t[u].type}),c=oI(MU(l,n,{allowDisabling:!1})).join(", ");let f;if(hP(s)){const r="x"===s?"x2":"y2",a=TU(t[r]);if(TP(l.bin)&&a){const t=EU(l,{expr:o}),e=EU(a,{expr:o}),{format:s,formatType:u}=BU(l);f=Yq(t,e,s,u,n),i[r]=!0}else if(e&&e.fieldChannel===s&&"normalize"===e.offset){const{format:t,formatType:e}=BU(l);f=qq({fieldOrDatumDef:l,format:t,formatType:e,expr:o,config:n,normalizeStack:!0}).signal}}f=null!=f?f:bH(l,n,o).signal,a.push({channel:s,key:c,value:f})}fW(t,((t,e)=>{dU(t)?s(t,e):fU(t)&&s(t.condition,e)}));const u={};for(const{channel:t,key:e,value:n}of a)i[t]||u[e]||(u[fI(e)]=n);return u}function _H(t,e,n,{reactiveGeom:r}={}){const i=UI(wH(t,e,n,{reactiveGeom:r})).map((({key:t,value:e})=>`${t}: ${e}`));return i.length>0?{signal:`{${i.join(", ")}}`}:void 0}function kH(t,e,n={}){const{markDef:r,encoding:i,config:o}=e,{vgChannel:a}=n;let{defaultRef:s,defaultValue:u}=n;void 0===s&&(u=null!=u?u:ZU(t,r,o,{vgChannel:a,ignoreVgConfig:!0}),void 0!==u&&(s=XU(u)));const l=i[t];return yH(e,l,null!=a?a:t,(n=>zq({channel:t,channelDef:n,markDef:r,config:o,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:s})))}function AH(t,e={filled:void 0}){var n,r,i,o;const{markDef:a,encoding:s,config:u}=t,{type:l}=a,c=null!==(n=e.filled)&&void 0!==n?n:ZU("filled",a,u),f=$I(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=null!==(i=null!==(r=ZU(!0===c?"color":void 0,a,u,{vgChannel:"fill"}))&&void 0!==r?r:u.mark[!0===c&&"color"])&&void 0!==i?i:f,d=null!==(o=ZU(!1===c?"color":void 0,a,u,{vgChannel:"stroke"}))&&void 0!==o?o:u.mark[!1===c&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},h?{fill:XU(h)}:{}),d?{stroke:XU(d)}:{});return a.color&&(c?a.fill:a.stroke)&&dL(YP("property",{fill:"fill"in a,stroke:"stroke"in a})),Object.assign(Object.assign(Object.assign(Object.assign({},g),kH("color",t,{vgChannel:p,defaultValue:c?h:d})),kH("fill",t,{defaultValue:s.fill?h:void 0})),kH("stroke",t,{defaultValue:s.stroke?d:void 0}))}function EH(t,e){const n=e[function(t){switch(t){case Xz:return"xOffset";case Kz:return"yOffset";case Yz:return"x2Offset";case Jz:return"y2Offset";case tR:return"thetaOffset";case Zz:return"radiusOffset";case eR:return"theta2Offset";case Qz:return"radius2Offset"}}(t)];if(n)return n}function DH(t,e,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:o,markDef:a,config:s,stack:u}=e,l=o[t],c=o[XR(t)],f=e.scaleName(t),h=e.getScaleComponent(t),d=EH(t,a),p=SH({model:e,defaultPos:n,channel:t,scaleName:f,scale:h}),g=!l&&hP(t)&&(o.latitude||o.longitude)?{field:e.getName(t)}:function(t){const{channel:e,channelDef:n,isMidPoint:r,scaleName:i,stack:o,offset:a,markDef:s,config:u}=t;if(vU(n)&&o&&e===o.fieldChannel){if(dU(n)){const t=uU({channel:e,fieldDef:n,isMidPoint:r,markDef:s,stack:o,config:u});if(void 0!==t)return Iq({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:t,offset:a})}return jq(n,i,{suffix:"end"},{offset:a})}return $q(t)}({channel:t,channelDef:l,channel2Def:c,markDef:a,config:s,isMidPoint:i,scaleName:f,scale:h,stack:u,offset:d,defaultRef:p});return g?{[r||t]:g}:void 0}function SH({model:t,defaultPos:e,channel:n,scaleName:r,scale:i}){const{markDef:o,config:a}=t;return()=>{const s=HR(n),u=GR(n),l=ZU(n,o,a,{vgChannel:u});if(void 0!==l)return Rq(n,l);switch(e){case"zeroOrMin":case"zeroOrMax":if(r){const t=i.get("type");if($I(["log",eq,nq],t));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===e)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const e=t[KR(n)];return Object.assign(Object.assign({},e),{mult:.5})}}}}const CH={left:"x",center:"xc",right:"x2"},OH={top:"y",middle:"yc",bottom:"y2"};function FH(t,e,n,r="middle"){if("radius"===t||"theta"===t)return GR(t);const i=ZU("x"===t?"align":"baseline",e,n);return"x"===t?CH[i||("top"===r?"left":"center")]:OH[i||r]}function MH(t,e,{defaultPos:n,defaultPos2:r,range:i}){return i?$H(t,e,{defaultPos:n,defaultPos2:r}):DH(t,e,{defaultPos:n})}function $H(t,e,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:o}=e,a=XR(t),s=KR(t),u=function(t,e,n){const{encoding:r,mark:i,markDef:o,stack:a,config:s}=t,u=HR(n),l=KR(n),c=GR(n),f=r[u],h=t.scaleName(u),d=t.getScaleComponent(u),p=EH(n in r||n in o?n:u,t.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:t.getName(n)}};const g=function({channel:t,channelDef:e,channel2Def:n,markDef:r,config:i,scaleName:o,scale:a,stack:s,offset:u,defaultRef:l}){return vU(e)&&s&&t.charAt(0)===s.fieldChannel.charAt(0)?jq(e,o,{suffix:"start"},{offset:u}):$q({channel:t,channelDef:n,scaleName:o,scale:a,stack:s,markDef:r,config:i,offset:u,defaultRef:l})}({channel:n,channelDef:f,channel2Def:r[n],markDef:o,config:s,scaleName:h,scale:d,stack:a,offset:p,defaultRef:void 0});return void 0!==g?{[c]:g}:NH(n,o)||NH(n,{[n]:tW(n,o,s.style),[l]:tW(l,o,s.style)})||NH(n,s[i])||NH(n,s.mark)||{[c]:SH({model:t,defaultPos:e,channel:n,scaleName:h,scale:d})()}}(e,r,a),l=u[s]?FH(t,i,o):GR(t);return Object.assign(Object.assign({},DH(t,e,{defaultPos:n,vgChannel:l})),u)}function NH(t,e){const n=KR(t),r=GR(t);return void 0!==e[r]?{[r]:Rq(t,e[r])}:void 0!==e[t]?{[r]:Rq(t,e[t])}:e[n]?{[n]:Rq(t,e[n])}:void 0}function BH(t,e,n){var r,i,o,a;const{config:s,encoding:u,markDef:l,stack:c}=t,f=XR(e),h=KR(e),d=u[e],p=u[f],g=t.getScaleComponent(e),m=g?g.get("type"):void 0,y=t.scaleName(e),v=l.orient,b=null!==(i=null!==(r=u[h])&&void 0!==r?r:u.size)&&void 0!==i?i:ZU("size",l,s,{vgChannel:h}),x="bar"===n&&("x"===e?"vertical"===v:"horizontal"===v);if(dU(d)&&(BP(d.bin)||TP(d.bin)||d.timeUnit&&!p)&&!b&&!gq(m)){const n=uU({channel:e,fieldDef:d,stack:c,markDef:l,config:s}),r=null===(o=t.component.axes[e])||void 0===o?void 0:o[0];return function({fieldDef:t,fieldDef2:e,channel:n,band:r,scaleName:i,markDef:o,spacing:a=0,axisTranslate:s,reverse:u,config:l}){const c=XR(n),f=GR(n),h=GR(c),d=EH(n,o);if(BP(t.bin)||t.timeUnit)return{[h]:IH({channel:n,fieldDef:t,scaleName:i,markDef:o,band:(1-r)/2,offset:jH(c,a,u,s,d),config:l}),[f]:IH({channel:n,fieldDef:t,scaleName:i,markDef:o,band:1-(1-r)/2,offset:jH(n,a,u,s,d),config:l})};if(TP(t.bin)){const r=jq(t,i,{},{offset:jH(c,a,u,s,d)});if(dU(e))return{[h]:r,[f]:jq(e,i,{},{offset:jH(n,a,u,s,d)})};if(jP(t.bin)&&t.bin.step)return{[h]:r,[f]:{signal:`scale("${i}", ${EU(t,{expr:"datum"})} + ${t.bin.step})`,offset:jH(n,a,u,s,d)}}}dL(lL(c))}({fieldDef:d,fieldDef2:p,channel:e,markDef:l,scaleName:y,band:n,axisTranslate:null!==(a=null==r?void 0:r.get("translate"))&&void 0!==a?a:.5,spacing:hP(e)?ZU("binSpacing",l,s):void 0,reverse:g.get("reverse"),config:s})}return(vU(d)&&gq(m)||x)&&!p?function(t,e,n,r){var i;const{markDef:o,encoding:a,config:s,stack:u}=r,l=o.orient,c=r.scaleName(n),f=r.getScaleComponent(n),h=KR(n),d=XR(n),p="horizontal"===l&&"y"===n||"vertical"===l&&"x"===n,g=ZU(p?"size":h,o,s,{vgChannel:h});let m;(a.size||void 0!==g)&&(p?m=kH("size",r,{vgChannel:h,defaultValue:g}):dL(function(t){return`Cannot apply size to non-oriented mark "${t}".`}(o.type)));const y=null!==(i=vU(e)?uU({channel:n,fieldDef:e,markDef:o,stack:u,config:s}):void 0)&&void 0!==i?i:1;m=m||{[h]:TH(t,h,c,f,s,y)};const v="band"!==(null==f?void 0:f.get("type"))||!("band"in m[h]),b=FH(n,o,s,v?"middle":"top"),x=EH(n,o),w=$q({channel:n,channelDef:e,markDef:o,config:s,scaleName:c,scale:f,stack:u,offset:x,defaultRef:SH({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-y)/2});if(h)return Object.assign({[b]:w},m);{const t=GR(d),e=m[h],n=x?Object.assign(Object.assign({},e),{offset:x}):e;return{[b]:w,[t]:Qj(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,d,e,t):$H(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function TH(t,e,n,r,i,o){if(r){const e=r.get("type");if("point"===e||"band"===e){if(void 0!==i[t].discreteBandSize)return{value:i[t].discreteBandSize};if(e===rq){const t=r.get("range");return FL(t)&&lI(t.step)?{value:t.step-2}:{value:QW-2}}return{scale:n,band:o}}return{value:i[t].continuousBandSize}}const a=JW(i.view,e),s=ez(i[t].discreteBandSize,a-2);return void 0!==s?{value:s}:void 0}function jH(t,e,n,r,i){if(DR(t))return 0;const o="x"===t||"y2"===t?-e/2:e/2;if(OL(n)){const t=YU(i);return{signal:`${n.signal} ? ${r-o}${t?"-"+t:""} : ${r+o}${t?"+"+t:""}`}}if(OL(i)){const t=r+(n?-o:o);return{signal:`${t||""}${n?" - ":t?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-o:+i+o)}function IH({channel:t,fieldDef:e,scaleName:n,markDef:r,band:i,offset:o,config:a}){return Nq({fieldDef:e,channel:t,markDef:r,ref:Iq({scaleName:n,fieldOrDatumDef:e,band:i,offset:o}),config:a})}const zH=new Set(["aria"]);function RH(t,e){const{fill:n,stroke:r}="include"===e.color?AH(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(t,e){return $L.reduce(((n,r)=>(zH.has(r)||void 0===t[r]||"ignore"===e[r]||(n[r]=XU(t[r])),n)),{})}(t.markDef,e)),PH(t,"fill",n)),PH(t,"stroke",r)),kH("opacity",t)),kH("fillOpacity",t)),kH("strokeOpacity",t)),kH("strokeWidth",t)),kH("strokeDash",t)),xH(t)),vH(t,"href")),function(t){const{markDef:e,config:n}=t,r=ZU("aria",e,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(t){const{mark:e,markDef:n,config:r}=t;if(!1===r.aria)return{};const i=ZU("ariaRoleDescription",n,r);return null!=i?{ariaRoleDescription:{value:i}}:e in NL?{}:{ariaRoleDescription:{value:e}}}(t)),function(t){const{encoding:e,markDef:n,config:r,stack:i}=t,o=e.description;if(o)return yH(t,o,"description",(e=>bH(e,t.config)));const a=ZU("description",n,r);if(null!=a)return{description:XU(a)};if(!1===r.aria)return{};const s=wH(e,i,r);return PI(s)?void 0:{description:{signal:UI(s).map((({key:t,value:e})=>`${t} + ": " + (${e})`)).join(' + "; " + ')}}}(t))}(t))}function PH(t,e,n){const{config:r,mark:i,markDef:o}=t;if("hide"===ZU("invalid",o,r)&&n&&!Sz(i)){const r=function(t,{invalid:e=!1,channels:n}){const r=n.reduce(((e,n)=>{const r=t.getScaleComponent(n);if(r){const i=r.get("type"),o=t.vgField(n,{expr:"datum"});o&&mq(i)&&(e[o]=!0)}return e}),{}),i=LI(r);if(i.length>0){const t=e?"||":"&&";return i.map((t=>Tq(t,e))).join(` ${t} `)}}(t,{invalid:!0,channels:SP});if(r)return{[e]:[{test:r,value:null},...oI(n)]}}return n?{[e]:n}:{}}function LH(t){const{config:e,markDef:n}=t;if(ZU("invalid",n,e)){const e=function(t,{invalid:e=!1,channels:n}){const r=n.reduce(((e,n)=>{const r=t.getScaleComponent(n);if(r){const i=r.get("type"),o=t.vgField(n,{expr:"datum"});o&&mq(i)&&(e[o]=!0)}return e}),{}),i=LI(r);if(i.length>0){const t=e?"||":"&&";return i.map((t=>Tq(t,e))).join(` ${t} `)}}(t,{channels:fP});if(e)return{defined:{signal:e}}}return{}}function qH(t,e){if(void 0!==e)return{[t]:XU(e)}}const UH="voronoi",WH={has:t=>"interval"!==t.type&&t.nearest,parse:(t,e)=>{if(e.events)for(const n of e.events)n.markname=t.getName(UH)},marks:(t,e,n)=>{const{x:r,y:i}=e.project.hasChannel,o=t.mark;if(Sz(o))return dL(`The "nearest" transform is not supported for ${o} marks.`),n;const a={name:t.getName(UH),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},xH(t,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let s=0,u=!1;return n.forEach(((e,n)=>{var r;const i=null!==(r=e.name)&&void 0!==r?r:"";i===t.component.mark[0].name?s=n:i.indexOf(UH)>=0&&(u=!0)})),u||n.splice(s+1,0,a),n}};class VH{constructor(t,e){this.debugName=e,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){this._children.indexOf(t)>-1?console.warn("Attempt to add the same child twice."):void 0!==e?this._children.splice(e,0,t):this._children.push(t)}removeChild(t){const e=this._children.indexOf(t);return this._children.splice(e,1),e}remove(){let t=this._parent.removeChild(this);for(const e of this._children)e._parent=this._parent,this._parent.addChild(e,t++)}insertAsParentOf(t){const e=t.parent;e.removeChild(this),this.parent=e,t.parent=this}swapWithParent(){const t=this._parent,e=t.parent;for(const e of this._children)e.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=e,t.parent=this}}class HH extends VH{constructor(t,e,n,r){super(t,e),this.type=n,this.refCounts=r,this._source=this._name=e,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${function(t){const e=++nz;return e}()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class GH extends VH{constructor(t,e){super(t),this.formula=e}clone(){return new GH(null,DI(this.formula))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,r)=>{const{field:i,timeUnit:o}=n,a=lJ(e)?e.encoding[XR(r)]:void 0,s=lJ(e)&&lU(r,n,a,e.stack,e.markDef,e.config);if(o){const e=EU(n,{forAs:!0});t[FI({as:e,field:i,timeUnit:o})]=Object.assign({as:e,field:i,timeUnit:o},s?{band:!0}:{})}return t}),{});return PI(n)?null:new GH(t,n)}static makeFromTransform(t,e){const n=Object.assign({},e),{timeUnit:r}=n,i=dI(n,["timeUnit"]),o=CL(r),a=Object.assign(Object.assign({},i),{timeUnit:o});return new GH(t,{[FI(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const e in t.formula)this.formula[e]&&!t.formula[e].band||(this.formula[e]=t.formula[e]);for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(qI(this.formula).map((t=>t.as)))}dependentFields(){return new Set(qI(this.formula).map((t=>t.field)))}hash(){return`TimeUnit ${FI(this.formula)}`}assemble(){const t=[];for(const e of qI(this.formula)){const{field:n,as:r,timeUnit:i}=e,o=CL(i),{unit:a,utc:s}=o,u=dI(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:JI(n),type:"timeunit"},a?{units:EL(a)}:{}),s?{timezone:"utc"}:{}),u),{as:[r,`${r}_end`]}))}return t}}const XH="_tuple_fields";class KH{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const YH={has:t=>"single"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind&&!qW(t.bind),parse:(t,e,n,r)=>{r.on||delete e.events,r.clear||delete e.clear},topLevelSignals:(t,e,n)=>{const r=e.name,i=e.project,o=e.bind,a=e.init&&e.init[0],s=WH.has(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((t,i)=>{var u,l;const c=VI(`${r}_${t.field}`);n.filter((t=>t.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},a?{init:dG(a[i])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${fI(t.field)}] : null`}]:[],bind:null!==(l=null!==(u=o[t.field])&&void 0!==u?u:o[t.channel])&&void 0!==l?l:o}))})),n},signals:(t,e,n)=>{const r=e.name,i=e.project,o=n.filter((t=>t.name===r+AG))[0],a=r+XH,s=i.items.map((t=>VI(`${r}_${t.field}`))),u=s.map((t=>`${t} !== null`)).join(" && ");return s.length&&(o.update=`${u} ? {fields: ${a}, values: [${s.join(", ")}]} : null`),delete o.value,delete o.on,n}},JH="_toggle",ZH={has:t=>"multi"===t.type&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+JH,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+AG,r=e.name+JH;return`${r} ? null : ${n}, `+("global"===e.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${CG(t)}}, `)+`${r} ? ${n} : null`}},QH={has:t=>void 0!==t.clear&&!1!==t.clear,parse:(t,e,n)=>{n.clear&&(e.clear=cI(n.clear)?iN(n.clear,"scope"):n.clear)},topLevelSignals:(t,e,n)=>{if(YH.has(e))for(const t of e.project.items){const r=n.findIndex((n=>n.name===VI(`${e.name}_${t.field}`)));-1!==r&&n[r].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function r(t,r){-1!==t&&n[t].on&&n[t].on.push({events:e.clear,update:r})}if("interval"===e.type)for(const t of e.project.items){const e=n.findIndex((e=>e.name===t.signals.visual));r(e,"[0, 0]"),-1===e&&r(n.findIndex((e=>e.name===t.signals.data)),"null")}else{let t=n.findIndex((t=>t.name===e.name+AG));r(t,"null"),ZH.has(e)&&(t=n.findIndex((t=>t.name===e.name+JH)),r(t,"false"))}return n}},tG={has:t=>"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind,parse:(t,e)=>{const n=e.scales=[];for(const r of e.project.items){const i=r.channel;if(!CP(i))continue;const o=t.getScaleComponent(i),a=o?o.get("type"):void 0;if(!o||!mq(a)){dL("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:e.name,field:r.field};o.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(t,e,n)=>{const r=e.scales.filter((t=>0===n.filter((e=>e.name===t.signals.data)).length));if(!t.parent||nG(t)||0===r.length)return n;const i=n.filter((t=>t.name===e.name))[0];let o=i.update;if(o.indexOf(EG)>=0)i.update=`{${r.map((t=>`${fI(t.field)}: ${t.signals.data}`)).join(", ")}}`;else{for(const t of r){const e=`${fI(t.field)}: ${t.signals.data}`;o.indexOf(e)<0&&(o=`${o.substring(0,o.length-1)}, ${e}}`)}i.update=o}return n.concat(r.map((t=>({name:t.signals.data}))))},signals:(t,e,n)=>{if(t.parent&&!nG(t))for(const t of e.scales){const e=n.filter((e=>e.name===t.signals.data))[0];e.push="outer",delete e.value,delete e.update}return n}};function eG(t,e){return`domain(${fI(t.scaleName(e))})`}function nG(t){var e;return t.parent&&hJ(t.parent)&&(null!==(e=!t.parent.parent)&&void 0!==e?e:nG(t.parent.parent))}const rG={has:t=>{const e="global"===t.resolve&&t.bind&&qW(t.bind),n=1===t.project.items.length&&t.project.items[0].field!==PW;return e&&!n&&dL("Legend bindings are only supported for selections over an individual field or encoding channel."),e&&n},parse:(t,e,n,r)=>{var i;if(r.on||delete e.events,r.clear||delete e.clear,r.on||r.clear){const t='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of e.events)n.filter=oI(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(t)<0&&n.filter.push(t)}const o=UW(e.bind)?e.bind.legend:"click",a=cI(o)?iN(o,"view"):oI(o);e.bind={legend:{merge:a}}},topLevelSignals:(t,e,n)=>{const r=e.name,i=UW(e.bind)&&e.bind.legend,o=t=>e=>{const n=DI(e);return n.markname=t,n};for(const t of e.project.items){if(!t.hasLegend)continue;const a=`${VI(t.field)}_legend`,s=`${r}_${a}`;if(0===n.filter((t=>t.name===s)).length){const t=i.merge.map(o(`${a}_symbols`)).concat(i.merge.map(o(`${a}_labels`))).concat(i.merge.map(o(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:s},e.init?{}:{value:null}),{on:[{events:t,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(t,e,n)=>{const r=e.name,i=e.project,o=n.find((t=>t.name===r+AG)),a=r+XH,s=i.items.filter((t=>t.hasLegend)).map((t=>VI(`${r}_${VI(t.field)}_legend`))),u=`${s.map((t=>`${t} !== null`)).join(" && ")} ? {fields: ${a}, values: [${s.join(", ")}]} : null`;e.events&&s.length>0?o.on.push({events:s.map((t=>({signal:t}))),update:u}):s.length>0&&(o.update=u,delete o.value,delete o.on);const l=n.find((t=>t.name===r+JH)),c=UW(e.bind)&&e.bind.legend;return l&&(e.events?l.on.push(Object.assign(Object.assign({},l.on[0]),{events:c})):l.on[0].events=c),n}},iG="_translate_anchor",oG="_translate_delta",aG={has:t=>"interval"===t.type&&t.translate,signals:(t,e,n)=>{const r=e.name,i=tG.has(e),o=r+iG,{x:a,y:s}=e.project.hasChannel;let u=iN(e.translate,"scope");return i||(u=u.map((t=>(t.between[0].markname=r+mG,t)))),n.push({name:o,value:{},on:[{events:u.map((t=>t.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==a?", extent_x: "+(i?eG(t,Xz):`slice(${a.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?eG(t,Kz):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+oG,value:{},on:[{events:u,update:`{x: ${o}.x - x(unit), y: ${o}.y - y(unit)}`}]}),void 0!==a&&sG(t,e,a,"width",n),void 0!==s&&sG(t,e,s,"height",n),n}};function sG(t,e,n,r,i){var o;const a=e.name,s=a+iG,u=a+oG,l=n.channel,c=tG.has(e),f=i.filter((t=>t.name===n.signals[c?"data":"visual"]))[0],h=t.getSizeSignalRef(r).signal,d=t.getScaleComponent(l),p=d.get("type"),g=`${s}.extent_${l}`,m=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${g}, ${`${c&&l===Xz?"-":""}${u}.${l} / `+(c?`${h}`:`span(${g})`)}`+(c&&"pow"===p?`, ${null!==(o=d.get("exponent"))&&void 0!==o?o:1}`:"")+")";f.on.push({events:{signal:u},update:c?m:`clampRange(${m}, 0, ${h})`})}const uG="_zoom_delta",lG={has:t=>"interval"===t.type&&t.zoom,signals:(t,e,n)=>{const r=e.name,i=tG.has(e),o=r+uG,{x:a,y:s}=e.project.hasChannel,u=fI(t.scaleName(Xz)),l=fI(t.scaleName(Kz));let c=iN(e.zoom,"scope");return i||(c=c.map((t=>(t.markname=r+mG,t)))),n.push({name:r+"_zoom_anchor",on:[{events:c,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter((t=>!!t)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:o,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==a&&cG(t,e,a,"width",n),void 0!==s&&cG(t,e,s,"height",n),n}};function cG(t,e,n,r,i){var o;const a=e.name,s=n.channel,u=tG.has(e),l=i.filter((t=>t.name===n.signals[u?"data":"visual"]))[0],c=t.getSizeSignalRef(r).signal,f=t.getScaleComponent(s),h=f.get("type"),d=u?eG(t,s):l.name,p=a+uG,g=`${u?"log"===h?"zoomLog":"pow"===h?"zoomPow":"zoomLinear":"zoomLinear"}(${d}, ${a}_zoom_anchor.${s}, ${p}`+(u&&"pow"===h?`, ${null!==(o=f.get("exponent"))&&void 0!==o?o:1}`:"")+")";l.on.push({events:{signal:p},update:u?g:`clampRange(${g}, 0, ${c})`})}const fG=[{has:()=>!0,parse:(t,e,n)=>{var r,i,o;const a=e.name,s=null!==(r=e.project)&&void 0!==r?r:e.project=new KH,u={},l={},c=new Set,f=(t,e)=>{const n="visual"===e?t.channel:t.field;let r=VI(`${a}_${n}`);for(let t=1;c.has(r);t++)r=VI(`${a}_${n}_${t}`);return c.add(r),{[e]:r}};if(!n.fields&&!n.encodings){const e=t.config.selection[n.type];if(n.init)for(const t of oI(n.init))for(const r of LI(t))qR[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(dL('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=e.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=e.encodings,n.fields=e.fields}for(const t of null!==(i=n.fields)&&void 0!==i?i:[]){const e={type:"E",field:t};e.signals=Object.assign({},f(e,"data")),s.items.push(e),s.hasField[t]=e}for(const r of null!==(o=n.encodings)&&void 0!==o?o:[]){const n=t.fieldDef(r);if(n){let i=n.field;if(n.aggregate){dL(WP(r,n.aggregate));continue}if(!i){dL(UP(r));continue}if(n.timeUnit){i=t.vgField(r);const e={timeUnit:n.timeUnit,as:i,field:n.field};l[FI(e)]=e}if(!u[i]){let o="E";"interval"===e.type?mq(t.getScaleComponent(r).get("type"))&&(o="R"):n.bin&&(o="R-RE");const a={field:i,channel:r,type:o};a.signals=Object.assign(Object.assign({},f(a,"data")),f(a,"visual")),s.items.push(u[i]=a),s.hasField[i]=s.hasChannel[r]=u[i]}}else dL(UP(r))}if(n.init){const t=t=>s.items.map((e=>void 0!==t[e.channel]?t[e.channel]:t[e.field]));if("interval"===n.type)e.init=t(n.init);else{const r=oI(n.init);e.init=r.map(t)}}PI(l)||(s.timeUnit=new GH(null,l))},signals:(t,e,n)=>{const r=e.name+XH;return n.filter((t=>t.name===r)).length>0?n:n.concat({name:r,value:e.project.items.map((t=>{const{signals:e,hasLegend:n}=t,r=dI(t,["signals","hasLegend"]);return r.field=JI(r.field),r}))})}},ZH,tG,rG,aG,lG,YH,WH,QH];function hG(t,e){for(const n of fG)n.has(t)&&e(n)}function dG(t,e=!0,n=Jj){if(Qj(t)){const r=t.map((t=>dG(t,e,n)));return e?`[${r.join(", ")}]`:r}return pL(t)?n(e?xL(t):function(t){const e=bL(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}(t)):e?n(JSON.stringify(t)):t}function pG(t,e){return SG(t,((n,r)=>{e=r.marks?r.marks(t,n,e):e,hG(n,(r=>{r.marks&&(e=r.marks(t,n,e))}))})),e}function gG(t){return t.map((t=>(t.on&&!t.on.length&&delete t.on,t)))}const mG="_brush",yG="_scale_trigger",vG={signals:(t,e)=>{const n=e.name,r=n+XH,i=tG.has(e),o=[],a=[],s=[];if(e.translate&&!i){const t=`!event.item || event.item.mark.name !== ${fI(n+mG)}`;bG(e,((e,n)=>{var r;const i=oI(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(t)<0&&i.push(t),e}))}e.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==Xz&&i!==Kz)return void dL("Interval selections only support x and y encoding channels.");const u=e.init?e.init[r]:null,l=function(t,e,n,r){const i=n.channel,o=n.signals.visual,a=n.signals.data,s=tG.has(e),u=fI(t.scaleName(i)),l=t.getScaleComponent(i),c=l?l.get("type"):void 0,f=t=>`scale(${u}, ${t})`,h=t.getSizeSignalRef(i===Xz?"width":"height").signal,d=`${i}(unit)`,p=bG(e,((t,e)=>[...t,{events:e.between[0],update:`[${d}, ${d}]`},{events:e,update:`[${o}[0], clamp(${d}, 0, ${h})]`}]));return p.push({events:{signal:e.name+yG},update:mq(c)?`[${f(`${a}[0]`)}, ${f(`${a}[1]`)}]`:"[0, 0]"}),s?[{name:a,on:[]}]:[Object.assign(Object.assign({name:o},r?{init:dG(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:a},r?{init:dG(r)}:{}),{on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${u}, ${o})`}]})]}(t,e,n,u),c=n.signals.data,f=n.signals.visual,h=fI(t.scaleName(i)),d=mq(t.getScaleComponent(i).get("type"))?"+":"";o.push(...l),a.push(c),s.push({scaleName:t.scaleName(i),expr:`(!isArray(${c}) || (${d}invert(${h}, ${f})[0] === ${d}${c}[0] && ${d}invert(${h}, ${f})[1] === ${d}${c}[1]))`})})),i||o.push({name:n+yG,value:{},on:[{events:s.map((t=>({scale:t.scaleName}))),update:s.map((t=>t.expr)).join(" && ")+` ? ${n+yG} : {}`}]});const u=e.init,l=`unit: ${CG(t)}, fields: ${r}, values`;return o.concat(Object.assign(Object.assign({name:n+AG},u?{init:`{${l}: ${dG(u)}}`}:{}),{on:[{events:[{signal:a.join(" || ")}],update:a.join(" && ")+` ? {${l}: [${a}]} : null`}]}))},modifyExpr:(t,e)=>e.name+AG+", "+("global"===e.resolve?"true":`{unit: ${CG(t)}}`),marks:(t,e,n)=>{const r=e.name,{x:i,y:o}=e.project.hasChannel,a=i&&i.signals.visual,s=o&&o.signals.visual,u=`data(${fI(e.name+kG)})`;if(tG.has(e))return n;const l={x:void 0!==i?{signal:`${a}[0]`}:{value:0},y:void 0!==o?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${a}[1]`}:{field:{group:"width"}},y2:void 0!==o?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===e.resolve)for(const e of LI(l))l[e]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${CG(t)}`},l[e]),{value:0}];const c=e.mark,{fill:f,fillOpacity:h,cursor:d}=c,p=dI(c,["fill","fillOpacity","cursor"]),g=LI(p).reduce(((t,e)=>(t[e]=[{test:[void 0!==i&&`${a}[0] !== ${a}[1]`,void 0!==o&&`${s}[0] !== ${s}[1]`].filter((t=>t)).join(" && "),value:p[e]},{value:null}],t)),{});return[{name:r+mG+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:h}},update:l}},...n,{name:r+mG,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},d?{cursor:{value:d}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),g)}}]}};function bG(t,e){return t.events.reduce(((t,n)=>n.between?e(t,n):(dL(`${n} is not an ordered event stream for interval selections.`),t)),[])}function xG(t,e){const n=e.name,r=n+XH,i=e.project,o="(item().isVoronoi ? datum.datum : datum)",a=i.items.map((e=>{const n=t.fieldDef(e.channel);return n&&n.bin?`[${o}[${fI(t.vgField(e.channel,{}))}], ${o}[${fI(t.vgField(e.channel,{binSuffix:"end"}))}]]`:`${o}[${fI(e.field)}]`})).join(", "),s=`unit: ${CG(t)}, fields: ${r}, values`,u=e.events;return[{name:n+AG,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${a}]} : null`,force:!0}]:[]}]}const wG={signals:xG,modifyExpr:(t,e)=>e.name+AG+", "+("global"===e.resolve?"null":`{unit: ${CG(t)}}`)},_G={signals:xG,modifyExpr:(t,e)=>e.name+AG+", "+("global"===e.resolve?"true":`{unit: ${CG(t)}}`)},kG="_store",AG="_tuple",EG="vlSelectionResolve",DG={single:_G,multi:wG,interval:vG};function SG(t,e){const n=t.component.selection;if(n)for(const t of qI(n))if(!0===e(t,DG[t.type]))break}function CG(t,{escape:e}={escape:!0}){let n=e?fI(t.name):t.name;const r=function(t){let e=t.parent;for(;e&&!cJ(e);)e=e.parent;return e}(t);if(r){const{facet:t}=r;for(const e of $R)t[e]&&(n+=` + '__facet_${e}_' + (facet[${fI(r.vgField(e))}])`)}return n}function OG(t){let e=!1;return SG(t,(t=>{e=e||t.project.items.some((t=>t.field===PW))})),e}function FG(t){this.type=t}var MG,$G,NG,BG,TG;FG.prototype.visit=function(t){let e,n,r;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case"CallExpression":return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];case"Identifier":case"Literal":case"RawCode":default:return[]}}(this),n=0,r=e.length;n<r;++n)if(e[n].visit(t))return 1},(MG={})[1]="Boolean",MG[2]="<end>",MG[3]="Identifier",MG[4]="Keyword",MG[5]="Null",MG[6]="Numeric",MG[7]="Punctuator",MG[8]="String",MG[9]="RegularExpression";var jG="Identifier",IG="Unexpected token %0",zG="Invalid regular expression",RG="Invalid regular expression: missing /",PG="Octal literals are not allowed in strict mode.",LG="ILLEGAL",qG="Disabled.",UG=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),WG=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function VG(t,e){if(!t)throw new Error("ASSERT: "+e)}function HG(t){return t>=48&&t<=57}function GG(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function XG(t){return"01234567".indexOf(t)>=0}function KG(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function YG(t){return 10===t||13===t||8232===t||8233===t}function JG(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&UG.test(String.fromCharCode(t))}function ZG(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&WG.test(String.fromCharCode(t))}var QG={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function tX(){for(var t;NG<BG&&(KG(t=$G.charCodeAt(NG))||YG(t));)++NG}function eX(t){var e,n,r,i=0;for(n="u"===t?4:2,e=0;e<n;++e)NG<BG&&GG($G[NG])?(r=$G[NG++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):pX({},IG,LG);return String.fromCharCode(i)}function nX(){var t,e,n,r;for(e=0,"}"===(t=$G[NG])&&pX({},IG,LG);NG<BG&&GG(t=$G[NG++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&pX({},IG,LG),e<=65535?String.fromCharCode(e):(n=55296+(e-65536>>10),r=56320+(e-65536&1023),String.fromCharCode(n,r))}function rX(){var t,e;for(t=$G.charCodeAt(NG++),e=String.fromCharCode(t),92===t&&(117!==$G.charCodeAt(NG)&&pX({},IG,LG),++NG,(t=eX("u"))&&"\\"!==t&&JG(t.charCodeAt(0))||pX({},IG,LG),e=t);NG<BG&&ZG(t=$G.charCodeAt(NG));)++NG,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==$G.charCodeAt(NG)&&pX({},IG,LG),++NG,(t=eX("u"))&&"\\"!==t&&ZG(t.charCodeAt(0))||pX({},IG,LG),e+=t);return e}function iX(){var t,e,n,r,i=NG,o=$G.charCodeAt(NG),a=$G[NG];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++NG,{type:7,value:String.fromCharCode(o),start:i,end:NG};default:if(61===(t=$G.charCodeAt(NG+1)))switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return NG+=2,{type:7,value:String.fromCharCode(o)+String.fromCharCode(t),start:i,end:NG};case 33:case 61:return NG+=2,61===$G.charCodeAt(NG)&&++NG,{type:7,value:$G.slice(i,NG),start:i,end:NG}}}return">>>="===(r=$G.substr(NG,4))?{type:7,value:r,start:i,end:NG+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:NG+=3}:a===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(a)>=0||"=>"===e?{type:7,value:e,start:i,end:NG+=2}:"<>=!+-*%&|^/".indexOf(a)>=0?{type:7,value:a,start:i,end:++NG}:void pX({},IG,LG)}function oX(){var t,e,n;if(VG(HG((n=$G[NG]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=NG,t="","."!==n){if(t=$G[NG++],n=$G[NG],"0"===t){if("x"===n||"X"===n)return++NG,function(t){for(var e="";NG<BG&&GG($G[NG]);)e+=$G[NG++];return 0===e.length&&pX({},IG,LG),JG($G.charCodeAt(NG))&&pX({},IG,LG),{type:6,value:parseInt("0x"+e,16),start:t,end:NG}}(e);if(XG(n))return function(t){for(var e="0"+$G[NG++];NG<BG&&XG($G[NG]);)e+=$G[NG++];return(JG($G.charCodeAt(NG))||HG($G.charCodeAt(NG)))&&pX({},IG,LG),{type:6,value:parseInt(e,8),octal:!0,start:t,end:NG}}(e);n&&HG(n.charCodeAt(0))&&pX({},IG,LG)}for(;HG($G.charCodeAt(NG));)t+=$G[NG++];n=$G[NG]}if("."===n){for(t+=$G[NG++];HG($G.charCodeAt(NG));)t+=$G[NG++];n=$G[NG]}if("e"===n||"E"===n)if(t+=$G[NG++],"+"!==(n=$G[NG])&&"-"!==n||(t+=$G[NG++]),HG($G.charCodeAt(NG)))for(;HG($G.charCodeAt(NG));)t+=$G[NG++];else pX({},IG,LG);return JG($G.charCodeAt(NG))&&pX({},IG,LG),{type:6,value:parseFloat(t),start:e,end:NG}}function aX(){var t;return tX(),NG>=BG?{type:2,start:NG,end:NG}:JG(t=$G.charCodeAt(NG))?function(){var t,e;return t=NG,{type:1===(e=92===$G.charCodeAt(NG)?rX():function(){var t,e;for(t=NG++;NG<BG;){if(92===(e=$G.charCodeAt(NG)))return NG=t,rX();if(!ZG(e))break;++NG}return $G.slice(t,NG)}()).length?3:QG.hasOwnProperty(e)?4:"null"===e?5:"true"===e||"false"===e?1:3,value:e,start:t,end:NG}}():40===t||41===t||59===t?iX():39===t||34===t?function(){var t,e,n,r,i="",o=!1;for(VG("'"===(t=$G[NG])||'"'===t,"String literal must starts with a quote"),e=NG,++NG;NG<BG;){if((n=$G[NG++])===t){t="";break}if("\\"===n)if((n=$G[NG++])&&YG(n.charCodeAt(0)))"\r"===n&&"\n"===$G[NG]&&++NG;else switch(n){case"u":case"x":"{"===$G[NG]?(++NG,i+=nX()):i+=eX(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:XG(n)?(0!==(r="01234567".indexOf(n))&&(o=!0),NG<BG&&XG($G[NG])&&(o=!0,r=8*r+"01234567".indexOf($G[NG++]),"0123".indexOf(n)>=0&&NG<BG&&XG($G[NG])&&(r=8*r+"01234567".indexOf($G[NG++]))),i+=String.fromCharCode(r)):i+=n}else{if(YG(n.charCodeAt(0)))break;i+=n}}return""!==t&&pX({},IG,LG),{type:8,value:i,octal:o,start:e,end:NG}}():46===t?HG($G.charCodeAt(NG+1))?oX():iX():HG(t)?oX():iX()}function sX(){var t;return NG=(t=TG).end,TG=aX(),NG=t.end,t}function uX(){var t;t=NG,TG=aX(),NG=t}function lX(t,e,n){var r=new FG("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return r.operator=t,r.left=e,r.right=n,r}function cX(t){var e=new FG(jG);return e.name=t,e}function fX(t){var e=new FG("Literal");return e.value=t.value,e.raw=$G.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function hX(t,e,n){var r=new FG("MemberExpression");return r.computed="["===t,r.object=e,r.property=n,r.computed||(n.member=!0),r}function dX(t,e,n){var r=new FG("Property");return r.key=e,r.value=n,r.kind=t,r}function pX(t,e){var n,r=Array.prototype.slice.call(arguments,2),i=e.replace(/%(\d)/g,(function(t,e){return VG(e<r.length,"Message reference must be in range"),r[e]}));throw(n=new Error(i)).index=NG,n.description=i,n}function gX(t){2===t.type&&pX(t,"Unexpected end of input"),6===t.type&&pX(t,"Unexpected number"),8===t.type&&pX(t,"Unexpected string"),3===t.type&&pX(t,"Unexpected identifier"),4===t.type&&pX(t,"Unexpected reserved word"),pX(t,IG,t.value)}function mX(t){var e=sX();7===e.type&&e.value===t||gX(e)}function yX(t){return 7===TG.type&&TG.value===t}function vX(t){return 4===TG.type&&TG.value===t}function bX(){var t;return NG=TG.start,8===(t=sX()).type||6===t.type?(t.octal&&pX(t,PG),fX(t)):cX(t.value)}function xX(){var t,e,n;return NG=TG.start,3===(t=TG).type?(n=bX(),mX(":"),dX("init",n,CX())):2!==t.type&&7!==t.type?(e=bX(),mX(":"),dX("init",e,CX())):void gX(t)}var wX={if:1};function _X(){var t,e,n;if(yX("("))return function(){var t;return mX("("),t=OX(),mX(")"),t}();if(yX("["))return function(){var t=[];for(NG=TG.start,mX("[");!yX("]");)yX(",")?(sX(),t.push(null)):(t.push(CX()),yX("]")||mX(","));return sX(),function(t){var e=new FG("ArrayExpression");return e.elements=t,e}(t)}();if(yX("{"))return function(){var t,e,n=[],r={},i=String;for(NG=TG.start,mX("{");!yX("}");)e="$"+((t=xX()).key.type===jG?t.key.name:i(t.key.value)),Object.prototype.hasOwnProperty.call(r,e)?pX({},"Duplicate data property in object literal not allowed in strict mode"):r[e]=!0,n.push(t),yX("}")||mX(",");return mX("}"),function(t){var e=new FG("ObjectExpression");return e.properties=t,e}(n)}();if(t=TG.type,NG=TG.start,3===t||wX[TG.value])n=cX(sX().value);else if(8===t||6===t)TG.octal&&pX(TG,PG),n=fX(sX());else{if(4===t)throw new Error(qG);1===t?((e=sX()).value="true"===e.value,n=fX(e)):5===t?((e=sX()).value=null,n=fX(e)):yX("/")||yX("/=")?(n=fX(function(){var t,e,n,r;return TG=null,tX(),t=NG,e=function(){var t,e,n,r;for(VG("/"===(t=$G[NG]),"Regular expression literal must start with a slash"),e=$G[NG++],n=!1,r=!1;NG<BG;)if(e+=t=$G[NG++],"\\"===t)YG((t=$G[NG++]).charCodeAt(0))&&pX({},RG),e+=t;else if(YG(t.charCodeAt(0)))pX({},RG);else if(n)"]"===t&&(n=!1);else{if("/"===t){r=!0;break}"["===t&&(n=!0)}return r||pX({},RG),{value:e.substr(1,e.length-2),literal:e}}(),n=function(){var t,e,n;for(e="",n="";NG<BG&&ZG((t=$G[NG]).charCodeAt(0));)++NG,"\\"===t&&NG<BG?pX({},IG,LG):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&pX({},zG,n),{value:n,literal:e}}(),r=function(t,e){var n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(function(t,e){if(parseInt(e,16)<=1114111)return"x";pX({},zG)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){pX({},zG)}try{return new RegExp(t,e)}catch(t){return null}}(e.value,n.value),{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:NG}}()),uX()):gX(sX())}return n}function kX(){var t=[];if(mX("("),!yX(")"))for(;NG<BG&&(t.push(CX()),!yX(")"));)mX(",");return mX(")"),t}function AX(){var t;return mX("["),t=OX(),mX("]"),t}function EX(){var t=function(){var t,e,n,r,i;for(t=_X();;)if(yX("."))t=hX(".",t,(i=void 0,mX("."),NG=TG.start,function(t){return 3===t.type||4===t.type||1===t.type||5===t.type}(i=sX())||gX(i),cX(i.value)));else if(yX("("))e=t,n=kX(),r=void 0,(r=new FG("CallExpression")).callee=e,r.arguments=n,t=r;else{if(!yX("["))break;t=hX("[",t,AX())}return t}();if(7===TG.type&&(yX("++")||yX("--")))throw new Error(qG);return t}function DX(){var t,e;if(7!==TG.type&&4!==TG.type)e=EX();else{if(yX("++")||yX("--"))throw new Error(qG);if(yX("+")||yX("-")||yX("~")||yX("!"))t=sX(),e=DX(),e=function(t,e){var n=new FG("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else{if(vX("delete")||vX("void")||vX("typeof"))throw new Error(qG);e=EX()}}return e}function SX(t){var e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function CX(){var t,e;return t=function(){var t,e,n,r,i,o,a,s,u,l;if(t=TG,u=DX(),0===(i=SX(r=TG)))return u;for(r.prec=i,sX(),e=[t,TG],o=[u,r,a=DX()];(i=SX(TG))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),e.pop(),n=lX(s,u,a),o.push(n);(r=sX()).prec=i,o.push(r),e.push(TG),n=DX(),o.push(n)}for(n=o[l=o.length-1],e.pop();l>1;)e.pop(),n=lX(o[l-1].value,o[l-2],n),l-=2;return n}(),yX("?")&&(sX(),e=CX(),mX(":"),t=function(t,e,n){var r=new FG("ConditionalExpression");return r.test=t,r.consequent=e,r.alternate=n,r}(t,e,CX())),t}function OX(){var t=CX();if(yX(","))throw new Error(qG);return t}function FX(t,e,n){return t.fields=e||[],t.fname=n,t}function MX(t){return 1===t.length?$X(t[0]):NX(t)}const $X=t=>function(e){return e[t]},NX=t=>{const e=t.length;return function(n){for(let r=0;r<e;++r)n=n[t[r]];return n}};function BX(t){throw Error(t)}function TX(t){const e=[];return"Identifier"===t.type?[t.name]:"Literal"===t.type?[t.value]:("MemberExpression"===t.type&&(e.push(...TX(t.object)),e.push(...TX(t.property))),e)}function jX(t){return"MemberExpression"===t.object.type?jX(t.object):"datum"===t.object.name}function IX(t){const e=function(t){NG=0,BG=($G=t).length,TG=null,uX();var e=OX();if(2!==TG.type)throw new Error("Unexpect token after expression.");return e}(t),n=new Set;return e.visit((t=>{"MemberExpression"===t.type&&jX(t)&&n.add(TX(t).slice(1).join("."))})),n}(function(t,e,n){const r=function(t){const e=[],n=t.length;let r,i,o,a=null,s=0,u="";function l(){e.push(u+t.substring(r,i)),u="",r=i+1}for(t+="",r=i=0;i<n;++i)if(o=t[i],"\\"===o)u+=t.substring(r,i),u+=t.substring(++i,++i),r=i;else if(o===a)l(),a=null,s=-1;else{if(a)continue;r===s&&'"'===o||r===s&&"'"===o?(r=i+1,a=o):"."!==o||s?"["===o?(i>r&&l(),s=r=i+1):"]"===o&&(s||BX("Access path missing open bracket: "+t),s>0&&l(),s=0,r=i+1):i>r?l():r=i+1}return s&&BX("Access path missing closing bracket: "+t),a&&BX("Access path missing closing quote: "+t),i>r&&(i++,l()),e}(t);t=1===r.length?r[0]:t,FX((n&&n.get||MX)(r),[t],e||t)})("id"),FX((t=>t),[],"identity"),FX((()=>0),[],"zero"),FX((()=>1),[],"one"),FX((()=>!0),[],"true"),FX((()=>!1),[],"false"),Array.isArray,Object.prototype.hasOwnProperty;class zX extends VH{constructor(t,e,n){super(t),this.model=e,this.filter=n,this.expr=LX(this.model,this.filter,this),this._dependentFields=IX(this.expr)}clone(){return new zX(null,this.model,DI(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function RX(t,e,n,r="datum"){const i=[],o=HI(e,(function(e){const o=VI(e),a=t.getSelectionComponent(o,e),s=fI(o+kG);if(a.project.timeUnit){const e=null!=n?n:t.component.data.raw,r=a.project.timeUnit.clone();e.parent?r.insertAsParentOf(e):e.parent=r}return"none"!==a.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===a.resolve?")":`, ${fI(a.resolve)})`)}));return(i.length?"!("+i.map((t=>`length(data(${t}))`)).join(" || ")+") || ":"")+`(${o})`}function PX(t,e){const n=e.encoding;let r=e.field;if(n||r){if(n&&!r){const i=t.project.items.filter((t=>t.channel===n));!i.length||i.length>1?(r=t.project.items[0].field,dL((i.length?"Multiple ":"No ")+`matching ${fI(n)} encoding found for selection ${fI(e.selection)}. `+`Using "field": ${fI(r)}.`)):r=i[0].field}}else r=t.project.items[0].field,t.project.items.length>1&&dL(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${fI(r)}.`);return`${t.name}[${fI(r)}]`}function LX(t,e,n){return HI(e,(e=>cI(e)?e:function(t){return null==t?void 0:t.selection}(e)?RX(t,e.selection,n):WL(e)))}function qX(t,e,n,r){var i,o,a;t.encode=null!==(i=t.encode)&&void 0!==i?i:{},t.encode[e]=null!==(o=t.encode[e])&&void 0!==o?o:{},t.encode[e].update=null!==(a=t.encode[e].update)&&void 0!==a?a:{},t.encode[e].update[n]=r}function UX(t,e,n,r={header:!1}){var i,o;const a=t.combine(),{disable:s,orient:u,scale:l,labelExpr:c,title:f,zindex:h}=a,d=dI(a,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const t in d){const n=uz[t],r=d[t];if(n&&n!==e&&"both"!==n)delete d[t];else if(az(r)){const{condition:e}=r,n=dI(r,["condition"]),i=oI(e),o=oz[t];if(o){const{vgProp:e,part:r}=o;qX(d,r,e,[...i.map((t=>{const{test:e}=t,n=dI(t,["test"]);return Object.assign({test:LX(null,e)},n)})),n]),delete d[t]}else if(null===o){const e={signal:i.map((t=>{const{test:e}=t,n=dI(t,["test"]);return`${LX(null,e)} ? ${KU(n)} : `})).join("")+KU(n)};d[t]=e}}else if(OL(r)){const e=oz[t];if(e){const{vgProp:n,part:i}=e;qX(d,i,n,r),delete d[t]}}}if("grid"===e){if(!d.grid)return;if(d.encode){const{grid:t}=d.encode;d.encode=Object.assign({},t?{grid:t}:{}),PI(d.encode)&&delete d.encode}return Object.assign(Object.assign({scale:l,orient:u},d),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:ez(h,0)})}{if(!r.header&&t.mainExtracted)return;if(void 0!==c){let t=c;(null===(o=null===(i=d.encode)||void 0===i?void 0:i.labels)||void 0===o?void 0:o.update)&&OL(d.encode.labels.update.text)&&(t=ZI(c,"datum.label",d.encode.labels.update.text.signal)),qX(d,"labels","text",{signal:t})}if(null===d.labelAlign&&delete d.labelAlign,d.encode){for(const e of sz)t.hasAxisPart(e)||delete d.encode[e];PI(d.encode)&&delete d.encode}const e=function(t,e){if(t)return Qj(t)&&!GU(t)?t.map((t=>NU(t,e))).join(", "):t}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},e?{title:e}:{}),d),!1===n.aria?{aria:!1}:{}),{zindex:ez(h,0)})}}}function WX(t){const{axes:e}=t.component,n=[];for(const r of fP)if(e[r])for(const i of e[r])if(!i.get("disable")&&!i.get("gridScale")){const e="x"===r?"height":"width",i=t.getSizeSignalRef(e).signal;e!==i&&n.push({name:e,update:i})}return n}const VX={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},HX={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},GX=LI(VX),XX=LI(HX);function KX(t,e,n,r){return Object.assign.apply(null,[{},...t.map((t=>{if("axisOrient"===t){const t="x"===n?"bottom":"left",i=e["x"===n?"axisBottom":"axisLeft"]||{},o=e["x"===n?"axisTop":"axisRight"]||{},a=new Set([...LI(i),...LI(o)]),s={};for(const e of a.values())s[e]={signal:`${r.signal} === "${t}" ? ${YU(i[e])} : ${YU(o[e])}`};return s}return e[t]}))])}function YX(t,e){var n;const r=[{}];for(const i of t){let t=null===(n=e[i])||void 0===n?void 0:n.style;if(t){t=oI(t);for(const n of t)r.push(e.style[n])}}return Object.assign.apply(null,r)}function JX(t,e,n,r={}){var i;const o=eW(t,n,e.style);if(void 0!==o)return{configFrom:"style",configValue:o};for(const e of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[e])||void 0===i?void 0:i[t]))return{configFrom:e,configValue:r[e][t]};return{}}const ZX={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:n})=>{const{format:r,formatType:i}=n;return Vq(t,t.type,r,i,e,!0)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:r}=t;return Hq(r,e,n)},grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>{var r;return(!dU(t)||!TP(t.bin))&&(null!==(r=e.grid)&&void 0!==r?r:function(t,e){return!gq(t)&&dU(e)&&!BP(null==e?void 0:e.bin)}(n,t))},gridScale:({model:t,channel:e})=>function(t,e){const n="x"===e?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelAlign||eK(e,n,r),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:r})=>t.labelBaseline||tK(e,n,r),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>{var r;return null!==(r=t.labelFlush)&&void 0!==r?r:function(t,e){if("x"===e&&$I(["quantitative","temporal"],t))return!0}(e.type,n)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{var r;return null!==(r=t.labelOverlap)&&void 0!==r?r:function(t,e){if("nominal"!==t)return"log"!==e||"greedy"}(e.type,n)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var o;const a="x"===t?"width":"y"===t?"height":void 0,s=a?e.getSizeSignalRef(a):void 0;return null!==(o=n.tickCount)&&void 0!==o?o:function({fieldOrDatumDef:t,scaleType:e,size:n,values:r}){var i;if(!r&&!gq(e)&&"log"!==e){if(dU(t)){if(BP(t.bin))return{signal:`ceil(${n.signal}/10)`};if(t.timeUnit&&$I(["month","hours","day","quarter"],null===(i=CL(t.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:t,model:e,channel:n})=>{if(void 0!==t.title)return t.title;const r=nK(e,n);if(void 0!==r)return r;const i=e.typedFieldDef(n),o="x"===n?"x2":"y2",a=e.fieldDef(o);return rW(i?[aU(i)]:[],dU(a)?[aU(a)]:[])},values:({axis:t,fieldOrDatumDef:e})=>function(t,e){const n=t.values;return Qj(n)?WU(e,n):OL(n)?n:void 0}(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>{var r;return null!==(r=t.zindex)&&void 0!==r?r:function(t,e){return"rect"===t&&DU(e)?1:0}(n,e)}};function QX(t){return`(((${t.signal} % 360) + 360) % 360)`}function tK(t,e,n,r){if(void 0!==t){if("x"===n){if(OL(t)){const n=QX(t);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${OL(e)?`(${e.signal} === "top")`:"top"===e} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315)return"middle";if(OL(e)){const n=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${n} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)==("top"===e)?"bottom":"top"}if(OL(t)){const n=QX(t);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${OL(e)?`(${e.signal} === "left")`:"left"===e} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225)return r?"middle":null;if(OL(e)){const n=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)==("left"===e)?"top":"bottom"}}function eK(t,e,n){if(void 0===t)return;const r="x"===n,i=r?0:90,o=r?"bottom":"left";if(OL(t)){const n=QX(t);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${OL(e)?`(${e.signal} === "${o}")`:e===o} ? "left" : "right"`}}if((t+i)%180==0)return r?null:"center";if(OL(e)){const n=i<t&&t<180+i?"===":"!==";return{signal:`${e.signal} ${n} "${o}" ? "left" : "right"`}}return(i<t&&t<180+i)==(e===o)?"left":"right"}function nK(t,e){const n="x"===e?"x2":"y2",r=t.fieldDef(e),i=t.fieldDef(n),o=r?r.title:void 0,a=i?i.title:void 0;return o&&a?iW(o,a):o||a||(void 0!==o?o:void 0!==a?a:void 0)}class rK extends VH{constructor(t,e){super(t),this.transform=e,this._dependentFields=IX(this.transform.calculate)}clone(){return new rK(null,DI(this.transform))}static parseAllForSortIndex(t,e){return e.forEachFieldDef(((e,n)=>{if(wU(e)&&nU(e.sort)){const{field:r,timeUnit:i}=e,o=e.sort,a=o.map(((t,e)=>`${WL({field:r,timeUnit:i,equal:t})} ? ${e} : `)).join("")+o.length;t=new rK(t,{calculate:a,as:iK(e,n,{forAs:!0})})}})),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${FI(this.transform)}`}}function iK(t,e,n){return EU(t,Object.assign({prefix:e,suffix:"sort_index"},null!=n?n:{}))}function oK(t,e){return $I(["top","bottom"],e)?"column":$I(["left","right"],e)||"row"===t?"row":"column"}function aK(t,e,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return ez(((null==e?void 0:e.header)||{})[t],i[t],n.header[t])}function sK(t,e,n,r){const i={};for(const o of t){const t=aK(o,e,n,r);void 0!==t&&(i[o]=t)}return i}const uK=["row","column"],lK=["header","footer"];function cK(t,e){const n=t.component.layoutHeaders[e].title,r=t.config?t.config:void 0,i=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:o,titleAngle:a,titleOrient:s}=sK(["titleAnchor","titleAngle","titleOrient"],i,r,e),u=oK(e,s),l=rz(a);return{name:`${e}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===e?{orient:"left"}:{}),{style:"guide-title"}),hK(l,u)),fK(u,l,o)),bK(r,i,e,GX,VX))}}function fK(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=eK(e,"row"===t?"left":"top","row"===t?"y":"x");return r?{align:r}:{}}function hK(t,e){const n=tK(t,"row"===e?"left":"top","row"===e?"y":"x",!0);return n?{baseline:n}:{}}function dK(t,e){const n=t.component.layoutHeaders[e],r=[];for(const i of lK)if(n[i])for(const o of n[i]){const a=mK(t,e,i,n,o);null!=a&&r.push(a)}return r}function pK(t,e){var n;const{sort:r}=t;return eU(r)?{field:EU(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:Qj(r)?{field:iK(t,e,{expr:"datum"}),order:"ascending"}:{field:EU(t,{expr:"datum"}),order:null!=r?r:"ascending"}}function gK(t,e,n){const{format:r,formatType:i,labelAngle:o,labelAnchor:a,labelOrient:s,labelExpr:u}=sK(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t,n,e),l=qq({fieldOrDatumDef:t,format:r,formatType:i,expr:"parent",config:n}).signal,c=oK(e,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?ZI(ZI(u,"datum.label",l),"datum.value",EU(t,{expr:"parent"})):l}},"row"===e?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),hK(o,c)),fK(c,o,a)),bK(n,t,e,XX,HX))}function mK(t,e,n,r,i){if(i){let o=null;const{facetFieldDef:a}=r,s=t.config?t.config:void 0;if(a&&i.labels){const{labelOrient:t}=sK(["labelOrient"],a,s,e);("row"===e&&!$I(["top","bottom"],t)||"column"===e&&!$I(["left","right"],t))&&(o=gK(a,e,s))}const u=cJ(t)&&!rU(t.facet),l=i.axes,c=(null==l?void 0:l.length)>0;if(o||c){const s="row"===e?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`},r.facetFieldDef?{from:{data:t.getName(e+"_domain")},sort:pK(a,e)}:{}),c&&u?{from:{data:t.getName(`facet_domain_${e}`)}}:{}),o?{title:o}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const yK={column:{start:0,end:1},row:{start:1,end:0}};function vK(t,e){return yK[e][t]}function bK(t,e,n,r,i){const o={};for(const a of r){if(!i[a])continue;const r=aK(a,e,t,n);void 0!==r&&(o[i[a]]=r)}return o}function xK(t){return[...wK(t,"width"),...wK(t,"height"),...wK(t,"childWidth"),...wK(t,"childHeight")]}function wK(t,e){const n="width"===e?"x":"y",r=t.component.layoutSize.get(e);if(!r||"merged"===r)return[];const i=t.getSizeSignalRef(e).signal;if("step"===r){const e=t.getScaleComponent(n);if(e){const r=e.get("type"),o=e.get("range");if(gq(r)&&FL(o)){const r=t.scaleName(n);return cJ(t.parent)&&"independent"===t.parent.component.resolve.scale[n]?[_K(r,o)]:[_K(r,o),{name:i,update:kK(r,e,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const e=i.endsWith("width"),n=e?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${YW(t.config.view,e?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function _K(t,e){return{name:t+"_step",value:e.step}}function kK(t,e,n){const r=e.get("type"),i=e.get("padding"),o=ez(e.get("paddingOuter"),i);let a=e.get("paddingInner");return a="band"===r?void 0!==a?a:i:1,`bandspace(${n}, ${a}, ${o}) * ${t}_step`}function AK(t){return"childWidth"===t?"width":"childHeight"===t?"height":t}function EK(t,e){return LI(t).reduce(((n,r)=>{const i=t[r];return Object.assign(Object.assign({},n),yH(e,i,r,(t=>OL(t)?t:{value:t.value})))}),{})}function DK(t,e){if(hJ(e)||cJ(e))return"shared";if(fJ(e))return hP(t)?"independent":"shared";throw new Error("invalid model type for resolve")}function SK(t,e){const n=t.scale[e],r=hP(e)?"axis":"legend";return"independent"===n?("shared"===t[r][e]&&dL(function(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}(e)),"independent"):t[r][e]||"shared"}const CK=Object.assign(Object.assign({},RW),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),OK=LI(CK);class FK extends IV{}const MK={symbols:function(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i,legendType:o}){var a,s,u,l,c;if("symbol"!==o)return;const{markDef:f,encoding:h,config:d,mark:p}=n,g=f.filled&&"trail"!==p;let m=Object.assign(Object.assign({},function(t,e,n){for(const r of n){const n=QU(r,e.markDef,e.config);void 0!==n&&(t[r]=XU(n))}return t}({},n,Mz)),AH(n,{filled:g}));const y=null!==(a=$K(h.opacity))&&void 0!==a?a:f.opacity;if(m.fill)if("fill"===r||g&&r===aR)delete m.fill;else if(m.fill.field)i.get("symbolFillColor")?delete m.fill:(m.fill=XU(null!==(s=d.legend.symbolBaseFillColor)&&void 0!==s?s:"black"),m.fillOpacity=XU(null!=y?y:1));else if(Qj(m.fill)){const t=null!==(c=null!==(l=NK(null!==(u=h.fill)&&void 0!==u?u:h.color))&&void 0!==l?l:f.fill)&&void 0!==c?c:g&&f.color;t&&(m.fill=XU(t))}if(m.stroke)if("stroke"===r||!g&&r===aR)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(Qj(m.stroke)){const t=ez(NK(h.stroke||h.color),f.stroke,g?f.color:void 0);t&&(m.stroke={value:t})}if(r!==hR){const t=dU(e)&&TK(0,i,e);t?m.opacity=[Object.assign({test:t},XU(null!=y?y:1)),XU(d.legend.unselectedOpacity)]:y&&(m.opacity=XU(y))}return m=Object.assign(Object.assign({},m),t),PI(m)?void 0:m},gradient:function(t,{model:e,legendType:n}){if("gradient"!==n)return;let r={};const i=$K(e.encoding.opacity)||e.markDef.opacity;return i&&(r.opacity=XU(i)),r=Object.assign(Object.assign({},r),t),PI(r)?void 0:r},labels:function(t,{fieldOrDatumDef:e,model:n,channel:r,legendCmpt:i}){const o=n.legend(r)||{},a=n.config,s=dU(e)?TK(0,i,e):void 0,u=s?[{test:s,value:1},{value:a.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=o,f=Pq(c)?Wq({fieldOrDatumDef:e,field:"datum.value",format:l,formatType:c,config:a}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),t);return PI(h)?void 0:h},entries:function(t,{legendCmpt:e}){const n=e.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}};function $K(t){return BK(t,((t,e)=>Math.max(t,e.value)))}function NK(t){return BK(t,((t,e)=>ez(t,e.value)))}function BK(t,e){return function(t){const e=t&&t.condition;return!!e&&(Qj(e)||xU(e))}(t)?oI(t.condition).reduce(e,t.value):xU(t)?t.value:void 0}function TK(t,e,n){const r=e.get("selections");if(!(null==r?void 0:r.length))return;const i=fI(n.field);return r.map((t=>`(!length(data(${fI(VI(t)+kG)})) || (${t}[${i}] && indexof(${t}[${i}], datum.value) >= 0))`)).join(" || ")}const jK={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:r,formatType:i}=e;return Vq(t,t.type,r,i,n,!1)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:r}=t;return Hq(r,e,n)},gradientLength:t=>{var e,n;const{legend:r,legendConfig:i}=t;return null!==(n=null!==(e=r.gradientLength)&&void 0!==e?e:i.gradientLength)&&void 0!==n?n:function({legendConfig:t,model:e,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:a,gradientVerticalMaxLength:s,gradientVerticalMinLength:u}=t;if(yq(i))return"horizontal"===n?"top"===r||"bottom"===r?zK(e,"width",a,o):a:zK(e,"height",u,s)}(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>{var r,i;return null!==(i=null!==(r=t.labelOverlap)&&void 0!==r?r:e.labelOverlap)&&void 0!==i?i:function(t){if($I(["quantile","threshold","log"],t))return"greedy"}(n)},symbolType:({legend:t,markDef:e,channel:n,encoding:r})=>{var i;return null!==(i=t.symbolType)&&void 0!==i?i:function(t,e,n,r){var i;if("shape"!==e){const t=null!==(i=NK(n))&&void 0!==i?i:r;if(t)return t}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(e.type,n,r.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>MU(t,e,{allowDisabling:!0}),type:({legendType:t,scaleType:e,channel:n})=>{if(FR(n)&&yq(e)){if("gradient"===t)return}else if("symbol"===t)return;return t},values:({fieldOrDatumDef:t,legend:e})=>function(t,e){const n=t.values;return Qj(n)?WU(e,n):OL(n)?n:void 0}(e,t)};function IK({legendConfig:t,legendType:e,orient:n,legend:r}){var i,o;return null!==(o=null!==(i=r.direction)&&void 0!==i?i:t[e?"gradientDirection":"symbolDirection"])&&void 0!==o?o:function(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===e?"horizontal":void 0}}(n,e)}function zK(t,e,n,r){return{signal:`clamp(${t.getSizeSignalRef(e).signal}, ${n}, ${r})`}}function RK(t){const e=lJ(t)?function(t){const{encoding:e}=t,n={};for(const r of[aR,...IW]){const i=jU(e[r]);i&&t.getScaleComponent(r)&&(r===lR&&dU(i)&&i.type===ZL||(n[r]=LK(t,r)))}return n}(t):function(t){const{legends:e,resolve:n}=t.component;for(const r of t.children){RK(r);for(const i of LI(r.component.legends))n.legend[i]=SK(t.component.resolve,i),"shared"===n.legend[i]&&(e[i]=qK(e[i],r.component.legends[i]),e[i]||(n.legend[i]="independent",delete e[i]))}for(const r of LI(e))for(const e of t.children)e.component.legends[r]&&"shared"===n.legend[r]&&delete e.component.legends[r];return e}(t);return t.component.legends=e,e}function PK(t,e,n,r){switch(e){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===e&&t===(null==r?void 0:r.title))return!0}return t===(n||{})[e]}function LK(t,e){var n,r,i;let o=t.legend(e);const{markDef:a,encoding:s,config:u}=t,l=u.legend,c=new FK({},function(t,e){const n=t.scaleName(e);if("trail"===t.mark){if("color"===e)return{stroke:n};if("size"===e)return{strokeWidth:n}}return"color"===e?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}(t,e));!function(t,e,n){var r;const i=null===(r=t.fieldDef(e))||void 0===r?void 0:r.field;SG(t,(t=>{var r,o;const a=null!==(r=t.project.hasField[i])&&void 0!==r?r:t.project.hasChannel[e];if(a&&rG.has(t)){const e=null!==(o=n.get("selections"))&&void 0!==o?o:[];e.push(t.name),n.set("selections",e,!1),a.hasLegend=!0}}))}(t,e,c);const f=void 0!==o?!o:l.disable;if(c.set("disable",f,void 0!==o),f)return c;o=o||{};const h=t.getScaleComponent(e).get("type"),d=jU(s[e]),p=dU(d)?null===(n=CL(d.timeUnit))||void 0===n?void 0:n.unit:void 0,g=o.orient||u.legend.orient||"right",m=function(t){const{legend:e}=t;return ez(e.type,function({channel:t,timeUnit:e,scaleType:n}){if(FR(t)){if($I(["quarter","month","day"],e))return"symbol";if(yq(n))return"gradient"}return"symbol"}(t))}({legend:o,channel:e,timeUnit:p,scaleType:h}),y={legend:o,channel:e,model:t,markDef:a,encoding:s,fieldOrDatumDef:d,legendConfig:l,config:u,scaleType:h,orient:g,legendType:m,direction:IK({legend:o,legendType:m,orient:g,legendConfig:l})};for(const n of OK){const r=n in jK?jK[n](y):o[n];if(void 0!==r){const i=PK(r,n,o,t.fieldDef(e));(i||void 0===u.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==o?void 0:o.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:d,model:t,channel:e,legendCmpt:c,legendType:m};for(const e of["labels","legend","title","symbols","gradient","entries"]){const n=EK(null!==(i=v[e])&&void 0!==i?i:{},t),r=e in MK?MK[e](n,w):n;void 0===r||PI(r)||(x[e]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&dU(d)?{name:`${VI(d.field)}_legend_${e}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return PI(x)||c.set("encode",x,!!(null==o?void 0:o.encoding)),c}function qK(t,e){var n,r,i,o;if(!t)return e.clone();const a=t.getWithExplicit("orient"),s=e.getWithExplicit("orient");if(a.explicit&&s.explicit&&a.value!==s.value)return;let u=!1;for(const n of OK){const r=qV(t.getWithExplicit(n),e.getWithExplicit(n),n,"legend",((t,e)=>{switch(n){case"symbolType":return r=t,"circle"===(i=e).value?i:r;case"title":return oW(t,e);case"type":return u=!0,RV("symbol")}var r,i;return LV(t,e,n,"legend")}));t.setWithExplicit(n,r)}return u&&((null===(r=null===(n=t.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&GI(t.implicit,["encode","gradient"]),(null===(o=null===(i=t.explicit)||void 0===i?void 0:i.encode)||void 0===o?void 0:o.gradient)&&GI(t.explicit,["encode","gradient"])),t}function UK(t,e,n,r){var i,o,a;t.encode=null!==(i=t.encode)&&void 0!==i?i:{},t.encode[e]=null!==(o=t.encode[e])&&void 0!==o?o:{},t.encode[e].update=null!==(a=t.encode[e].update)&&void 0!==a?a:{},t.encode[e].update[n]=r}function WK(t){const e=t.component.legends,n={};for(const r of LI(e)){const i=t.getScaleComponent(r),o=OI(i.get("domains"));if(n[o])for(const t of n[o])qK(t,e[r])||n[o].push(e[r]);else n[o]=[e[r].clone()]}return qI(n).flat().map((e=>function(t,e){var n,r,i;const o=t.combine(),{disable:a,labelExpr:s,selections:u}=o,l=dI(o,["disable","labelExpr","selections"]);if(!a){if(!1===e.aria&&null==l.aria&&(l.aria=!1),null===(n=l.encode)||void 0===n?void 0:n.symbols){const t=l.encode.symbols.update;!t.fill||"transparent"===t.fill.value||t.stroke||l.stroke||(t.stroke={value:"transparent"});for(const e of IW)l[e]&&delete t[e]}if(l.title||delete l.title,void 0!==s){let t=s;(null===(i=null===(r=l.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&OL(l.encode.labels.update.text)&&(t=ZI(s,"datum.label",l.encode.labels.update.text.signal)),UK(l,"labels","text",{signal:t})}for(const t in l){const e=l[t];if(OL(e)){const n=zW[t];if(n){const{vgProp:r,part:i}=n;UK(l,i,r,e),delete l[t]}}}return l}}(e,t.config))).filter((t=>void 0!==t))}function VK(t){const e=t.component.projection;if(!e||e.merged)return[];const n=e.combine(),{name:r}=n;if(e.data){const i={signal:`[${e.size.map((t=>t.signal)).join(", ")}]`},o=e.data.reduce(((e,n)=>{const r=OL(n)?n.signal:`data('${t.lookupDataSource(n)}')`;return $I(e,r)||e.push(r),e}),[]);if(o.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:o.length>1?`[${o.join(", ")}]`:o[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const HK=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class GK extends IV{constructor(t,e,n,r){super(Object.assign({},e),{name:t}),this.specifiedProjection=e,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function XK(t){t.component.projection=lJ(t)?function(t){var e;if(t.hasProjection){const n=t.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,o=r?function(t){const e=[],{encoding:n}=t;for(const r of[[rR,nR],[oR,iR]])(jU(n[r[0]])||jU(n[r[1]]))&&e.push({signal:t.getName(`geojson_${e.length}`)});return t.channelHasField(lR)&&t.typedFieldDef(lR).type===ZL&&e.push({signal:t.getName(`geojson_${e.length}`)}),0===e.length&&e.push(t.requestDataName(JV)),e}(t):void 0;return new GK(t.projectionName(!0),Object.assign(Object.assign({},null!==(e=t.config.projection)&&void 0!==e?e:{}),null!=n?n:{}),i,o)}}(t):function(t){if(0===t.children.length)return;let e;for(const e of t.children)XK(e);const n=BI(t.children,(t=>{const n=t.component.projection;if(n){if(e){const t=function(t,e){const n=BI(HK,(n=>!sI(t.explicit,n)&&!sI(e.explicit,n)||!(!sI(t.explicit,n)||!sI(e.explicit,n)||OI(t.get(n))!==OI(e.get(n)))));if(OI(t.size)===OI(e.size)){if(n)return t;if(OI(t.explicit)===OI({}))return e;if(OI(e.explicit)===OI({}))return t}return null}(e,n);return t&&(e=t),!!t}return e=n,!0}return!0}));if(e&&n){const n=t.projectionName(!0),r=new GK(n,e.specifiedProjection,e.size,DI(e.data));for(const e of t.children){const t=e.component.projection;t&&(t.isFit&&r.data.push(...e.component.projection.data),e.renameProjection(t.get("name"),n),t.merged=!0)}return r}}(t)}function KK(t,e){return`${NP(t)}_${e}`}function YK(t,e,n){var r;const i=KK(null!==(r=PU(n,void 0))&&void 0!==r?r:{},e);return t.getName(`${i}_bins`)}function JK(t,e,n){let r,i;r=function(t){return"as"in t}(t)?cI(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]:[EU(t,{forAs:!0}),EU(t,{binSuffix:"end",forAs:!0})];const o=Object.assign({},PU(e,void 0)),a=KK(o,t.field),{signal:s,extentSignal:u}=function(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}(n,a);if(IP(o.extent)){const t=o.extent,e=t.selection;i=PX(n.getSelectionComponent(VI(e),e),t),delete o.extent}return{key:a,binComponent:Object.assign(Object.assign(Object.assign({bin:o,field:t.field,as:[r]},s?{signal:s}:{}),u?{extentSignal:u}:{}),i?{span:i}:{})}}class ZK extends VH{constructor(t,e){super(t),this.bins=e}clone(){return new ZK(null,DI(this.bins))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,r)=>{if(bU(n)&&BP(n.bin)){const{key:i,binComponent:o}=JK(n,n.bin,e);t[i]=Object.assign(Object.assign(Object.assign({},o),t[i]),function(t,e,n,r){var i,o;if(VU(e,n)){const a=lJ(t)&&null!==(o=null!==(i=t.axis(n))&&void 0!==i?i:t.legend(n))&&void 0!==o?o:{},s=EU(e,{expr:"datum"}),u=EU(e,{expr:"datum",binSuffix:"end"});return{formulaAs:EU(e,{binSuffix:"range",forAs:!0}),formula:Yq(s,u,a.format,a.formatType,r)}}return{}}(e,n,r,e.config))}return t}),{});return PI(n)?null:new ZK(t,n)}static makeFromTransform(t,e,n){const{key:r,binComponent:i}=JK(e,e.bin,n);return new ZK(t,{[r]:i})}merge(t,e){for(const n of LI(t.bins))n in this.bins?(e(t.bins[n].signal,this.bins[n].signal),this.bins[n].as=jI([...this.bins[n].as,...t.bins[n].as],FI)):this.bins[n]=t.bins[n];for(const e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(qI(this.bins).map((t=>t.as)).flat(2))}dependentFields(){return new Set(qI(this.bins).map((t=>t.field)))}hash(){return`Bin ${FI(this.bins)}`}assemble(){return qI(this.bins).flatMap((t=>{const e=[],[n,...r]=t.as,i=t.bin,{extent:o}=i,a=dI(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:JI(t.field),as:n,signal:t.signal},IP(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(e.push({type:"extent",field:JI(t.field),signal:t.extentSignal}),s.extent={signal:t.extentSignal}),e.push(s);for(const t of r)for(let r=0;r<2;r++)e.push({type:"formula",expr:EU({field:n[r]},{expr:"datum"}),as:t[r]});return t.formula&&e.push({type:"formula",expr:t.formula,as:t.formulaAs}),e}))}}class QK extends VH{constructor(t){let e;if(super(null),GV(t=null!=t?t:{name:"source"})||(e=t.format?Object.assign({},CI(t.format,["parse"])):{}),VV(t))this._data={values:t.values};else if(WV(t)){if(this._data={url:t.url},!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];$I(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.type=n}}else KV(t)?this._data={values:[{type:"Sphere"}]}:(HV(t)||GV(t))&&(this._data={});this._generator=GV(t),t.name&&(this._name=t.name),e&&!PI(e)&&(this._data.format=e)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function tY(t){for(const e of t){for(const t of e.children)if(t.parent!==e)return console.error("Dataflow graph is inconsistent.",e,t),!1;if(!tY(e.children))return!1}return!0}class eY extends VH{constructor(t,e){super(t),this.params=e}clone(){return new eY(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${FI(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class nY extends VH{constructor(t,e){super(t),this.params=e}clone(){return new nY(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([null!==(t=this.params.as)&&void 0!==t?t:"data"])}hash(){return`Hash ${FI(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function rY(t){return t instanceof QK||t instanceof eY||t instanceof nY}class iY{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class oY extends iY{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:e}){t&&this.setContinue(),e&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(rY(t))return!1;const e=t.parent,{continueFlag:n}=this.run(t);return n&&this.optimizeNextFromLeaves(e),this.mutatedFlag}}class aY extends iY{}class sY extends VH{constructor(t,e,n){super(t),this.dimensions=e,this.measures=n}clone(){return new sY(null,new Set(this.dimensions),DI(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=!1;e.forEachFieldDef((t=>{t.aggregate&&(n=!0)}));const r={},i=new Set;return n?(e.forEachFieldDef(((t,n)=>{var o,a,s,u;const{aggregate:l,field:c}=t;if(l)if("count"===l)r["*"]=null!==(o=r["*"])&&void 0!==o?o:{},r["*"].count=new Set([EU(t,{forAs:!0})]);else{if(zz(l)||Rz(l)){const t=zz(l)?"argmin":"argmax",e=l[t];r[e]=null!==(a=r[e])&&void 0!==a?a:{},r[e][t]=new Set([EU({op:t,field:e},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][l]=new Set([EU(t,{forAs:!0})]);CP(n)&&"unaggregated"===e.scaleDomain(n)&&(r[c]=null!==(u=r[c])&&void 0!==u?u:{},r[c].min=new Set([EU({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([EU({field:c,aggregate:"max"},{forAs:!0})]))}else!function(t,e,n,r){const i=lJ(r)?r.encoding[XR(e)]:void 0;if(bU(n)&&lJ(r)&&lU(e,n,i,r.stack,r.markDef,r.config))t.add(EU(n,{})),t.add(EU(n,{suffix:"end"})),n.bin&&VU(n,e)&&t.add(EU(n,{binSuffix:"range"}));else if(e in SR){const n=function(t){switch(t){case nR:return"y";case iR:return"y2";case rR:return"x";case oR:return"x2"}}(e);t.add(r.getName(n))}else t.add(EU(n))}(i,n,t,e)})),i.size+LI(r).length===0?null:new sY(t,i,r)):null}static makeFromTransform(t,e){var n,r,i;const o=new Set,a={};for(const t of e.aggregate){const{op:e,field:i,as:o}=t;e&&("count"===e?(a["*"]=null!==(n=a["*"])&&void 0!==n?n:{},a["*"].count=new Set([o||EU(t,{forAs:!0})])):(a[i]=null!==(r=a[i])&&void 0!==r?r:{},a[i][e]=new Set([o||EU(t,{forAs:!0})])))}for(const t of null!==(i=e.groupby)&&void 0!==i?i:[])o.add(t);return o.size+LI(a).length===0?null:new sY(t,o,a)}merge(t){return function(t,e){if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}(this.dimensions,t.dimensions)?(function(t,e){var n;for(const r of LI(e)){const i=e[r];for(const e of LI(i))r in t?t[r][e]=new Set([...null!==(n=t[r][e])&&void 0!==n?n:[],...i[e]]):t[r]={[e]:i[e]}}}(this.measures,t.measures),!0):(function(...t){hL.debug(...t)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...LI(this.measures)])}producedFields(){const t=new Set;for(const e of LI(this.measures))for(const n of LI(this.measures[e])){const r=this.measures[e][n];0===r.size?t.add(`${n}_${e}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${FI({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],e=[],n=[];for(const r of LI(this.measures))for(const i of LI(this.measures[r]))for(const o of this.measures[r][i])n.push(o),t.push(i),e.push("*"===r?null:JI(r));return{type:"aggregate",groupby:[...this.dimensions].map(JI),ops:t,fields:e,as:n}}}class uY extends VH{constructor(t,e,n,r){super(t),this.model=e,this.name=n,this.data=r;for(const t of $R){const n=e.facet[t];if(n){const{bin:r,sort:i}=n;this[t]=Object.assign({name:e.getName(`${t}_domain`),fields:[EU(n),...BP(r)?[EU(n,{binSuffix:"end"})]:[]]},eU(i)?{sortField:i}:Qj(i)?{sortIndexField:iK(n,t)}:{})}}this.childModel=e.child}hash(){let t="Facet";for(const e of $R)this[e]&&(t+=` ${e.charAt(0)}:${FI(this[e])}`);return t}get fields(){var t;const e=[];for(const n of $R)(null===(t=this[n])||void 0===t?void 0:t.fields)&&e.push(...this[n].fields);return e}dependentFields(){const t=new Set(this.fields);for(const e of $R)this[e]&&(this[e].sortField&&t.add(this[e].sortField.field),this[e].sortIndexField&&t.add(this[e].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const e of fP){const n=this.childModel.component.scales[e];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(gq(r)&&FL(i)){const n=UY(WY(this.childModel,e));n?t[e]=n:dL(`Unknown field for ${e}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,e,n){const r={row:"y",column:"x"}[t],i=[],o=[],a=[];n&&n[r]&&(e?(i.push(`distinct_${n[r]}`),o.push("max")):(i.push(n[r]),o.push("distinct")),a.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:u}=this[t];if(s){const{op:t=Jq,field:e}=s;i.push(e),o.push(t),a.push(EU(s,{forAs:!0}))}else u&&(i.push(u),o.push("max"),a.push(u));return{name:this[t].name,source:null!=e?e:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},i.length?{fields:i,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var e,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,o=[],a={};for(const t of uK){for(const r of lK){const o=null!==(e=i[t]&&i[t][r])&&void 0!==e?e:[];for(const e of o)if((null===(n=e.axes)||void 0===n?void 0:n.length)>0){a[t]=!0;break}}if(a[t]){const e=`length(data("${this.facet.name}"))`,n="row"===t?r?{signal:`ceil(${e} / ${r})`}:1:r?{signal:`min(${e}, ${r})`}:{signal:e};o.push({name:`${this.facet.name}_${t}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:u}=a;return(s||u)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,e;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:s}=this;if(o&&a&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(null!==(t=i.x)&&void 0!==t?t:[],null!==(e=i.y)&&void 0!==e?e:[]),a=o.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:a}]})}for(const t of[Hz,Vz])this[t]&&n.push(this.assembleRowColumnHeaderData(t,r,i));if(s){const t=this.assembleFacetHeaderData(i);t&&n.push(...t)}return n}}function lY(t){return"'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]?t.slice(1,-1):t}function cY(t){const e={};return kI(t.filter,(t=>{var n;if(qL(t)){let r=null;TL(t)?r=t.equal:PL(t)?r=t.range[0]:LL(t)&&(r=(null!==(n=t.oneOf)&&void 0!==n?n:t.in)[0]),r&&(pL(r)?e[t.field]="date":lI(r)?e[t.field]="number":cI(r)&&(e[t.field]="string")),t.timeUnit&&(e[t.field]="date")}})),e}class fY extends VH{constructor(t,e){super(t),this._parse=e}clone(){return new fY(null,DI(this._parse))}hash(){return`Parse ${FI(this._parse)}`}static makeExplicit(t,e,n){let r={};const i=e.data;return!GV(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(t,r,{},n)}static makeWithAncestors(t,e,n,r){for(const t of LI(n)){const e=r.getWithExplicit(t);void 0!==e.value&&(e.explicit||e.value===n[t]||"derived"===e.value||"flatten"===n[t]?delete n[t]:dL(GP(t,n[t],e.value)))}for(const t of LI(e)){const n=r.get(t);void 0!==n&&(n===e[t]?delete e[t]:dL(GP(t,e[t],n)))}const i=new IV(e,n);r.copyAll(i);const o={};for(const t of LI(i.combine())){const e=i.get(t);null!==e&&(o[t]=e)}return 0===LI(o).length||r.parseNothing?null:new fY(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const e of LI(this._parse)){const n=this._parse[e];1===tz(e)&&(t[e]=n)}return t}producedFields(){return new Set(LI(this._parse))}dependentFields(){return new Set(LI(this._parse))}assembleTransforms(t=!1){return LI(this._parse).filter((e=>!t||tz(e)>1)).map((t=>{const e=function(t,e){const n=KI(t);return"number"===e?`toNumber(${n})`:"boolean"===e?`toBoolean(${n})`:"string"===e?`toString(${n})`:"date"===e?`toDate(${n})`:"flatten"===e?n:0===e.indexOf("date:")?`timeParse(${n},'${lY(e.slice(5,e.length))}')`:0===e.indexOf("utc:")?`utcParse(${n},'${lY(e.slice(4,e.length))}')`:(dL(`Unrecognized parse "${e}".`),null)}(t,this._parse[t]);return e?{type:"formula",expr:e,as:QI(t)}:null})).filter((t=>null!==t))}}class hY extends VH{clone(){return new hY(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([PW])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:PW}}}class dY extends VH{constructor(t,e){super(t),this.transform=e}clone(){return new dY(null,DI(this.transform))}addDimensions(t){this.transform.groupby=jI(this.transform.groupby.concat(t),(t=>t))}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map((t=>t.field)).filter((t=>void 0!==t)).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:EU(t)}hash(){return`JoinAggregateTransform ${FI(this.transform)}`}assemble(){const t=[],e=[],n=[];for(const r of this.transform.joinaggregate)e.push(r.op),n.push(this.getDefaultName(r)),t.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:e,fields:t},void 0!==r?{groupby:r}:{})}}class pY extends VH{constructor(t,e){super(t),this._stack=e}clone(){return new pY(null,DI(this._stack))}static makeFromTransform(t,e){const{stack:n,groupby:r,as:i,offset:o="zero"}=e,a=[],s=[];if(void 0!==e.sort)for(const t of e.sort)a.push(t.field),s.push(ez(t.order,"ascending"));const u={field:a,order:s};let l;return l=function(t){return Qj(t)&&t.every((t=>cI(t)))&&t.length>1}(i)?i:cI(i)?[i,i+"_end"]:[e.stack+"_start",e.stack+"_end"],new pY(t,{stackField:n,groupby:r,offset:o,sort:u,facetby:[],as:l})}static makeFromEncoding(t,e){const n=e.stack,{encoding:r}=e;if(!n)return null;const{groupbyChannel:i,fieldChannel:o,offset:a,impute:s}=n;let u;i&&(u=TU(r[i]));const l=function(t){return t.stack.stackBy.reduce(((t,e)=>{const n=EU(e.fieldDef);return n&&t.push(n),t}),[])}(e),c=e.encoding.order;let f;return f=Qj(c)||dU(c)?nW(c):l.reduce(((t,e)=>(t.field.push(e),t.order.push("y"===o?"descending":"ascending"),t)),{field:[],order:[]}),new pY(t,{dimensionFieldDef:u,stackField:e.vgField(o),facetby:[],stackby:l,sort:f,offset:a,impute:s,as:[e.vgField(o,{suffix:"start",forAs:!0}),e.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${FI(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:e,groupby:n}=this._stack;return t?t.bin?e?[EU(t,{binSuffix:"mid"})]:[EU(t,{}),EU(t,{binSuffix:"end"})]:[EU(t)]:null!=n?n:[]}assemble(){const t=[],{facetby:e,dimensionFieldDef:n,stackField:r,stackby:i,sort:o,offset:a,impute:s,as:u}=this._stack;if(s&&n){const{band:o=.5,bin:a}=n;a&&t.push({type:"formula",expr:`${o}*`+EU(n,{expr:"datum"})+`+${1-o}*`+EU(n,{expr:"datum",binSuffix:"end"}),as:EU(n,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...i,...e],key:EU(n,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:r,sort:o,as:u,offset:a}),t}}class gY extends VH{constructor(t,e){super(t),this.transform=e}clone(){return new gY(null,DI(this.transform))}addDimensions(t){this.transform.groupby=jI(this.transform.groupby.concat(t),(t=>t))}dependentFields(){var t,e;const n=new Set;return(null!==(t=this.transform.groupby)&&void 0!==t?t:[]).forEach(n.add,n),(null!==(e=this.transform.sort)&&void 0!==e?e:[]).forEach((t=>n.add(t.field))),this.transform.window.map((t=>t.field)).filter((t=>void 0!==t)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:EU(t)}hash(){return`WindowTransform ${FI(this.transform)}`}assemble(){var t;const e=[],n=[],r=[],i=[];for(const t of this.transform.window)n.push(t.op),r.push(this.getDefaultName(t)),i.push(void 0===t.param?null:t.param),e.push(void 0===t.field?null:t.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&null===o[0]&&null===o[1]&&n.every((t=>Pz(t))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:e},void 0!==a?{groupby:a}:{});const s=[],u=[];if(void 0!==this.transform.sort)for(const e of this.transform.sort)s.push(e.field),u.push(null!==(t=e.order)&&void 0!==t?t:"ascending");const l={field:s,order:u},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:e,sort:l},void 0!==c?{ignorePeers:c}:{}),void 0!==a?{groupby:a}:{}),void 0!==o?{frame:o}:{})}}class mY extends oY{run(t){const e=t.parent;if(t instanceof fY){if(rY(e))return this.flags;if(e.numChildren()>1)return this.setContinue(),this.flags;if(e instanceof fY)this.setMutated(),e.merge(t);else{if(RI(e.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class yY extends aY{mergeNodes(t,e){const n=e.shift();for(const r of e)t.removeChild(r),r.parent=n,r.remove()}run(t){const e=t.children.map((t=>t.hash())),n={};for(let r=0;r<e.length;r++)void 0===n[e[r]]?n[e[r]]=[t.children[r]]:n[e[r]].push(t.children[r]);for(const e of LI(n))n[e].length>1&&(this.setMutated(),this.mergeNodes(t,n[e]));for(const e of t.children)this.run(e);return this.mutatedFlag}}class vY extends oY{run(t){return t instanceof HH||t.numChildren()>0||t instanceof uY||(this.setMutated(),t.remove()),this.flags}}class bY extends oY{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof GH){const e=t.producedFields();II(e,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...e]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class xY extends oY{run(t){this.setContinue();const e=t.parent.children.filter((t=>t instanceof GH)),n=e.pop();for(const t of e)this.setMutated(),n.merge(t);return this.flags}}function wY(t){if(t instanceof uY)if(1!==t.numChildren()||t.children[0]instanceof HH){const n=t.model.component.data.main;_Y(n);const r=(e=t,function t(n){if(!(n instanceof uY)){const r=n.clone();if(r instanceof HH){const t=OY+r.getSource();r.setSource(t),e.model.component.data.outputNodes[t]=r}else(r instanceof sY||r instanceof pY||r instanceof gY||r instanceof dY)&&r.addDimensions(e.fields);for(const e of n.children.flatMap(t))e.parent=r;return[r]}return n.children.flatMap(t)}),i=t.children.map(r).flat();for(const t of i)t.parent=n}else{const e=t.children[0];(e instanceof sY||e instanceof pY||e instanceof gY||e instanceof dY)&&e.addDimensions(t.fields),e.swapWithParent(),wY(t)}else t.children.map(wY);var e}function _Y(t){if(t instanceof HH&&t.type===JV&&1===t.numChildren()){const e=t.children[0];e instanceof uY||(e.swapWithParent(),_Y(t))}}class kY extends aY{constructor(){super()}run(t){t instanceof HH&&!t.isRequired()&&(this.setMutated(),t.remove());for(const e of t.children)this.run(e);return this.mutatedFlag}}class AY extends aY{constructor(t){super(),this.requiresSelectionId=t&&OG(t)}run(t){t instanceof hY&&(this.requiresSelectionId&&(rY(t.parent)||t.parent instanceof sY||t.parent instanceof fY)||(this.setMutated(),t.remove()));for(const e of t.children)this.run(e);return this.mutatedFlag}}class EY extends oY{run(t){const e=t.parent,n=[...e.children],r=e.children.filter((t=>t instanceof fY));if(e.numChildren()>1&&r.length>=1){const t={},i=new Set;for(const e of r){const n=e.parse;for(const e of LI(n))e in t?t[e]!==n[e]&&i.add(e):t[e]=n[e]}for(const e of i)delete t[e];if(!PI(t)){this.setMutated();const r=new fY(e,t);for(const i of n){if(i instanceof fY)for(const e of LI(t))delete i.parse[e];e.removeChild(i),i.parent=r,i instanceof fY&&0===LI(i.parse).length&&i.remove()}}}return this.setContinue(),this.flags}}class DY extends oY{run(t){const e=t.parent,n=e.children.filter((t=>t instanceof sY)),r={};for(const t of n){const e=FI(t.groupBy);e in r||(r[e]=[]),r[e].push(t)}for(const t of LI(r)){const n=r[t];if(n.length>1){const t=n.pop();for(const r of n)t.merge(r)&&(e.removeChild(r),r.parent=t,r.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class SY extends oY{constructor(t){super(),this.model=t}run(t){const e=t.parent,n=!(rY(e)||e instanceof zX||e instanceof fY||e instanceof hY),r=[],i=[];for(const t of e.children)t instanceof ZK&&(n&&!RI(e.producedFields(),t.dependentFields())?r.push(t):i.push(t));if(r.length>0){const t=r.pop();for(const e of r)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated(),e instanceof ZK?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(i.length>1){const t=i.pop();for(const e of i)t.merge(e,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class CY extends oY{run(t){const e=t.parent,n=[...e.children];if(!NI(n,(t=>t instanceof HH))||e.numChildren()<=1)return this.setContinue(),this.flags;const r=[];let i;for(const t of n)if(t instanceof HH){let n=t;for(;1===n.numChildren();){const t=n.children[0];if(!(t instanceof HH))break;n=t}r.push(...n.children),i?(e.removeChild(t),t.parent=i.parent,i.parent.removeChild(i),i.parent=n,this.setMutated()):i=n}else r.push(t);if(r.length){this.setMutated();for(const t of r)t.parent.removeChild(t),t.parent=i}return this.setContinue(),this.flags}}const OY="scale_";function FY(t){const e=[];function n(t){if(0===t.numChildren())e.push(t);else for(const e of t.children)n(e)}for(const e of t)n(e);return e}function MY(t){return t}function $Y(t,e){return e.map((e=>{if(t instanceof oY){const n=t.optimizeNextFromLeaves(e);return t.reset(),n}return t.run(e)})).some(MY)}function NY(t,e){let n=t.sources;const r=new Set;return r.add($Y(new kY,n)),r.add($Y(new AY(e),n)),n=n.filter((t=>t.numChildren()>0)),r.add($Y(new vY,FY(n))),n=n.filter((t=>t.numChildren()>0)),r.add($Y(new mY,FY(n))),r.add($Y(new SY(e),FY(n))),r.add($Y(new bY,FY(n))),r.add($Y(new EY,FY(n))),r.add($Y(new DY,FY(n))),r.add($Y(new xY,FY(n))),r.add($Y(new yY,n)),r.add($Y(new CY,FY(n))),t.sources=n,r.has(!0)}class BY{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,e){return new BY((()=>t(e)))}}function TY(t){lJ(t)?function(t){const e=t.component.scales;for(const n of LI(e)){const r=jY(t,n);if(e[n].setWithExplicit("domains",r),PY(t,n),t.component.data.isFaceted){let e=t;for(;!cJ(e)&&e.parent;)e=e.parent;if("shared"===e.component.resolve.scale[n])for(const t of r.value)ML(t)&&(t.data=OY+t.data.replace(OY,""))}}}(t):function(t){for(const e of t.children)TY(e);const e=t.component.scales;for(const n of LI(e)){let r,i=null;for(const e of t.children){const t=e.component.scales[n];if(t){r=void 0===r?t.getWithExplicit("domains"):qV(r,t.getWithExplicit("domains"),"domains","scale",qY);const e=t.get("selectionExtent");i&&e&&i.selection!==e.selection&&dL("The same selection must be used to override scale domains in a layered view."),i=e}}e[n].setWithExplicit("domains",r),i&&e[n].set("selectionExtent",i,!0)}}(t)}function jY(t,e){const n=t.getScaleComponent(e).get("type"),{encoding:r}=t,i=function(t,e,n,r){if("unaggregated"===t){const{valid:t,reason:r}=LY(e,n);if(!t)return void dL(r)}else if(void 0===t&&r.useUnaggregatedDomain){const{valid:t}=LY(e,n);if(t)return"unaggregated"}return t}(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return i!==t.scaleDomain(e)&&(t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:i})),"x"===e&&jU(r.x2)?jU(r.x)?qV(zY(n,i,t,"x"),zY(n,i,t,"x2"),"domain","scale",qY):zY(n,i,t,"x2"):"y"===e&&jU(r.y2)?jU(r.y)?qV(zY(n,i,t,"y"),zY(n,i,t,"y2"),"domain","scale",qY):zY(n,i,t,"y2"):zY(n,i,t,e)}function IY(t,e,n){var r;const i=null===(r=CL(n))||void 0===r?void 0:r.unit;return"temporal"===e||i?function(t,e,n){return t.map((t=>({signal:`{data: ${UU(t,{timeUnit:n,type:e})}}`})))}(t,e,i):[t]}function zY(t,e,n,r){const{encoding:i}=n,o=jU(i[r]),{type:a}=o,s=o.timeUnit;if(function(t){return t&&t.unionWith}(e)){const i=zY(t,void 0,n,r),o=IY(e.unionWith,a,s);return zV([...i.value,...o])}if(OL(e))return zV([e]);if(e&&"unaggregated"!==e&&!bq(e))return zV(IY(e,a,s));const u=n.stack;if(u&&r===u.fieldChannel){if("normalize"===u.offset)return RV([[0,1]]);const t=n.requestDataName(JV);return RV([{data:t,field:n.vgField(r,{suffix:"start"})},{data:t,field:n.vgField(r,{suffix:"end"})}])}const l=CP(r)&&dU(o)?function(t,e,n){if(!gq(n))return;const r=t.fieldDef(e),i=r.sort;if(nU(i))return{op:"min",field:iK(r,e),order:"ascending"};const{stack:o}=t,a=o?[...o.groupbyField?[o.groupbyField]:[],...o.stackBy.map((t=>t.fieldDef.field))]:void 0;if(eU(i))return RY(i,o&&!$I(a,i.field));if(tU(i)){const{encoding:e,order:n}=i,r=t.fieldDef(e),{aggregate:s,field:u}=r,l=o&&!$I(a,u);if(zz(s)||Rz(s))return RY({field:EU(r),order:n},l);if(Pz(s)||!s)return RY({op:s,field:u,order:n},l)}else{if("descending"===i)return{op:"min",field:t.vgField(e),order:"descending"};if($I(["ascending",void 0],i))return!0}}(n,r,t):void 0;if(gU(o))return RV(IY([o.datum],a,s));const c=o;if("unaggregated"===e){const t=n.requestDataName(JV),{field:e}=o;return RV([{data:t,field:EU({field:e,aggregate:"min"})},{data:t,field:EU({field:e,aggregate:"max"})}])}if(BP(c.bin)){if(gq(t))return RV("bin-ordinal"===t?[]:[{data:WI(l)?n.requestDataName(JV):n.requestDataName(ZV),field:n.vgField(r,VU(c,r)?{binSuffix:"range"}:{}),sort:!0!==l&&tI(l)?l:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:t}=c;if(BP(t)){const e=YK(n,c.field,t);return RV([new BY((()=>{const t=n.getSignalName(e);return`[${t}.start, ${t}.stop]`}))])}return RV([{data:n.requestDataName(JV),field:n.vgField(r,{})}])}}if(c.timeUnit&&$I(["time","utc"],t)&&lU(r,c,lJ(n)?n.encoding[XR(r)]:void 0,n.stack,n.markDef,n.config)){const t=n.requestDataName(JV);return RV([{data:t,field:n.vgField(r)},{data:t,field:n.vgField(r,{suffix:"end"})}])}return RV(l?[{data:WI(l)?n.requestDataName(JV):n.requestDataName(ZV),field:n.vgField(r),sort:l}]:[{data:n.requestDataName(JV),field:n.vgField(r)}])}function RY(t,e){const{op:n,field:r,order:i}=t;return Object.assign(Object.assign({op:null!=n?n:e?"sum":Jq},r?{field:JI(r)}:{}),i?{order:i}:{})}function PY(t,e){var n;const r=t.component.scales[e],i=t.specifiedScales[e].domain,o=null===(n=t.fieldDef(e))||void 0===n?void 0:n.bin,a=bq(i)&&i,s=jP(o)&&IP(o.extent)&&o.extent;(a||s)&&r.set("selectionExtent",null!=a?a:s,!0)}function LY(t,e){const{aggregate:n,type:r}=t;return n?cI(n)&&!Wz[n]?{valid:!1,reason:nL(n)}:"quantitative"===r&&"log"===e?{valid:!1,reason:rL(t)}:{valid:!0}:{valid:!1,reason:eL(t)}}function qY(t,e,n,r){return t.explicit&&e.explicit&&dL(function(t,e,n,r){return`Conflicting ${e.toString()} property "${t.toString()}" (${OI(n)} and ${OI(r)}). Using the union of the two domains.`}(n,r,t.value,e.value)),{explicit:t.explicit,value:[...t.value,...e.value]}}function UY(t){if(ML(t)&&cI(t.field))return t.field;if(function(t){return!Qj(t)&&"fields"in t&&!("data"in t)}(t)){let e;for(const n of t.fields)if(ML(n)&&cI(n.field))if(e){if(e!==n.field)return dL("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),e}else e=n.field;return dL("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),e}if(function(t){return!Qj(t)&&"fields"in t&&"data"in t}(t)){dL("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const e=t.fields[0];return cI(e)?e:void 0}}function WY(t,e){return function(t){const e=jI(t.map((t=>{if(ML(t)){const{sort:e}=t;return dI(t,["sort"])}return t})),FI),n=jI(t.map((t=>{if(ML(t)){const e=t.sort;return void 0===e||WI(e)||("op"in e&&"count"===e.op&&delete e.field,"ascending"===e.order&&delete e.order),e}})).filter((t=>void 0!==t)),FI);if(0===e.length)return;if(1===e.length){const e=t[0];if(ML(e)&&n.length>0){let t=n[0];if(n.length>1)dL(aL),t=!0;else if(tI(t)&&"field"in t){const n=t.field;e.field===n&&(t=!t.order||{order:t.order})}return Object.assign(Object.assign({},e),{sort:t})}return e}const r=jI(n.map((t=>WI(t)||!("op"in t)||t.op in Iz?t:(dL(function(t){return`Dropping sort property ${OI(t)} as unioned domains only support boolean or op "count", "min", and "max".`}(t)),!0))),FI);let i;1===r.length?i=r[0]:r.length>1&&(dL(aL),i=!0);const o=jI(t.map((t=>ML(t)?t.data:null)),(t=>t));return 1===o.length&&null!==o[0]?Object.assign({data:o[0],fields:e.map((t=>t.field))},i?{sort:i}:{}):Object.assign({fields:e},i?{sort:i}:{})}(t.component.scales[e].get("domains").map((e=>(ML(e)&&(e.data=t.lookupDataSource(e.data)),e))))}function VY(t){return hJ(t)||fJ(t)?t.children.reduce(((t,e)=>t.concat(VY(e))),HY(t)):HY(t)}function HY(t){return LI(t.component.scales).reduce(((e,n)=>{const r=t.component.scales[n];if(r.merged)return e;const i=r.combine(),{name:o,type:a,selectionExtent:s,domains:u,range:l,reverse:c}=i,f=dI(i,["name","type","selectionExtent","domains","range","reverse"]),h=function(t,e,n){return hP(n)&&FL(t)?{step:{signal:e+"_step"}}:t}(i.range,o,n);let d;s&&(d=function(t,e){const n=e.selection;return{signal:PX(t.getSelectionComponent(n,VI(n)),e)}}(t,s));const p=WY(t,n);return e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:o,type:a},p?{domain:p}:{}),d?{domainRaw:d}:{}),{range:h}),void 0!==c?{reverse:c}:{}),f)),e}),[])}class GY extends IV{constructor(t,e){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",e)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||NI(this.get("domains"),(t=>Qj(t)&&2===t.length&&t[0]<=0&&t[1]>=0))}}const XY=["range","scheme"];function KY(t){return"x"===t?"width":"y"===t?"height":void 0}function YY(t,e){const n=t.fieldDef(e);if(n&&n.bin&&BP(n.bin)){const r=YK(t,n.field,n.bin),i=KY(e),o=t.getName(i);return new BY((()=>{const e=t.getSignalName(r),n=`(${e}.stop - ${e}.start) / ${e}.step`;return`${t.getSignalName(o)} / (${n})`}))}}function JY(t,e){const n=e.specifiedScales[t],{size:r}=e,i=e.getScaleComponent(t).get("type");for(const r of XY)if(void 0!==n[r]){const o=Sq(i,r),a=Cq(t,r);if(o)if(a)dL(a);else switch(r){case"range":return Qj(n.range)&&hP(t)?zV(n.range.map((t=>{if("width"===t||"height"===t){const n=e.getName(t),r=e.getSignalName.bind(e);return BY.fromName(r,n)}return t}))):zV(n.range);case"scheme":return zV(ZY(n[r]))}else dL(iL(i,r,t))}if(t===Xz||t===Kz){const e=t===Xz?"width":"height",n=r[e];if(GW(n)){if(gq(i))return zV({step:n.step});dL(oL(e))}}return RV(function(t,e){const{size:n,config:r,mark:i,encoding:o}=e,a=e.getSignalName.bind(e),{type:s}=jU(o[t]),u=e.getScaleComponent(t).get("type"),{domain:l,domainMid:c}=e.specifiedScales[t];switch(t){case Xz:case Kz:{if($I(["point","band"],u))if(t!==Xz||n.width){if(t===Kz&&!n.height){const t=ZW(r.view,"height");if(GW(t))return t}}else{const t=ZW(r.view,"width");if(GW(t))return t}const i=KY(t),o=e.getName(i);return t===Kz&&mq(u)?[BY.fromName(a,o),0]:[0,BY.fromName(a,o)]}case cR:{const o=QY(i,e.component.scales[t].get("zero"),r),a=function(t,e,n,r){const i={x:YY(n,"x"),y:YY(n,"y")};switch(t){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const t=eJ(e,i,r.view);return lI(t)?t-1:new BY((()=>`${t.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const t=eJ(e,i,r.view);return lI(t)?Math.pow(tJ*t,2):new BY((()=>`pow(0.95 * ${t.signal}, 2)`))}}throw new Error(ZP("size",t))}(i,n,e,r);return vq(u)?function(t,e,n){const r=()=>{const r=YU(e),i=YU(t),o=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${o}, ${o})`};return OL(e)?new BY(r):{signal:r()}}(o,a,function(t,e,n,r){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":return void 0!==n&&Qj(n)?n.length+1:(dL(function(t){return`Domain for ${t} is required for threshold scale.`}(r)),3)}}(u,r,l,t)):[o,a]}case tR:return[0,2*Math.PI];case fR:return[0,360];case Zz:return[0,new BY((()=>`min(${e.getSignalName("width")},${e.getSignalName("height")})/2`))];case gR:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case mR:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case lR:return"symbol";case aR:case sR:case uR:return"ordinal"===u?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case hR:case dR:case pR:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${t}`)}(t,e))}function ZY(t){return function(t){return!cI(t)&&!!t.name}(t)?Object.assign({scheme:t.name},CI(t,["name"])):{scheme:t}}function QY(t,e,n){if(e)return OL(e)?{signal:`${e.signal} ? 0 : ${QY(t,!1,n)}`}:0;switch(t){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(ZP("size",t))}const tJ=.95;function eJ(t,e,n){const r=GW(t.width)?t.width.step:JW(n,"width"),i=GW(t.height)?t.height.step:JW(n,"height");return e.x||e.y?new BY((()=>`min(${[e.x?e.x.signal:r,e.y?e.y.signal:i].join(", ")})`)):Math.min(r,i)}function nJ(t,e){lJ(t)?function(t,e){const n=t.component.scales,{config:r,encoding:i,markDef:o,specifiedScales:a}=t;for(const s of LI(n)){const u=a[s],l=n[s],c=t.getScaleComponent(s),f=jU(i[s]),h=u[e],d=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=Sq(d,e),y=Cq(s,e);if(void 0!==h&&(m?y&&dL(y):dL(iL(d,e,s))),m&&void 0===y)if(void 0!==h)l.copyKeyFromObject(e,u);else{const n=e in rJ?rJ[e]({model:t,channel:s,fieldOrDatumDef:f,scaleType:d,scalePadding:p,scalePaddingInner:g,domain:u.domain,markDef:o,config:r}):r.scale[e];void 0!==n&&l.set(e,n,!1)}}}(t,e):oJ(t,e)}const rJ={bins:({model:t,fieldOrDatumDef:e})=>dU(e)?function(t,e){const n=e.bin;if(BP(n)){const r=YK(t,e.field,n);return new BY((()=>t.getSignalName(r)))}if(TP(n)&&jP(n)&&void 0!==n.step)return{step:n.step}}(t,e):void 0,interpolate:({channel:t,fieldOrDatumDef:e})=>function(t,e){if($I([aR,sR,uR],t)&&"nominal"!==e)return"hcl"}(t,e.type),nice:({scaleType:t,channel:e,fieldOrDatumDef:n})=>function(t,e,n){var r;if(!(null===(r=TU(n))||void 0===r?void 0:r.bin)&&!$I([eq,nq],t))return e in cP||void 0}(t,e,n),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:r,config:i})=>function(t,e,n,r,i,o){if(t in cP){if(yq(e)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:e,orient:a}=i;if("bar"===e&&(!dU(r)||!r.bin&&!r.timeUnit)&&("vertical"===a&&"x"===t||"horizontal"===a&&"y"===t))return o.continuousBandSize}if(e===rq)return n.pointPadding}}(t,e,i.scale,n,r,i.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,config:r})=>function(t,e,n,r){if(void 0===t&&e in cP){const{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:i}=r;return ez(t,"bar"===n?e:i)}}(t,e,n.type,r.scale),paddingOuter:({scalePadding:t,channel:e,scaleType:n,markDef:r,scalePaddingInner:i,config:o})=>function(t,e,n,r,i,o){if(void 0===t&&e in cP&&"band"===n){const{bandPaddingOuter:t}=o;return ez(t,OL(i)?{signal:`${i.signal}/2`}:i/2)}}(t,e,n,r.type,i,o.scale),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:r})=>function(t,e,n,r){return"x"===n&&void 0!==r.xReverse?mq(t)&&"descending"===e?OL(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse:!(!mq(t)||"descending"!==e)||void 0}(e,dU(t)?t.sort:void 0,n,r.scale),zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:r,scaleType:i})=>function(t,e,n,r,i){if(n&&"unaggregated"!==n&&mq(i)){if(Qj(n)){const t=n[0],e=n[n.length-1];if(t<=0&&e>=0)return!0}return!1}if("size"===t&&"quantitative"===e.type&&!vq(i))return!0;if((!dU(e)||!e.bin)&&$I([...fP,...pP],t)){const{orient:e,type:n}=r;return!$I(["bar","area","line","trail"],n)||!("horizontal"===e&&"y"===t||"vertical"===e&&"x"===t)}return!1}(t,e,n,r,i)};function iJ(t){lJ(t)?function(t){const e=t.component.scales;for(const n of SP){const r=e[n];if(!r)continue;const i=JY(n,t);r.setWithExplicit("range",i)}}(t):oJ(t,"range")}function oJ(t,e){const n=t.component.scales;for(const n of t.children)"range"===e?iJ(n):nJ(n,e);for(const r of LI(n)){let i;for(const n of t.children){const t=n.component.scales[r];t&&(i=qV(i,t.getWithExplicit(e),e,"scale",PV(((t,n)=>{switch(e){case"range":return t.step&&n.step?t.step-n.step:0}return 0}))))}n[r].setWithExplicit(e,i)}}function aJ(t){lJ(t)?t.component.scales=function(t){const{encoding:e,mark:n}=t;return SP.reduce(((r,i)=>{const o=jU(e[i]);if(o&&n===Dz&&i===lR&&o.type===ZL)return r;let a=o&&o.scale;if(o&&null!==a&&!1!==a){a=null!=a?a:{};const e=function(t,e,n,r){const i=function(t,e,n){var r;switch(e.type){case"nominal":case"ordinal":if(FR(t)||"discrete"===$P(t))return"shape"===t&&"ordinal"===e.type&&dL(tL(t,"ordinal")),"ordinal";if(t in cP){if($I(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&t in dP)return"band";return void 0!==e.band||_U(e)&&(null===(r=e.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return FR(t)?"time":"discrete"===$P(t)?(dL(tL(t,"temporal")),"ordinal"):dU(e)&&e.timeUnit&&CL(e.timeUnit).utc?"utc":"time";case"quantitative":return FR(t)?dU(e)&&BP(e.bin)?"bin-ordinal":"linear":"discrete"===$P(t)?(dL(tL(t,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(KP(e.type))}(e,n,r),{type:o}=t;return CP(e)?void 0!==o?Fq(e,o)?dU(n)&&!Oq(o,n.type)?(dL(function(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}(o,i)),i):o:(dL(function(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}(e,o,i)),i):i:null}(a,i,o,n);r[i]=new GY(t.scaleName(i+"",!0),{value:e,explicit:a.type===e})}return r}),{})}(t):t.component.scales=function(t){var e;const n=t.component.scales={},r={},i=t.component.resolve;for(const n of t.children){aJ(n);for(const o of LI(n.component.scales))if(i.scale[o]=null!==(e=i.scale[o])&&void 0!==e?e:DK(o,t),"shared"===i.scale[o]){const t=r[o],e=n.component.scales[o].getWithExplicit("type");t?aq(t.value,e.value)?r[o]=qV(t,e,"type","scale",sJ):(i.scale[o]="independent",delete r[o]):r[o]=e}}for(const e of LI(r)){const i=t.scaleName(e,!0),o=r[e];n[e]=new GY(i,o);for(const n of t.children){const t=n.component.scales[e];t&&(n.renameScale(t.get("name"),i),t.merged=!0)}}return n}(t)}const sJ=PV(((t,e)=>uq(t)-uq(e)));class uJ{constructor(){this.nameMap={}}rename(t,e){this.nameMap[t]=e}has(t){return void 0!==this.nameMap[t]}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function lJ(t){return"unit"===(null==t?void 0:t.type)}function cJ(t){return"facet"===(null==t?void 0:t.type)}function fJ(t){return"concat"===(null==t?void 0:t.type)}function hJ(t){return"layer"===(null==t?void 0:t.type)}class dJ{constructor(t,e,n,r,i,o,a){var s,u;this.type=e,this.parent=n,this.config=i,this.view=a,this.children=[],this.correctDataNames=t=>(t.from&&t.from.data&&(t.from.data=this.lookupDataSource(t.from.data)),t.from&&t.from.facet&&t.from.facet.data&&(t.from.facet.data=this.lookupDataSource(t.from.facet.data)),t),this.parent=n,this.config=i,this.name=null!==(s=t.name)&&void 0!==s?s:r,this.title=GU(t.title)?{text:t.title}:t.title,this.scaleNameMap=n?n.scaleNameMap:new uJ,this.projectionNameMap=n?n.projectionNameMap:new uJ,this.signalNameMap=n?n.signalNameMap:new uJ,this.data=t.data,this.description=t.description,this.transforms=(null!==(u=t.transform)&&void 0!==u?u:[]).map((t=>QV(t)?{filter:AI(t.filter,HL)}:t)),this.layout="layer"===e||"unit"===e?{}:function(t,e,n){var r,i;const o=n[e],a={},{spacing:s,columns:u}=o;void 0!==s&&(a.spacing=s),void 0!==u&&(oU(t)&&!rU(t.facet)||WW(t))&&(a.columns=u),VW(t)&&(a.columns=1);for(const e of KW)if(void 0!==t[e])if("spacing"===e){const n=t[e];a[e]=lI(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else a[e]=t[e];return a}(t,e,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:oU(t)||n&&n.component.data.isFaceted&&void 0===t.data},layoutSize:new IV,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?DI(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(t,{ignoreRange:e}={}){aJ(t),TY(t);for(const e of Dq)nJ(t,e);e||iJ(t)}(this)}parseProjection(){XK(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){RK(this)}assembleGroupStyle(){var t,e;if("unit"===this.type||"layer"===this.type)return null!==(e=null===(t=this.view)||void 0===t?void 0:t.style)&&void 0!==e?e:"cell"}assembleEncodeFromView(t){const{style:e}=t,n=dI(t,["style"]),r={};for(const t of LI(n)){const e=n[t];void 0!==e&&(r[t]=XU(e))}return r}assembleGroupEncodeEntry(t){let e={};return this.view&&(e=this.assembleEncodeFromView(this.view)),t||(this.description&&(e.description=XU(this.description)),"unit"!==this.type&&"layer"!==this.type)?PI(e)?void 0:e:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=e?e:{})}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:e}=t,n=dI(t,["spacing"]),{component:r,config:i}=this,o=function(t,e){const n={};for(const r of $R){const i=t[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:t,titleOrient:o}=sK(["titleAnchor","titleOrient"],i.facetFieldDef,e,r),a=oK(r,o),s=vK(t,a);void 0!==s&&(n[a]=s)}}return PI(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:e},this.assembleDefaultLayout()),n),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let e=[];for(const n of $R)t[n].title&&e.push(cK(this,n));for(const t of uK)e=e.concat(dK(this,t));return e}assembleAxes(){return function(t,e){const{x:n=[],y:r=[]}=t;return[...n.map((t=>UX(t,"grid",e))),...r.map((t=>UX(t,"grid",e))),...n.map((t=>UX(t,"main",e))),...r.map((t=>UX(t,"main",e)))].filter((t=>t))}(this.component.axes,this.config)}assembleLegends(){return WK(this)}assembleProjections(){return hJ(t=this)||fJ(t)?function(t){return t.children.reduce(((t,e)=>t.concat(e.assembleProjections())),VK(t))}(t):VK(t);var t}assembleTitle(){var t,e,n;const r=null!==(t=this.title)&&void 0!==t?t:{},{encoding:i}=r,o=dI(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},HU(this.config.title).nonMark),o),i?{encode:{update:i}}:{});if(a.text)return $I(["unit","layer"],this.type)?$I(["middle",void 0],a.anchor)&&(a.frame=null!==(e=a.frame)&&void 0!==e?e:"group"):a.anchor=null!==(n=a.anchor)&&void 0!==n?n:"start",PI(a)?void 0:a}assembleGroup(t=[]){const e={};(t=t.concat(this.assembleSignals())).length>0&&(e.signals=t);const n=this.assembleLayout();n&&(e.layout=n),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||cJ(this.parent)?VY(this):[];r.length>0&&(e.scales=r);const i=this.assembleAxes();i.length>0&&(e.axes=i);const o=this.assembleLegends();return o.length>0&&(e.legends=o),e}getName(t){return VI((this.name?this.name+"_":"")+t)}requestDataName(t){var e;const n=this.getName(t),r=this.component.data.outputNodeRefCounts;return r[n]=(null!==(e=r[n])&&void 0!==e?e:0)+1,n}getSizeSignalRef(t){if(cJ(this.parent)){const e=gP(AK(t)),n=this.component.scales[e];if(n&&!n.merged){const t=n.get("type"),r=n.get("range");if(gq(t)&&FL(r)){const t=n.get("name"),r=UY(WY(this,e));return r?{signal:kK(t,n,EU({aggregate:"distinct",field:r},{expr:"datum"}))}:(dL(`Unknown field for ${e}. Cannot calculate view size.`),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const e=this.component.data.outputNodes[t];return e?e.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){return e?this.getName(t):UR(t)&&CP(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const e=this.component.scales[t];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(t,e)),!n)throw new Error(`Cannot find a selection named "${e}".`);return n}hasAxisOrientSignalRef(){var t,e;return(null===(t=this.component.axes.x)||void 0===t?void 0:t.some((t=>t.hasOrientSignalRef())))||(null===(e=this.component.axes.y)||void 0===e?void 0:e.some((t=>t.hasOrientSignalRef())))}}class pJ extends dJ{vgField(t,e={}){const n=this.fieldDef(t);if(n)return EU(n,e)}reduceFieldDef(t,e){return hW(this.getMapping(),((e,n,r)=>{const i=TU(n);return i?t(e,i,r):e}),e)}forEachFieldDef(t,e){fW(this.getMapping(),((e,n)=>{const r=TU(e);r&&t(r,n)}),e)}}class gJ extends VH{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=DI(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=o[0])&&void 0!==r?r:"value",null!==(i=o[1])&&void 0!==i?i:"density"]}clone(){return new gJ(null,DI(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${FI(this.transform)}`}assemble(){const t=this.transform,{density:e}=t,n=dI(t,["density"]);return Object.assign({type:"kde",field:e},n)}}class mJ extends VH{constructor(t,e){super(t),this.filter=e}clone(){return new mJ(null,Object.assign({},this.filter))}static make(t,e){const{config:n,mark:r,markDef:i}=e;if("filter"!==ZU("invalid",i,n))return null;const o=e.reduceFieldDef(((t,n,i)=>{const o=CP(i)&&e.getScaleComponent(i);return o&&mq(o.get("type"))&&"count"!==n.aggregate&&!Sz(r)&&(t[n.field]=n),t}),{});return LI(o).length?new mJ(t,o):null}dependentFields(){return new Set(LI(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${FI(this.filter)}`}assemble(){const t=LI(this.filter).reduce(((t,e)=>{const n=this.filter[e],r=EU(n,{expr:"datum"});return null!==n&&("temporal"===n.type?t.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(t.push(`isValid(${r})`),t.push(`isFinite(+${r})`))),t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class yJ extends VH{constructor(t,e){super(t),this.transform=e,this.transform=DI(e);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((t,e)=>{var n;return null!==(n=r[e])&&void 0!==n?n:t}))}clone(){return new yJ(this.parent,DI(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${FI(this.transform)}`}assemble(){const{flatten:t,as:e}=this.transform;return{type:"flatten",fields:t,as:e}}}class vJ extends VH{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=DI(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=o[0])&&void 0!==r?r:"key",null!==(i=o[1])&&void 0!==i?i:"value"]}clone(){return new vJ(null,DI(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${FI(this.transform)}`}assemble(){const{fold:t,as:e}=this.transform;return{type:"fold",fields:t,as:e}}}class bJ extends VH{constructor(t,e,n,r){super(t),this.fields=e,this.geojson=n,this.signal=r}clone(){return new bJ(null,DI(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit)return t;let n=0;for(const r of[[rR,nR],[oR,iR]]){const i=r.map((t=>{const n=jU(e.encoding[t]);return dU(n)?n.field:gU(n)?{expr:`${n.datum}`}:xU(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(t=new bJ(t,i,null,e.getName("geojson_"+n++)))}if(e.channelHasField(lR)){const r=e.typedFieldDef(lR);r.type===ZL&&(t=new bJ(t,null,r.field,e.getName("geojson_"+n++)))}return t}dependentFields(){var t;const e=(null!==(t=this.fields)&&void 0!==t?t:[]).filter(cI);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${FI(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class xJ extends VH{constructor(t,e,n,r){super(t),this.projection=e,this.fields=n,this.as=r}clone(){return new xJ(null,this.projection,DI(this.fields),DI(this.as))}static parseAll(t,e){if(!e.projectionName())return t;for(const n of[[rR,nR],[oR,iR]]){const r=n.map((t=>{const n=jU(e.encoding[t]);return dU(n)?n.field:gU(n)?{expr:`${n.datum}`}:xU(n)?{expr:`${n.value}`}:void 0})),i=n[0]===oR?"2":"";(r[0]||r[1])&&(t=new xJ(t,e.projectionName(),r,[e.getName("x"+i),e.getName("y"+i)]))}return t}dependentFields(){return new Set(this.fields.filter(cI))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${FI(this.fields)} ${FI(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class wJ extends VH{constructor(t,e){super(t),this.transform=e}clone(){return new wJ(null,DI(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:e=0,stop:n,step:r}=t;return{signal:`sequence(${[e,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,e){return new wJ(t,e)}static makeFromEncoding(t,e){const n=e.encoding,r=n.x,i=n.y;if(dU(r)&&dU(i)){const o=r.impute?r:i.impute?i:void 0;if(void 0===o)return;const a=r.impute?i:i.impute?r:void 0,{method:s,value:u,frame:l,keyvals:c}=o.impute,f=dW(e.mark,n);return new wJ(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},s?{method:s}:{}),void 0!==u?{value:u}:{}),l?{frame:l}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${FI(this.transform)}`}assemble(){const{impute:t,key:e,keyvals:n,method:r,groupby:i,value:o,frame:a=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:e},n?{keyvals:(u=n,void 0!==(null==u?void 0:u.stop)?this.processSequence(n):n)}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:o});var u;return r&&"value"!==r?[s,Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t}]:[s]}}class _J extends VH{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=DI(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=o[0])&&void 0!==r?r:e.on,null!==(i=o[1])&&void 0!==i?i:e.loess]}clone(){return new _J(null,DI(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${FI(this.transform)}`}assemble(){const t=this.transform,{loess:e,on:n}=t,r=dI(t,["loess","on"]);return Object.assign({type:"loess",x:n,y:e},r)}}class kJ extends VH{constructor(t,e,n){super(t),this.transform=e,this.secondary=n}clone(){return new kJ(null,DI(this.transform),this.secondary)}static make(t,e,n,r){const i=e.component.data.sources,{from:o}=n;let a=null;if(function(t){return"data"in t}(o)){let t=zJ(o.data,i);t||(t=new QK(o.data),i.push(t));const n=e.getName(`lookup_${r}`);a=new HH(t,n,"lookup",e.component.data.outputNodeRefCounts),e.component.data.outputNodes[n]=a}else if(function(t){return"selection"in t}(o)){const t=o.selection;if(n=Object.assign({as:t},n),a=e.getSelectionComponent(VI(t),t).materialized,!a)throw new Error(`Cannot define and lookup the "${t}" selection in the same view. Try moving the lookup into a second, layered view?`)}return new kJ(t,n,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?oI(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${FI({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:oI(this.transform.as)}:{});else{let e=this.transform.as;cI(e)||(dL('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),e="_lookup"),t={as:[e]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class AJ extends VH{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=DI(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=o[0])&&void 0!==r?r:"prob",null!==(i=o[1])&&void 0!==i?i:"value"]}clone(){return new AJ(null,DI(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${FI(this.transform)}`}assemble(){const t=this.transform,{quantile:e}=t,n=dI(t,["quantile"]);return Object.assign({type:"quantile",field:e},n)}}class EJ extends VH{constructor(t,e){var n,r,i;super(t),this.transform=e,this.transform=DI(e);const o=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=o[0])&&void 0!==r?r:e.on,null!==(i=o[1])&&void 0!==i?i:e.regression]}clone(){return new EJ(null,DI(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${FI(this.transform)}`}assemble(){const t=this.transform,{regression:e,on:n}=t,r=dI(t,["regression","on"]);return Object.assign({type:"regression",x:n,y:e},r)}}class DJ extends VH{constructor(t,e){super(t),this.transform=e}clone(){return new DJ(null,DI(this.transform))}addDimensions(t){var e;this.transform.groupby=jI((null!==(e=this.transform.groupby)&&void 0!==e?e:[]).concat(t),(t=>t))}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}hash(){return`PivotTransform ${FI(this.transform)}`}assemble(){const{pivot:t,value:e,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:e},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class SJ extends VH{constructor(t,e){super(t),this.transform=e}clone(){return new SJ(null,DI(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${FI(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function CJ(t){let e=0;return function n(r,i){var o;if(r instanceof QK&&!r.isGenerator&&!WV(r.data)&&(t.push(i),i={name:null,source:i.name,transform:[]}),r instanceof fY&&(r.parent instanceof QK&&!i.source?(i.format=Object.assign(Object.assign({},null!==(o=i.format)&&void 0!==o?o:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof uY){i.name||(i.name="data_"+e++),!i.source||i.transform.length>0?(t.push(i),r.data=i.name):r.data=i.source;for(const e of r.assemble())t.push(e)}else switch((r instanceof eY||r instanceof nY||r instanceof mJ||r instanceof zX||r instanceof rK||r instanceof xJ||r instanceof bJ||r instanceof sY||r instanceof kJ||r instanceof gY||r instanceof dY||r instanceof vJ||r instanceof yJ||r instanceof gJ||r instanceof _J||r instanceof AJ||r instanceof EJ||r instanceof hY||r instanceof SJ||r instanceof DJ)&&i.transform.push(r.assemble()),(r instanceof ZK||r instanceof GH||r instanceof wJ||r instanceof pY)&&i.transform.push(...r.assemble()),r instanceof HH&&(i.source&&0===i.transform.length?r.setSource(i.source):r.parent instanceof HH?r.setSource(i.name):(i.name||(i.name="data_"+e++),r.setSource(i.name),1===r.numChildren()&&(t.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof HH&&(!i.source||i.transform.length>0)&&t.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+e++);let o=i.name;!i.source||i.transform.length>0?t.push(i):o=i.source;for(const t of r.children)n(t,{name:null,source:o,transform:[]});break}}}}function OJ(t){return"top"===t||"left"===t||OL(t)?"header":"footer"}function FJ(t,e){var n;const{facet:r,config:i,child:o,component:a}=t;if(t.channelHasField(e)){const s=r[e],u=aK("title",null,i,e);let l=MU(s,i,{allowDisabling:!0,includeDefault:void 0===u||!!u});o.component.layoutHeaders[e].title&&(l=Qj(l)?l.join(", "):l,l+=" / "+o.component.layoutHeaders[e].title,o.component.layoutHeaders[e].title=null);const c=aK("labelOrient",s,i,e),f=ez((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),h=$I(["bottom","right"],c)?"footer":"header";a.layoutHeaders[e]={title:l,facetFieldDef:s,[h]:"facet"===e?[]:[MJ(t,e,f)]}}}function MJ(t,e,n){const r="row"===e?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(r)?t.child.getSizeSignalRef(r):void 0,axes:[]}}function $J(t,e){var n;const{child:r}=t;if(r.component.axes[e]){const{layoutHeaders:i,resolve:o}=t.component;if(o.axis[e]=SK(o,e),"shared"===o.axis[e]){const o="x"===e?"column":"row",a=i[o];for(const i of r.component.axes[e]){const e=OJ(i.get("orient"));a[e]=null!==(n=a[e])&&void 0!==n?n:[MJ(t,o,!1)];const r=UX(i,"main",t.config,{header:!0});r&&a[e][0].axes.push(r),i.mainExtracted=!0}}}}function NJ(t){for(const e of t.children)e.parseLayoutSize()}function BJ(t,e){const n=AK(e),r=gP(n),i=t.component.resolve,o=t.component.layoutSize;let a;for(const e of t.children){const t=e.component.layoutSize.getWithExplicit(n),o=i.scale[r];if("independent"===o&&"step"===t.value){a=void 0;break}if(a){if("independent"===o&&a.value!==t.value){a=void 0;break}a=qV(a,t,n,"")}else a=t}if(a){for(const r of t.children)t.renameSignal(r.getName(n),t.getName(e)),r.component.layoutSize.set(n,"merged",!1);o.setWithExplicit(e,a)}else o.setWithExplicit(e,{explicit:!1,value:void 0})}function TJ(t,e){const n="width"===e?"x":"y",r=t.config,i=t.getScaleComponent(n);if(i){const t=i.get("type"),n=i.get("range");if(gq(t)){const t=ZW(r.view,e);return FL(n)||GW(t)?"step":t}return YW(r.view,e)}if(t.hasProjection||"arc"===t.mark)return YW(r.view,e);{const t=ZW(r.view,e);return GW(t)?t.step:t}}function jJ(t,e,n){return EU(e,Object.assign({suffix:`by_${EU(t)}`},null!=n?n:{}))}class IJ extends pJ{constructor(t,e,n,r){super(t,"facet",e,n,r,t.resolve),this.child=iZ(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet,r)}initFacet(t,e){return rU(t)?hW(t,((t,n,r)=>$I([Vz,Hz],r)?void 0===n.field?(dL(JP(n,r)),t):(t[r]=IU(n,r,e),t):(dL(ZP(r,"facet")),t)),{}):{facet:IU(t,"facet",e)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=RJ(this),this.child.parseData()}parseLayoutSize(){NJ(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(const e of $R)FJ(t,e);$J(t,"x"),$J(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,e,n;const r={};for(const i of $R)for(const o of lK){const a=this.component.layoutHeaders[i],s=a[o],{facetFieldDef:u}=a;if(u){const e=aK("titleOrient",u,this.config,i);if($I(["right","bottom"],e)){const n=oK(i,e);r.titleAnchor=null!==(t=r.titleAnchor)&&void 0!==t?t:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const t="row"===i?"height":"width",s="header"===o?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(t)||(r[s]=null!==(e=r[s])&&void 0!==e?e:{},r[s][i]=.5),a.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:e}=this.facet,n=t?this.columnDistinctSignal():e?1:void 0;let r="all";return(e||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof IJ))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof IJ?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:EU(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],e=[],n=[];if(this.child instanceof IJ){if(this.child.channelHasField("column")){const r=EU(this.child.facet.column);t.push(r),e.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of fP){const i=this.child.component.scales[r];if(i&&!i.merged){const o=i.get("type"),a=i.get("range");if(gq(o)&&FL(a)){const i=UY(WY(this.child,r));i?(t.push(i),e.push("distinct"),n.push(`distinct_${i}`)):dL(`Unknown field for ${r}. Cannot calculate view size.`)}}}return{fields:t,ops:e,as:n}}assembleFacet(){const{name:t,data:e}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:o,as:a}=this.getCardinalityAggregateForChild(),s=[];for(const t of $R){const e=this.facet[t];if(e){s.push(EU(e));const{bin:u,sort:l}=e;if(BP(u)&&s.push(EU(e,{binSuffix:"end"})),eU(l)){const{field:t,op:s=Jq}=l,u=jJ(e,l);n&&r?(i.push(u),o.push("max"),a.push(u)):(i.push(t),o.push(s),a.push(u))}else if(Qj(l)){const n=iK(e,t);i.push(n),o.push("max"),a.push(n)}}}const u=!!n&&!!r;return Object.assign({name:t,data:e,groupby:s},u||i.length>0?{aggregate:Object.assign(Object.assign({},u?{cross:u}:{}),i.length?{fields:i,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:e}=this,n=e[t];return n?eU(n.sort)?[jJ(n,n.sort,{expr:"datum"})]:Qj(n.sort)?[iK(n,t,{expr:"datum"})]:[EU(n,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:e}=this,n=e[t];if(n){const{sort:t}=n;return[(eU(t)?t.order:!Qj(t)&&t)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:e}=this;if(t.facet)return gK(t.facet,"facet",e);const n={row:["top","bottom"],column:["left","right"]};for(const r of uK)if(t[r]){const i=aK("labelOrient",t[r],e,r);if($I(n[r],i))return gK(t[r],r,e)}}assembleMarks(){const{child:t}=this,e=function(t){const e=[],n=CJ(e);for(const e of t.children)n(e,{source:t.name,name:null,transform:[]});return e}(this.component.data.facetRoot),n=t.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||t.assembleTitle(),i=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:$R.map((t=>this.facetSortFields(t))).flat(),order:$R.map((t=>this.facetSortOrder(t))).flat()}}),e.length>0?{data:e}:{}),n?{encode:{update:n}}:{}),t.assembleGroup(function(t,e){if(t.component.selection&&LI(t.component.selection).length){const n=fI(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:iN("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return gG(e)}(this,[])))]}getMapping(){return this.facet}}function zJ(t,e){var n,r,i,o,a,s,u,l,c,f;for(const h of e){const e=h.data;if(!(t.name&&h.hasName()&&t.name!==h.dataName||(null===(n=t.format)||void 0===n?void 0:n.mesh)&&(null===(r=e.format)||void 0===r?void 0:r.feature)||((null===(i=t.format)||void 0===i?void 0:i.feature)||(null===(o=e.format)||void 0===o?void 0:o.feature))&&(null===(a=t.format)||void 0===a?void 0:a.feature)!==(null===(s=e.format)||void 0===s?void 0:s.feature)||((null===(u=t.format)||void 0===u?void 0:u.mesh)||(null===(l=e.format)||void 0===l?void 0:l.mesh))&&(null===(c=t.format)||void 0===c?void 0:c.mesh)!==(null===(f=e.format)||void 0===f?void 0:f.mesh)))if(VV(t)&&VV(e)){if(EI(t.values,e.values))return h}else if(WV(t)&&WV(e)){if(t.url===e.url)return h}else if(HV(t)&&t.name===h.dataName)return h}return null}function RJ(t){var e,n,r,i,o,a,s,u,l,c;let f=function(t,e){if(t.data||!t.parent){if(null===t.data){const t=new QK({values:[]});return e.push(t),t}const n=zJ(t.data,e);if(n)return GV(t.data)||(n.data.format=function(t,...e){for(const n of e)TI(t,null!=n?n:{});return t}({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{const n=new QK(t.data);return e.push(n),n}}return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}(t,t.component.data.sources);const{outputNodes:h,outputNodeRefCounts:d}=t.component.data,p=t.parent?t.parent.component.data.ancestorParse.clone():new UV,g=t.data;GV(g)?(XV(g)?f=new nY(f,g.sequence):YV(g)&&(f=new eY(f,g.graticule)),p.parseNothing=!0):null===(null===(e=null==g?void 0:g.format)||void 0===e?void 0:e.parse)&&(p.parseNothing=!0),f=null!==(n=fY.makeExplicit(f,t,p))&&void 0!==n?n:f,f=new hY(f);const m=t.parent&&hJ(t.parent);(lJ(t)||cJ(t))&&m&&(f=null!==(r=ZK.makeFromEncoding(f,t))&&void 0!==r?r:f),t.transforms.length>0&&(f=function(t,e,n){var r,i;let o=0;for(const a of e.transforms){let s,u;if(cH(a))u=t=new rK(t,a),s="derived";else if(QV(a)){const i=cY(a);u=t=null!==(r=fY.makeWithAncestors(t,{},i,n))&&void 0!==r?r:t,t=new zX(t,e,a.filter)}else if(fH(a))u=t=ZK.makeFromTransform(t,a,e),s="number";else if(dH(a))s="date",void 0===n.getWithExplicit(a.field).value&&(t=new fY(t,{[a.field]:s}),n.set(a.field,s,!1)),u=t=GH.makeFromTransform(t,a);else if(pH(a))u=t=sY.makeFromTransform(t,a),s="number",OG(e)&&(t=new hY(t));else if(tH(a))u=t=kJ.make(t,e,a,o++),s="derived";else if(sH(a))u=t=new gY(t,a),s="number";else if(uH(a))u=t=new dY(t,a),s="number";else if(gH(a))u=t=pY.makeFromTransform(t,a),s="derived";else if(mH(a))u=t=new vJ(t,a),s="derived";else if(lH(a))u=t=new yJ(t,a),s="derived";else if(eH(a))u=t=new DJ(t,a),s="derived";else if(aH(a))t=new SJ(t,a);else if(hH(a))u=t=wJ.makeFromTransform(t,a),s="derived";else if(nH(a))u=t=new gJ(t,a),s="derived";else if(rH(a))u=t=new AJ(t,a),s="derived";else if(iH(a))u=t=new EJ(t,a),s="derived";else{if(!oH(a)){dL(`Ignoring an invalid transform: ${OI(a)}.`);continue}u=t=new _J(t,a),s="derived"}if(u&&void 0!==s)for(const t of null!==(i=u.producedFields())&&void 0!==i?i:[])n.set(t,s,!1)}return t}(f,t,p));const y=function(t){const e={};if(lJ(t)&&t.component.selection)for(const n of LI(t.component.selection)){const r=t.component.selection[n];for(const t of r.project.items)!t.channel&&tz(t.field)>1&&(e[t.field]="flatten")}return e}(t),v=function(t){const e={};function n(t){var n;qU(t)?e[t.field]="date":"quantitative"===t.type&&cI(n=t.aggregate)&&$I(["min","max"],n)?e[t.field]="number":tz(t.field)>1?t.field in e||(e[t.field]="flatten"):wU(t)&&eU(t.sort)&&tz(t.sort.field)>1&&(t.sort.field in e||(e[t.sort.field]="flatten"))}if((lJ(t)||cJ(t))&&t.forEachFieldDef(((e,r)=>{if(bU(e))n(e);else{const i=HR(r),o=t.fieldDef(i);n(Object.assign(Object.assign({},e),{type:o.type}))}})),lJ(t)){const{mark:n,markDef:r,encoding:i}=t;if(Sz(n)&&!t.encoding.order){const t=i["horizontal"===r.orient?"y":"x"];dU(t)&&"quantitative"===t.type&&!(t.field in e)&&(e[t.field]="number")}}return e}(t);f=null!==(i=fY.makeWithAncestors(f,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:f,lJ(t)&&(f=bJ.parseAll(f,t),f=xJ.parseAll(f,t)),(lJ(t)||cJ(t))&&(m||(f=null!==(o=ZK.makeFromEncoding(f,t))&&void 0!==o?o:f),f=null!==(a=GH.makeFromEncoding(f,t))&&void 0!==a?a:f,f=rK.parseAllForSortIndex(f,t));const b=t.getName(ZV),x=new HH(f,b,ZV,d);if(h[b]=x,f=x,lJ(t)){const e=sY.makeFromEncoding(f,t);e&&(f=e,OG(t)&&(f=new hY(f))),f=null!==(s=wJ.makeFromEncoding(f,t))&&void 0!==s?s:f,f=null!==(u=pY.makeFromEncoding(f,t))&&void 0!==u?u:f}lJ(t)&&(f=null!==(l=mJ.make(f,t))&&void 0!==l?l:f);const w=t.getName(JV),_=new HH(f,w,JV,d);h[w]=_,f=_,lJ(t)&&function(t,e){SG(t,(n=>{const r=n.name,i=t.getName(`lookup_${r}`);t.component.data.outputNodes[i]=n.materialized=new HH(new zX(e,t,{selection:r}),i,"lookup",t.component.data.outputNodeRefCounts)}))}(t,_);let k=null;if(cJ(t)){const e=t.getName("facet");f=null!==(c=function(t,e){const{row:n,column:r}=e;if(n&&r){let e=null;for(const i of[n,r])if(eU(i.sort)){const{field:n,op:r=Jq}=i.sort;t=e=new dY(t,{joinaggregate:[{op:r,field:n,as:jJ(i,i.sort,{forAs:!0})}],groupby:[EU(i)]})}return e}return null}(f,t.facet))&&void 0!==c?c:f,k=new uY(f,t,e,_.getSource()),h[e]=k}return Object.assign(Object.assign({},t.component.data),{outputNodes:h,outputNodeRefCounts:d,raw:x,main:_,facetRoot:k,ancestorParse:p})}class PJ extends dJ{constructor(t,e,n,r){var i,o,a,s;super(t,"concat",e,n,r,t.resolve),"shared"!==(null===(o=null===(i=t.resolve)||void 0===i?void 0:i.axis)||void 0===o?void 0:o.x)&&"shared"!==(null===(s=null===(a=t.resolve)||void 0===a?void 0:a.axis)||void 0===s?void 0:s.y)||dL("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(t).map(((t,e)=>iZ(t,this,this.getName("concat_"+e),void 0,r)))}parseData(){this.component.data=RJ(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of LI(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return VW(t)?t.vconcat:HW(t)?t.hconcat:t.concat}parseLayoutSize(){!function(t){NJ(t);const e=1===t.layout.columns?"width":"childWidth",n=void 0===t.layout.columns?"height":"childHeight";BJ(t,e),BJ(t,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.forEach((t=>t.assembleSignals())),[]}assembleLayoutSignals(){const t=xK(this);for(const e of this.children)t.push(...e.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleMarks(){return this.children.map((t=>{const e=t.assembleTitle(),n=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},e?{title:e}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())}))}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},null!=t?{columns:t}:{}),{bounds:"full",align:"each"})}}const LJ=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},lz),{labelExpr:1,encode:1}),qJ=LI(LJ);class UJ extends IV{constructor(t={},e={},n=!1){super(),this.explicit=t,this.implicit=e,this.mainExtracted=n}clone(){return new UJ(DI(this.explicit),DI(this.implicit),this.mainExtracted)}hasAxisPart(t){return!("axis"!==t&&("grid"===t||"title"===t?!this.get(t):!1===(e=this.get(t))||null===e));var e}hasOrientSignalRef(){return OL(this.explicit.orient)}}const WJ={bottom:"top",top:"bottom",left:"right",right:"left"};function VJ(t,e){if(!t)return e.map((t=>t.clone()));{if(t.length!==e.length)return;const n=t.length;for(let r=0;r<n;r++){const n=t[r],i=e[r];if(!!n!=!!i)return;if(n&&i){const e=n.getWithExplicit("orient"),o=i.getWithExplicit("orient");if(e.explicit&&o.explicit&&e.value!==o.value)return;t[r]=HJ(n,i)}}}return t}function HJ(t,e){for(const n of qJ){const r=qV(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",((t,e)=>{switch(n){case"title":return oW(t,e);case"gridScale":return{explicit:t.explicit,value:ez(t.value,e.value)}}return LV(t,e,n,"axis")}));t.setWithExplicit(n,r)}return t}function GJ(t,e,n,r,i){if("disable"===e)return void 0!==n;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(OL(n.labelAngle)?n.labelAngle:rz(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===nK(r,i))return!0}return t===n[e]}const XJ=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function KJ(t,e){var n,r,i;let o=e.axis(t);const a=new UJ,s=jU(e.encoding[t]),{mark:u,config:l}=e,c=(null==o?void 0:o.orient)||(null===(n=l["x"===t?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=l.axis)||void 0===r?void 0:r.orient)||function(t){return"x"===t?"bottom":"left"}(t),f=e.getScaleComponent(t).get("type"),h=function(t,e,n,r){const i="band"===e?["axisDiscrete","axisBand"]:"point"===e?["axisDiscrete","axisPoint"]:e in fq?["axisQuantitative"]:"time"===e||"utc"===e?["axisTemporal"]:[],o="x"===t?"axisX":"axisY",a=OL(n)?"axisOrient":"axis"+XI(n),s=[...i,...i.map((t=>o+t.substr(4)))],u=["axis",a,o];return{vlOnlyAxisConfig:KX(s,r,t,n),vgAxisConfig:KX(u,r,t,n),axisConfigStyle:YX([...u,...s],r)}}(t,f,c,e.config),d=void 0!==o?!o:JX("disable",l,null==o?void 0:o.style,h).configValue;if(a.set("disable",d,void 0!==o),d)return a;o=o||{};const p=function(t,e,n,r,i){const o=null==e?void 0:e.labelAngle;if(void 0!==o)return OL(o)?o:rz(o);{const{configValue:o}=JX("labelAngle",t.config,null==e?void 0:e.style,i);return void 0!==o?rz(o):n===Xz&&$I([JL,KL],r.type)?270:void 0}}(e,o,t,s,h),g={fieldOrDatumDef:s,axis:o,channel:t,model:e,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const n of qJ){const r=n in ZX?ZX[n](g):fz(n)?o[n]:void 0,i=void 0!==r,s=GJ(r,n,o,e,t);if(i&&s)a.set(n,r,s);else{const{configValue:t,configFrom:u}=fz(n)&&"values"!==n?JX(n,e.config,o.style,h):{},l=void 0!==t;i&&!l?a.set(n,r,s):("vgAxisConfig"!==u||XJ.has(n)&&l||az(t)||OL(t))&&a.set(n,t,!1)}}const m=null!==(i=o.encoding)&&void 0!==i?i:{},y=sz.reduce(((n,r)=>{var i;if(!a.hasAxisPart(r))return n;const o=EK(null!==(i=m[r])&&void 0!==i?i:{},e),s="labels"===r?function(t,e,n){var r;const{encoding:i,config:o}=t,a=null!==(r=jU(i[e]))&&void 0!==r?r:jU(i[XR(e)]),s=t.axis(e)||{},{format:u,formatType:l}=s;return Pq(l)?Object.assign({text:Wq({fieldOrDatumDef:a,field:"datum.value",format:u,formatType:l,config:o})},n):n}(e,t,o):o;return void 0===s||PI(s)||(n[r]={update:s}),n}),{});return PI(y)||a.set("encode",y,!!o.encoding||void 0!==o.labelAngle),a}function YJ(t,e){const{config:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),DH("x",t,{defaultPos:"mid"})),DH("y",t,{defaultPos:"mid"})),kH("size",t)),kH("angle",t)),function(t,e,n){return n?{shape:{value:n}}:kH("shape",t)}(t,0,e))}function JJ(t){var e;const{config:n,markDef:r}=t,{orient:i}=r,o="horizontal"===i?"width":"height",a=t.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(e=ZU("size",r,n,{vgChannel:o}))&&void 0!==e?e:n.tick.bandSize;if(void 0!==s)return s;{const t=a?a.get("range"):void 0;return t&&FL(t)&&lI(t.step)?3*t.step/4:3*JW(n.view,o)/4}}const ZJ={arc:{vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),DH("x",t,{defaultPos:"mid"})),DH("y",t,{defaultPos:"mid"})),BH(t,"radius","arc")),BH(t,"theta","arc"))},area:{vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),MH("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===t.markDef.orient})),MH("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===t.markDef.orient})),LH(t))},bar:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),BH(t,"x","bar")),BH(t,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:t=>YJ(t,"circle")},geoshape:{vgMark:"shape",encodeEntry:t=>Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t,n=e.shape;return[Object.assign({type:"geoshape",projection:t.projectionName()},n&&dU(n)&&n.type===ZL?{field:EU(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),BH(t,"x","image")),BH(t,"y","image")),vH(t,"url"))},line:{vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),DH("x",t,{defaultPos:"mid"})),DH("y",t,{defaultPos:"mid"})),kH("size",t,{vgChannel:"strokeWidth"})),LH(t))},point:{vgMark:"symbol",encodeEntry:t=>YJ(t)},rect:{vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),BH(t,"x","rect")),BH(t,"y","rect"))},rule:{vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t,n=e.orient;return t.encoding.x||t.encoding.y||t.encoding.latitude||t.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),MH("x",t,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),MH("y",t,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),kH("size",t,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:t=>YJ(t,"square")},text:{vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),DH("x",t,{defaultPos:"mid"})),DH("y",t,{defaultPos:"mid"})),vH(t)),kH("size",t,{vgChannel:"fontSize"})),kH("angle",t)),qH("align",function(t,e,n){if(void 0===ZU("align",t,n))return"center"}(t.markDef,0,e))),qH("baseline",function(t,e,n){if(void 0===ZU("baseline",t,n))return"middle"}(t.markDef,0,e))),DH("radius",t,{defaultPos:null,isMidPoint:!0})),DH("theta",t,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t,r=n.orient,i="horizontal"===r?"width":"height",o="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),DH("x",t,{defaultPos:"mid",vgChannel:"xc"})),DH("y",t,{defaultPos:"mid",vgChannel:"yc"})),kH("size",t,{defaultValue:JJ(t),vgChannel:i})),{[o]:XU(ZU("thickness",n,e))})}},trail:{vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},RH(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),DH("x",t,{defaultPos:"mid"})),DH("y",t,{defaultPos:"mid"})),kH("size",t)),LH(t))}};const QJ="faceted_path_",tZ="stack_group_";function eZ(t,e={fromPrefix:""}){const{mark:n,markDef:r,config:i}=t,o=ez(r.clip,function(t){const e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return!!(e&&e.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(t),function(t){const e=t.component.projection;return!(!e||e.isFit)||void 0}(t)),a=JU(r),s=t.encoding.key,u=function(t){const{encoding:e,stack:n,mark:r,markDef:i,config:o}=t,a=e.order;if(!(!Qj(a)&&xU(a)&&MI(a.value)||!a&&MI(ZU("order",i,o)))){if((Qj(a)||dU(a))&&!n)return nW(a,{expr:"datum"});if(Sz(r)){const n="horizontal"===i.orient?"y":"x",r=e[n];if(dU(r)){const e=r.sort;return Qj(e)?{field:EU(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:eU(e)?{field:EU({aggregate:sW(t.encoding)?e.op:void 0,field:e.field},{expr:"datum"})}:tU(e)?{field:EU(t.fieldDef(e.encoding),{expr:"datum"}),order:e.order}:null===e?void 0:{field:EU(r,{binSuffix:t.stack&&t.stack.impute?"mid":void 0,expr:"datum"})}}}}}(t),l=function(t){if(!t.component.selection)return null;const e=LI(t.component.selection).length;let n=e,r=t.parent;for(;r&&0===n;)n=LI(r.component.selection).length,r=r.parent;return n?{interactive:e>0}:null}(t),c=ZU("aria",r,i),f=ZJ[n].postEncodingTransform?ZJ[n].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:ZJ[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),s?{key:s.field}:{}),u?{sort:u}:{}),l||{}),!1===c?{aria:c}:{}),{from:{data:e.fromPrefix+t.requestDataName(JV)},encode:{update:ZJ[n].encodeEntry(t)}}),f?{transform:f}:{})]}class nZ extends pJ{constructor(t,e,n,r={},i){var o,a;super(t,"unit",e,n,i,void 0,XW(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const s=Fz(t.mark)?t.mark.type:t.mark;this.markDef=function(t,e,n,{graticule:r}){const i=Fz(t)?Object.assign({},t):{type:t},o=ZU("orient",i,n);if(i.orient=function(t,e,n){switch(t){case vz:case Az:case Ez:case wz:case bz:case mz:return}const{x:r,y:i,x2:o,y2:a}=e;switch(t){case gz:if(dU(r)&&(TP(r.bin)||dU(i)&&i.aggregate&&!r.aggregate))return"vertical";if(dU(i)&&(TP(i.bin)||dU(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(a||o){if(n)return n;if(!o&&(dU(r)&&r.type===XL&&!BP(r.bin)||yU(r)))return"horizontal";if(!a&&(dU(i)&&i.type===XL&&!BP(i.bin)||yU(i)))return"vertical"}case xz:if(o&&(!dU(r)||!TP(r.bin))&&a&&(!dU(i)||!TP(i.bin)))return;case pz:if(a)return dU(i)&&TP(i.bin)?"horizontal":"vertical";if(o)return dU(r)&&TP(r.bin)?"vertical":"horizontal";if(t===xz){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case yz:case _z:{const e=mU(r),o=mU(i);if(e&&!o)return"tick"!==t?"horizontal":"vertical";if(!e&&o)return"tick"!==t?"vertical":"horizontal";if(e&&o){const e=r,o=i,a=e.type===YL,s=o.type===YL;return a&&!s?"tick"!==t?"vertical":"horizontal":!a&&s?"tick"!==t?"horizontal":"vertical":!e.aggregate&&o.aggregate?"tick"!==t?"vertical":"horizontal":e.aggregate&&!o.aggregate?"tick"!==t?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(i.type,e,o),void 0!==o&&o!==i.orient&&dL(`Specified orient "${i.orient}" overridden with "${o}".`),"bar"===i.type&&i.orient){const t=ZU("cornerRadiusEnd",i,n);if(void 0!==t){const n="horizontal"===i.orient&&e.x2||"vertical"===i.orient&&e.y2?["cornerRadius"]:Nz[i.orient];for(const e of n)i[e]=t;void 0!==i.cornerRadiusEnd&&delete i.cornerRadiusEnd}}return void 0===ZU("opacity",i,n)&&(i.opacity=function(t,e){if($I([vz,_z,Az,Ez],t)&&!sW(e))return.7}(i.type,e)),void 0===i.filled&&(i.filled=!r&&function(t,e){const n=QU("filled",t,e),r=t.type;return ez(n,r!==vz&&r!==yz&&r!==xz)}(i,n)),void 0===ZU("cursor",i,n)&&(i.cursor=function(t,e,n){return e.href||t.href||ZU("href",t,n)?"pointer":t.cursor}(i,e,n)),i}(t.mark,null!==(o=t.encoding)&&void 0!==o?o:{},i,{graticule:t.data&&YV(t.data)});const u=this.encoding=lW(null!==(a=t.encoding)&&void 0!==a?a:{},this.markDef,i);this.size=function({encoding:t,size:e}){for(const n of fP){const r=KR(n);GW(e[r])&&mU(t[n])&&(delete e[r],dL(oL(r)))}return e}({encoding:u,size:XW(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=gV(s,u),this.specifiedScales=this.initScales(s,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegend(u),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,e=this.mark===Dz,n=t&&CR.some((e=>vU(t[e])));return e||n}scaleDomain(t){const e=this.specifiedScales[t];return e?e.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return SP.reduce(((t,n)=>{var r;const i=jU(e[n]);return i&&(t[n]=null!==(r=i.scale)&&void 0!==r?r:{}),t}),{})}initAxes(t){return fP.reduce(((e,n)=>{const r=t[n];if(vU(r)||n===Xz&&vU(t.x2)||n===Kz&&vU(t.y2)){const t=vU(r)?r.axis:void 0;e[n]=t?Object.assign({},t):t}return e}),{})}initLegend(t){return EP.reduce(((e,n)=>{const r=jU(t[n]);if(r&&function(t){switch(t){case aR:case sR:case uR:case cR:case lR:case hR:case gR:case mR:return!0;case dR:case pR:case fR:return!1}}(n)){const t=r.legend;e[n]=t?Object.assign({},t):t}return e}),{})}parseData(){this.component.data=RJ(this)}parseLayoutSize(){!function(t){const{size:e,component:n}=t;for(const r of fP){const i=KR(r);if(e[i]){const t=e[i];n.layoutSize.set(i,GW(t)?"step":t,!0)}else{const e=TJ(t,i);n.layoutSize.set(i,e,!1)}}}(this)}parseSelections(){this.component.selection=function(t,e){var n;const r={},i=t.config.selection;for(const o of LI(null!=e?e:{})){const a=DI(e[o]),s=i[a.type],{fields:u,encodings:l}=s,c=dI(s,["fields","encodings"]);for(const t in c)"encodings"===t&&a.fields||"fields"===t&&a.encodings||("mark"===t&&(a[t]=Object.assign(Object.assign({},c[t]),a[t])),void 0!==a[t]&&!0!==a[t]||(a[t]=null!==(n=c[t])&&void 0!==n?n:a[t]));const f=VI(o),h=r[f]=Object.assign(Object.assign({},a),{name:f,events:cI(a.on)?iN(a.on,"scope"):DI(a.on)});hG(h,(n=>{n.has(h)&&n.parse&&n.parse(t,h,a,e[o])}))}return r}(this,this.selection)}parseMarkGroup(){var t;this.component.mark=$I([yz,pz,kz],(t=this).mark)?function(t){const e=dW(t.mark,t.encoding),n=eZ(t,{fromPrefix:e.length>0?QJ:""});return e.length>0?[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:QJ+t.requestDataName(JV),data:t.requestDataName(JV),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}(t):$I([gz],t.mark)?function(t){const e=BL.some((e=>ZU(e,t.markDef,t.config)));if(t.stack&&!t.fieldDef("size")&&e){const[e]=eZ(t,{fromPrefix:tZ}),n=t.scaleName(t.stack.fieldChannel),r=(e={})=>t.vgField(t.stack.fieldChannel,e),i=(t,e)=>`${t}(${[r({prefix:"min",suffix:"start",expr:e}),r({prefix:"max",suffix:"start",expr:e}),r({prefix:"min",suffix:"end",expr:e}),r({prefix:"max",suffix:"end",expr:e})].map((t=>`scale('${n}',${t})`)).join(",")})`;let o,a;"x"===t.stack.fieldChannel?(o=Object.assign(Object.assign({},SI(e.encode.update,["y","yc","y2","height",...BL])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},e.encode.update=Object.assign(Object.assign({},CI(e.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},SI(e.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},e.encode.update=Object.assign(Object.assign({},CI(e.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of BL){const r=QU(n,t.markDef,t.config);e.encode.update[n]?(o[n]=e.encode.update[n],delete e.encode.update[n]):r&&(o[n]=XU(r)),r&&(e.encode.update[n]={value:0})}const s=t.fieldDef(t.stack.groupbyChannel),u=EU(s)?[EU(s)]:[];return((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&u.push(EU(s,{binSuffix:"end"})),o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(e.encode.update[r])return Object.assign(Object.assign({},n),{[r]:e.encode.update[r]});{const e=QU(r,t.markDef,t.config);return void 0!==e?Object.assign(Object.assign({},n),{[r]:XU(e)}):n}}),o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName(JV),name:tZ+t.requestDataName(JV),groupby:u,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[e]}]}]}return eZ(t)}(t):eZ(t)}parseAxesAndHeaders(){var t;this.component.axes=(t=this,fP.reduce(((e,n)=>(t.component.scales[n]&&(e[n]=[KJ(n,t)]),e)),{}))}assembleSelectionTopLevelSignals(t){return function(t,e){let n=!1;return SG(t,((r,i)=>{const o=r.name,a=fI(o+kG);if(0===e.filter((t=>t.name===o)).length){const t="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";e.push({name:r.name,update:`${EG}(${a}, ${fI(t)}${n}`})}n=!0,i.topLevelSignals&&(e=i.topLevelSignals(t,r,e)),hG(r,(n=>{n.topLevelSignals&&(e=n.topLevelSignals(t,r,e))}))})),n&&0===e.filter((t=>"unit"===t.name)).length&&e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),gG(e)}(this,t)}assembleSignals(){return[...WX(this),...(t=this,e=[],SG(t,((n,r)=>{const i=n.name;let o=r.modifyExpr(t,n);e.push(...r.signals(t,n)),hG(n,(r=>{r.signals&&(e=r.signals(t,n,e)),r.modifyExpr&&(o=r.modifyExpr(t,n,o))})),e.push({name:i+"_modify",on:[{events:{signal:n.name+AG},update:`modify(${fI(n.name+kG)}, ${o})`}]})})),gG(e))];var t,e}assembleSelectionData(t){return function(t,e){const n=[...e];return SG(t,(e=>{const r={name:e.name+kG};if(e.init){const n=e.project.items.map((t=>{const{signals:e}=t;return dI(t,["signals"])})),i=e.init.map((t=>dG(t,!1)));r.values="interval"===e.type?[{unit:CG(t,{escape:!1}),fields:n,values:i}]:i.map((e=>({unit:CG(t,{escape:!1}),fields:n,values:e})))}n.filter((t=>t.name===e.name+kG)).length||n.push(r)})),n}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return xK(this)}assembleMarks(){var t;let e=null!==(t=this.component.mark)&&void 0!==t?t:[];return this.parent&&hJ(this.parent)||(e=pG(this,e)),e.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return aW(this.encoding,t)}fieldDef(t){return TU(this.encoding[t])}typedFieldDef(t){const e=this.fieldDef(t);return bU(e)?e:null}}class rZ extends dJ{constructor(t,e,n,r,i){super(t,"layer",e,n,i,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map(((t,e)=>{if(lV(t))return new rZ(t,this,this.getName("layer_"+e),o,i);if(Bz(t))return new nZ(t,this,this.getName("layer_"+e),o,i);throw new Error(RP(t))}))}parseData(){this.component.data=RJ(this);for(const t of this.children)t.parseData()}parseLayoutSize(){NJ(this),BJ(this,"width"),BJ(this,"height")}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of LI(t.component.selection))this.component.selection[e]=t.component.selection[e]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){!function(t){var e;const{axes:n,resolve:r}=t.component,i={top:0,bottom:0,right:0,left:0};for(const e of t.children){e.parseAxesAndHeaders();for(const i of LI(e.component.axes))r.axis[i]=SK(t.component.resolve,i),"shared"===r.axis[i]&&(n[i]=VJ(n[i],e.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const o of fP){for(const a of t.children)if(a.component.axes[o]){if("independent"===r.axis[o]){n[o]=(null!==(e=n[o])&&void 0!==e?e:[]).concat(a.component.axes[o]);for(const t of a.component.axes[o]){const{value:e,explicit:n}=t.getWithExplicit("orient");if(!OL(e)){if(i[e]>0&&!n){const n=WJ[e];i[e]>i[n]&&t.set("orient",n,!1)}i[e]++}}}delete a.component.axes[o]}if("independent"===r.axis[o]&&n[o]&&n[o].length>1)for(const t of n[o])t.get("grid")&&!t.explicit.grid&&(t.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleSignals())),WX(this))}assembleLayoutSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleLayoutSignals())),xK(this))}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const e of this.children)if(t=e.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return function(t,e){for(const n of t.children)lJ(n)&&(e=pG(n,e));return e}(this,this.children.flatMap((t=>t.assembleMarks())))}assembleLegends(){return this.children.reduce(((t,e)=>t.concat(e.assembleLegends())),WK(this))}}function iZ(t,e,n,r,i){if(oU(t))return new IJ(t,e,n,i);if(lV(t))return new rZ(t,e,n,r,i);if(Bz(t))return new nZ(t,e,n,r,i);if(function(t){return VW(t)||HW(t)||WW(t)}(t))return new PJ(t,e,n,i);throw new Error(RP(t))}function oZ(t,e={}){var n;e.logger&&(n=e.logger,hL=n),e.fieldTitle&&FU(e.fieldTitle);try{const n=iV(nI(e.config,t.config)),r=$V(t,n),i=iZ(r,null,"",void 0,n);return i.parse(),function(t,e){tY(t.sources);let n=0,r=0;for(let r=0;r<5&&NY(t,e);r++)n++;t.sources.map(wY);for(let n=0;n<5&&NY(t,e);n++)r++;tY(t.sources),5===Math.max(n,r)&&dL("Maximum optimization runs(5) reached.")}(i.component.data,i),{spec:function(t,e,n={},r){const i=t.config?function(t){t=DI(t);for(const e of aV)delete t[e];if(t.axis)for(const e in t.axis)az(t.axis[e])&&delete t.axis[e];if(t.legend)for(const e of jW)delete t.legend[e];if(t.mark){for(const e of $z)delete t.mark[e];t.mark.tooltip&&tI(t.mark.tooltip)&&delete t.mark.tooltip}for(const e of oV){for(const n of $z)delete t[e][n];const n=sV[e];if(n)for(const r of n)delete t[e][r];uV(t,e)}for(const e of LI(BW))delete t[e];!function(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:r}=HU(t.title);PI(e)||(t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e)),PI(n)||(t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),n)),PI(r)?delete t.title:t.title=r}(t);for(const e in t)tI(t[e])&&PI(t[e])&&delete t[e];return PI(t)?void 0:t}(t.config):void 0,o=[].concat(t.assembleSelectionData([]),function(t,e){var n,r;const i=[],o=CJ(i);let a=0;for(const e of t.sources){e.hasName()||(e.dataName="source_"+a++);const t=e.assemble();o(e,t)}for(const t of i)0===t.transform.length&&delete t.transform;let s=0;for(const[t,e]of i.entries())0!==(null!==(n=e.transform)&&void 0!==n?n:[]).length||e.source||i.splice(s++,0,i.splice(t,1)[0]);for(const e of i)for(const n of null!==(r=e.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=t.outputNodes[n.from].getSource());for(const t of i)t.name in e&&(t.values=e[t.name]);return i}(t.component.data,n)),a=t.assembleProjections(),s=t.assembleTitle(),u=t.assembleGroupStyle(),l=t.assembleGroupEncodeEntry(!0);let c=t.assembleLayoutSignals();return c=c.filter((t=>"width"!==t.name&&"height"!==t.name||void 0===t.value||(e[t.name]=+t.value,!1))),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),e),s?{title:s}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:o}),a.length>0?{projections:a}:{}),t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(t,e,n,r){const i=r.component.layoutSize.get("width"),o=r.component.layoutSize.get("height");if(void 0===e?(e={type:"pad"},r.hasAxisOrientSignalRef()&&(e.resize=!0)):cI(e)&&(e={type:e}),i&&o&&("fit"===(a=e.type)||"fit-x"===a||"fit-y"===a))if("step"===i&&"step"===o)dL(qP()),e.type="pad";else if("step"===i||"step"===o){const t="step"===i?"width":"height";dL(qP(gP(t)));const n="width"===t?"height":"width";e.type=function(t){return t?`fit-${gP(t)}`:"fit"}(n)}var a;return Object.assign(Object.assign(Object.assign({},1===LI(e).length&&e.type?"pad"===e.type?{}:{autosize:e.type}:{autosize:e}),jV(n)),jV(t))}(t,r.autosize,n,i),t.datasets,t.usermeta),normalized:r}}finally{e.logger&&(hL=cL),e.fieldTitle&&FU(CU)}}const aZ=new class extends cV{mapUnit(t,{config:e}){if(t.encoding){const{encoding:n,transform:r}=t,{bins:i,timeUnits:o,aggregate:a,groupby:s,encoding:u}=uW(n,e),l=[...r||[],...i,...o,...0===a.length?[]:[{aggregate:a,groupby:s}]];return Object.assign(Object.assign(Object.assign({},t),l.length>0?{transform:l}:{}),{encoding:u})}return t}};function sZ(t,e){return aZ.map(t,{config:e})}const uZ="4.13.1";function lZ(t){const[e,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}}const cZ="#fff",fZ={background:"#333",title:{color:cZ,subtitleColor:cZ},style:{"guide-label":{fill:cZ},"guide-title":{fill:cZ}},axis:{domainColor:cZ,gridColor:"#888",tickColor:cZ}},hZ="#4572a7",dZ={background:"#fff",arc:{fill:hZ},area:{fill:hZ},line:{stroke:hZ,strokeWidth:2},path:{stroke:hZ},rect:{fill:hZ},shape:{stroke:hZ},symbol:{fill:hZ,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},pZ="#30a2da",gZ="#cbcbcb",mZ="#f0f0f0",yZ="#333",vZ={arc:{fill:pZ},area:{fill:pZ},axis:{domainColor:gZ,grid:!0,gridColor:gZ,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:gZ,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:mZ,group:{fill:mZ},legend:{labelColor:yZ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:yZ,titleFontSize:14,titlePadding:10},line:{stroke:pZ,strokeWidth:2},path:{stroke:pZ,strokeWidth:.5},rect:{fill:pZ},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:pZ},bar:{binSpacing:2,fill:pZ,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},bZ="#000",xZ={group:{fill:"#e5e5e5"},arc:{fill:bZ},area:{fill:bZ},line:{stroke:bZ},path:{stroke:bZ},rect:{fill:bZ},shape:{stroke:bZ},symbol:{fill:bZ,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},wZ="Benton Gothic, sans-serif",_Z="#82c6df",kZ="Benton Gothic Bold, sans-serif",AZ="normal",EZ={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},DZ={background:"#ffffff",title:{anchor:"start",color:"#000000",font:kZ,fontSize:22,fontWeight:"normal"},arc:{fill:_Z},area:{fill:_Z},line:{stroke:_Z,strokeWidth:2},path:{stroke:_Z},rect:{fill:_Z},shape:{stroke:_Z},symbol:{fill:_Z,size:30},axis:{labelFont:wZ,labelFontSize:11.5,labelFontWeight:"normal",titleFont:kZ,titleFontSize:13,titleFontWeight:AZ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:wZ,labelFontSize:11.5,symbolType:"square",titleFont:kZ,titleFontSize:13,titleFontWeight:AZ},range:{category:EZ["category-6"],diverging:EZ["fireandice-6"],heatmap:EZ["fire-7"],ordinal:EZ["fire-7"],ramp:EZ["fire-7"]}},SZ="#ab5787",CZ="#979797",OZ={background:"#f9f9f9",arc:{fill:SZ},area:{fill:SZ},line:{stroke:SZ},path:{stroke:SZ},rect:{fill:SZ},shape:{stroke:SZ},symbol:{fill:SZ,size:30},axis:{domainColor:CZ,domainWidth:.5,gridWidth:.2,labelColor:CZ,tickColor:CZ,tickWidth:.2,titleColor:CZ},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},FZ="#3e5c69",MZ={background:"#fff",arc:{fill:FZ},area:{fill:FZ},line:{stroke:FZ},path:{stroke:FZ},rect:{fill:FZ},shape:{stroke:FZ},symbol:{fill:FZ},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},$Z="#1696d2",NZ="#000000",BZ="Lato",TZ="Lato",jZ={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},IZ={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:BZ},axisX:{domain:!0,domainColor:NZ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:TZ,labelAngle:0,tickColor:NZ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:BZ},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:TZ,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:BZ,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:TZ,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:BZ,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:jZ["six-groups-cat-1"],diverging:jZ["diverging-colors"],heatmap:jZ["diverging-colors"],ordinal:jZ["six-groups-seq"],ramp:jZ["shades-blue"]},area:{fill:$Z},rect:{fill:$Z},line:{color:$Z,stroke:$Z,strokeWidth:5},trail:{color:$Z,stroke:$Z,strokeWidth:0,size:1},path:{stroke:$Z,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:$Z,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:$Z,stroke:null}},arc:{fill:$Z},shape:{stroke:$Z},symbol:{fill:$Z,size:30}},zZ="#3366CC",RZ="#ccc",PZ="Arial, sans-serif",LZ={arc:{fill:zZ},area:{fill:zZ},path:{stroke:zZ},rect:{fill:zZ},shape:{stroke:zZ},symbol:{stroke:zZ},circle:{fill:zZ},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:PZ,fontSize:12},"guide-title":{font:PZ,fontSize:12},"group-title":{font:PZ,fontSize:12}},title:{font:PZ,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:RZ,tickColor:RZ,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},qZ="2.10.0";const UZ="vg-tooltip-element",WZ={offsetX:10,offsetY:10,id:UZ,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function VZ(t,e){return JSON.stringify(t,function(t){const e=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=e.indexOf(this)+1;return e.length=i,e.length>t?"[Object]":e.indexOf(r)>=0?"[Circular]":(e.push(r),r)}}(e))}class HZ{constructor(t){this.options=Object.assign(Object.assign({},WZ),t);const e=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const t=document.createElement("style");t.setAttribute("id",this.options.styleId),t.innerHTML=function(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw new Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n".toString().replace(UZ,t)}(e);const n=document.head;n.childNodes.length>0?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)}}tooltipHandler(t,e,n,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(null!=document.fullscreenElement?document.fullscreenElement:document.body).appendChild(this.el),null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=function(t,e,n){if(_t(t))return`[${t.map((t=>e(ve(t)?t:VZ(t,n)))).join(", ")}]`;if(kt(t)){let r="";const i=t,{title:o,image:a}=i,s=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(i,["title","image"]);o&&(r+=`<h2>${e(o)}</h2>`),a&&(r+=`<img src="${e(a)}">`);const u=Object.keys(s);if(u.length>0){r+="<table>";for(const t of u){let i=s[t];void 0!==i&&(kt(i)&&(i=VZ(i,n)),r+=`<tr><td class="key">${e(t)}:</td><td class="value">${e(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return e(t)}(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:o}=function(t,e,n,r){let i=t.clientX+n;i+e.width>window.innerWidth&&(i=+t.clientX-n-e.width);let o=t.clientY+r;return o+e.height>window.innerHeight&&(o=+t.clientY-r-e.height),{x:i,y:o}}(e,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${o}px; left: ${i}px`)}}function GZ(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n((function(e){e(t)}))}(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))}var XZ;function KZ(t,...e){for(const n of e)YZ(t,n);return t}function YZ(t,e){for(const n of Object.keys(e))Dt(t,n,e[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t});const JZ=y;let ZZ=v;const QZ="undefined"!=typeof window?window:void 0;void 0===ZZ&&(null===(XZ=null==QZ?void 0:QZ.vl)||void 0===XZ?void 0:XZ.compile)&&(ZZ=QZ.vl);const tQ={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},eQ={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},nQ={vega:"Vega","vega-lite":"Vega-Lite"},rQ={vega:JZ.version,"vega-lite":ZZ?ZZ.version:"not available"},iQ={vega:t=>t,"vega-lite":(t,e)=>ZZ.compile(t,{config:e}).spec};function oQ(t,e,n,r){const i=`<html><head>${e}</head><body><pre><code class="json">`,o=`</code></pre>${n}</body></html>`,a=window.open("");a.document.write(i+t+o),a.document.title=`${nQ[r]} JSON Source`}function aQ(t,e){var n;if(t.$schema){const r=lZ(t.$schema);e&&e!==r.library&&console.warn(`The given visualization spec is written in ${nQ[r.library]}, but mode argument sets ${null!==(n=nQ[e])&&void 0!==n?n:e}.`);const i=r.library;return(0,Q.satisfies)(rQ[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${nQ[i]} ${r.version}, but the current version of ${nQ[i]} is v${rQ[i]}.`),i}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":null!=e?e:"vega"}function sQ(t){return(e=t)&&"load"in e?t:JZ.loader(t);var e}function uQ(t){var e;return null!==(e=t.usermeta&&t.usermeta.embedOptions)&&void 0!==e?e:{}}function lQ(t,e){var n;return GZ(this,void 0,void 0,(function*(){const r=ve(t.config)?JSON.parse(yield e.load(t.config)):null!==(n=t.config)&&void 0!==n?n:{},i=ve(t.patch)?JSON.parse(yield e.load(t.patch)):t.patch;return Object.assign(Object.assign(Object.assign({},t),i?{patch:i}:{}),r?{config:r}:{})}))}const cQ=function(t,e,n={}){var r,i,o;return GZ(this,void 0,void 0,(function*(){let a,s;ve(e)?(s=sQ(n.loader),a=JSON.parse(yield s.load(e))):a=e;const u=uQ(a).loader;s&&!u||(s=sQ(null!==(r=n.loader)&&void 0!==r?r:u));const l=yield lQ(uQ(a),s),c=yield lQ(n,s),f=Object.assign(Object.assign({},KZ(c,l)),{config:Et(null!==(i=c.config)&&void 0!==i?i:{},null!==(o=l.config)&&void 0!==o?o:{})});return yield function(t,e,n={},r){var i,o,a,s,u,l;return GZ(this,void 0,void 0,(function*(){const c=n.theme?Et(b[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=de(n.actions)?n.actions:KZ({},tQ,null!==(o=n.actions)&&void 0!==o?o:{}),h=Object.assign(Object.assign({},eQ),n.i18n),d=null!==(a=n.renderer)&&void 0!==a?a:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:JZ.Warn,g=null!==(u=n.downloadFileName)&&void 0!==u?u:"visualization",m="string"==typeof t?document.querySelector(t):t;if(!m)throw new Error(`${t} does not exist`);if(!1!==n.defaultStyle){const t="vega-embed-style",{root:e,rootContainer:r}=function(t){var e;const n=t.getRootNode?t.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(e=document.head)&&void 0!==e?e:document.body}}(m);if(!e.getElementById(t)){const e=document.createElement("style");e.id=t,e.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n'.toString():n.defaultStyle,r.appendChild(e)}}const y=aQ(e,n.mode);let v=iQ[y](e,c);if("vega-lite"===y&&v.$schema){const t=lZ(v.$schema);(0,Q.satisfies)(rQ.vega,`^${t.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${t.version}, but current version is v${rQ.vega}.`)}m.classList.add("vega-embed"),f&&m.classList.add("has-actions"),m.innerHTML="";let x=m;if(f){const t=document.createElement("div");t.classList.add("chart-wrapper"),m.appendChild(t),x=t}const w=n.patch;w&&(v=w instanceof Function?w(v):z(v,w,!0,!1).newDocument),n.formatLocale&&JZ.formatLocale(n.formatLocale),n.timeFormatLocale&&JZ.timeFormatLocale(n.timeFormatLocale);const{ast:_}=n,k=JZ.parse(v,"vega-lite"===y?{}:c,{ast:_}),A=new(n.viewClass||JZ.View)(k,Object.assign({loader:r,logLevel:p,renderer:d},_?{expr:JZ.expressionInterpreter}:{}));if(!1!==n.tooltip){let t;t="function"==typeof n.tooltip?n.tooltip:new HZ(!0===n.tooltip?{}:n.tooltip).call,A.tooltip(t)}let E,{hover:D}=n;if(void 0===D&&(D="vega"===y),D){const{hoverSet:t,updateSet:e}="boolean"==typeof D?{}:D;A.hover(t,e)}if(n&&(null!=n.width&&A.width(n.width),null!=n.height&&A.height(n.height),null!=n.padding&&A.padding(n.padding)),yield A.initialize(x,n.bind).runAsync(),!1!==f){let t=m;if(!1!==n.defaultStyle){const e=document.createElement("details");e.title=h.CLICK_TO_VIEW_ACTIONS,m.append(e),t=e;const n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',e.append(n),E=t=>{e.contains(t.target)||e.removeAttribute("open")},document.addEventListener("click",E)}const r=document.createElement("div");if(t.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const t of["svg","png"])if(!0===f||!0===f.export||f.export[t]){const e=h[`${t.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=e,i.href="#",i.target="_blank",i.download=`${g}.${t}`,i.addEventListener("mousedown",(function(e){return GZ(this,void 0,void 0,(function*(){e.preventDefault();const r=yield A.toImageURL(t,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const t=document.createElement("a");t.text=h.SOURCE_ACTION,t.href="#",t.addEventListener("click",(function(t){var r,i;oQ(Z()(e),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),t.preventDefault()})),r.append(t)}if("vega-lite"===y&&(!0===f||!1!==f.compiled)){const t=document.createElement("a");t.text=h.COMPILED_ACTION,t.href="#",t.addEventListener("click",(function(t){var e,r;oQ(Z()(v),null!==(e=n.sourceHeader)&&void 0!==e?e:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),t.preventDefault()})),r.append(t)}if(!0===f||!1!==f.editor){const t=null!==(l=n.editorUrl)&&void 0!==l?l:"https://vega.github.io/editor/",i=document.createElement("a");i.text=h.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(t,e,n){const r=t.open(e),{origin:i}=new URL(e);let o=40;t.addEventListener("message",(function e(n){n.source===r&&(o=0,t.removeEventListener("message",e,!1))}),!1),setTimeout((function t(){o<=0||(r.postMessage(n,i),setTimeout(t,250),o-=1)}),250)}(window,t,{config:c,mode:y,renderer:d,spec:Z()(e)}),n.preventDefault()})),r.append(i)}}return{view:A,spec:e,vgSpec:v,finalize:function(){E&&document.removeEventListener("click",E),A.finalize()}}}))}(t,a,f,s)}))}},4890:(t,e,n)=>{const r=Symbol("SemVer ANY");class i{static get ANY(){return r}constructor(t,e){if(e=o(e),t instanceof i){if(t.loose===!!e.loose)return t;t=t.value}l("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(t){const e=this.options.loose?a[s.COMPARATORLOOSE]:a[s.COMPARATOR],n=t.match(e);if(!n)throw new TypeError(`Invalid comparator: ${t}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new c(n[2],this.options.loose):this.semver=r}toString(){return this.value}test(t){if(l("Comparator.test",t,this.options.loose),this.semver===r||t===r)return!0;if("string"==typeof t)try{t=new c(t,this.options)}catch(t){return!1}return u(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof i))throw new TypeError("a Comparator is required");if(e&&"object"==typeof e||(e={loose:!!e,includePrerelease:!1}),""===this.operator)return""===this.value||new f(t.value,e).test(this.value);if(""===t.operator)return""===t.value||new f(this.value,e).test(t.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),o=this.semver.version===t.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),s=u(this.semver,"<",t.semver,e)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),l=u(this.semver,">",t.semver,e)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return n||r||o&&a||s||l}}t.exports=i;const o=n(4167),{re:a,t:s}=n(6152),u=n(1427),l=n(4272),c=n(7800),f=n(1540)},1540:(t,e,n)=>{class r{constructor(t,e){if(e=o(e),t instanceof r)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new r(t.raw,e);if(t instanceof a)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((t=>this.parseRange(t.trim()))).filter((t=>t.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const t=this.set[0];if(this.set=this.set.filter((t=>!p(t[0]))),0===this.set.length)this.set=[t];else if(this.set.length>1)for(const t of this.set)if(1===t.length&&g(t[0])){this.set=[t];break}}this.format()}format(){return this.range=this.set.map((t=>t.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();const e=`parseRange:${Object.keys(this.options).join(",")}:${t}`,n=i.get(e);if(n)return n;const r=this.options.loose,o=r?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];t=t.replace(o,S(this.options.includePrerelease)),s("hyphen replace",t),t=t.replace(l[c.COMPARATORTRIM],f),s("comparator trim",t,l[c.COMPARATORTRIM]),t=(t=(t=t.replace(l[c.TILDETRIM],h)).replace(l[c.CARETTRIM],d)).split(/\s+/).join(" ");const u=r?l[c.COMPARATORLOOSE]:l[c.COMPARATOR],g=t.split(" ").map((t=>y(t,this.options))).join(" ").split(/\s+/).map((t=>D(t,this.options))).filter(this.options.loose?t=>!!t.match(u):()=>!0).map((t=>new a(t,this.options))),m=(g.length,new Map);for(const t of g){if(p(t))return[t];m.set(t.value,t)}m.size>1&&m.has("")&&m.delete("");const v=[...m.values()];return i.set(e,v),v}intersects(t,e){if(!(t instanceof r))throw new TypeError("a Range is required");return this.set.some((n=>m(n,e)&&t.set.some((t=>m(t,e)&&n.every((n=>t.every((t=>n.intersects(t,e)))))))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new u(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(C(this.set[e],t,this.options))return!0;return!1}}t.exports=r;const i=new(n(9593))({max:1e3}),o=n(4167),a=n(4890),s=n(4272),u=n(7800),{re:l,t:c,comparatorTrimReplace:f,tildeTrimReplace:h,caretTrimReplace:d}=n(6152),p=t=>"<0.0.0-0"===t.value,g=t=>""===t.value,m=(t,e)=>{let n=!0;const r=t.slice();let i=r.pop();for(;n&&r.length;)n=r.every((t=>i.intersects(t,e))),i=r.pop();return n},y=(t,e)=>(s("comp",t,e),t=w(t,e),s("caret",t),t=b(t,e),s("tildes",t),t=k(t,e),s("xrange",t),t=E(t,e),s("stars",t),t),v=t=>!t||"x"===t.toLowerCase()||"*"===t,b=(t,e)=>t.trim().split(/\s+/).map((t=>x(t,e))).join(" "),x=(t,e)=>{const n=e.loose?l[c.TILDELOOSE]:l[c.TILDE];return t.replace(n,((e,n,r,i,o)=>{let a;return s("tilde",t,e,n,r,i,o),v(n)?a="":v(r)?a=`>=${n}.0.0 <${+n+1}.0.0-0`:v(i)?a=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:o?(s("replaceTilde pr",o),a=`>=${n}.${r}.${i}-${o} <${n}.${+r+1}.0-0`):a=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,s("tilde return",a),a}))},w=(t,e)=>t.trim().split(/\s+/).map((t=>_(t,e))).join(" "),_=(t,e)=>{s("caret",t,e);const n=e.loose?l[c.CARETLOOSE]:l[c.CARET],r=e.includePrerelease?"-0":"";return t.replace(n,((e,n,i,o,a)=>{let u;return s("caret",t,e,n,i,o,a),v(n)?u="":v(i)?u=`>=${n}.0.0${r} <${+n+1}.0.0-0`:v(o)?u="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:a?(s("replaceCaret pr",a),u="0"===n?"0"===i?`>=${n}.${i}.${o}-${a} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}-${a} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o}-${a} <${+n+1}.0.0-0`):(s("no pr"),u="0"===n?"0"===i?`>=${n}.${i}.${o}${r} <${n}.${i}.${+o+1}-0`:`>=${n}.${i}.${o}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${o} <${+n+1}.0.0-0`),s("caret return",u),u}))},k=(t,e)=>(s("replaceXRanges",t,e),t.split(/\s+/).map((t=>A(t,e))).join(" ")),A=(t,e)=>{t=t.trim();const n=e.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return t.replace(n,((n,r,i,o,a,u)=>{s("xRange",t,n,r,i,o,a,u);const l=v(i),c=l||v(o),f=c||v(a),h=f;return"="===r&&h&&(r=""),u=e.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&h?(c&&(o=0),a=0,">"===r?(r=">=",c?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):"<="===r&&(r="<",c?i=+i+1:o=+o+1),"<"===r&&(u="-0"),n=`${r+i}.${o}.${a}${u}`):c?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:f&&(n=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),s("xRange return",n),n}))},E=(t,e)=>(s("replaceStars",t,e),t.trim().replace(l[c.STAR],"")),D=(t,e)=>(s("replaceGTE0",t,e),t.trim().replace(l[e.includePrerelease?c.GTE0PRE:c.GTE0],"")),S=t=>(e,n,r,i,o,a,s,u,l,c,f,h,d)=>`${n=v(r)?"":v(i)?`>=${r}.0.0${t?"-0":""}`:v(o)?`>=${r}.${i}.0${t?"-0":""}`:a?`>=${n}`:`>=${n}${t?"-0":""}`} ${u=v(l)?"":v(c)?`<${+l+1}.0.0-0`:v(f)?`<${l}.${+c+1}.0-0`:h?`<=${l}.${c}.${f}-${h}`:t?`<${l}.${c}.${+f+1}-0`:`<=${u}`}`.trim(),C=(t,e,n)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let n=0;n<t.length;n++)if(s(t[n].semver),t[n].semver!==a.ANY&&t[n].semver.prerelease.length>0){const r=t[n].semver;if(r.major===e.major&&r.minor===e.minor&&r.patch===e.patch)return!0}return!1}return!0}},7800:(t,e,n)=>{const r=n(4272),{MAX_LENGTH:i,MAX_SAFE_INTEGER:o}=n(1266),{re:a,t:s}=n(6152),u=n(4167),{compareIdentifiers:l}=n(4126);class c{constructor(t,e){if(e=u(e),t instanceof c){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError(`Invalid Version: ${t}`);if(t.length>i)throw new TypeError(`version is longer than ${i} characters`);r("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?a[s.LOOSE]:a[s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>o||this.major<0)throw new TypeError("Invalid major version");if(this.minor>o||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>o||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){const e=+t;if(e>=0&&e<o)return e}return t})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(r("SemVer.compare",this.version,this.options,t),!(t instanceof c)){if("string"==typeof t&&t===this.version)return 0;t=new c(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof c||(t=new c(t,this.options)),l(this.major,t.major)||l(this.minor,t.minor)||l(this.patch,t.patch)}comparePre(t){if(t instanceof c||(t=new c(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],i=t.prerelease[e];if(r("prerelease compare",e,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return l(n,i)}while(++e)}compareBuild(t){t instanceof c||(t=new c(t,this.options));let e=0;do{const n=this.build[e],i=t.build[e];if(r("prerelease compare",e,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return l(n,i)}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e),this.inc("pre",e);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let t=this.prerelease.length;for(;--t>=0;)"number"==typeof this.prerelease[t]&&(this.prerelease[t]++,t=-2);-1===t&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}}t.exports=c},3974:(t,e,n)=>{const r=n(155);t.exports=(t,e)=>{const n=r(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null}},1427:(t,e,n)=>{const r=n(3641),i=n(7351),o=n(3365),a=n(4457),s=n(2687),u=n(6039);t.exports=(t,e,n,l)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return r(t,n,l);case"!=":return i(t,n,l);case">":return o(t,n,l);case">=":return a(t,n,l);case"<":return s(t,n,l);case"<=":return u(t,n,l);default:throw new TypeError(`Invalid operator: ${e}`)}}},6751:(t,e,n)=>{const r=n(7800),i=n(155),{re:o,t:a}=n(6152);t.exports=(t,e)=>{if(t instanceof r)return t;if("number"==typeof t&&(t=String(t)),"string"!=typeof t)return null;let n=null;if((e=e||{}).rtl){let e;for(;(e=o[a.COERCERTL].exec(t))&&(!n||n.index+n[0].length!==t.length);)n&&e.index+e[0].length===n.index+n[0].length||(n=e),o[a.COERCERTL].lastIndex=e.index+e[1].length+e[2].length;o[a.COERCERTL].lastIndex=-1}else n=t.match(o[a.COERCE]);return null===n?null:i(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,e)}},2995:(t,e,n)=>{const r=n(7800);t.exports=(t,e,n)=>{const i=new r(t,n),o=new r(e,n);return i.compare(o)||i.compareBuild(o)}},1844:(t,e,n)=>{const r=n(6004);t.exports=(t,e)=>r(t,e,!0)},6004:(t,e,n)=>{const r=n(7800);t.exports=(t,e,n)=>new r(t,n).compare(new r(e,n))},2513:(t,e,n)=>{const r=n(155),i=n(3641);t.exports=(t,e)=>{if(i(t,e))return null;{const n=r(t),i=r(e),o=n.prerelease.length||i.prerelease.length,a=o?"pre":"",s=o?"prerelease":"";for(const t in n)if(("major"===t||"minor"===t||"patch"===t)&&n[t]!==i[t])return a+t;return s}}},3641:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>0===r(t,e,n)},3365:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>r(t,e,n)>0},4457:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>r(t,e,n)>=0},3866:(t,e,n)=>{const r=n(7800);t.exports=(t,e,n,i)=>{"string"==typeof n&&(i=n,n=void 0);try{return new r(t,n).inc(e,i).version}catch(t){return null}}},2687:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>r(t,e,n)<0},6039:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>r(t,e,n)<=0},2439:(t,e,n)=>{const r=n(7800);t.exports=(t,e)=>new r(t,e).major},3332:(t,e,n)=>{const r=n(7800);t.exports=(t,e)=>new r(t,e).minor},7351:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>0!==r(t,e,n)},155:(t,e,n)=>{const{MAX_LENGTH:r}=n(1266),{re:i,t:o}=n(6152),a=n(7800),s=n(4167);t.exports=(t,e)=>{if(e=s(e),t instanceof a)return t;if("string"!=typeof t)return null;if(t.length>r)return null;if(!(e.loose?i[o.LOOSE]:i[o.FULL]).test(t))return null;try{return new a(t,e)}catch(t){return null}}},8425:(t,e,n)=>{const r=n(7800);t.exports=(t,e)=>new r(t,e).patch},1298:(t,e,n)=>{const r=n(155);t.exports=(t,e)=>{const n=r(t,e);return n&&n.prerelease.length?n.prerelease:null}},2737:(t,e,n)=>{const r=n(6004);t.exports=(t,e,n)=>r(e,t,n)},1761:(t,e,n)=>{const r=n(2995);t.exports=(t,e)=>t.sort(((t,n)=>r(n,t,e)))},826:(t,e,n)=>{const r=n(1540);t.exports=(t,e,n)=>{try{e=new r(e,n)}catch(t){return!1}return e.test(t)}},5626:(t,e,n)=>{const r=n(2995);t.exports=(t,e)=>t.sort(((t,n)=>r(t,n,e)))},6798:(t,e,n)=>{const r=n(155);t.exports=(t,e)=>{const n=r(t,e);return n?n.version:null}},2543:(t,e,n)=>{const r=n(6152);t.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(1266).SEMVER_SPEC_VERSION,SemVer:n(7800),compareIdentifiers:n(4126).compareIdentifiers,rcompareIdentifiers:n(4126).rcompareIdentifiers,parse:n(155),valid:n(6798),clean:n(3974),inc:n(3866),diff:n(2513),major:n(2439),minor:n(3332),patch:n(8425),prerelease:n(1298),compare:n(6004),rcompare:n(2737),compareLoose:n(1844),compareBuild:n(2995),sort:n(5626),rsort:n(1761),gt:n(3365),lt:n(2687),eq:n(3641),neq:n(7351),gte:n(4457),lte:n(6039),cmp:n(1427),coerce:n(6751),Comparator:n(4890),Range:n(1540),satisfies:n(826),toComparators:n(434),maxSatisfying:n(4600),minSatisfying:n(142),minVersion:n(734),validRange:n(2617),outside:n(2416),gtr:n(9903),ltr:n(1611),intersects:n(1413),simplifyRange:n(9901),subset:n(2792)}},1266:t=>{const e=Number.MAX_SAFE_INTEGER||9007199254740991;t.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:e,MAX_SAFE_COMPONENT_LENGTH:16}},4272:t=>{const e="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};t.exports=e},4126:t=>{const e=/^[0-9]+$/,n=(t,n)=>{const r=e.test(t),i=e.test(n);return r&&i&&(t=+t,n=+n),t===n?0:r&&!i?-1:i&&!r?1:t<n?-1:1};t.exports={compareIdentifiers:n,rcompareIdentifiers:(t,e)=>n(e,t)}},4167:t=>{const e=["includePrerelease","loose","rtl"];t.exports=t=>t?"object"!=typeof t?{loose:!0}:e.filter((e=>t[e])).reduce(((t,e)=>(t[e]=!0,t)),{}):{}},6152:(t,e,n)=>{const{MAX_SAFE_COMPONENT_LENGTH:r}=n(1266),i=n(4272),o=(e=t.exports={}).re=[],a=e.src=[],s=e.t={};let u=0;const l=(t,e,n)=>{const r=u++;i(r,e),s[t]=r,a[r]=e,o[r]=new RegExp(e,n?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION",`(${a[s.NUMERICIDENTIFIER]})\\.(${a[s.NUMERICIDENTIFIER]})\\.(${a[s.NUMERICIDENTIFIER]})`),l("MAINVERSIONLOOSE",`(${a[s.NUMERICIDENTIFIERLOOSE]})\\.(${a[s.NUMERICIDENTIFIERLOOSE]})\\.(${a[s.NUMERICIDENTIFIERLOOSE]})`),l("PRERELEASEIDENTIFIER",`(?:${a[s.NUMERICIDENTIFIER]}|${a[s.NONNUMERICIDENTIFIER]})`),l("PRERELEASEIDENTIFIERLOOSE",`(?:${a[s.NUMERICIDENTIFIERLOOSE]}|${a[s.NONNUMERICIDENTIFIER]})`),l("PRERELEASE",`(?:-(${a[s.PRERELEASEIDENTIFIER]}(?:\\.${a[s.PRERELEASEIDENTIFIER]})*))`),l("PRERELEASELOOSE",`(?:-?(${a[s.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${a[s.PRERELEASEIDENTIFIERLOOSE]})*))`),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD",`(?:\\+(${a[s.BUILDIDENTIFIER]}(?:\\.${a[s.BUILDIDENTIFIER]})*))`),l("FULLPLAIN",`v?${a[s.MAINVERSION]}${a[s.PRERELEASE]}?${a[s.BUILD]}?`),l("FULL",`^${a[s.FULLPLAIN]}$`),l("LOOSEPLAIN",`[v=\\s]*${a[s.MAINVERSIONLOOSE]}${a[s.PRERELEASELOOSE]}?${a[s.BUILD]}?`),l("LOOSE",`^${a[s.LOOSEPLAIN]}$`),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE",`${a[s.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),l("XRANGEIDENTIFIER",`${a[s.NUMERICIDENTIFIER]}|x|X|\\*`),l("XRANGEPLAIN",`[v=\\s]*(${a[s.XRANGEIDENTIFIER]})(?:\\.(${a[s.XRANGEIDENTIFIER]})(?:\\.(${a[s.XRANGEIDENTIFIER]})(?:${a[s.PRERELEASE]})?${a[s.BUILD]}?)?)?`),l("XRANGEPLAINLOOSE",`[v=\\s]*(${a[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[s.XRANGEIDENTIFIERLOOSE]})(?:\\.(${a[s.XRANGEIDENTIFIERLOOSE]})(?:${a[s.PRERELEASELOOSE]})?${a[s.BUILD]}?)?)?`),l("XRANGE",`^${a[s.GTLT]}\\s*${a[s.XRANGEPLAIN]}$`),l("XRANGELOOSE",`^${a[s.GTLT]}\\s*${a[s.XRANGEPLAINLOOSE]}$`),l("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),l("COERCERTL",a[s.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM",`(\\s*)${a[s.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",l("TILDE",`^${a[s.LONETILDE]}${a[s.XRANGEPLAIN]}$`),l("TILDELOOSE",`^${a[s.LONETILDE]}${a[s.XRANGEPLAINLOOSE]}$`),l("LONECARET","(?:\\^)"),l("CARETTRIM",`(\\s*)${a[s.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",l("CARET",`^${a[s.LONECARET]}${a[s.XRANGEPLAIN]}$`),l("CARETLOOSE",`^${a[s.LONECARET]}${a[s.XRANGEPLAINLOOSE]}$`),l("COMPARATORLOOSE",`^${a[s.GTLT]}\\s*(${a[s.LOOSEPLAIN]})$|^$`),l("COMPARATOR",`^${a[s.GTLT]}\\s*(${a[s.FULLPLAIN]})$|^$`),l("COMPARATORTRIM",`(\\s*)${a[s.GTLT]}\\s*(${a[s.LOOSEPLAIN]}|${a[s.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE",`^\\s*(${a[s.XRANGEPLAIN]})\\s+-\\s+(${a[s.XRANGEPLAIN]})\\s*$`),l("HYPHENRANGELOOSE",`^\\s*(${a[s.XRANGEPLAINLOOSE]})\\s+-\\s+(${a[s.XRANGEPLAINLOOSE]})\\s*$`),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0.0.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},9903:(t,e,n)=>{const r=n(2416);t.exports=(t,e,n)=>r(t,e,">",n)},1413:(t,e,n)=>{const r=n(1540);t.exports=(t,e,n)=>(t=new r(t,n),e=new r(e,n),t.intersects(e))},1611:(t,e,n)=>{const r=n(2416);t.exports=(t,e,n)=>r(t,e,"<",n)},4600:(t,e,n)=>{const r=n(7800),i=n(1540);t.exports=(t,e,n)=>{let o=null,a=null,s=null;try{s=new i(e,n)}catch(t){return null}return t.forEach((t=>{s.test(t)&&(o&&-1!==a.compare(t)||(o=t,a=new r(o,n)))})),o}},142:(t,e,n)=>{const r=n(7800),i=n(1540);t.exports=(t,e,n)=>{let o=null,a=null,s=null;try{s=new i(e,n)}catch(t){return null}return t.forEach((t=>{s.test(t)&&(o&&1!==a.compare(t)||(o=t,a=new r(o,n)))})),o}},734:(t,e,n)=>{const r=n(7800),i=n(1540),o=n(3365);t.exports=(t,e)=>{t=new i(t,e);let n=new r("0.0.0");if(t.test(n))return n;if(n=new r("0.0.0-0"),t.test(n))return n;n=null;for(let e=0;e<t.set.length;++e){const i=t.set[e];let a=null;i.forEach((t=>{const e=new r(t.semver.version);switch(t.operator){case">":0===e.prerelease.length?e.patch++:e.prerelease.push(0),e.raw=e.format();case"":case">=":a&&!o(e,a)||(a=e);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${t.operator}`)}})),!a||n&&!o(n,a)||(n=a)}return n&&t.test(n)?n:null}},2416:(t,e,n)=>{const r=n(7800),i=n(4890),{ANY:o}=i,a=n(1540),s=n(826),u=n(3365),l=n(2687),c=n(6039),f=n(4457);t.exports=(t,e,n,h)=>{let d,p,g,m,y;switch(t=new r(t,h),e=new a(e,h),n){case">":d=u,p=c,g=l,m=">",y=">=";break;case"<":d=l,p=f,g=u,m="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(t,e,h))return!1;for(let n=0;n<e.set.length;++n){const r=e.set[n];let a=null,s=null;if(r.forEach((t=>{t.semver===o&&(t=new i(">=0.0.0")),a=a||t,s=s||t,d(t.semver,a.semver,h)?a=t:g(t.semver,s.semver,h)&&(s=t)})),a.operator===m||a.operator===y)return!1;if((!s.operator||s.operator===m)&&p(t,s.semver))return!1;if(s.operator===y&&g(t,s.semver))return!1}return!0}},9901:(t,e,n)=>{const r=n(826),i=n(6004);t.exports=(t,e,n)=>{const o=[];let a=null,s=null;const u=t.sort(((t,e)=>i(t,e,n)));for(const t of u)r(t,e,n)?(s=t,a||(a=t)):(s&&o.push([a,s]),s=null,a=null);a&&o.push([a,null]);const l=[];for(const[t,e]of o)t===e?l.push(t):e||t!==u[0]?e?t===u[0]?l.push(`<=${e}`):l.push(`${t} - ${e}`):l.push(`>=${t}`):l.push("*");const c=l.join(" || "),f="string"==typeof e.raw?e.raw:String(e);return c.length<f.length?c:e}},2792:(t,e,n)=>{const r=n(1540),i=n(4890),{ANY:o}=i,a=n(826),s=n(6004),u=(t,e,n)=>{if(t===e)return!0;if(1===t.length&&t[0].semver===o){if(1===e.length&&e[0].semver===o)return!0;t=n.includePrerelease?[new i(">=0.0.0-0")]:[new i(">=0.0.0")]}if(1===e.length&&e[0].semver===o){if(n.includePrerelease)return!0;e=[new i(">=0.0.0")]}const r=new Set;let u,f,h,d,p,g,m;for(const e of t)">"===e.operator||">="===e.operator?u=l(u,e,n):"<"===e.operator||"<="===e.operator?f=c(f,e,n):r.add(e.semver);if(r.size>1)return null;if(u&&f){if(h=s(u.semver,f.semver,n),h>0)return null;if(0===h&&(">="!==u.operator||"<="!==f.operator))return null}for(const t of r){if(u&&!a(t,String(u),n))return null;if(f&&!a(t,String(f),n))return null;for(const r of e)if(!a(t,String(r),n))return!1;return!0}let y=!(!f||n.includePrerelease||!f.semver.prerelease.length)&&f.semver,v=!(!u||n.includePrerelease||!u.semver.prerelease.length)&&u.semver;y&&1===y.prerelease.length&&"<"===f.operator&&0===y.prerelease[0]&&(y=!1);for(const t of e){if(m=m||">"===t.operator||">="===t.operator,g=g||"<"===t.operator||"<="===t.operator,u)if(v&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===v.major&&t.semver.minor===v.minor&&t.semver.patch===v.patch&&(v=!1),">"===t.operator||">="===t.operator){if(d=l(u,t,n),d===t&&d!==u)return!1}else if(">="===u.operator&&!a(u.semver,String(t),n))return!1;if(f)if(y&&t.semver.prerelease&&t.semver.prerelease.length&&t.semver.major===y.major&&t.semver.minor===y.minor&&t.semver.patch===y.patch&&(y=!1),"<"===t.operator||"<="===t.operator){if(p=c(f,t,n),p===t&&p!==f)return!1}else if("<="===f.operator&&!a(f.semver,String(t),n))return!1;if(!t.operator&&(f||u)&&0!==h)return!1}return!(u&&g&&!f&&0!==h||f&&m&&!u&&0!==h||v||y)},l=(t,e,n)=>{if(!t)return e;const r=s(t.semver,e.semver,n);return r>0?t:r<0||">"===e.operator&&">="===t.operator?e:t},c=(t,e,n)=>{if(!t)return e;const r=s(t.semver,e.semver,n);return r<0?t:r>0||"<"===e.operator&&"<="===t.operator?e:t};t.exports=(t,e,n={})=>{if(t===e)return!0;t=new r(t,n),e=new r(e,n);let i=!1;t:for(const r of t.set){for(const t of e.set){const e=u(r,t,n);if(i=i||null!==e,e)continue t}if(i)return!1}return!0}},434:(t,e,n)=>{const r=n(1540);t.exports=(t,e)=>new r(t,e).set.map((t=>t.map((t=>t.value)).join(" ").trim().split(" ")))},2617:(t,e,n)=>{const r=n(1540);t.exports=(t,e)=>{try{return new r(t,e).range||"*"}catch(t){return null}}},9602:t=>{"use strict";t.exports=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}},4411:(t,e,n)=>{"use strict";function r(t){var e=this;if(e instanceof r||(e=new r),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach((function(t){e.push(t)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}function i(t,e,n){var r=e===t.head?new s(n,null,e,t):new s(n,e,e.next,t);return null===r.next&&(t.tail=r),null===r.prev&&(t.head=r),t.length++,r}function o(t,e){t.tail=new s(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function a(t,e){t.head=new s(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function s(t,e,n,r){if(!(this instanceof s))return new s(t,e,n,r);this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}t.exports=r,r.Node=s,r.create=r,r.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e},r.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},r.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},r.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)o(this,arguments[t]);return this.length},r.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)a(this,arguments[t]);return this.length},r.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},r.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},r.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,r=0;null!==n;r++)t.call(e,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,r=this.length-1;null!==n;r--)t.call(e,n.value,r,this),n=n.prev},r.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},r.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},r.prototype.map=function(t,e){e=e||this;for(var n=new r,i=this.head;null!==i;)n.push(t.call(e,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(t,e){e=e||this;for(var n=new r,i=this.tail;null!==i;)n.push(t.call(e,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(t,e){var n,r=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=t(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(t,e){var n,r=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=t(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},r.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},r.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,o=this.head;null!==o&&i<t;i++)o=o.next;for(;null!==o&&i<e;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,o=this.tail;null!==o&&i>e;i--)o=o.prev;for(;null!==o&&i>t;i--,o=o.prev)n.push(o.value);return n},r.prototype.splice=function(t,e,...n){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var r=0,o=this.head;null!==o&&r<t;r++)o=o.next;var a=[];for(r=0;o&&r<e;r++)a.push(o.value),o=this.removeNode(o);for(null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev),r=0;r<n.length;r++)o=i(this,o,n[r]);return a},r.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=e,this.tail=t,this};try{n(9602)(r)}catch(t){}},5410:()=>{},8628:()=>{},5042:()=>{}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),n(5590)})()}));
//# sourceMappingURL=tfjs-vis.umd.min.js.map